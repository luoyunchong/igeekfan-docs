<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh-CN">
  <id>https://igeekfan.cn/igeekfan-docs/</id>
  <title>IGeekFançš„æ–‡æ¡£</title>
  <subtitle>IGeekFan Documents</subtitle>
  <updated>2022-06-02T13:21:24.274Z</updated>
  <generator>vuepress-plugin-feed2</generator>
  <link rel="self" href="https://igeekfan.cn/igeekfan-docs/atom.xml"/>
  <link rel="alternate" href="https://igeekfan.cn/igeekfan-docs/"/>
  <category term="lin-cms-dotnetcore"/>
  <entry>
    <title type="html">Blogsåˆ†äº«</title>
    <id>https://igeekfan.cn/igeekfan-docs/blogs/</id>
    <link href="https://igeekfan.cn/igeekfan-docs/blogs/"/>
    <updated>2022-01-07T10:07:15.000Z</updated>
    <content type="html"><![CDATA[<h1 id="blogsåˆ†äº«" tabindex="-1"> Blogsåˆ†äº«</h1>
]]></content>
    <published>2022-01-07T10:07:15.000Z</published>
  </entry>
  <entry>
    <title type="html">git emoji</title>
    <id>https://igeekfan.cn/igeekfan-docs/blogs/git-emoji.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/blogs/git-emoji.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="git-emoji" tabindex="-1"> git emoji</h1>
<table>
<thead>
<tr>
<th>emoji å›¾æ ‡</th>
<th>emoji</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ¨(è°ƒè‰²æ¿)</td>
<td><code>:art:</code></td>
<td>æ”¹è¿›ä»£ç ç»“æ„/ä»£ç æ ¼å¼</td>
</tr>
<tr>
<td>âš¡ï¸ (é—ªç”µ)</td>
<td><code>:zap:</code></td>
<td>æå‡æ€§èƒ½</td>
</tr>
<tr>
<td>ğŸ (èµ›é©¬)</td>
<td><code>:racehorse:</code></td>
<td>æå‡æ€§èƒ½</td>
</tr>
<tr>
<td>ğŸ”¥ (ç«ç„°)</td>
<td><code>:fire:</code></td>
<td>ç§»é™¤ä»£ç æˆ–æ–‡ä»¶</td>
</tr>
<tr>
<td>ğŸ› (bug)</td>
<td><code>:bug: </code></td>
<td>ä¿®å¤ bug</td>
</tr>
<tr>
<td>ğŸš‘ (æ€¥æ•‘è½¦)</td>
<td><code>:ambulance:</code></td>
<td>é‡è¦è¡¥ä¸</td>
</tr>
<tr>
<td>âœ¨ (ç«èŠ±)</td>
<td><code>:sparkles:</code></td>
<td>å¼•å…¥æ–°åŠŸèƒ½</td>
</tr>
<tr>
<td>ğŸ“ (å¤‡å¿˜å½•)</td>
<td><code>:memo: </code></td>
<td>æ’°å†™æ–‡æ¡£</td>
</tr>
<tr>
<td>ğŸš€ (ç«ç®­)</td>
<td><code>:rocket: </code></td>
<td>éƒ¨ç½²åŠŸèƒ½</td>
</tr>
<tr>
<td>ğŸ’„ (å£çº¢)</td>
<td><code>:lipstick:</code></td>
<td>æ›´æ–° UI å’Œæ ·å¼æ–‡ä»¶</td>
</tr>
<tr>
<td>ğŸ‰ (åº†ç¥)</td>
<td><code>:tada:</code></td>
<td>åˆæ¬¡æäº¤</td>
</tr>
<tr>
<td>âœ… (ç™½è‰²å¤é€‰æ¡†)</td>
<td><code>:white_check_mark:</code></td>
<td>æ›´æ–°æµ‹è¯•</td>
</tr>
<tr>
<td>ğŸ”’ (é”)</td>
<td><code>:lock:</code></td>
<td>ä¿®å¤å®‰å…¨é—®é¢˜</td>
</tr>
<tr>
<td>ğŸ (è‹¹æœ)</td>
<td><code>:apple:</code></td>
<td>ä¿®å¤ macOS ä¸‹çš„é—®é¢˜</td>
</tr>
<tr>
<td>ğŸ§ (ä¼é¹…)</td>
<td><code>:penguin:</code></td>
<td>ä¿®å¤ Linux ä¸‹çš„é—®é¢˜</td>
</tr>
<tr>
<td>ğŸ (æ——å¸œ)</td>
<td><code>:checkered_flag:</code></td>
<td>ä¿®å¤ Windows ä¸‹çš„é—®é¢˜</td>
</tr>
<tr>
<td>ğŸ¤–ï¼ˆæœºå™¨äººï¼‰</td>
<td><code>:robot:</code></td>
<td>ä¿®å¤ Android ä¸‹çš„é—®é¢˜</td>
</tr>
<tr>
<td>ğŸ (ç»¿è‹¹æœ)</td>
<td><code>:green_apple:</code></td>
<td>ä¿®å¤ iOS ä¸‹çš„é—®é¢˜</td>
</tr>
<tr>
<td>ğŸ”– (ä¹¦ç­¾)</td>
<td><code>:bookmark:</code></td>
<td>å‘è¡Œ/ç‰ˆæœ¬æ ‡ç­¾</td>
</tr>
<tr>
<td>ğŸš¨ (è­¦è½¦ç¯)</td>
<td><code>:rotating_light:</code></td>
<td>ç§»é™¤ linter è­¦å‘Š</td>
</tr>
<tr>
<td>ğŸš§ (æ–½å·¥)</td>
<td><code>:construction:</code></td>
<td>å·¥ä½œè¿›è¡Œä¸­</td>
</tr>
<tr>
<td>ğŸ‘· (å·¥äºº)</td>
<td><code>:construction_worker:</code></td>
<td>æ·»åŠ  CI æ„å»ºç³»ç»Ÿ</td>
</tr>
<tr>
<td>ğŸ’š (ç»¿å¿ƒ)</td>
<td><code>:green_heart:</code></td>
<td>ä¿®å¤ CI æ„å»ºé—®é¢˜</td>
</tr>
<tr>
<td>â¬†ï¸ (ä¸Šå‡ç®­å¤´)</td>
<td><code> :arrow_up:</code></td>
<td>å‡çº§ä¾èµ–</td>
</tr>
<tr>
<td>â¬‡ï¸ (ä¸‹é™ç®­å¤´)</td>
<td><code> :arrow_down:</code></td>
<td>é™çº§ä¾èµ–</td>
</tr>
<tr>
<td>ğŸ“Œ (å›¾é’‰)</td>
<td><code>:pushpin: </code></td>
<td>å°†ä¾èµ–é¡¹å›ºå®šåˆ°ç‰¹å®šç‰ˆæœ¬</td>
</tr>
<tr>
<td>ğŸ“ˆ (ä¸Šå‡è¶‹åŠ¿å›¾)</td>
<td><code>:chart_with_upwards_trend:</code></td>
<td>æ·»åŠ åˆ†ææˆ–è·Ÿè¸ªä»£ç </td>
</tr>
<tr>
<td>â™»ï¸ ï¼ˆå›æ”¶ï¼‰</td>
<td><code>:recycle:</code></td>
<td>é‡æ„ä»£ç </td>
</tr>
<tr>
<td>ğŸ³ (é²¸é±¼)</td>
<td><code>:whale:</code></td>
<td>Docker ç›¸å…³å·¥ä½œ</td>
</tr>
<tr>
<td>ğŸŒ (å¸¦å­åˆçº¿çš„åœ°çƒä»ª)</td>
<td><code>:globe_with_meridians:</code></td>
<td>å›½é™…åŒ–ä¸æœ¬åœ°åŒ–</td>
</tr>
<tr>
<td>â• (åŠ å·)</td>
<td><code>:heavy_plus_sign: </code></td>
<td>å¢åŠ ä¸€ä¸ªä¾èµ–</td>
</tr>
<tr>
<td>â– (å‡å·)</td>
<td><code>:heavy_minus_sign:</code></td>
<td>å‡å°‘ä¸€ä¸ªä¾èµ–</td>
</tr>
<tr>
<td>ğŸ”§ (æ‰³æ‰‹)</td>
<td><code>:wrench:</code></td>
<td>ä¿®æ”¹é…ç½®æ–‡ä»¶</td>
</tr>
<tr>
<td>ğŸ”¨ (é”¤å­)</td>
<td><code>:hammer:</code></td>
<td>é‡å¤§é‡æ„</td>
</tr>
<tr>
<td>âœï¸ (é“…ç¬”)</td>
<td><code>:pencil2:</code></td>
<td>ä¿®å¤ typo</td>
</tr>
<tr>
<td>ğŸ’© (ç²‘ç²‘â€¦)</td>
<td><code>:poop:</code></td>
<td>å†™äº†è¾£é¸¡ä»£ç éœ€è¦ä¼˜åŒ–</td>
</tr>
<tr>
<td>âª (å€’å¸¦)</td>
<td><code>:rewind:</code></td>
<td>æ¢å¤æ›´æ”¹</td>
</tr>
<tr>
<td>ğŸ”€ (äº¤å‰å‘å³çš„ç®­å¤´)</td>
<td><code>:twisted_rightwards_arrows:</code></td>
<td>åˆå¹¶åˆ†æ”¯</td>
</tr>
<tr>
<td>ğŸ“¦ (åŒ…è£¹)</td>
<td><code>:package:</code></td>
<td>æ›´æ–°ç¼–è¯‘çš„æ–‡ä»¶æˆ–åŒ…</td>
</tr>
<tr>
<td>ğŸ‘½ (å¤–æ˜Ÿäºº)</td>
<td><code>:alien:</code></td>
<td>ç”±äºå¤–éƒ¨ API æ›´æ”¹è€Œæ›´æ–°ä»£ç </td>
</tr>
<tr>
<td>ğŸšš (è´§è½¦)</td>
<td><code>:truck:</code></td>
<td>ç§»åŠ¨æˆ–è€…é‡å‘½åæ–‡ä»¶</td>
</tr>
<tr>
<td>ğŸ“„ (æ­£é¢æœä¸Šçš„é¡µé¢)</td>
<td><code>:page_facing_up:</code></td>
<td>å¢åŠ æˆ–æ›´æ–°è®¸å¯è¯ä¹¦</td>
</tr>
<tr>
<td>ğŸ’¥ (çˆ†ç‚¸)</td>
<td><code>:boom:</code></td>
<td>å¼•å…¥çªç ´æ€§çš„å˜åŒ–</td>
</tr>
<tr>
<td>ğŸ± (é“…ç¬”)</td>
<td><code>:bento:</code></td>
<td>å¢åŠ æˆ–æ›´æ–°èµ„æº</td>
</tr>
<tr>
<td>ğŸ‘Œ (OK æ‰‹åŠ¿)</td>
<td><code>:ok_hand:</code></td>
<td>ç”±äºä»£ç å®¡æŸ¥æ›´æ”¹è€Œæ›´æ–°ä»£ç </td>
</tr>
<tr>
<td>â™¿ï¸ (è½®æ¤…)</td>
<td><code>:wheelchair:</code></td>
<td>æ”¹å–„æ— éšœç¢äº¤äº’</td>
</tr>
<tr>
<td>ğŸ’¡ (ç¯æ³¡)</td>
<td><code>:bulb:</code></td>
<td>ç»™ä»£ç æ·»åŠ æ³¨é‡Š</td>
</tr>
<tr>
<td>ğŸ» (å•¤é…’)</td>
<td><code>:beers:</code></td>
<td>é†‰é†ºé†ºåœ°å†™ä»£ç â€¦</td>
</tr>
<tr>
<td>ğŸ’¬ (æ¶ˆæ¯æ°”æ³¡)</td>
<td><code>:speech_balloon:</code></td>
<td>æ›´æ–°æ–‡æœ¬æ–‡æ¡£</td>
</tr>
<tr>
<td>ğŸ—ƒ (å¡ç‰‡æ–‡ä»¶ç›’)</td>
<td><code>:card_file_box:</code></td>
<td>æ‰§è¡Œä¸æ•°æ®åº“ç›¸å…³çš„æ›´æ”¹</td>
</tr>
<tr>
<td>ğŸ”Š (éŸ³é‡å¤§)</td>
<td><code>:loud_sound:</code></td>
<td>å¢åŠ æ—¥å¿—</td>
</tr>
<tr>
<td>ğŸ”‡ (é™éŸ³)</td>
<td><code>:mute:</code></td>
<td>ç§»é™¤æ—¥å¿—</td>
</tr>
<tr>
<td>ğŸ‘¥ (è½®å»“ä¸­çš„åŠèº«åƒ)</td>
<td><code>:busts_in_silhouette:</code></td>
<td>å¢åŠ è´¡çŒ®è€…</td>
</tr>
<tr>
<td>ğŸš¸ (å­©ç«¥é€šè¡Œ)</td>
<td><code>:children_crossing:</code></td>
<td>ä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€å¯ç”¨æ€§</td>
</tr>
<tr>
<td>ğŸ— (å»ºç­‘å»ºé€ )</td>
<td><code>:building_construction:</code></td>
<td>ç»“æ„å˜åŠ¨</td>
</tr>
<tr>
<td>ğŸ“± (iPhone)</td>
<td><code>:iphone:</code></td>
<td>åšå“åº”å¼è®¾è®¡</td>
</tr>
<tr>
<td>ğŸ¤¡ (å°ä¸‘è„¸)</td>
<td><code>:clown_face:</code></td>
<td>å˜²å¼„äº‹ç‰©ï¼ˆç›´è¯‘ï¼Œè¿™ä¸ªæ²¡æ˜ç™½ï¼‰</td>
</tr>
<tr>
<td>ğŸ¥š (é¸¡è›‹)</td>
<td><code>:egg: </code></td>
<td>å¢åŠ å½©è›‹</td>
</tr>
<tr>
<td>ğŸ™ˆ (çœ‹ä¸è§é‚ªæ¶)</td>
<td><code>:see_no_evil:</code></td>
<td>å¢åŠ æˆ–æ›´æ”¹ gitignore</td>
</tr>
<tr>
<td>ğŸ“¸ (ç…§ç›¸æœºé—ªå…‰ç¯)</td>
<td><code>:camera_flash:</code></td>
<td>å¢åŠ æˆ–æ›´æ–°æˆªå›¾</td>
</tr>
<tr>
<td>âš—ï¸ (è’¸é¦å™¨)</td>
<td><code>:alembic:</code></td>
<td>å°è¯•æ–°ä¸œè¥¿</td>
</tr>
<tr>
<td>ğŸ” (æ”¾å¤§é•œ)</td>
<td><code>:mag: </code></td>
<td>SEO ä¼˜åŒ–</td>
</tr>
<tr>
<td>â˜¸ï¸ (èˆ¹çš„æ–¹å‘ç›˜)</td>
<td><code>:wheel_of_dharma: </code></td>
<td>å…³äº Kubernetes çš„å·¥ä½œ</td>
</tr>
<tr>
<td>ğŸ· (æ ‡ç­¾)</td>
<td><code>:label:</code></td>
<td>å¢åŠ ç±»å‹ï¼ˆFLowã€Typescript</td>
</tr>
</tbody>
</table>
]]></content>
    <published>2022-01-07T10:07:15.000Z</published>
  </entry>
  <entry>
    <title type="html">.NET ç¼–ç çš„åŸºç¡€çŸ¥è¯†</title>
    <id>https://igeekfan.cn/igeekfan-docs/blogs/net-encoded-1.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/blogs/net-encoded-1.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="net-ç¼–ç çš„åŸºç¡€çŸ¥è¯†" tabindex="-1"> .NET ç¼–ç çš„åŸºç¡€çŸ¥è¯†</h1>
<p>.NET ç¼–ç çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µå’Œåˆ†æ</p>
<h3 id="ç®€å•çš„ç±»å‹æ¦‚å¿µ" tabindex="-1"> ç®€å•çš„ç±»å‹æ¦‚å¿µ</h3>
<ul>
<li>Hex ï¼ˆ16 è¿›åˆ¶ï¼‰</li>
<li>byte å­—èŠ‚ èŒƒå›´æ˜¯ï¼š<code>0~255</code>ï¼ŒäºŒè¿›åˆ¶ä¸‹çš„èŒƒå›´å°±æ˜¯<code>00000000~11111111</code>ï¼Œç›¸å½“äº 1 å­—èŠ‚ã€‚</li>
<li>byte[] å­—èŠ‚æ•°ç»„</li>
<li>bit æ¯”ç‰¹ï¼Œåªæœ‰ 2 ç§çŠ¶æ€ï¼š0ï¼Œ1</li>
</ul>
<p><strong>1 å­—èŠ‚ ç­‰äº 8 æ¯”ç‰¹</strong> å³<strong>1byte=8bit</strong></p>
<p>åœ¨ c#ä¸­ã€‚Byte å³ byteï¼Œä»–æ˜¯ä¸€ä¸ª struct ç»“æ„ä½“ï¼Œ</p>
<p>b1 ç­‰äº b2.</p>
<div><pre><code><span><span>byte</span></span> b <span>=</span> <span>1</span><span>;</span>
<span><span>byte</span></span> b1 <span>=</span> <span>0xf</span><span>;</span><span>//ä»¥0xå¼€å¤´ å³16è¿›åˆ¶çš„å†™æ³•</span>
<span><span>byte</span></span> b2 <span>=</span> <span>15</span><span>;</span>
Assert<span>.</span><span>Equal</span><span>(</span>b1<span>,</span> b2<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>é”™è¯¯çš„è¯­æ³•</p>
<div><pre><code><span><span>byte</span></span> b3 <span>=</span> b1 <span>+</span> b2<span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æ­£ç¡®çš„è¯­æ³•</p>
<div><pre><code>byte b3 = (byte)(b1 + b2);
//æˆ–
int b4 = b1 + b2;
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>å› ä¸º byte çš„ç›¸äº’è¿ç®—å¤ªå®¹æ˜“å‘ç”Ÿæº¢å‡ºï¼Œ+ åŠ çš„é‡è½½ æ˜¯ int ç±»å‹ç›¸åŠ ï¼Œæ‰€ä»¥ç»“æœæ˜¯ int ç±»å‹</p>
<h3 id="encoding-utf8-getbytes" tabindex="-1"> Encoding.UTF8.GetBytes</h3>
<p>UTF8 æ˜¯ç»Ÿä¸€çš„ç¼–ç æ–¹å¼ï¼Œå®ƒæ˜¯ä¸€ç§å˜é•¿çš„ç¼–ç æ–¹å¼.å®ƒå¯ä»¥ä½¿ç”¨ 1~4 ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç¬¦å·ï¼Œæ ¹æ®ä¸åŒçš„ç¬¦å·è€Œå˜åŒ–å­—èŠ‚é•¿åº¦</p>
<div><pre><code>byte[] plaintext = Encoding.UTF8.GetBytes("0123456789");
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>èƒ½å¾—åˆ°ä»€ä¹ˆæ ·çš„æ•°æ®ï¼Œ<strong>48,49,50,51,52,53,54,55,56,57</strong>ã€‚ä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>æœ ASCII ç ï¼Œæˆ‘ä»¬å°±çŸ¥é“ <code>0</code>çš„ ASCII ç æ˜¯ <code>48</code></p>
<p>å¦‚æœæ˜¯å­—æ¯å‘¢ã€‚</p>
<div><pre><code>byte[] plaintext = Encoding.UTF8.GetBytes("ABCDabcd");
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>èƒ½å¾—åˆ°ä»€ä¹ˆæ ·çš„æ•°æ®ï¼Œ<strong>65,66,67,68,97,98,99,100</strong>ã€‚ä¸ºä»€ä¹ˆï¼Ÿè¿˜æ˜¯å› ä¸º ASCII ç ã€‚UTF8 å½“ç„¶æ˜¯å…¼å®¹ ASCII ç ã€‚</p>
<p>å› ä¸ºä¸€ä¸ª ASCII ç ï¼Œ1 ä¸ªå­—èŠ‚å°±èƒ½è¡¨ç¤º 256 ä¸ªçŠ¶æ€ï¼Œæ‰€ä»¥è‹±æ–‡å­—æ¯ï¼Œé˜¿æ‹‰ä¼¯æ•°å­—ï¼Œæ ‡ç‚¹ç¬¦å·éƒ½ä¸åœ¨è¯ï¼Œå“ªå¦‚æœæ˜¯ä¸­æ–‡å‘¢ã€‚è¿™é‡Œæˆ‘ä»¬å°±æ‹¿ UTF8 ç¼–ç æ¥åˆ†æã€‚</p>
<div><pre><code>byte[]   plaintext = Encoding.UTF8.GetBytes("ä¸­å›½");
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å¦‚ä¸‹å†…å®¹ï¼Œé•¿åº¦ä¸º 6ï¼Œ228ï¼Œ184ï¼Œ173 éƒ½æ˜¯åè¿›åˆ¶ã€‚å¦‚æœè½¬æˆ 16 è¿›åˆ¶å‘¢ã€‚<strong>e4ï¼Œb8ï¼Œad</strong>ï¼Œå¦‚æœåˆ†ä¸æ¸…åå…­è¿›åˆ¶ï¼Œå»ºè®®å­¦ä¸€ä¸‹ï¼Œè®¡ç®—æœºç³»ç»ŸåŸºç¡€ã€‚å½“ç„¶ï¼Œè¯´æ˜ä¸€ä¸‹ï¼Œ<code>a</code>ä»£è¡¨<code>10</code>ï¼Œ<code>e</code>å³ä»£è¡¨<code>14</code>.å³<code>14*16+4=228</code>.è¡¨ç¤ºæ—¶ä¸åŒºåˆ†å¤§å°å†™ï¼Œå³ç”¨å¤§å†™<code>A</code>ï¼Œå’Œå°å†™<code>a</code>éƒ½èƒ½è¡¨ç¤º<code>10</code></p>
<table>
<thead>
<tr>
<th>åˆ—</th>
<th>åè¿›åˆ¶</th>
<th>åå…­è¿›åˆ¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>228</td>
<td>e4</td>
</tr>
<tr>
<td>1</td>
<td>184</td>
<td>b8</td>
</tr>
<tr>
<td>2</td>
<td>173</td>
<td>ad</td>
</tr>
<tr>
<td>3</td>
<td>229</td>
<td>e5</td>
</tr>
<tr>
<td>4</td>
<td>155</td>
<td>9b</td>
</tr>
<tr>
<td>5</td>
<td>189</td>
<td>bd</td>
</tr>
</tbody>
</table>
<p>æˆ‘ä»¬ä»ç½‘ä¸Šæœä¸‹ï¼Œå¯ä»¥å‘ç° ä¸­å›½ çš„ UTF-8 ç¼–ç ï¼š <strong>E4B8AD E59BBD</strong>.è¯´æ˜é€šè¿‡<code>Encoding.UTF8.GetBytes</code>çš„ç»“æœè‚¯å®šæ˜¯å¯¹çš„ã€‚ä¸­æ–‡æ˜¯ç”¨ 3 æˆ– 4 ä¸ª Bytes å­˜å‚¨çš„ã€‚</p>
<h3 id="_1-byte-è½¬æ¢-hex-16-è¿›åˆ¶å­—ç¬¦ä¸²" tabindex="-1"> 1.byte[] è½¬æ¢ hex(16 è¿›åˆ¶å­—ç¬¦ä¸²)</h3>
<ol>
<li><code>Encoding.UTF8.GetBytes</code>èƒ½å¾—åˆ°æ•°æ®çš„åè¿›åˆ¶çš„å­—èŠ‚æ•°ç»„ã€‚</li>
<li><code>BitConverter.ToString</code>æ”¯æŒå°†åè¿›åˆ¶çš„æ•°æ®è½¬æ¢æˆ 16 è¿›åˆ¶ï¼Œä¸­é—´ä»¥<code>-</code>åˆ†éš”ï¼Œæ‰€ä»¥éœ€è¦å°†ä¸­é—´çš„<code>-</code> <code>Replace</code>æ‰</li>
</ol>
<div><pre><code>public string ByteToHex(string str)
{
    byte[] bytes = Encoding.UTF8.GetBytes(str);
    string hex = BitConverter.ToString(bytes, 0).Replace("-", string.Empty);
    return hex;
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p><code>hex</code>å¾—åˆ° çš„æ•°æ®å°±æ˜¯ <code>E4B8ADE59BBD</code></p>
<div><pre><code> <span><span>string</span></span> hex<span>=</span> <span>ByteToHex</span><span>(</span><span>"ä¸­å›½"</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h3 id="_2-byte-è½¬æ¢-hex-stringbuilder-æ–¹å¼" tabindex="-1"> 2.byte[] è½¬æ¢ hex:StringBuilder æ–¹å¼</h3>
<p>å¦‚ä¸‹å†…å®¹ä¸ºä»€ä¹ˆèƒ½å°†æ•°æ®è½¬æˆ 16 è¿›åˆ¶.</p>
<ol>
<li><code>Encoding.UTF8.GetBytes</code>èƒ½å¾—åˆ°æ•°æ®çš„åè¿›åˆ¶çš„å­—èŠ‚æ•°ç»„ã€‚</li>
<li>åˆ©ç”¨ c#ä¸­çš„ <strong><a href="https://docs.microsoft.com/zh-cn/dotnet/standard/base-types/composite-formatting" target="_blank" rel="noopener noreferrer">å¤åˆæ ¼å¼åŒ–ç‰¹æ€§</a></strong> {0:X2}è‡ªåŠ¨è½¬æ¢æˆ 16 è¿›åˆ¶ã€‚åŒæ ·å†…å®¹æ”¯æŒ Console.WriteLine ç­‰</li>
</ol>
<div><pre><code><span>public</span> <span><span>string</span></span> <span>ByteToHex2</span><span>(</span><span><span>string</span></span> str<span>)</span>
<span>{</span>
    <span><span>byte</span><span>[</span><span>]</span></span> bytes <span>=</span> Encoding<span>.</span>UTF8<span>.</span><span>GetBytes</span><span>(</span>str<span>)</span><span>;</span>
    <span>StringBuilder</span> ret <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span>
    <span>foreach</span> <span>(</span><span><span>byte</span></span> b <span>in</span> bytes<span>)</span>
    <span>{</span>
        <span>//{0:x2} å°å†™</span>
        ret<span>.</span><span>AppendFormat</span><span>(</span><span>"{0:X2}"</span><span>,</span> b<span>)</span><span>;</span>
    <span>}</span>
    <span>return</span> ret<span>.</span><span>ToString</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h3 id="hex-16-è¿›åˆ¶å­—ç¬¦ä¸²-è½¬æ¢-byte" tabindex="-1"> hex(16 è¿›åˆ¶å­—ç¬¦ä¸²)è½¬æ¢ byte[]</h3>
<ol>
<li>ä¸€ä¸ªå¾ªç¯å°† 16 è¿›åˆ¶è½¬æ¢æˆ 10 è¿›åˆ¶ã€‚</li>
</ol>
<div><pre><code><span>public</span> <span><span>byte</span><span>[</span><span>]</span></span> <span>HexToByte</span><span>(</span><span><span>string</span></span> hex<span>)</span>
<span>{</span>
    <span><span>byte</span><span>[</span><span>]</span></span> inputByteArray <span>=</span> <span>new</span> <span><span>byte</span></span><span>[</span>hex<span>.</span>Length <span>/</span> <span>2</span><span>]</span><span>;</span>
    <span>for</span> <span>(</span><span><span>var</span></span> x <span>=</span> <span>0</span><span>;</span> x <span>&lt;</span> inputByteArray<span>.</span>Length<span>;</span> x<span>++</span><span>)</span>
    <span>{</span>
        <span><span>var</span></span> i <span>=</span> Convert<span>.</span><span>ToInt32</span><span>(</span>hex<span>.</span><span>Substring</span><span>(</span>x <span>*</span> <span>2</span><span>,</span> <span>2</span><span>)</span><span>,</span> <span>16</span><span>)</span><span>;</span>
        inputByteArray<span>[</span>x<span>]</span> <span>=</span> <span>(</span><span>byte</span><span>)</span>i<span>;</span>
    <span>}</span>
    <span>return</span> inputByteArray<span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><p>è°ƒç”¨å¦‚ä¸‹å†…å®¹ï¼Œbytes[]ä¸­çš„é•¿åº¦ä¸º 6ï¼Œæ•°æ®æ˜¯ 228ï¼Œ184ï¼Œ173ã€229ï¼Œ155ï¼Œ189ã€‚å³ä¸Šæ–‡ä¸­çš„ä¸­å›½çš„åè¿›åˆ¶ byte æ•°ç»„</p>
<div><pre><code><span><span>string</span></span> hexChinese <span>=</span> <span>"E4B8ADE59BBD"</span><span>;</span><span>//ä¸­å›½çš„UTF8ç¼–ç ã€‚åå…­è¿›åˆ¶ã€‚</span>
<span><span>byte</span><span>[</span><span>]</span></span> bytes <span>=</span> <span>HexToByte</span><span>(</span>hexChinese<span>)</span><span>;</span>
<span><span>string</span></span> text <span>=</span> Encoding<span>.</span>UTF8<span>.</span><span>GetString</span><span>(</span>bytes<span>)</span><span>;</span><span>// `ä¸­å›½`</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div>]]></content>
    <published>2022-01-07T10:07:15.000Z</published>
  </entry>
  <entry>
    <title type="html">.NET+Sqlite å¦‚ä½•æ”¯æŒåŠ å¯†</title>
    <id>https://igeekfan.cn/igeekfan-docs/blogs/net-sqlite-encryption.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/blogs/net-sqlite-encryption.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="net-sqlite-å¦‚ä½•æ”¯æŒåŠ å¯†" tabindex="-1"> .NET+Sqlite å¦‚ä½•æ”¯æŒåŠ å¯†</h1>
<h2 id="ç›¸å…³æ–‡ç« " tabindex="-1"> ç›¸å…³æ–‡ç« </h2>
<ul>
<li><a href="https://www.cnblogs.com/igeekfan/p/freesql-sqlitecore-SQLCipher.html" target="_blank" rel="noopener noreferrer">FreeSql.Provider.SqliteCore å¦‚ä½•åŠ å¯†</a></li>
</ul>
<h2 id="sqlite" tabindex="-1"> Sqlite</h2>
<p><code>SQLite</code> æ¥æºäºå…¬å…±é¢†åŸŸ <code>SQLite Is Public Domain</code>ã€
ç¡®ä¿ä»£ç ä¸ä¼šå—åˆ°ä»»ä½•ä¸“æœ‰æˆ–è®¸å¯å†…å®¹çš„æ±¡æŸ“ï¼Œæ²¡æœ‰ä»»ä½•æ¥è‡ªäº’è”ç½‘ä¸Šçš„æœªçŸ¥æ¥æºå¤åˆ¶ã€‚å³å…¨æ˜¯åŸåˆ›çš„ã€‚</p>
<p>è™½ç„¶æ˜¯å…è´¹çš„ï¼Œæ— éœ€è®¸å¯è¯ï¼Œå¯ç”¨äºä»»ä½•ç›®çš„ï¼Œä½†å¦‚æœä½ çš„å…¬å¸å¿…é¡»è¦ä¸€ä¸ªè®¸å¯è¯ï¼Œä½ ä¹Ÿèƒ½ç”³è¯·æˆæƒ<a href="https://sqlite.org/purchase/license" target="_blank" rel="noopener noreferrer">https://sqlite.org/purchase/license</a>.</p>
<p>ä½†ä¸æ”¯æŒ<strong>åŠ å¯†</strong>ã€‚å¦‚æœæƒ³æ”¯æŒç™»å½•åŠ å¯†ï¼Œéœ€è¦å¦å¤–çš„æ‰©å±•<strong>SQLite åŠ å¯†æ‰©å±•(SQLite Encryption Extension,)</strong>ï¼Œå…·æœ‰è¯»å–/å†™å…¥ AES åŠ å¯†æ•°æ®åº“çš„é™„åŠ åŠŸèƒ½ã€‚å…·ä½“æˆæƒå¯å‚è€ƒ <a href="https://www.sqlite.org/prosupport.html" target="_blank" rel="noopener noreferrer">https://www.sqlite.org/prosupport.html</a></p>
<h2 id="sqlite-åŠ å¯†" tabindex="-1"> Sqlite åŠ å¯†</h2>
<p>ä¸€ç›´ä»¥æ¥ï¼Œ<code>FreeSql</code>å¼€å‘ç¾¤ä¸­ï¼Œæ€»ä¼šæœ‰ä¸€äº›å¼€å‘è€…æ¥è¯¢é—®<code>Sqlite</code>åŠ å¯†çš„é—®é¢˜ï¼Œäº‹å®ä¸Šï¼Œå®˜æ–¹æä¾›çš„ Sqlite åŠ å¯†åŠŸèƒ½æ˜¯æ”¶è´¹çš„ã€‚å½“è¿æ¥ä¸²ä¸Šä½¿ç”¨<code>Password</code>æ—¶ï¼Œä¼šæç¤ºæˆæƒé—®é¢˜ã€‚
å¦‚æœåº•å±‚ä¾èµ–äº<code>System.Data.SQLite.Core</code>ï¼Œ</p>
<div><pre><code>Could not load file or assembly 'System.Data.SQLite.SEE.License,
Version=1.0.115.5, Culture=neutral, PublicKeyToken=433d9874d0bb98c5,
processorArchitecture=MSIL
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>å¦‚æœåº•å±‚ä¾èµ–äº<code>Microsoft.Data.Sqlite</code> ä¹Ÿä¼šæç¤º</p>
<div><pre><code>You specified a password in the connection string, but the native SQLite
library 'e_sqlite3' doesn't support encryption.
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h2 id="system-data-sqlite-core" tabindex="-1"> System.Data.SQLite.Core</h2>
<p>åˆ›å»ºä¸€ä¸ªæ§åˆ¶å°é¡¹ç›®,èµ·å <code>OvOv.SqliteSystemCore</code></p>
<div><pre><code>dotnet new console -n OvOv.SqliteSystemCore
<span>cd</span> OvOv.SqliteSystemCore
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>å®‰è£…åŒ…</p>
<div><pre><code>dotnet <span>add</span> package System.Data.SQLite.Core
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>ä½¿ç”¨<code>SQLiteConnection</code>åˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œä½¿ç”¨ Password æŒ‡å®šå¯†ç </p>
<div><pre><code><span>using</span> <span>System<span>.</span>Data<span>.</span>SQLite</span><span>;</span>

<span>static</span> <span><span>void</span></span> <span>Open</span><span>(</span><span>)</span>
<span>{</span>
    <span><span>string</span></span> baseConnectionString <span>=</span> <span>"Data Source=local.db"</span><span>;</span>
    <span><span>var</span></span> connectionString <span>=</span> <span>new</span> <span>SQLiteConnectionStringBuilder</span><span>(</span>baseConnectionString<span>)</span>
    <span>{</span>
        Password <span>=</span> <span>"123qwe"</span>
    <span>}</span><span>.</span><span>ToString</span><span>(</span><span>)</span><span>;</span>

    <span>using</span> <span>SQLiteConnection<span>?</span></span> connection <span>=</span> <span>new</span> <span>SQLiteConnection</span><span>(</span>connectionString<span>)</span><span>;</span>
    connection<span>.</span><span>Open</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
<span>Open</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><p>è¿è¡Œé¡¹ç›®</p>
<div><pre><code>dotnet run
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å°±ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ã€‚</p>
<div><pre><code>System.IO.FileNotFoundException:â€œCould not load file or assembly
'System.Data.SQLite.SEE.License, Version=1.0.115.5, Culture=neutral, PublicKeyToken=433d9874d0bb98c5, processorArchitecture=MSIL'.
ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶ã€‚â€
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><h2 id="microsoft-data-sqlite" tabindex="-1"> Microsoft.Data.Sqlite</h2>
<p>åˆ›å»ºä¸€ä¸ªæ§åˆ¶å°é¡¹ç›®,èµ·å <code>OvOv.SqliteMicrosoft</code></p>
<div><pre><code>dotnet new console -n OvOv.SqliteMicrosoft
<span>cd</span> OvOv.SqliteMicrosoft
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>å®‰è£…åŒ…</p>
<div><pre><code>dotnet <span>add</span> package Microsoft.Data.Sqlite
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>ä½¿ç”¨<code>SqliteConnection</code>åˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œä½¿ç”¨ Password æŒ‡å®šå¯†ç </p>
<div><pre><code><span>using</span> <span>Microsoft<span>.</span>Data<span>.</span>Sqlite</span><span>;</span>

<span>static</span> <span><span>void</span></span> <span>Open</span><span>(</span><span>)</span>
<span>{</span>
    <span><span>string</span></span> baseConnectionString <span>=</span> <span>"Data Source=local.db"</span><span>;</span>
    <span><span>var</span></span> connectionString <span>=</span> <span>new</span> <span>SqliteConnectionStringBuilder</span><span>(</span>baseConnectionString<span>)</span>
    <span>{</span>
        Mode <span>=</span> SqliteOpenMode<span>.</span>ReadWriteCreate<span>,</span>
        Password <span>=</span> <span>"123qwe"</span>
    <span>}</span><span>.</span><span>ToString</span><span>(</span><span>)</span><span>;</span>

    <span>using</span> <span>SqliteConnection<span>?</span></span> connection <span>=</span> <span>new</span> <span>SqliteConnection</span><span>(</span>connectionString<span>)</span><span>;</span>
    connection<span>.</span><span>Open</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>Open</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br></div></div><p>è¿è¡Œé¡¹ç›®</p>
<div><pre><code>dotnet run
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å°±ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ã€‚</p>
<div><pre><code>Unhandled exception. System.InvalidOperationException: You specified a password in the connection string,
but the native SQLite library
'e_sqlite3' doesn't support encryption. at Microsoft.Data.Sqlite.SqliteConnection.Open()
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>å…¶å®å¾®è½¯å·²ç»æä¾›äº†åŠ å¯†çš„æ–¹æ¡ˆã€‚</p>
<ul>
<li><a href="https://docs.microsoft.com/zh-cn/dotnet/standard/data/sqlite/encryption?tabs=netcore-cli" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/dotnet/standard/data/sqlite/encryption?tabs=netcore-cli</a></li>
</ul>
<div><pre><code>dotnet remove package Microsoft.Data.Sqlite
dotnet <span>add</span> package Microsoft.Data.Sqlite.Core
dotnet <span>add</span> package SQLitePCLRaw.bundle_e_sqlcipher
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>é‡æ–°è¿è¡Œé¡¹ç›® ï¼Œå°±ä¼šå‘ç°ï¼Œä»–æ­£å¸¸æ‰§è¡Œã€‚æ²¡æœ‰ä»»ä½•æŠ¥é”™ã€‚</p>
<p>æœ‰å…³ä½¿ç”¨ä¸åŒçš„æœ¬æœºåº“è¿›è¡ŒåŠ å¯†çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.microsoft.com/zh-cn/dotnet/standard/data/sqlite/custom-versions?tabs=netcore-cli" target="_blank" rel="noopener noreferrer">è‡ªå®šä¹‰ SQLite ç‰ˆæœ¬</a>ã€‚</p>
<p>æˆ‘ä»¬ä» è‡ªå®šä¹‰ SQLite ç‰ˆæœ¬ä¸Šå¯ä»¥çœ‹åˆ°ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸» <code>Microsoft.Data.Sqlite</code> åŒ…å¼•å…¥ <code>SQLitePCLRaw.bundle_e_sqlite3</code>ã€‚ è‹¥è¦ä½¿ç”¨ä¸åŒçš„æ†ç»‘ï¼Œè¯·æ”¹ä¸ºå®‰è£… <code>Microsoft.Data.Sqlite.Core</code> åŒ…ä»¥åŠè¦ä½¿ç”¨çš„æ†ç»‘åŒ…ã€‚</p>
<h4 id="sqlitepclraw-bundle-e-sqlcipher" tabindex="-1"> <code>SQLitePCLRaw.bundle_e_sqlcipher</code></h4>
<p>æä¾› SQLCipher çš„<strong>éå®˜æ–¹å¼€æ”¾æºä»£ç å†…éƒ¨ç‰ˆæœ¬</strong>ã€‚æ­¤ç‰ˆæœ¬æ”¯æŒ<strong>åŠ å¯†</strong>ã€‚</p>
<h3 id="ado-net-ä¿®æ”¹-sqlite-å¯†ç " tabindex="-1"> ADO.NET ä¿®æ”¹ Sqlite å¯†ç </h3>
<div><pre><code><span>static</span> <span><span>int</span></span> <span>UpdatePassword</span><span>(</span><span><span>string</span></span> oldPassword<span>,</span> <span><span>string</span></span> newPassword<span>)</span>
<span>{</span>
    <span><span>string</span></span> baseConnectionString <span>=</span> <span>"Data Source=local.db"</span><span>;</span>
    <span><span>var</span></span> connectionString <span>=</span> <span>new</span> <span>SqliteConnectionStringBuilder</span><span>(</span>baseConnectionString<span>)</span>
    <span>{</span>
        Mode <span>=</span> SqliteOpenMode<span>.</span>ReadWriteCreate<span>,</span>
        Password <span>=</span> oldPassword
    <span>}</span><span>.</span><span>ToString</span><span>(</span><span>)</span><span>;</span>

    <span>using</span> <span>(</span><span><span>var</span></span> connection <span>=</span> <span>new</span> <span>SqliteConnection</span><span>(</span>connectionString<span>)</span><span>)</span>
    <span>{</span>
        connection<span>.</span><span>Open</span><span>(</span><span>)</span><span>;</span>
        <span>using</span> <span>(</span><span><span>var</span></span> command <span>=</span> connection<span>.</span><span>CreateCommand</span><span>(</span><span>)</span><span>)</span>
        <span>{</span>
            command<span>.</span>CommandText <span>=</span> <span>"SELECT quote($newPassword);"</span><span>;</span>
            command<span>.</span>Parameters<span>.</span><span>AddWithValue</span><span>(</span><span>"$newPassword"</span><span>,</span> newPassword<span>)</span><span>;</span>
            <span><span>var</span></span> quotedNewPassword <span>=</span> command<span>.</span><span>ExecuteScalar</span><span>(</span><span>)</span> <span>as</span> <span><span>string</span></span><span>;</span>

            command<span>.</span>CommandText <span>=</span> <span>"PRAGMA rekey = "</span> <span>+</span> quotedNewPassword<span>;</span>
            command<span>.</span>Parameters<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
            <span><span>int</span></span> x <span>=</span> command<span>.</span><span>ExecuteNonQuery</span><span>(</span><span>)</span><span>;</span>
            <span>return</span> x<span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>

<span><span>string</span></span> oldPassword <span>=</span> <span>"123qwe"</span><span>;</span>
<span><span>string</span></span> newPassword <span>=</span> <span>"abcd"</span><span>;</span>
<span>UpdatePassword</span><span>(</span>oldPassword<span>,</span> newPassword<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br></div></div><h4 id="å®Œæ•´ä»£ç " tabindex="-1"> å®Œæ•´ä»£ç </h4>
<ul>
<li><a href="https://github.com/luoyunchong/dotnetcore-examples/blob/master/Database-Drivers/OvOv.SqliteMicrosoftCore/Program.cs" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/blob/master/Database-Drivers/OvOv.SqliteMicrosoftCore/Program.cs</a></li>
</ul>
]]></content>
    <published>2022-01-07T10:07:15.000Z</published>
  </entry>
  <entry>
    <title type="html">SerilogæŒ‡å—</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/serilog-tutorial.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/serilog-tutorial.html"/>
    <updated>2022-01-07T10:07:15.000Z</updated>
    <content type="html"><![CDATA[<h1 id="serilogæŒ‡å—" tabindex="-1"> SerilogæŒ‡å—</h1>
<ul>
<li>åŸæ–‡ï¼š<a href="https://blog.datalust.co/serilog-tutorial/#3eventsandlevels" target="_blank" rel="noopener noreferrer">https://blog.datalust.co/serilog-tutorial/#3eventsandlevels</a></li>
<li>github: <a href="https://github.com/serilog/serilog" target="_blank" rel="noopener noreferrer">https://github.com/serilog/serilog</a></li>
</ul>
<h3 id="_1-æ¦‚è¿°" tabindex="-1"> 1.æ¦‚è¿°</h3>
<p>serilogæ˜¯ä¸€ä¸ªå®Œå…¨ç»“æ„åŒ–äº‹ä»¶çš„ç®€å•.NETæ—¥å¿—è®°å½•</p>
<p><code>fully-structured</code>,ç»“æ„åŒ–</p>
<ul>
<li>æ”¯æŒå¤šç§Providerï¼Œå¯å°†æ—¥å¿—æ¨é€åˆ°ä¸åŒçš„ä¸­é—´ä»¶ï¼Œå¦‚æ–‡ä»¶ï¼Œæ•°æ®åº“(mysql,sql server,mariadbç­‰)</li>
</ul>
<h3 id="_2-hello-serilog" tabindex="-1"> 2. Hello, Serilog!</h3>
<p>è®©æˆ‘ä»¬ä»æœ€ç®€å•çš„å¼€å§‹ï¼Œè·Ÿéšä»¥ä¸‹æ•™ç¨‹ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªConsoleé¡¹ç›®ï¼Œé€‚ç”¨äº.NET FrameWork å’Œ.NET Coreã€‚</p>
<p><code>Serilog</code> é€šè¿‡ <code>NuGet</code>  åˆ†å‘åŒ…. è¯¥é¡¹ç›®ä»¥SerilogåŒ…ä¸ºæ ¸å¿ƒç»„ç»‡ï¼Œé…åˆè®¸å¤š <code>sinks</code>ï¼ˆæ¥æ”¶å™¨ï¼‰ (è¶…è¿‡ä¸Šç™¾!), ç”¨äºå°†äº‹ä»¶å†™å…¥ç»ˆç«¯,æ–‡ä»¶ï¼Œæ•°æ®åº“ï¼Œæ—¥å¿—æœåŠ¡å™¨çš„æ’ä»¶ä¸­ã€‚</p>
<p>æˆ‘ä»¬ä» <code>Serilog</code> å’Œ <code>Serilog.Sinks.Console</code>å¼€å§‹, ç¨åå†è®¨è®ºå…¶ä»–é€‰é¡¹:</p>
<div><pre><code>Install-Package Serilog
Install-Package Serilog.Sinks.Console
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>ä»¥ä¸‹æ˜¯ä¸–ç•Œä¸Šæœ€ç®€å•çš„ Serilog é…ç½®ï¼š</p>
<div><pre><code>using Serilog;

class Program
{
    public static void Main(string[] args)
    {
        using (var log = new LoggerConfiguration()
            .WriteTo.Console()
            .CreateLogger())
        {
            log.Information("Hello, Serilog!");
            log.Warning("Goodbye, Serilog.");
        }
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><p>æ˜ç¡®ä»¥ä¸‹å‡ ç‚¹</p>
<ul>
<li><code>LoggerConfiguration</code> ç±»æä¾› äº†ä¸€ä¸ªfluent æ¥å£ æ„å»ºä¸€ä¸ªæ—¥å¿—ç®¡é“</li>
<li><code>WriteTo.Console() </code> å°†ä¸€ä¸ªæ§åˆ¶å°æ¥æ”¶å™¨ æ·»åŠ åˆ°ç®¡é“ä¸­</li>
<li><code>CreateLogger()</code> é›†åˆæ„å»ºåä¼š è¿”å›ä¸€ä¸ª <code>Logger</code> å¯¹è±¡, ä»–å®ç°äº† <code>ILogger</code>çš„æ¥å£</li>
<li><code>Logger</code> æ¥å£ç»§æ‰¿ <code>IDisposable</code>, æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ <code>using</code> å—</li>
<li>æœ€å, <code>log.Information()</code> å’Œ <code>log.Warning()</code> é€šè¿‡loggerè®°å½•æ‰€æœ‰çš„å‘å‡ºçš„äº‹ä»¶</li>
</ul>
<p>è¿è¡Œç¨‹åº</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/261B46CA8E7E474D889CC2D6312BA39E?method=download&amp;shareKey=b47ca475a270339f81b8af4ba28a1954" alt="image" loading="lazy"></p>
<p>ç°åœ¨æœ€è¿«åˆ‡çš„é—®é¢˜æ˜¯: åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå…¶ä»–ç±»å¦‚ä½•å¾—åˆ°è¿™ä¸ªLogå¯¹è±¡? é™¤äº†é€šè¿‡å‚æ•°è¿›è¡Œä¼ é€’, æœ‰ä¸¤ç§å¯èƒ½æ€§</p>
<ul>
<li>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ <code>IoC</code> å®¹å™¨, ä½  å¯ä»¥ä½¿ç”¨ç»„ä»¶æ¥æ”¶<code>ILogger</code>å¯¹è±¡ï¼Œå³é€šè¿‡ <code>dependency injection</code>(ä¾èµ–æ³¨å…¥)<code> ILogger</code>çš„æ–¹å¼ä½¿ç”¨. åƒé›†æˆ <a href="https://github.com/nblumhardt/autofac-serilog-integration" target="_blank" rel="noopener noreferrer">AutofacSerilogIntegration</a>ç­‰åŒ…å³å¯ã€‚</li>
</ul>
<p>æˆ–è€…,ä½ å¯ä»¥æŠŠLoggerå­˜å‚¨åˆ°ä¸€ä¸ªå·²çŸ¥çš„ä½ç½®ä¸­;ä¸ºæ­¤ <code>Serilog</code>æœ‰ä¸€ä¸ªé™æ€æ—¥å¿—ç±»</p>
<div><pre><code>Log<span>.</span>Logger <span>=</span> <span>new</span> <span>LoggerConfiguration</span><span>(</span><span>)</span>
    <span>.</span>WriteTo<span>.</span><span>Console</span><span>(</span><span>)</span>
    <span>.</span><span>CreateLogger</span><span>(</span><span>)</span><span>;</span>

Log<span>.</span><span>Information</span><span>(</span><span>"Hello again, Serilog!"</span><span>)</span><span>;</span>

Log<span>.</span><span>CloseAndFlush</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p><code>Log</code> ç±»æä¾›äº†ä¸<code>ILogger</code>æ¥å£ç›¸åŒçš„æ‰€æœ‰æ–¹æ³•.ç”¨äºæ›¿æ¢ä½¿ç”¨using å—,æˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>Log.CloseAndFlush()</code>ï¼Œé‡ç½®<code>Serilog.Log.Logger</code>,å¹¶é‡Šæ”¾åŸæœ‰çš„èµ„æº</p>
<blockquote>
<p>ä½ å¯èƒ½é€‰æ‹©åŸºäº<code>ILogger</code>çš„æ³¨å…¥æ–¹å¼ä½¿ç”¨ï¼Œæˆ–ä½¿ç”¨é™æ€Logç±» -è¿™ç§é€‰æ‹©æ˜¯åŸºäºä¸ªäººå£å‘³å’Œçˆ±å¥½çš„é—®é¢˜. ä¸ºäº†ä¿æŒç®€å• æˆ‘ä»¬å°†åœ¨æ­¤æ•™ç¨‹ä¸­ä½¿ç”¨é™æ€æ—¥å¿—ç±»ã€‚</p>
</blockquote>
<h3 id="_3-äº‹ä»¶å’Œçº§åˆ«" tabindex="-1"> 3. äº‹ä»¶å’Œçº§åˆ«</h3>
<p>å¦‚æœä½¿ç”¨è¿‡<code>log4net</code>ç­‰è¾ƒæ—§çš„åº“ï¼Œåœ¨ä½¿<code>Serilog</code>æ—¶ï¼Œæ‚¨éœ€è¦åœ¨æ€ç»´æ–¹å¼ä¸Šåšçš„æœ€å¤§æ”¹å˜æ˜¯ä»æ—¥å¿—äº‹ä»¶è€Œä¸æ˜¯æ—¥å¿—æ¶ˆæ¯çš„è§’åº¦æ¥æ€è€ƒã€‚æ´»åŠ¨ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>è®°å½•äº‹ä»¶å‘ç”Ÿæ—¶çš„æ—¶é—´æˆ³</li>
<li>æè¿°ä½•æ—¶åº”æ•è·äº‹ä»¶çš„çº§åˆ«</li>
<li>è®°å½•äº‹ä»¶æ‰€ä»£è¡¨å†…å®¹çš„æ¶ˆæ¯</li>
<li>æè¿°äº‹ä»¶çš„å‘½åå±æ€§</li>
<li>å¯èƒ½æ˜¯ä¸€ä¸ªå¼‚å¸¸å¯¹è±¡</li>
</ul>
<p>æ‚¨å¯ä»¥å°†æ—¥å¿—äº‹ä»¶æ ¼å¼åŒ–ä¸ºæ§åˆ¶å°çš„å¯è¯»æ–‡æœ¬ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­çœ‹åˆ°çš„ï¼š</p>
<div><pre><code>11:33:01 [INF] Hello, Serilog!
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥å°†åŒä¸€äº‹ä»¶æ ¼å¼åŒ–ä¸ºJSONï¼Œå¹¶å°†å…¶å‘é€åˆ°è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨ï¼š</p>
<div><pre><code>{"@t":"2017-11-20T11:33:01.22138","@m":"Hello, Serilog!"}`
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>åœ¨å¹•åï¼Œåº”ç”¨ç¨‹åºä¸­çš„æ—¥å¿—è¯­å¥åˆ›å»ºLogEventå¯¹è±¡ï¼Œè€Œè¿æ¥åˆ°ç®¡é“çš„æ¥æ”¶å™¨åˆ™ç¡®å®šå¦‚ä½•è®°å½•å®ƒä»¬ã€‚</p>
<h3 id="logging-levels" tabindex="-1"> Logging levels</h3>
<p><code>Serilog</code>é€Ÿåº¦å¾ˆå¿«ï¼Œä½†å§‹ç»ˆæ„é€ å’Œè®°å½•è¯¦ç»†çš„æ—¥å¿—äº‹ä»¶å¯èƒ½ä¼šæµªè´¹CPUã€ç£ç›˜å’Œç½‘ç»œèµ„æºã€‚ä¸ºäº†ç®¡ç†è¿™ä¸€ç‚¹ï¼Œ<code>Serilog</code>äº‹ä»¶è¢«åˆ†é…äº†è°ƒè¯•ã€ä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯ç­‰çº§åˆ«ã€‚æ¯ä¸ªæ”¯æŒçš„çº§åˆ«éƒ½æœ‰ä¸€ä¸ª<code>Log.*ï¼ˆï¼‰</code>æ–¹æ³•ã€‚</p>
<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šæ‰“å¼€è°ƒè¯•çº§åˆ«äº‹ä»¶ï¼š</p>
<div><pre><code>Log.Logger = new LoggerConfiguration()
    .MinimumLevel.Debug() // &lt;- Set the minimum level
    .WriteTo.Console()
    .CreateLogger();

// In a tight loop...
Log.Debug("Processing item {ItemNumber} of {ItemCount}", itemNumber, itemCount);
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>åœ¨ç”Ÿäº§ä¸­ï¼Œé€šå¸¸å…³é—­è°ƒè¯•äº‹ä»¶å¹¶å°†æœ€ä½çº§åˆ«è®¾ç½®ä¸ºä¿¡æ¯ï¼Œä»¥ä¾¿åªè®°å½•é‡è¦äº‹ä»¶ã€‚é˜…è¯»æ–‡æ¡£ä¸­æœ‰å…³<code>Serilog</code>çº§åˆ«çš„<a href="https://github.com/serilog/serilog/wiki/Writing-Log-Events#log-event-levels" target="_blank" rel="noopener noreferrer">æ›´å¤šä¿¡æ¯</a>ã€‚</p>
<h3 id="_4-å‘é€å’Œæ”¶é›†ç»“æ„åŒ–æ•°æ®" tabindex="-1"> 4. å‘é€å’Œæ”¶é›†ç»“æ„åŒ–æ•°æ®</h3>
<div><pre><code>var itemNumber = 10;
var itemCount = 999;
Log.Debug("Processing item {ItemNumber} of {ItemCount}", itemNumber, itemCount);
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>æ‚¨æ³¨æ„åˆ°æ—¥å¿—æ¶ˆæ¯ä¸­çš„<code>{ItemNumber}</code>ä¹‹ç±»çš„å‘½åå ä½ç¬¦äº†å—ï¼Ÿè¿™ä¸æ˜¯C#æ’å€¼å­—ç¬¦ä¸²ï¼šLog.*ï¼ˆï¼‰æ–¹æ³•æ¥å—æ¶ˆæ¯æ¨¡æ¿ï¼Œè¿™æ˜¯.NETæ ¼å¼å­—ç¬¦ä¸²çš„ä¸€ç§å˜ä½“ï¼Œé™¤äº†é€šå¸¸çš„{0}ä½ç½®å­—ç¬¦ä¸²å¤–ï¼Œè¿˜æ”¯æŒ{Named}å ä½ç¬¦ã€‚</p>
<p>è¿™ä¼¼ä¹æœ‰ç‚¹å¥‡æ€ªï¼Œç›´åˆ°æ‚¨æ„è¯†åˆ°ï¼Œé€šè¿‡è¿™æ ·åšï¼Œ<code>Serilog</code>å¯ä»¥å°†æ¶ˆæ¯çš„ä¸€éƒ¨åˆ†ä½œä¸ºä¸€çº§å±æ€§ä¸äººæ€§åŒ–æ–‡æœ¬ä¸€èµ·æ•è·ï¼š</p>
<div><pre><code>{
    "@t": "2017-11-20T11:33:01.22138",
    "@l": "Debug",
    "@m": "Processing item 10 of 999",
    "ItemNumber": 10,
    "ItemCount": 999
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿç”±äºæ—¥å¿—äº‹ä»¶é™„å¸¦äº†ä¸€äº›æœ‰è¶£çš„å­—æ®µä½œä¸ºå±æ€§ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç«‹å³ä½¿ç”¨ç®€å•çš„è¿‡æ»¤å™¨ï¼ˆå¦‚<code>ItemNumber&gt;900</code>ï¼‰æ¥æŸ¥æ‰¾äº‹ä»¶ï¼Œè€Œä¸å¿…é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ä»æ¶ˆæ¯ä¸­æå–ä¿¡æ¯ã€‚</p>
<p>æ›´è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>@structure</code>æ•è·æ“ä½œç¬¦ä¸ä»…è·å–å¹³é¢å±æ€§å€¼ï¼Œè¿˜è·å–å®Œæ•´çš„å¯¹è±¡ï¼š</p>
<div><pre><code>var user = new { Name = "Nick", Id = "nblumhardt" };
Log.Information("Logged on user {@User}", user);
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>åœ¨è¿™é‡Œï¼Œç”¨æˆ·å¯¹è±¡è¢«æ•è·åˆ°ç”Ÿæˆçš„JSONä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¸å¦‚<code>user.Id='nblumhardt'</code>ä¹‹ç±»çš„æŸ¥è¯¢æ¥æŸ¥æ‰¾äº‹ä»¶ï¼š</p>
<div><pre><code>{
    "@t": "2017-11-20T11:33:01.22138",
    "@m": "Logged on user {\"Name\": \"Nick\", \"Id\": \"nblumhardt\"}",
    "User": {"Name": "Nick", "Id": "nblumhardt"}
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>ç”Ÿäº§ç›‘æ§å’Œè°ƒè¯•å·²ç»æ˜¯ä¸€é¡¹è‰°å·¨ã€è€—æ—¶ä¸”ç»å¸¸å……æ»¡å‹åŠ›çš„ä»»åŠ¡ï¼šé€šå¸¸è¿™äº›ç›¸å…³æ•°æ®è§¦æ‰‹å¯åŠï¼Œ<code>Serilog</code>æ¶ˆé™¤äº†ä¸æ“ä½œç›¸å…³ æ´»åŠ¨ä¸­æœ€å¤§çš„åˆ†æ­§ä¹‹ä¸€ã€‚</p>
<blockquote>
<p>æç¤ºï¼šä»<code>VisualStudioMarketplace</code>å®‰è£…äº†ä¸èµ·çš„<a href="https://marketplace.visualstudio.com/items?itemName=Suchiman.SerilogAnalyzer" target="_blank" rel="noopener noreferrer">Serilogåˆ†æå™¨</a>ï¼Œä»¥ä¾¿åœ¨é”®å…¥æ—¶æ£€æŸ¥æ¶ˆæ¯æ¨¡æ¿è¯­æ³•</p>
</blockquote>
<p>è¿™å®é™…ä¸Šä¼šäº§ç”Ÿå¤šå¤§çš„å·®å¼‚ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæ‚¨å¦‚ä½•ä»<code>Serilog</code>æ”¶é›†äº‹ä»¶ã€‚ä¼ ç»Ÿä¸Šï¼Œæ—¥å¿—äº‹ä»¶è¿›å…¥æ–‡æœ¬æ–‡ä»¶å¹¶ä½¿ç”¨<code>grep</code>è¿›è¡Œæœç´¢ã€‚<code>Serilog</code>ä¹Ÿå¯ä»¥è®°å½•æ–‡æœ¬æ–‡ä»¶ï¼Œä½†æ‚¨ä¸èƒ½åœ¨è®°äº‹æœ¬ä¸­æ‰§è¡Œ<code>ItemNumber&gt;900</code>ï¼Œå› æ­¤æ‚¨éœ€è¦è¯„ä¼°æ›´å¼ºå¤§çš„å·¥å…·æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<h2 id="å°†äº‹ä»¶å†™å…¥jsonæ—¥å¿—æ–‡ä»¶" tabindex="-1"> å°†äº‹ä»¶å†™å…¥JSONæ—¥å¿—æ–‡ä»¶</h2>
<p>å¦‚æœæ‚¨çš„éœ€æ±‚å¾ˆç®€å•ï¼Œå¯ä»¥å°†<code>JSON</code>å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨<code>JSON</code>æ„ŸçŸ¥å·¥å…·ç›´æ¥æŸ¥è¯¢æ–‡ä»¶ã€‚<code>Serilog</code>çš„æ–‡ä»¶æ¥æ”¶å™¨å’Œç´§å‡‘çš„<code>JSON</code>æ ¼å¼åŒ–ç¨‹åºä½¿ç¬¬ä¸€éƒ¨åˆ†å˜å¾—ç®€å•ã€‚è®©æˆ‘ä»¬å°è¯•å¦ä¸€ä¸ªå®‰è£…äº†ä»¥ä¸‹è½¯ä»¶åŒ…çš„å°å‹æ§åˆ¶å°åº”ç”¨ç¨‹åºï¼š</p>
<div><pre><code>Install-Package Serilog;
Install-Package Serilog.Sinks.File
Install-Package Serilog.Formatting.Compact
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>åœ¨Mainï¼ˆï¼‰æ–¹æ³•ä¸­ï¼š</p>
<div><pre><code>Log.Logger = new LoggerConfiguration()
    .MinimumLevel.Debug()
    .WriteTo.File(new CompactJsonFormatter(), "log.clef")
    .CreateLogger();

var itemCount = 99;
for (var itemNumber = 0; itemNumber &lt; itemCount; ++itemNumber)
    Log.Debug("Processing item {ItemNumber} of {ItemCount}", itemNumber, itemCount);

Log.CloseAndFlush();
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><p>è¿è¡Œæ­¤åº”ç”¨ç¨‹åºå°†ä½¿ç”¨<code>Serilog</code>çš„å‹ç¼©æ—¥å¿—äº‹ä»¶æ ¼å¼åœ¨<code>log.clef</code>ä¸­ç”Ÿæˆä¸€ä¸ª<a href="https://en.wikipedia.org/wiki/JSON_streaming" target="_blank" rel="noopener noreferrer">æ–°è¡Œåˆ†éš”çš„<code>JSON</code>æµ</a>ã€‚ï¼ˆå¦‚æœæ²¡æœ‰<code>CompactJsonFormatter</code>ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„å¹³é¢æ—¥å¿—æ–‡ä»¶ã€‚ï¼‰</p>
<p>å¦‚æœåœ¨æ–‡æœ¬ç¼–è¾‘å™¨ä¸­æ‰“å¼€è¯¥æ–‡ä»¶ï¼Œæ‚¨å°†çœ‹åˆ°JSONäº‹ä»¶ï¼Œå¦‚æˆ‘ä»¬ä¸Šé¢ä½¿ç”¨çš„ç¤ºä¾‹ã€‚</p>
<h3 id="å°†äº‹ä»¶å†™å…¥æ—¥å¿—æœåŠ¡å™¨" tabindex="-1"> å°†äº‹ä»¶å†™å…¥æ—¥å¿—æœåŠ¡å™¨</h3>
<div><pre><code>Install-Package Serilog.Sinks.Seq
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><div><pre><code>Log.Logger = new LoggerConfiguration()
    .MinimumLevel.Debug()
    .WriteTo.Seq("http://localhost:5341")
    .CreateLogger();
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h3 id="_5-æ ‡è®°ç”¨äºç­›é€‰å’Œå…³è”çš„äº‹ä»¶" tabindex="-1"> 5.æ ‡è®°ç”¨äºç­›é€‰å’Œå…³è”çš„äº‹ä»¶</h3>
<h4 id="å¢åŠ å›ºå®šå±æ€§" tabindex="-1"> å¢åŠ å›ºå®šå±æ€§</h4>
<p>æœ€ç®€å•çš„å……å®æ–¹æ³•æ˜¯å‘æºè‡ªæ—¥å¿—ç®¡é“çš„æ‰€æœ‰äº‹ä»¶æ·»åŠ å›ºå®šå±æ€§å€¼ã€‚è¿™æ˜¯ä½¿ç”¨è®°å½•å™¨é…ç½®ä¸­çš„<code>Enrich.WithProperty()</code>å®Œæˆçš„ï¼š</p>
<div><pre><code>Log.Logger = new LoggerConfiguration()
    .Enrich.WithProperty("Application", "Demo")
    .WriteTo.Seq("http://localhost:5341")
    .CreateLogger();
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>åœ¨<code>LogEvents</code>ä¸Šï¼Œé€šè¿‡æ‰©å±•æ·»åŠ çš„å±æ€§ä¸æºè‡ªæ¶ˆæ¯æ¨¡æ¿çš„å±æ€§ç›¸åŒï¼š</p>
<div><pre><code>{
    "@t": "2017-11-20T11:33:01.22138",
    "@l": "Debug",
    "@m": "Processing item 10 of 999",
    "ItemNumber": 10,
    "ItemCount": 999,
    "Application": "Demo"
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>è¿™ç§ç­–ç•¥æœ‰åŠ©äºæ”¾å¤§é›†ä¸­æ—¥å¿—æµä¸­çš„ç‰¹å®šæ—¥å¿—æºï¼›ä»¥è¿™ç§æ–¹å¼æ·»åŠ çš„å±æ€§åŒ…æ‹¬åº”ç”¨ç¨‹åºã€ç¯å¢ƒå’Œç‰ˆæœ¬ç­‰å†…å®¹ã€‚</p>
<h2 id="å¢åŠ äº‹ä»¶æˆ–è®°å½•å™¨ç‰¹å®šå±æ€§" tabindex="-1"> å¢åŠ äº‹ä»¶æˆ–è®°å½•å™¨ç‰¹å®šå±æ€§</h2>
<p>é€šè¿‡åˆ›å»ºå’Œä½¿ç”¨ä¸Šä¸‹æ–‡è®°å½•å™¨ï¼Œå¯ä»¥å°†å±æ€§æ·»åŠ åˆ°ä¸€ä¸ªæˆ–å‡ ä¸ªç›¸å…³äº‹ä»¶ä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç›¸åŒçš„å€¼ä¸°å¯Œæ‰€æœ‰äº‹ä»¶ï¼š</p>
<div><pre><code>var orderLog = Log.ForContext("OrderId", order.Id);
orderLog.Information("Looking up product codes");
// ...
orderLog.Information("Product lookup took {Elapsed} ms", elapsed.TotalMilliseconds);
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>åœ¨è¿™é‡Œï¼Œé€šè¿‡<code>orderLog</code>å‘å‡ºçš„ä¸¤ä¸ªäº‹ä»¶éƒ½å°†é™„åŠ <code>OrderId</code>å±æ€§ã€‚</p>
<p>æ‰©å±•æ˜¯å¯æ·»åŠ çš„ï¼šå¦‚æœ<code>Application</code>å±æ€§è®¾ç½®åœ¨ç®¡é“çº§åˆ«ï¼Œåˆ™ä¸Šé¢çš„ç¬¬äºŒä¸ªäº‹ä»¶å°†æºå¸¦ç»è¿‡ï¼ˆæ¥è‡ªæ¶ˆæ¯ï¼‰ã€<code>OrderId</code>ï¼ˆæ¥è‡ªä¸Šä¸‹æ–‡è®°å½•å™¨ï¼‰å’Œ<code>Application</code>ï¼ˆæ¥è‡ªæ—¥å¿—ç®¡é“ï¼‰ã€‚</p>
<h3 id="ä¸°å¯Œæºç±»å‹ä¿¡æ¯" tabindex="-1"> ä¸°å¯Œæºç±»å‹ä¿¡æ¯</h3>
<p>ç‰¹å®šäºè®°å½•å™¨çš„å……å®çš„ä¸€ä¸ªç‰¹ä¾‹æ˜¯å¦‚ä½•ç”¨åˆ›å»ºäº‹ä»¶çš„ç±»æ ‡è®°äº‹ä»¶ã€‚</p>
<p>åœ¨åä¸º<code>HomeController</code>çš„ç±»ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åˆ›å»ºç‰¹å®šäºç±»å‹çš„è®°å½•å™¨ï¼š</p>
<div><pre><code>private readonly ILogger _log = Log.ForContext&lt;HomeController>();
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>é€šè¿‡<code>_log</code>å‘å‡ºçš„äº‹ä»¶å°†æºå¸¦å€¼ä¸º<code>MyApp.Controller.HomeController</code>çš„<code>SourceContext</code>å±æ€§ã€‚</p>
<h3 id="ä¸°å¯Œç¯å¢ƒè¯­å¢ƒ" tabindex="-1"> ä¸°å¯Œç¯å¢ƒè¯­å¢ƒ</h3>
<p>ä¸ºäº†ä¸°å¯Œå·¥ä½œå•å…ƒä¸­å¼•å‘çš„æ‰€æœ‰äº‹ä»¶ï¼Œ<code>Serilog</code>æä¾›äº†<code>LogContext</code>ã€‚é¦–å…ˆéœ€è¦åœ¨<code>LoggerConfiguration</code>çº§åˆ«ä½¿ç”¨<code>Enrich.FromLogContext()</code>å¯ç”¨æ­¤åŠŸèƒ½ï¼š</p>
<div><pre><code>Log.Logger = new LoggerConfiguraition()
     .Enrich.FromLogContext()
     // ...
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p><code>LogContext</code>å¯ä»¥çœ‹ä½œæ˜¯ï¼ˆé”®ã€å€¼ï¼‰å¯¹çš„å †æ ˆï¼›å½“ä»æ—¥å¿—ä¸Šä¸‹æ–‡ä¸­ä¸°å¯Œäº‹ä»¶æ—¶ï¼Œè¿™äº›äº‹ä»¶å°†ä½œä¸ºå±æ€§æ·»åŠ åˆ°äº‹ä»¶ä¸­ã€‚</p>
<div><pre><code>using (LogContext.PushProperty("MessageId", message.Id))
{
    Log.Debug("Dispatching message of type {MessageType}", message.GetType());
    await handler.HandleAsync(message);
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p><code>LogContext</code>çš„æœ‰è¶£ä¹‹å¤„åœ¨äºä¸éœ€è¦ä¼ é€’ä»»ä½•ä¿¡æ¯ã€‚åœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œ<code>HandleAsync()</code>çš„å®ç°ä»¥åŠå®ƒè°ƒç”¨çš„ä»»ä½•å…¶ä»–æ–¹æ³•éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨<code>Log</code>å’Œ<code>ILogger</code>ã€ <code>MessageId</code>å±æ€§å°†è¢«æå–å¹¶æ·»åŠ åˆ°åå°ã€‚</p>
<blockquote>
<p>æç¤ºï¼š<code>LogContext</code>æ˜¯ä¸€ä¸ªå †æ ˆï¼›æ¨é€åˆ°å †æ ˆä¸Šçš„å±æ€§å¿…é¡»é€šè¿‡å¤„ç†ä»<code>PushProperty()</code>è¿”å›çš„å¯¹è±¡å†æ¬¡å¼¹å‡º-å¿…é¡»ä½¿ç”¨å—ã€‚</p>
</blockquote>
]]></content>
    <published>2022-01-07T10:07:15.000Z</published>
  </entry>
  <entry>
    <title type="html">Nacos é…ç½®ä¸­å¿ƒ</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/nacos-aspnetcore.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/nacos-aspnetcore.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="nacos-é…ç½®ä¸­å¿ƒ" tabindex="-1"> Nacos é…ç½®ä¸­å¿ƒ</h1>
<p><code>nacos</code> æ˜¯ä¸€ä¸ªæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ã€‚ã€‚</p>
<h2 id="é…ç½®ç®¡ç†" tabindex="-1"> é…ç½®ç®¡ç†</h2>
<p>asp.net core ä¸­æ‰€æœ‰çš„é…ç½®é¡¹ï¼Œå¦‚ appsetting.json è¿›è¡Œé›†ä¸­ç®¡ç†,æ”¯æŒçƒ­åŠ è½½ï¼Œæ”¯æŒæœåŠ¡å‘ç°ã€‚</p>
<ul>
<li>nacos github <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos</a></li>
<li>csharp sdk github <a href="https://github.com/nacos-group/nacos-sdk-csharp" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group/nacos-sdk-csharp</a></li>
<li>csharp sdk æ–‡æ¡£ï¼š<a href="https://nacos-sdk-csharp.readthedocs.io/en/latest/introduction/gettingstarted.html" target="_blank" rel="noopener noreferrer">https://nacos-sdk-csharp.readthedocs.io/en/latest/introduction/gettingstarted.html</a></li>
<li><a href="https://nacos.io/zh-cn/" target="_blank" rel="noopener noreferrer">https://nacos.io/zh-cn/</a></li>
</ul>
<p>å®‰è£…è¯·å‚è€ƒï¼š<a href="https://nacos.io/zh-cn/docs/quick-start.html" target="_blank" rel="noopener noreferrer">https://nacos.io/zh-cn/docs/quick-start.html</a></p>
<h3 id="å¼€å§‹" tabindex="-1"> å¼€å§‹</h3>
<ul>
<li>windows è¿›å…¥ nacos çš„ bin ç›®å½•ï¼Œæˆ–æŠŠç›®å½• <code>D:\work\tools\nacos\bin</code>ï¼ˆæˆ‘æœ¬åœ°ï¼‰é…ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­çš„ Path ä¸­ã€‚</li>
</ul>
<p>å³å¯åœ¨ä»»æ„ä½ç½®ï¼Œæ‰§è¡Œå‘½ä»¤</p>
<div><pre><code>startup.cmd -m standalone
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><ul>
<li>standalone ä»£è¡¨ç€å•æœºæ¨¡å¼è¿è¡Œï¼Œéé›†ç¾¤æ¨¡å¼</li>
</ul>
<div><pre><code>C:\WINDOWS\system32&gt;startup.cmd -m standalone
&quot;nacos is starting with standalone&quot;

         ,--.
       ,--.'|
   ,--,:  : |                                           Nacos 2.0.3
,`--.'`|  ' :                       ,---.               Running in stand alone mode, All function modules
|   :  :  | |                      '   ,'\   .--.--.    Port: 8848
:   |   \ | :  ,--.--.     ,---.  /   /   | /  /    '   Pid: 14504
|   : '  '; | /       \   /     \.   ; ,. :|  :  /`./   Console: http://192.168.0.10:8848/nacos/index.html
'   ' ;.    ;.--.  .-. | /    / ''   | |: :|  :  ;_
|   | | \   | \__\/: . ..    ' / '   | .; : \  \    `.      https://nacos.io
'   : |  ; .' ,&quot; .--.; |'   ; :__|   :    |  `----.   \
|   | '`--'  /  /  ,.  |'   | '.'|\   \  /  /  /`--'  /
'   : |     ;  :   .'   \   :    : `----'  '--'.     /
;   |.'     |  ,     .-./\   \  /            `--'---'
'---'        `--`---'     `----'

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><p>é»˜è®¤è¿è¡Œåœ¨ 8848 ç«¯å£</p>
<ul>
<li>http://localhost:8848/nacos/#/login</li>
<li>nacos</li>
<li>nacos</li>
</ul>
<h2 id="å¿…åš" tabindex="-1"> å¿…åš</h2>
<p>ç™»å½•åï¼Œæ‰“å¼€<strong>å‘½åç©ºé—´</strong>-&gt;æ–°å»ºå‘½åç©ºé—´-&gt;</p>
<ul>
<li><code> å‘½åç©ºé—´ID</code>:è¿™é‡Œå¡«ï¼Œ<code>cs-test</code>ï¼Œæ³¨æ„ä¸‹æ–¹çš„é…ç½®é¡¹ Namespace è¯·å¡«å†™æ­¤å€¼ã€‚</li>
<li><code>å‘½åç©ºé—´åï¼š</code>è¿™ä¸ªåªæ˜¯ç”¨äºå±•ç¤ºåŒºåˆ†ï¼Œå¡«<code>cs-test</code>ï¼Œå»ºè®®ç›´æ¥å’Œå‘½åç©ºé—´ id ç›¸åŒå³å¯ã€‚</li>
<li><code>æè¿°ï¼š</code>:è¿™ä¸ªéšä¾¿å¡«</li>
</ul>
<h2 id="nacos-console" tabindex="-1"> Nacos+Console</h2>
<p>æ–°å»ºä¸€ä¸ªæ§åˆ¶å°é¡¹ç›®</p>
<p>å¼•å…¥åŒ…</p>
<div><pre><code><span><span><span>&lt;</span>PackageReference</span> <span>Include</span><span><span>=</span><span>"</span>Microsoft.Extensions.Hosting<span>"</span></span> <span>Version</span><span><span>=</span><span>"</span>6.0.0<span>"</span></span> <span>/></span></span>
<span><span><span>&lt;</span>PackageReference</span> <span>Include</span><span><span>=</span><span>"</span>nacos-sdk-csharp<span>"</span></span> <span>Version</span><span><span>=</span><span>"</span>1.2.2<span>"</span></span> <span>/></span></span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><div><pre><code><span>static</span> <span>IHost</span> <span>AppStartup</span><span>(</span><span>)</span>
<span>{</span>
    <span><span>var</span></span> host <span>=</span> Host<span>.</span><span>CreateDefaultBuilder</span><span>(</span><span>)</span>
                <span>.</span><span>ConfigureServices</span><span>(</span><span>(</span>context<span>,</span> services<span>)</span> <span>=></span>
                <span>{</span>
                    <span>ConfigureServices</span><span>(</span>context<span>,</span> services<span>)</span><span>;</span>
                    services<span>.</span><span><span>AddTransient</span><span><span>&lt;</span>App<span>></span></span></span><span>(</span><span>)</span><span>;</span>
                <span>}</span><span>)</span>
                <span>.</span><span>ConfigureAppConfiguration</span><span>(</span><span>(</span>host<span>,</span> config<span>)</span> <span>=></span>
                <span>{</span>

                <span>}</span><span>)</span>
                <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span> <span>// Build the Host</span>

    <span>return</span> host<span>;</span>
<span>}</span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><p>é…ç½®<code>nacos</code>çš„æœåŠ¡</p>
<div><pre><code><span>static</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>HostBuilderContext</span> context<span>,</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
    services<span>.</span><span>AddNacosV2Config</span><span>(</span>x <span>=></span>
    <span>{</span>
        x<span>.</span>ServerAddresses <span>=</span> <span>new</span> <span>System<span>.</span>Collections<span>.</span>Generic<span>.</span>List<span>&lt;</span><span>string</span><span>></span></span> <span>{</span> <span>"http://localhost:8848/"</span> <span>}</span><span>;</span>
        x<span>.</span>EndPoint <span>=</span> <span>""</span><span>;</span>
        x<span>.</span>Namespace <span>=</span> <span>"cs-test"</span><span>;</span>

        <span>/*x.UserName = "nacos";
       x.Password = "nacos";*/</span>

        <span>// swich to use http or rpc</span>
        x<span>.</span>ConfigUseRpc <span>=</span> <span>true</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>

    services<span>.</span><span>AddNacosV2Naming</span><span>(</span>x <span>=></span>
    <span>{</span>
        x<span>.</span>ServerAddresses <span>=</span> <span>new</span> <span>System<span>.</span>Collections<span>.</span>Generic<span>.</span>List<span>&lt;</span><span>string</span><span>></span></span> <span>{</span> <span>"http://localhost:8848/"</span> <span>}</span><span>;</span>
        x<span>.</span>EndPoint <span>=</span> <span>""</span><span>;</span>
        x<span>.</span>Namespace <span>=</span> <span>"cs-test"</span><span>;</span>

        <span>/*x.UserName = "nacos";
       x.Password = "nacos";*/</span>

        <span>// swich to use http or rpc</span>
        x<span>.</span>NamingUseRpc <span>=</span> <span>true</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br></div></div><p>è°ƒç”¨</p>
<div><pre><code><span><span>var</span></span> host <span>=</span> <span>AppStartup</span><span>(</span><span>)</span><span>;</span>
<span><span>var</span></span> service <span>=</span> ActivatorUtilities<span>.</span><span><span>CreateInstance</span><span><span>&lt;</span>App<span>></span></span></span><span>(</span>host<span>.</span>Services<span>)</span><span>;</span>
<span>await</span> service<span>.</span><span>RunAsync</span><span>(</span>args<span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>App.cs æ–‡ä»¶é…ç½®</p>
<div><pre><code><span>public</span> <span>class</span> <span>App</span>
<span>{</span>
    <span>private</span> <span>readonly</span> <span>ILogger<span>&lt;</span>App<span>></span></span> _logger<span>;</span>
    <span>private</span> <span>readonly</span> <span>INacosConfigService</span> _ns<span>;</span>
    <span>public</span> <span>App</span><span>(</span><span>ILogger<span>&lt;</span>App<span>></span></span> logger<span>,</span> <span>INacosConfigService</span> ns<span>)</span>
    <span>{</span>
        _logger <span>=</span> logger<span>;</span>
        _ns <span>=</span> ns<span>;</span>
    <span>}</span>

    <span>public</span> <span>async</span> <span>Task</span> <span>RunAsync</span><span>(</span><span><span>string</span><span>[</span><span>]</span></span> args<span>)</span>
    <span>{</span>
        <span>await</span> <span>PublishConfig</span><span>(</span>_ns<span>)</span><span>;</span>
        <span>await</span> <span>GetConfig</span><span>(</span>_ns<span>)</span><span>;</span>
        <span>await</span> <span>RemoveConfig</span><span>(</span>_ns<span>)</span><span>;</span>
    <span>}</span>

    <span>static</span> <span>async</span> <span>Task</span> <span>PublishConfig</span><span>(</span><span>INacosConfigService</span> svc<span>)</span>
    <span>{</span>
        <span><span>var</span></span> dataId <span>=</span> <span>"demo-dateid"</span><span>;</span>
        <span><span>var</span></span> <span>group</span> <span>=</span> <span>"demo-group"</span><span>;</span>
        <span><span>var</span></span> val <span>=</span> <span>"test-value-"</span> <span>+</span> DateTimeOffset<span>.</span>Now<span>.</span><span>ToUnixTimeSeconds</span><span>(</span><span>)</span><span>.</span><span>ToString</span><span>(</span><span>)</span><span>;</span>

        <span>await</span> Task<span>.</span><span>Delay</span><span>(</span><span>500</span><span>)</span><span>;</span>
        <span><span>var</span></span> flag <span>=</span> <span>await</span> svc<span>.</span><span>PublishConfig</span><span>(</span>dataId<span>,</span> <span>group</span><span>,</span> val<span>)</span><span>;</span>
        Console<span>.</span><span>WriteLine</span><span>(</span><span><span>$"======================å‘å¸ƒé…ç½®ç»“æœï¼Œ</span><span><span>{</span><span>flag</span><span>}</span></span><span>"</span></span><span>)</span><span>;</span>
    <span>}</span>

    <span>static</span> <span>async</span> <span>Task</span> <span>GetConfig</span><span>(</span><span>INacosConfigService</span> svc<span>)</span>
    <span>{</span>
        <span><span>var</span></span> dataId <span>=</span> <span>"demo-dateid"</span><span>;</span>
        <span><span>var</span></span> <span>group</span> <span>=</span> <span>"demo-group"</span><span>;</span>

        <span>await</span> Task<span>.</span><span>Delay</span><span>(</span><span>500</span><span>)</span><span>;</span>
        <span><span>var</span></span> config <span>=</span> <span>await</span> svc<span>.</span><span>GetConfig</span><span>(</span>dataId<span>,</span> <span>group</span><span>,</span> <span>5000L</span><span>)</span><span>;</span>
        Console<span>.</span><span>WriteLine</span><span>(</span><span><span>$"======================è·å–é…ç½®ç»“æœï¼Œ</span><span><span>{</span><span>config</span><span>}</span></span><span>"</span></span><span>)</span><span>;</span>
    <span>}</span>

    <span>static</span> <span>async</span> <span>Task</span> <span>RemoveConfig</span><span>(</span><span>INacosConfigService</span> svc<span>)</span>
    <span>{</span>
        <span><span>var</span></span> dataId <span>=</span> <span>"demo-dateid"</span><span>;</span>
        <span><span>var</span></span> <span>group</span> <span>=</span> <span>"demo-group"</span><span>;</span>

        <span>await</span> Task<span>.</span><span>Delay</span><span>(</span><span>500</span><span>)</span><span>;</span>
        <span><span>var</span></span> flag <span>=</span> <span>await</span> svc<span>.</span><span>RemoveConfig</span><span>(</span>dataId<span>,</span> <span>group</span><span>)</span><span>;</span>
        Console<span>.</span><span>WriteLine</span><span>(</span><span><span>$"=====================åˆ é™¤é…ç½®ç»“æœï¼Œ</span><span><span>{</span><span>flag</span><span>}</span></span><span>"</span></span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br></div></div><p>f5 è¿è¡Œåå¯çœ‹åˆ°è¾“å‡ºå¦‚ä¸‹å†…å®¹</p>
<div><pre><code>======================å‘å¸ƒé…ç½®ç»“æœï¼ŒTrue
======================è·å–é…ç½®ç»“æœï¼Œtest-value-1637000754
=====================åˆ é™¤é…ç½®ç»“æœï¼ŒTrue
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>æˆ‘ä»¬æŠŠ<code>await RemoveConfig(_ns);</code>è¿™è¡Œåˆ é™¤ï¼Œå³å¯åœ¨ nacos çš„ç½‘ç«™ä¸Šçœ‹åˆ°ä¿¡æ¯ã€‚</p>
<p>é…ç½®ç®¡ç† -é€‰<code>cs-test</code>,å¯ä»¥çœ‹åˆ°<code>Data Idä¸ºdemo-dateid</code>ï¼Œ<code>Group</code>ä¸º<code>demo-group</code>çš„ä¸€è¡Œæ•°æ®ï¼Œç‚¹å‡»è¡Œå†…çš„ç¼–è¾‘å³å¯çœ‹åˆ°å…·ä½“ä¿¡æ¯ã€‚</p>
<h2 id="nacso-asp-net-core" tabindex="-1"> Nacso+Asp.NET Core</h2>
<p>æ–°å¢åŒ…</p>
<div><pre><code><span><span><span>&lt;</span>PackageReference</span> <span>Include</span><span><span>=</span><span>"</span>nacos-sdk-csharp.AspNetCore<span>"</span></span> <span>Version</span><span><span>=</span><span>"</span>1.2.2<span>"</span></span> <span>/></span></span>
<span><span><span>&lt;</span>PackageReference</span> <span>Include</span><span><span>=</span><span>"</span>nacos-sdk-csharp.Extensions.Configuration<span>"</span></span> <span>Version</span><span><span>=</span><span>"</span>1.2.2<span>"</span></span> <span>/></span></span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>åœ¨ Program ä¸­é…ç½®æœåŠ¡</p>
<div><pre><code>builder<span>.</span>Host<span>.</span><span>ConfigureAppConfiguration</span><span>(</span><span>(</span>context<span>,</span> builder<span>)</span> <span>=></span>
        <span>{</span>
            <span><span>var</span></span> c <span>=</span> builder<span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>

            <span>// ä»é…ç½®æ–‡ä»¶è¯»å–Nacosç›¸å…³é…ç½®</span>
            <span>// é»˜è®¤ä¼šä½¿ç”¨JSONè§£æå™¨æ¥è§£æå­˜åœ¨Nacos Serverçš„é…ç½®</span>
            builder<span>.</span><span>AddNacosV2Configuration</span><span>(</span>c<span>.</span><span>GetSection</span><span>(</span><span>"NacosConfig"</span><span>)</span><span>)</span><span>;</span>
            <span>// ä¹Ÿå¯ä»¥æŒ‰éœ€ä½¿ç”¨iniæˆ–yamlçš„è§£æå™¨</span>
            <span>// builder.AddNacosV2Configuration(c.GetSection("NacosConfig"), Nacos.IniParser.IniConfigurationStringParser.Instance);</span>
            <span>// builder.AddNacosV2Configuration(c.GetSection("NacosConfig"), Nacos.YamlParser.YamlConfigurationStringParser.Instance);</span>
        <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p><code>appsetting.json</code>é…ç½®</p>
<div><pre><code><span>{</span>
  <span>"NacosConfig"</span><span>:</span> <span>{</span>
    <span>"Listeners"</span><span>:</span> <span>[</span>
      <span>{</span>
        <span>"Optional"</span><span>:</span> <span>false</span><span>,</span>
        <span>"DataId"</span><span>:</span> <span>"common"</span><span>,</span>
        <span>"Group"</span><span>:</span> <span>"DEFAULT_GROUP"</span>
      <span>}</span><span>,</span>
      <span>{</span>
        <span>"Optional"</span><span>:</span> <span>false</span><span>,</span>
        <span>"DataId"</span><span>:</span> <span>"demo"</span><span>,</span>
        <span>"Group"</span><span>:</span> <span>"DEFAULT_GROUP"</span>
      <span>}</span>
    <span>]</span><span>,</span>
    <span>"Namespace"</span><span>:</span> <span>"cs-test"</span><span>,</span>
    <span>"ServerAddresses"</span><span>:</span> <span>[</span><span>"http://localhost:8848/"</span><span>]</span><span>,</span>
    <span>"UserName"</span><span>:</span> <span>"nacos"</span><span>,</span>
    <span>"Password"</span><span>:</span> <span>"nacos"</span><span>,</span>
    <span>"AccessKey"</span><span>:</span> <span>""</span><span>,</span>
    <span>"SecretKey"</span><span>:</span> <span>""</span><span>,</span>
    <span>"EndPoint"</span><span>:</span> <span>""</span><span>,</span>
    <span>"ConfigFilterAssemblies"</span><span>:</span> <span>[</span><span>]</span><span>,</span>
    <span>"ConfigFilterExtInfo"</span><span>:</span> <span>""</span>
  <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br></div></div><p>åœ¨ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>DataId</code>ä¸º<code>common</code>çš„ã€æˆ‘ä»¬å»ç®¡ç†ç«¯ UIï¼Œå‘½åç©ºé—´ä¸º<code>cs-test</code>æ–°å¢ä¸€ä¸ªé…ç½®</p>
<p>æ–°å¢äºŒä¸ªé…ç½®é¡¹</p>
<ul>
<li>Data ID:common</li>
<li>Group:DEFAULT_GROUP</li>
<li>é…ç½®å†…å®¹ï¼šé€‰æ‹© jsonã€‚</li>
</ul>
<div><pre><code><span>{</span>
  <span>"UserInfo"</span><span>:</span> <span>{</span>
    <span>"Name"</span><span>:</span> <span>"luo"</span><span>,</span>
    <span>"Sex"</span><span>:</span> <span>"Boy"</span><span>,</span>
    <span>"Age"</span><span>:</span> <span>99</span>
  <span>}</span><span>,</span>
  <span>"commonkey"</span><span>:</span> <span>"commonkey_value_å€¼"</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><ul>
<li>Data ID:demo</li>
<li>Group:DEFAULT_GROUP</li>
<li>é…ç½®å†…å®¹ï¼šé€‰æ‹© jsonã€‚</li>
</ul>
<div><pre><code><span>{</span>
  <span>"demokey"</span><span>:</span> <span>"demo_value_å€¼"</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>é‚£æˆ‘ä»¬å¦‚ä½•è·å–çš„è¿™ä¹ˆä¸€ä¸ª json å€¼å’Œ demokey ä¸­çš„å€¼å‘¢ã€‚</p>
<p>æˆ‘ä»¬æ–°å¢ä¸€ä¸ªç±»</p>
<div><pre><code>    <span>public</span> <span>class</span> <span>UserInfo</span>
    <span>{</span>
        <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Sex <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>int</span></span> Age <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>åœ¨é»˜è®¤çš„æ§åˆ¶å™¨æ³¨å…¥ <code>IConfiguration</code>,åƒä» appsettings.json ä¸­è·å–æ•°æ®ä¸€æ ·ï¼Œå¯ç›´æ¥å–å‡ºæ¥ã€‚</p>
<div><pre><code>    <span>private</span> <span>readonly</span> <span>ILogger<span>&lt;</span>ConfigController<span>></span></span> _logger<span>;</span>
    <span>private</span> <span>readonly</span> <span>IConfiguration</span> _configuration<span>;</span>

    <span>public</span> <span>ConfigController</span><span>(</span><span>ILogger<span>&lt;</span>WeatherForecastController<span>></span></span> logger<span>,</span> <span>IConfiguration</span> configuration<span>)</span>
    <span>{</span>
        _logger <span>=</span> logger<span>;</span>
        _configuration <span>=</span> configuration<span>;</span>
    <span>}</span>

    <span>[</span><span><span>HttpGet</span><span><span>(</span><span>"getconfig"</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>UserInfo</span> <span>GetConfig</span><span>(</span><span>)</span>
    <span>{</span>
        <span><span>var</span></span> userInfo1 <span>=</span> _configuration<span>.</span><span>GetSection</span><span>(</span><span>"UserInfo"</span><span>)</span><span>.</span><span><span>Get</span><span><span>&lt;</span>UserInfo<span>></span></span></span><span>(</span><span>)</span><span>;</span>
        <span><span>var</span></span> commonvalue <span>=</span> _configuration<span>[</span><span>"commonkey"</span><span>]</span><span>;</span>
        <span><span>var</span></span> demovalue <span>=</span> _configuration<span>[</span><span>"demokey"</span><span>]</span><span>;</span>
        _logger<span>.</span><span>LogInformation</span><span>(</span><span>"commonkey:"</span> <span>+</span> commonvalue<span>)</span><span>;</span>
        _logger<span>.</span><span>LogInformation</span><span>(</span><span>"demokey:"</span> <span>+</span> demovalue<span>)</span><span>;</span>
        <span>return</span> userInfo1<span>;</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></div></div><p>ä¼šè¾“å‡ºå¦‚ä¸‹å†…å®¹</p>
<div><pre><code><span>info:</span> NacosApi<span>.</span>Controllers<span>.</span>WeatherForecastController<span>[</span><span>0</span><span>]</span>
      commonkey<span>:</span>commonkey_value_å€¼
<span>info:</span> NacosApi<span>.</span>Controllers<span>.</span>WeatherForecastController<span>[</span><span>0</span><span>]</span>
      demokey<span>:</span>demo_value_å€¼
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å¹¶åœ¨ç•Œé¢ä¸Šè¿”å› UserInfo çš„ä¿¡æ¯ã€‚</p>
<div><pre><code><span>{</span>
  <span>"name"</span><span>:</span> <span>"luo"</span><span>,</span>
  <span>"sex"</span><span>:</span> <span>"Boy"</span><span>,</span>
  <span>"age"</span><span>:</span> <span>99</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h4 id="æ³¨æ„" tabindex="-1"> æ³¨æ„</h4>
<ul>
<li>å½“äºŒä¸ª<code>DataId</code>ä¸­é…ç½®çš„ json,åŒ…å«ç›¸åŒçš„ Key æ—¶ï¼Œå®é™…ä¼šä¾åé¢çš„ Key ä¸­å€¼ä¸ºå‡†ã€‚é¡ºåºä»¥ appsetting.json ä¸­çš„é…ç½® Listeners çš„æ•°ç»„é¡ºåºä¸ºä¾æ®ã€‚</li>
</ul>
<p>å½“ç„¶æˆ‘ä»¬é€šè¿‡å¼ºç±»å‹ç»‘å®š<code>UserInfo</code>,åœ¨<code>Program</code>é…ç½®æœåŠ¡</p>
<div><pre><code>builder<span>.</span>Services<span>.</span><span><span>Configure</span><span><span>&lt;</span>UserInfo<span>></span></span></span><span>(</span>builder<span>.</span>Configuration<span>.</span><span>GetSection</span><span>(</span><span>"UserInfo"</span><span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><div><pre><code><span>public</span> <span>ConfigController</span><span>(</span><span>ILogger<span>&lt;</span>ConfigController<span>></span></span> logger<span>,</span>
        <span>IConfiguration</span> configuration<span>,</span>
        <span>IOptions<span>&lt;</span>UserInfo<span>></span></span> options1<span>,</span>
        <span>IOptionsSnapshot<span>&lt;</span>UserInfo<span>></span></span> options2<span>,</span>
        <span>IOptionsMonitor<span>&lt;</span>UserInfo<span>></span></span> options3
    <span>)</span>
<span>{</span>
    _logger <span>=</span> logger<span>;</span>
    _configuration <span>=</span> configuration<span>;</span>
    _user1 <span>=</span> options1<span>.</span>Value<span>;</span>
    _user2 <span>=</span> options2<span>.</span>Value<span>;</span>
    _user3 <span>=</span> options3<span>.</span>CurrentValue<span>;</span>
<span>}</span>

<span>[</span><span><span>HttpGet</span></span><span>]</span>
<span>public</span> <span><span>string</span></span> <span>Get</span><span>(</span><span>)</span>
<span>{</span>
    <span><span>string</span></span> id <span>=</span> Guid<span>.</span><span>NewGuid</span><span>(</span><span>)</span><span>.</span><span>ToString</span><span>(</span><span>"N"</span><span>)</span><span>;</span>

    _logger<span>.</span><span>LogInformation</span><span>(</span><span><span>$"============== begin </span><span><span>{</span><span>id</span><span>}</span></span><span> ====================="</span></span><span>)</span><span>;</span>

    <span><span>var</span></span> str1 <span>=</span> Newtonsoft<span>.</span>Json<span>.</span>JsonConvert<span>.</span><span>SerializeObject</span><span>(</span>_user1<span>)</span><span>;</span>
    _logger<span>.</span><span>LogInformation</span><span>(</span><span><span>$"</span><span><span>{</span><span>id</span><span>}</span></span><span> IOptions = </span><span><span>{</span><span>str1</span><span>}</span></span><span>"</span></span><span>)</span><span>;</span>

    <span><span>var</span></span> str2 <span>=</span> Newtonsoft<span>.</span>Json<span>.</span>JsonConvert<span>.</span><span>SerializeObject</span><span>(</span>_user2<span>)</span><span>;</span>
    _logger<span>.</span><span>LogInformation</span><span>(</span><span><span>$"</span><span><span>{</span><span>id</span><span>}</span></span><span> IOptionsSnapshot = </span><span><span>{</span><span>str2</span><span>}</span></span><span>"</span></span><span>)</span><span>;</span>

    <span><span>var</span></span> str3 <span>=</span> Newtonsoft<span>.</span>Json<span>.</span>JsonConvert<span>.</span><span>SerializeObject</span><span>(</span>_user3<span>)</span><span>;</span>
    _logger<span>.</span><span>LogInformation</span><span>(</span><span><span>$"</span><span><span>{</span><span>id</span><span>}</span></span><span> IOptionsMonitor = </span><span><span>{</span><span>str3</span><span>}</span></span><span>"</span></span><span>)</span><span>;</span>

    _logger<span>.</span><span>LogInformation</span><span>(</span><span><span>$"==============================================="</span></span><span>)</span><span>;</span>

    <span>return</span> <span>"ok"</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br></div></div><p>å½“ç„¶è¾“å‡ºæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚æˆ‘ä»¬åœ¨ç•Œé¢ä¸Šå†æ¬¡è°ƒæ•´ä¸‹æ•°æ®</p>
<div><pre><code><span>info:</span> NacosApi<span>.</span>Controllers<span>.</span>ConfigController<span>[</span><span>0</span><span>]</span>
      <span>7bafb7f9cd2a46ec95324e38d01048aa</span> IOptions <span>=</span> <span>{</span><span>"Name"</span><span>:</span><span>"luo"</span><span>,</span><span>"Sex"</span><span>:</span><span>"Boy"</span><span>,</span><span>"Age"</span><span>:</span><span>99</span><span>}</span>
<span>info:</span> NacosApi<span>.</span>Controllers<span>.</span>ConfigController<span>[</span><span>0</span><span>]</span>
      <span>7bafb7f9cd2a46ec95324e38d01048aa</span> IOptionsSnapshot <span>=</span> <span>{</span><span>"Name"</span><span>:</span><span>"luo"</span><span>,</span><span>"Sex"</span><span>:</span><span>"Boy"</span><span>,</span><span>"Age"</span><span>:</span><span>99</span><span>}</span>
<span>info:</span> NacosApi<span>.</span>Controllers<span>.</span>ConfigController<span>[</span><span>0</span><span>]</span>
      <span>7bafb7f9cd2a46ec95324e38d01048aa</span> IOptionsMonitor <span>=</span> <span>{</span><span>"Name"</span><span>:</span><span>"luo"</span><span>,</span><span>"Sex"</span><span>:</span><span>"Boy"</span><span>,</span><span>"Age"</span><span>:</span><span>99</span><span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>åªæœ‰<code>IOptions&lt;UserInfo&gt;</code>ä¸ä¼šå˜åŒ–ï¼Œå…¶ä»–æ˜¯ä¼šè·Ÿç€å˜åŒ–çš„ã€‚</p>
<div><pre><code><span>info:</span> NacosApi<span>.</span>Controllers<span>.</span>ConfigController<span>[</span><span>0</span><span>]</span>
      <span>604d8db7b0ad48ccbc64c3ccd06eb524</span> IOptions <span>=</span> <span>{</span><span>"Name"</span><span>:</span><span>"luo"</span><span>,</span><span>"Sex"</span><span>:</span><span>"Boy"</span><span>,</span><span>"Age"</span><span>:</span><span>99</span><span>}</span>
<span>info:</span> NacosApi<span>.</span>Controllers<span>.</span>ConfigController<span>[</span><span>0</span><span>]</span>
      <span>604d8db7b0ad48ccbc64c3ccd06eb524</span> IOptionsSnapshot <span>=</span> <span>{</span><span>"Name"</span><span>:</span><span>"abc"</span><span>,</span><span>"Sex"</span><span>:</span><span>"Boy"</span><span>,</span><span>"Age"</span><span>:</span><span>99</span><span>}</span>
<span>info:</span> NacosApi<span>.</span>Controllers<span>.</span>ConfigController<span>[</span><span>0</span><span>]</span>
      <span>604d8db7b0ad48ccbc64c3ccd06eb524</span> IOptionsMonitor <span>=</span> <span>{</span><span>"Name"</span><span>:</span><span>"abc"</span><span>,</span><span>"Sex"</span><span>:</span><span>"Boy"</span><span>,</span><span>"Age"</span><span>:</span><span>99</span><span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><h2 id="docker-å®‰è£…-nacos" tabindex="-1"> Docker å®‰è£… Nacos</h2>
<ul>
<li>
<p><a href="https://www.cnblogs.com/niunafei/p/12803965.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/niunafei/p/12803965.html</a></p>
<p>1.æ‹‰å–é•œåƒ</p>
</li>
</ul>
<div><pre><code>docker pull nacos/nacos-server
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>2ã€åˆ›å»ºæœ¬åœ°çš„æ˜ å°„æ–‡ä»¶ï¼Œapplication.propertiesï¼Œ</p>
<div><pre><code>mkdir -p  /root/nacos/logs /root/nacos/conf
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>é…ç½®æ•°æ®åº“</p>
<div><pre><code>vim /root/nacos/conf/application.properties
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><ul>
<li>application.properties</li>
</ul>
<div><pre><code>spring.datasource.platform=mysql
db.num=1
db.url.0=jdbc:mysql://ip:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true
db.user=userid
db.password=userpassword

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>ä¸‹é¢é€šè¿‡é…ç½®æ¥æš´éœ²é™¤äº†/shutdown ä¹‹å¤–çš„æ‰€æœ‰ç«¯ç‚¹ã€‚ä¸‹é¢é€šè¿‡é…ç½®æ¥æš´éœ²é™¤äº†/shutdown ä¹‹å¤–çš„æ‰€æœ‰ç«¯ç‚¹</p>
<div><pre><code>management.endpoints.web.exposure.include=*
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>è¿è¡Œå®¹å™¨ï¼šä½¿ç”¨<code>standalone</code>æ¨¡å¼å¹¶å¼€æ”¾ 8848 ç«¯å£ï¼Œå¹¶æ˜ å°„é…ç½®æ–‡ä»¶å’Œæ—¥å¿—ç›®å½•ï¼Œæ•°æ®åº“åœ¨ application.properties ä¸­é…ç½®</p>
<div><pre><code>docker run -d -p 8848:8848 -p 9848:9848 -p 9555:9555 -e MODE=standalone -e PREFER_HOST_MODE=hostname -v /root/nacos/logs:/home/nacos/logs -v /root/nacos/conf/application.properties:/home/nacos/conf/application.properties --restart always --name nacos nacos/nacos-server
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å…¶ä¸­-v æŒ‡å®šæ˜ å°„é…ç½®ã€‚å·¦ä¾§ä¸º linux æ–‡ä»¶ï¼Œå³ä¾§ä¸º docker ç›®å½•</p>
<h3 id="æ›´å¤šæŒ‡ä»¤" tabindex="-1"> æ›´å¤šæŒ‡ä»¤</h3>
<p>å¯åŠ¨å®¹å™¨</p>
<div><pre><code>docker start å®¹å™¨id
æˆ–è€…
docker start nacos
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>å…³é—­å®¹å™¨</p>
<div><pre><code>docker stop nacos
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="åšå®¢" tabindex="-1"> åšå®¢</h2>
<ul>
<li><a href="https://mp.weixin.qq.com/s/iC6lFJJsHUFUveSJhoZxgA" target="_blank" rel="noopener noreferrer">èŠä¸€èŠå¦‚ä½•åœ¨.NET Core ä¸­ä½¿ç”¨ Nacos 2.0</a></li>
</ul>
]]></content>
    <published>2021-12-22T18:31:25.000Z</published>
  </entry>
  <entry>
    <title type="html">LinCmså¦‚ä½•åˆ‡æ¢æˆSQL server</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/change-sqlserver.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/change-sqlserver.html"/>
    <updated>2021-12-22T18:31:25.000Z</updated>
    <content type="html"><![CDATA[<h1 id="lincmså¦‚ä½•åˆ‡æ¢æˆsql-server" tabindex="-1"> LinCmså¦‚ä½•åˆ‡æ¢æˆSQL server</h1>
<p>éœ€è¦ä¿®æ”¹LinCms.Webä¸­çš„appsetting.jsoné…ç½®</p>
<h3 id="æ•°æ®åº“é…ç½®" tabindex="-1"> æ•°æ®åº“é…ç½®</h3>
<p>DefaultDBï¼šæ”¹æˆ1
SqlServerï¼šæ”¹æˆè‡ªå·±çš„æ•°æ®åº“é…ç½®</p>
<div><pre><code><span><span> </span><span> "ConnectionStrings": {
</span></span><span><span>-</span><span>    "DefaultDB": "0",
</span></span><span><span>+</span><span>    "DefaultDB": "1",
</span></span><span><span> </span><span>   "DataType": {
</span><span> </span><span>     "MySql": 0,
</span><span> </span><span>     "SqlServer": 1,
</span><span> </span><span>     "PostgreSQL": 2,
</span><span> </span><span>     "Oracle": 3,
</span><span> </span><span>     "Sqlite": 4
</span><span> </span><span>   },
</span><span> </span><span>   "MySql": "Data Source=localhost;Port=3306;User ID=root;Password=rCsRedisoot;Initial Catalog=lincms;Charset=utf8mb4;SslMode=none;Max pool size=1;Connection LifeTime=20"
</span></span><span><span>+</span><span>   "SqlServer": "Data Source=.;User ID=sa;Password=123456;Integrated Security=True;Initial Catalog=LinCMS;Pooling=true;Min Pool Size=1"
</span></span><span><span> </span><span> },
</span></span></code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><h3 id="serilogé…ç½®" tabindex="-1"> Serilogé…ç½®</h3>
<p>Usingå¼•ç”¨  <code>&quot;Serilog.Sinks.MSSqlServer&quot;</code>,å»æ‰<code> &quot;Serilog.Sinks.MariaDB&quot;</code></p>
<p>æŠŠ <code>&quot;Name&quot;</code>ä¸º <code>&quot;MariaDB&quot;</code>çš„jsonæ³¨é‡Šæ‰ã€‚</p>
<p>æŠŠ<code>&quot;Name&quot;</code>ä¸º <code>&quot;MSSqlServer&quot;</code>çš„jsonæ³¨é‡Šå»æ‰ã€‚</p>
<p>å¹¶æ”¹æ‰<code>Args:connectionString</code>çš„è¿æ¥ä¸²ã€‚</p>
<div><pre><code><span><span> </span><span>   "Serilog": {
</span><span> </span><span>   "Using": [
</span><span> </span><span>     "Serilog.Sinks.Console",
</span><span> </span><span>     "Serilog.Sinks.File",
</span></span><span><span>-</span><span>      "Serilog.Sinks.MariaDB"
</span></span><span><span>+</span><span>      "Serilog.Sinks.MSSqlServer"
</span></span><span><span> </span><span>   ],
</span><span> </span><span>   "MinimumLevel": {
</span><span> </span><span>     "Default": "Information",
</span><span> </span><span>     "Override": {
</span><span> </span><span>       "Microsoft": "Information",
</span><span> </span><span>       "System": "Warning"
</span><span> </span><span>     }
</span><span> </span><span>   },
</span><span> </span><span>   "WriteTo": [
</span><span> </span><span>     {
</span><span> </span><span>       "Name": "File",
</span><span> </span><span>       "Args": {
</span><span> </span><span>         "path": "Logs/log.txt",
</span><span> </span><span>         "rollingInterval": "Day"
</span><span> </span><span>       }
</span><span> </span><span>     },
</span><span> </span><span>     {
</span><span> </span><span>       "Name": "Console",
</span><span> </span><span>       "Args": {
</span><span> </span><span>         "theme": "Serilog.Sinks.SystemConsole.Themes.AnsiConsoleTheme::Code, Serilog.Sinks.Console",
</span><span> </span><span>         "outputTemplate": "[{Timestamp:HH:mm:ss} {Level:u3}] {Message:lj} &lt;s:{SourceContext}>{NewLine}{Exception}"
</span><span> </span><span>       }
</span><span> </span><span>     },
</span></span><span><span>-</span><span>      {
</span></span><span><span> </span><span>       "Name": "MariaDB",
</span><span> </span><span>       "Args": {
</span><span> </span><span>         "connectionString": "Data Source=localhost;Port=3308;User ID=root;Password=root;Initial Catalog=lincms;Charset=utf8mb4;SslMode=none;Max pool size=1;Connection LifeTime=20",
</span><span> </span><span>         "autoCreateTable": true,
</span><span> </span><span>         "tableName": "app_serilog",
</span><span> </span><span>         "restrictedToMinimumLevel": "Information",
</span><span> </span><span>         "batchPostingLimit": 4, //1000
</span><span> </span><span>         "period": "0.00:00:03",
</span><span> </span><span>         "options": {
</span><span> </span><span>           "PropertiesToColumnsMapping": {
</span><span> </span><span>             "Exception": "exception",
</span><span> </span><span>             "Level": "level",
</span><span> </span><span>             "Message": "message",
</span><span> </span><span>             "MessageTemplate": "message_template",
</span><span> </span><span>             "Properties": "properties",
</span><span> </span><span>             "Timestamp": "timestamp"
</span><span> </span><span>           },
</span><span> </span><span>           "TimestampInUtc": false,
</span><span> </span><span>           "ExcludePropertiesWithDedicatedColumn": true,
</span><span> </span><span>           "EnumsAsInts": true,
</span><span> </span><span>           "LogRecordsCleanupFrequency": "0.02:00:00",
</span><span> </span><span>           "LogRecordsExpiration": "31.00:00:00"
</span><span> </span><span>         }
</span><span> </span><span>       }
</span></span><span><span>-</span><span>      }
</span></span><span><span>+</span><span>      //{
</span></span><span><span> </span><span>     //  "Name": "MSSqlServer",
</span><span> </span><span>     //  "Args": {
</span><span> </span><span>     //    "connectionString": "Data Source=.;User ID=sa;Password=123456;Integrated Security=True;Initial Catalog=LinCMS;Pooling=true;Min Pool Size=1",
</span><span> </span><span>     //    "restrictedToMinimumLevel": "Information",
</span><span> </span><span>     //    "sinkOptionsSection": {
</span><span> </span><span>     //      "tableName": "app_serilog",
</span><span> </span><span>     //      "schemaName": "dbo",
</span><span> </span><span>     //      "autoCreateSqlTable": true,
</span><span> </span><span>     //      "batchPostingLimit": 1000,
</span><span> </span><span>     //      "period": "0.00:00:15"
</span><span> </span><span>     //    },
</span><span> </span><span>     //    "columnOptionsSection": {
</span><span> </span><span>     //      "disableTriggers": true,
</span><span> </span><span>     //      "clusteredColumnstoreIndex": false,
</span><span> </span><span>     //      "primaryKeyColumnName": "id",
</span><span> </span><span>     //      "addStandardColumns": [ "LogEvent" ],
</span><span> </span><span>     //      "removeStandardColumns": [ "Properties" ],
</span><span> </span><span>     //      "additionalColumns": [
</span><span> </span><span>     //        {
</span><span> </span><span>     //          "ColumnName": "event_type",
</span><span> </span><span>     //          "DataType": "int",
</span><span> </span><span>     //          "AllowNull": true
</span><span> </span><span>     //        },
</span><span> </span><span>     //        {
</span><span> </span><span>     //          "ColumnName": "release",
</span><span> </span><span>     //          "DataType": "varchar",
</span><span> </span><span>     //          "DataLength": 32
</span><span> </span><span>     //        },
</span><span> </span><span>     //        {
</span><span> </span><span>     //          "ColumnName": "environment_user_name",
</span><span> </span><span>     //          "PropertyName": "UserName",
</span><span> </span><span>     //          "DataType": "varchar",
</span><span> </span><span>     //          "DataLength": 50
</span><span> </span><span>     //        },
</span><span> </span><span>     //        {
</span><span> </span><span>     //          "ColumnName": "all_sqlcolumn_defaults",
</span><span> </span><span>     //          "DataType": "varchar",
</span><span> </span><span>     //          "AllowNull": true,
</span><span> </span><span>     //          "DataLength": -1,
</span><span> </span><span>     //          "NonClusteredIndex": false
</span><span> </span><span>     //        }
</span><span> </span><span>     //      ],
</span><span> </span><span>     //      "id": {
</span><span> </span><span>     //        "columnName": "id",
</span><span> </span><span>     //        "nonClusteredIndex": true
</span><span> </span><span>     //      },
</span><span> </span><span>     //      "level": {
</span><span> </span><span>     //        "columnName": "level",
</span><span> </span><span>     //        "storeAsEnum": true
</span><span> </span><span>     //      },
</span><span> </span><span>     //      //"Properties": {
</span><span> </span><span>     //      //  "columnName": "properties",
</span><span> </span><span>     //      //  "excludeAdditionalProperties": true,
</span><span> </span><span>     //      //  "dictionaryElementName": "dict",
</span><span> </span><span>     //      //  "itemElementName": "item",
</span><span> </span><span>     //      //  "omitDictionaryContainerElement": false,
</span><span> </span><span>     //      //  "omitSequenceContainerElement": false,
</span><span> </span><span>     //      //  "omitStructureContainerElement": false,
</span><span> </span><span>     //      //  "omitElementIfEmpty": true,
</span><span> </span><span>     //      //  "propertyElementName": "prop",
</span><span> </span><span>     //      //  "rootElementName": "root",
</span><span> </span><span>     //      //  "sequenceElementName": "seq",
</span><span> </span><span>     //      //  "structureElementName": "struct",
</span><span> </span><span>     //      //  "usePropertyKeyAsElementName": false
</span><span> </span><span>     //      //},
</span><span> </span><span>     //      "TimeStamp": {
</span><span> </span><span>     //        "columnName": "timestamp",
</span><span> </span><span>     //        "convertToUtc": true,
</span><span> </span><span>     //        "DataType": "tinyint"
</span><span> </span><span>     //      },
</span><span> </span><span>     //      "MessageTemplate": {
</span><span> </span><span>     //        "columnName": "message_template",
</span><span> </span><span>     //        "convertToUtc": true
</span><span> </span><span>     //      },
</span><span> </span><span>     //      "Timestamp": "timestamp",
</span><span> </span><span>     //      "Exception": {
</span><span> </span><span>     //        "columnName": "exception"
</span><span> </span><span>     //      },
</span><span> </span><span>     //      "Message": {
</span><span> </span><span>     //        "columnName": "message"
</span><span> </span><span>     //      },
</span><span> </span><span>     //      "logEvent": {
</span><span> </span><span>     //        "columnName": "properties",
</span><span> </span><span>     //        "excludeAdditionalProperties": true,
</span><span> </span><span>     //        "excludeStandardColumns": true
</span><span> </span><span>     //      }
</span><span> </span><span>     //    }
</span><span> </span><span>     //  }
</span></span><span><span>+</span><span>      //}
</span></span><span><span> </span><span>   ]
</span><span> </span><span> }
</span></span></code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br><span>73</span><br><span>74</span><br><span>75</span><br><span>76</span><br><span>77</span><br><span>78</span><br><span>79</span><br><span>80</span><br><span>81</span><br><span>82</span><br><span>83</span><br><span>84</span><br><span>85</span><br><span>86</span><br><span>87</span><br><span>88</span><br><span>89</span><br><span>90</span><br><span>91</span><br><span>92</span><br><span>93</span><br><span>94</span><br><span>95</span><br><span>96</span><br><span>97</span><br><span>98</span><br><span>99</span><br><span>100</span><br><span>101</span><br><span>102</span><br><span>103</span><br><span>104</span><br><span>105</span><br><span>106</span><br><span>107</span><br><span>108</span><br><span>109</span><br><span>110</span><br><span>111</span><br><span>112</span><br><span>113</span><br><span>114</span><br><span>115</span><br><span>116</span><br><span>117</span><br><span>118</span><br><span>119</span><br><span>120</span><br><span>121</span><br><span>122</span><br><span>123</span><br><span>124</span><br><span>125</span><br><span>126</span><br><span>127</span><br><span>128</span><br><span>129</span><br><span>130</span><br><span>131</span><br><span>132</span><br><span>133</span><br><span>134</span><br><span>135</span><br><span>136</span><br><span>137</span><br><span>138</span><br><span>139</span><br><span>140</span><br><span>141</span><br><span>142</span><br><span>143</span><br><span>144</span><br><span>145</span><br><span>146</span><br><span>147</span><br></div></div><h3 id="capé…ç½®" tabindex="-1"> CAPé…ç½®</h3>
<p>å› ä¸ºç”¨äº†<code>CAP</code>ã€‚capæ¢<code>sql server</code>ã€‚è¿™é‡Œæ”¹æˆ <code>DefaultStorage</code>æ”¹æˆ2ã€‚</p>
<p>å¦‚æœMessqueueæ¢rabbitmqçš„è¯ï¼Œ<code>DefaultMessageQueue</code>å°±æ”¹æˆ1.ç„¶åé…ç½® RabbitMQ</p>
<div><pre><code><span><span> </span><span> "CAP": {
</span></span><span><span>-</span><span>    "DefaultStorage": "1",
</span></span><span><span>+</span><span>    "DefaultStorage": "2",
</span></span><span><span> </span><span>   "DefaultMessageQueue": "0",
</span><span> </span><span>   "Storage": {
</span><span> </span><span>     "InMemoryStorage": 0,
</span><span> </span><span>     "MySql": 1,
</span><span> </span><span>     "SqlServer": 2
</span><span> </span><span>   },
</span><span> </span><span>   "MessageQueue": {
</span><span> </span><span>     "InMemoryQueue": 0,
</span><span> </span><span>     "RabbitMQ": 1
</span><span> </span><span>   },
</span><span> </span><span>   "RabbitMQ": {
</span><span> </span><span>     "HostName": "localhost",
</span><span> </span><span>     "UserName": "admin",
</span><span> </span><span>     "Password": "123456",
</span><span> </span><span>     "Port": 5672,
</span><span> </span><span>     "VirtualHost": "/admin"
</span><span> </span><span>   }
</span><span> </span><span> },
</span></span></code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><p>åŒå‡»<code>LinCms.Application</code>é¡¹ç›®,æ³¨é‡Šæ‰<code>DotNetCore.CAP.MySql</code>çš„å¼•ç”¨ï¼Œå¼•ç”¨ SqlServerçš„åŒ…</p>
<div><pre><code>	&lt;ItemGroup>
		&lt;PackageReference Include="AspNet.Security.OAuth.Gitee" Version="5.0.11" />
		&lt;PackageReference Include="AspNet.Security.OAuth.GitHub" Version="5.0.11" />
		&lt;PackageReference Include="AspNet.Security.OAuth.QQ" Version="5.0.11" />
		&lt;PackageReference Include="AutoMapper" Version="10.1.1" />
		&lt;PackageReference Include="Autofac.Extensions.DependencyInjection" Version="7.1.0" />
<span><span>-</span><span>		&lt;PackageReference Include="DotNetCore.CAP.MySql" Version="5.1.3" />
</span></span><span><span>+</span><span>		&lt;PackageReference Include="DotNetCore.CAP.SqlServer" Version="5.1.3" />
</span></span>		&lt;PackageReference Include="IdentityServer4" Version="4.1.2" />
		&lt;PackageReference Include="DotNetCore.CAP" Version="5.1.3" />
		&lt;PackageReference Include="IdentityModel" Version="5.1.0" />
		&lt;PackageReference Include="MQiniu.Core" Version="1.0.1" />
		&lt;PackageReference Include="Caching.CSRedis" Version="3.6.60" />
		&lt;PackageReference Include="CSRedisCore" Version="3.6.6" />
	&lt;/ItemGroup>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br></div></div><p>æ‰“å¼€<code>LinCms.Application</code>é¡¹ç›®ä¸­çš„<code>CapUnitOfWorkExtensions.cs</code>æ–‡ä»¶</p>
<p>ä¿®æ”¹æ–¹æ³•<code>BeginTransaction</code></p>
<div><pre><code>public static ICapTransaction BeginTransaction(this IUnitOfWork unitOfWork, ICapPublisher publisher, bool autoCommit = false)
{
<span><span> </span><span>   //çœ‹äº†æºç ï¼Œæ¢äº†æ–°çš„å†™æ³•ï¼Œæ¢ä¸åŒçš„æ•°æ®åº“ï¼Œå°±éœ€è¦æ‰‹åŠ¨ä¿®æ”¹è¿™æ®µä»£ç äº†ï¼ˆMySqlCapTransactionï¼‰
</span><span> </span><span>   //publisher.Transaction.Value = (ICapTransaction)publisher.ServiceProvider.GetService(typeof(ICapTransaction));æ–°ç‰ˆæœ¬åªèƒ½å¾—åˆ°nul
</span></span><span><span>-</span><span>   publisher.Transaction.Value = ActivatorUtilities.CreateInstance&lt;MySqlCapTransaction>(publisher.ServiceProvider);
</span></span><span><span>+</span><span>   publisher.Transaction.Value = ActivatorUtilities.CreateInstance&lt;SqlServerCapTransaction>(publisher.ServiceProvider);
</span></span>}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div>]]></content>
    <published>2021-12-22T18:31:25.000Z</published>
  </entry>
  <entry>
    <title type="html">ASP.NETCore ä¸‹ FreeSql çš„ä»“å‚¨äº‹åŠ¡</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/aspnetcore-repository-unitofwork.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/aspnetcore-repository-unitofwork.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="asp-netcore-ä¸‹-freesql-çš„ä»“å‚¨äº‹åŠ¡" tabindex="-1"> ASP.NETCore ä¸‹ FreeSql çš„ä»“å‚¨äº‹åŠ¡</h1>
<h4 id="ç¬¬ä¸€æ­¥-é…ç½®-startup-cs-æ³¨å…¥" tabindex="-1"> ç¬¬ä¸€æ­¥ï¼šé…ç½® Startup.cs æ³¨å…¥</h4>
<p>å¼•å…¥åŒ…</p>
<div><pre><code>dotnet <span>add</span> package FreeSql
dotnet <span>add</span> package FreeSql<span>.</span>DbContext
dotnet <span>add</span> package FreeSql<span>.</span>Provider<span>.</span>MySqlConnector
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>é…ç½® Startup.cs æ³¨å…¥</p>
<div><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  <span>IConfigurationSection</span> Mysql <span>=</span> Configuration<span>.</span><span>GetSection</span><span>(</span><span>"Mysql"</span><span>)</span><span>;</span>
        Fsql <span>=</span> <span>new</span> <span>FreeSqlBuilder</span><span>(</span><span>)</span>
            <span>.</span><span>UseConnectionString</span><span>(</span>DataType<span>.</span>MySql<span>,</span> Mysql<span>.</span>Value<span>)</span>
            <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span>
            <span>.</span><span>UseNameConvert</span><span>(</span>NameConvertType<span>.</span>PascalCaseToUnderscoreWithLower<span>)</span>
            <span>.</span><span>UseMonitorCommand</span><span>(</span>cmd <span>=></span> Trace<span>.</span><span>WriteLine</span><span>(</span>cmd<span>.</span>CommandText<span>)</span><span>)</span>
            <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
    services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>IFreeSql<span>></span></span></span><span>(</span>fsql<span>)</span><span>;</span>
    services<span>.</span><span><span>AddScoped</span><span><span>&lt;</span>UnitOfWorkManager<span>></span></span></span><span>(</span><span>)</span><span>;</span>
    services<span>.</span><span>AddFreeRepository</span><span>(</span><span>null</span><span>,</span> <span>typeof</span><span>(</span><span>Startup</span><span>)</span><span>.</span>Assembly<span>)</span><span>;</span>
    <span>//æ–°å¢è‡ªå·±çš„æœåŠ¡ï¼Œè¿™é‡Œåªæœ‰å®ç°</span>
    services<span>.</span><span><span>AddScoped</span><span><span>&lt;</span>TransBlogService<span>></span></span></span><span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><ul>
<li>appsettings.json</li>
</ul>
<div><pre><code><span>{</span>
  <span>"Mysql"</span><span>:</span> <span>"Data Source=127.0.0.1;Port=3306;User ID=root;Password=root;Initial Catalog=ovov_freesql_repository;Charset=utf8;SslMode=none;Max pool size=10"</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><table>
<thead>
<tr>
<th>UnitOfWorkManager æˆå‘˜</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>IUnitOfWork Current</td>
<td>è¿”å›å½“å‰çš„å·¥ä½œå•å…ƒ</td>
</tr>
<tr>
<td>void Binding(repository)</td>
<td>å°†ä»“å‚¨çš„äº‹åŠ¡äº¤ç»™å®ƒç®¡ç†</td>
</tr>
<tr>
<td>IUnitOfWork Begin(propagation, isolationLevel)</td>
<td>åˆ›å»ºå·¥ä½œå•å…ƒ</td>
</tr>
</tbody>
</table>
<ul>
<li>TransBlogService.cs</li>
</ul>
<div><pre><code><span>private</span> <span>readonly</span> <span>IBaseRepository<span>&lt;</span>Blog<span>,</span> <span>int</span><span>></span></span> _blogRepository<span>;</span>
<span>private</span> <span>readonly</span> <span>IBaseRepository<span>&lt;</span>Tag<span>,</span> <span>int</span><span>></span></span> _tagRepository<span>;</span>
<span>private</span> <span>readonly</span> <span>UnitOfWorkManager</span> _unitOfWorkManager<span>;</span>

<span>public</span> <span>TransBlogService</span><span>(</span><span>IBaseRepository<span>&lt;</span>Blog<span>,</span> <span>int</span><span>></span></span> blogRepository<span>,</span> <span>IBaseRepository<span>&lt;</span>Tag<span>,</span> <span>int</span><span>></span></span> tagRepository<span>,</span><span>UnitOfWorkManager</span> unitOfWorkManager<span>)</span>
<span>{</span>
    _blogRepository <span>=</span> blogRepository <span>;</span>
    _tagRepository <span>=</span> tagRepository <span>;</span>
    _unitOfWorkManager <span>=</span> unitOfWorkManager<span>;</span>
<span>}</span>

<span>public</span> <span>async</span> <span>Task</span> <span>CreateBlogUnitOfWorkAsync</span><span>(</span><span>Blog</span> blog<span>,</span>List<span>&lt;</span>Tag<span>></span>tagList<span>)</span>
<span>{</span>
    <span>using</span> <span>(</span><span>IUnitOfWork</span> unitOfWork <span>=</span> _unitOfWorkManager<span>.</span><span>Begin</span><span>(</span><span>)</span><span>)</span>
    <span>{</span>
        <span>try</span>
        <span>{</span>
            <span>await</span> _blogRepository<span>.</span><span>InsertAsync</span><span>(</span>blog<span>)</span><span>;</span>
            tagList<span>.</span><span>ForEach</span><span>(</span>r <span>=></span>
            <span>{</span>
                r<span>.</span>PostId <span>=</span> blog<span>.</span>Id<span>;</span>
            <span>}</span><span>)</span><span>;</span>
            <span>await</span> _tagRepository<span>.</span><span>InsertAsync</span><span>(</span>tagList<span>)</span><span>;</span>
            unitOfWork<span>.</span><span>Commit</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
        <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span>
        <span>{</span>
            <span>//å®é™… å¯ä»¥ä¸Rollbackã€‚å› ä¸ºIUnitOfWorkå†…éƒ¨Disposeï¼Œä¼šæŠŠæ²¡æœ‰Commitçš„äº‹åŠ¡Rollbackå›æ¥ï¼Œä½†èƒ½æå‰Rollback</span>

            unitOfWork<span>.</span><span>Rollback</span><span>(</span><span>)</span><span>;</span>
            <span>//è®°å½•æ—¥å¿—ã€æˆ–ç»§ç»­throw;å‡ºæ¥</span>
        <span>}</span>
    <span>}</span>
<span>}</span>

<span>public</span> <span>async</span> <span>Task</span> <span>UpdateBlogAsync</span><span>(</span><span><span>int</span></span> id<span>)</span>
<span>{</span>
    <span>using</span> <span>(</span><span>IUnitOfWork</span> unitOfWork <span>=</span> _unitOfWorkManager<span>.</span><span>Begin</span><span>(</span><span>)</span><span>)</span>
    <span>{</span>
        <span>try</span>
        <span>{</span>
            <span>Blog</span> blog <span>=</span> _blogRepository<span>.</span>Select<span>.</span><span>Where</span><span>(</span>r <span>=></span> r<span>.</span>Id <span>==</span> id<span>)</span><span>.</span><span>First</span><span>(</span><span>)</span><span>;</span>
            blog<span>.</span>IsDeleted <span>=</span> <span>true</span><span>;</span>
            <span>await</span> _blogRepository<span>.</span><span>UpdateAsync</span><span>(</span>blog<span>)</span><span>;</span>
            unitOfWork<span>.</span><span>Commit</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
        <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span>
        <span>{</span>
           <span>//è®°å½•æ—¥å¿—ã€æˆ–ç»§ç»­throw;å‡ºæ¥</span>
            unitOfWork<span>.</span><span>Rollback</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br></div></div><table>
<thead>
<tr>
<th>IUnitOfWork æˆå‘˜</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>IFreeSql Orm</td>
<td>è¯¥å¯¹è±¡ Select/Delete/Insert/Update/InsertOrUpdate ä¸å·¥ä½œå•å…ƒäº‹åŠ¡ä¿æŒä¸€è‡´ï¼Œå¯çœç•¥ä¼ é€’ WithTransaction</td>
</tr>
<tr>
<td>DbTransaction GetOrBeginTransaction()</td>
<td>å¼€å¯äº‹åŠ¡ï¼Œæˆ–è€…è¿”å›å·²å¼€å¯çš„äº‹åŠ¡</td>
</tr>
<tr>
<td>void Commit()</td>
<td>æäº¤äº‹åŠ¡</td>
</tr>
<tr>
<td>void Rollback()</td>
<td>å›æ»šäº‹åŠ¡</td>
</tr>
<tr>
<td>DbContext.EntityChangeReport EntityChangeReport</td>
<td>å·¥ä½œå•å…ƒå†…çš„å®ä½“å˜åŒ–è·Ÿè¸ª</td>
</tr>
</tbody>
</table>
<h4 id="å®Œæ•´çš„ä»£ç " tabindex="-1"> å®Œæ•´çš„ä»£ç </h4>
<ul>
<li><a href="https://github.com/luoyunchong/dotnetcore-examples/blob/master/ORM/FreeSql/OvOv.Core/Domain/Blog.cs" target="_blank" rel="noopener noreferrer">Blog.cs</a></li>
<li><a href="https://github.com/luoyunchong/dotnetcore-examples/blob/master/ORM/FreeSql/OvOv.Core/Domain/Tag.cs" target="_blank" rel="noopener noreferrer">Tag.cs</a></li>
<li><a href="https://github.com/luoyunchong/dotnetcore-examples/blob/master/ORM/FreeSql/OvOv.FreeSql.AutoFac.DynamicProxy/Services/TransBlogService.cs" target="_blank" rel="noopener noreferrer">TransBlogService.cs</a></li>
</ul>
<p>ä»¥ä¸Šä½¿ç”¨çš„æ˜¯æ³›å‹ä»“å‚¨ï¼Œé‚£æˆ‘ä»¬å¦‚æœæ˜¯é‡å†™ä¸€ä¸ªä»“å‚¨ å¦‚ä½•ä¿æŒå’Œ<code>UnitOfWorkManager</code>åŒä¸€ä¸ªäº‹åŠ¡å‘¢ã€‚
ç»§æ‰¿ç°æœ‰çš„<code>DefaultRepository&lt;,&gt;</code>ä»“å‚¨ï¼Œå®ç°è‡ªå®šä¹‰çš„ä»“å‚¨<code>BlogRepository.cs</code>,</p>
<div><pre><code>    <span>public</span> <span>class</span> <span>BlogRepository</span> <span>:</span> <span><span>DefaultRepository<span>&lt;</span>Blog<span>,</span> <span>int</span><span>></span></span><span>,</span> <span>IBlogRepository</span></span>
    <span>{</span>
        <span>public</span> <span>BlogRepository</span><span>(</span><span>UnitOfWorkManager</span> uowm<span>)</span> <span>:</span> <span>base</span><span>(</span>uowm<span>?.</span>Orm<span>,</span> uowm<span>)</span>
        <span>{</span>
        <span>}</span>

        <span>public</span> <span>List<span>&lt;</span>Blog<span>></span></span> <span>GetBlogs</span><span>(</span><span>)</span>
        <span>{</span>
            <span>return</span> Select<span>.</span><span>Page</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>å…¶ä¸­æ¥å£ã€‚<code>IBlogRepository.cs</code></p>
<div><pre><code>    <span>public</span> <span>interface</span> <span>IBlogRepository</span> <span>:</span> <span><span>IBaseRepository<span>&lt;</span>Blog<span>,</span> <span>int</span><span>></span></span></span>
    <span>{</span>
        <span>List<span>&lt;</span>Blog<span>></span></span> <span>GetBlogs</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>åœ¨ startup.cs æ³¨å…¥æ­¤æœåŠ¡</p>
<div><pre><code>    services<span>.</span><span><span>AddScoped</span><span><span>&lt;</span>IBlogRepository<span>,</span> BlogRepository<span>></span></span></span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div>]]></content>
    <published>2021-12-12T10:05:43.000Z</published>
  </entry>
  <entry>
    <title type="html">Autofac ä¾èµ–æ³¨å…¥å°çŸ¥è¯†</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/autofac.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/autofac.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="autofac-ä¾èµ–æ³¨å…¥å°çŸ¥è¯†" tabindex="-1"> Autofac ä¾èµ–æ³¨å…¥å°çŸ¥è¯†</h1>
<h2 id="æ§åˆ¶åè½¬-ä¾èµ–æ³¨å…¥-ioc-di" tabindex="-1"> æ§åˆ¶åè½¬/ä¾èµ–æ³¨å…¥ IOC/DI</h2>
<p>ä¾èµ–æ¥å£è€Œä¸ä¾èµ–äºå®ç°ï¼Œæ˜¯é¢å‘å¯¹è±¡çš„å…­å¤§è®¾è®¡åŸåˆ™ï¼ˆSOLID)ä¹‹ä¸€ã€‚å³ä¾èµ–å€’ç½®åŸåˆ™(<code>Dependence Inversion Principle</code>)</p>
<p>ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºä¸‰ç§ï¼Œå…·ä½“å¦‚ä¸‹</p>
<ul>
<li><code>Singleton</code> å•ä¾‹ï¼ˆå…¨å±€å”¯ä¸€å®ä¾‹ï¼‰</li>
<li><code>Scoped</code> èŒƒå›´ ï¼ˆåœ¨åŒä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå†…æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼‰</li>
<li><code>Transient</code> ç¬æ—¶ï¼ˆæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼‰</li>
</ul>
<h2 id="ä½¿ç”¨è¯´æ˜" tabindex="-1"> ä½¿ç”¨è¯´æ˜</h2>
<p>åˆ›å»º<code>ASP.NET Core 3.0+</code>çš„é¡¹ç›®ï¼Œå¹¶å®‰è£…<code>Autofac</code>åŒ…</p>
<div><pre><code>dotnet <span>add</span> package Autofac.Extensions.DependencyInjection
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>åœ¨ Program ä¸­ Host ä¸»æœºæŒ‡å®š <code>.UseServiceProviderFactory(new AutofacServiceProviderFactory())</code>.</p>
<p>UseServiceProviderFactory è°ƒç”¨ Autofac æä¾›ç¨‹åº,é™„åŠ åˆ°é€šç”¨å®¿ä¸»æœºåˆ¶ã€‚</p>
<div><pre><code>public class Program
{
<span><span> </span><span>   public static void Main(string[] args)
</span><span> </span><span>   {
</span><span> </span><span>       var host = Host.CreateDefaultBuilder(args)
</span></span><span><span>+</span><span>       .UseServiceProviderFactory(new AutofacServiceProviderFactory())
</span></span><span><span> </span><span>       .ConfigureWebHostDefaults(webHostBuilder => {
</span><span> </span><span>           webHostBuilder
</span><span> </span><span>           .UseContentRoot(Directory.GetCurrentDirectory())
</span><span> </span><span>           .UseIISIntegration()
</span><span> </span><span>           .UseStartup&lt;Startup>();
</span><span> </span><span>       })
</span><span> </span><span>       .Build();
</span></span>
<span><span> </span><span>       host.Run();
</span><span> </span><span>   }
</span></span>}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><p>åœ¨ StartUp ä¸­é…ç½®</p>
<div><pre><code>public class Startup
{
<span><span> </span><span> public Startup(IConfiguration configuration)
</span><span> </span><span> {
</span><span> </span><span>   this.Configuration = configuration;
</span><span> </span><span> }
</span></span>
<span><span> </span><span> public IConfiguration Configuration { get; private set; }
</span></span>
<span><span>+</span><span>  public ILifetimeScope AutofacContainer { get; private set; }
</span></span>
<span><span> </span><span> public void ConfigureServices(IServiceCollection services)
</span><span> </span><span> {
</span><span> </span><span>   services.AddOptions();
</span><span> </span><span> }
</span></span>
<span><span> </span><span> // ConfigureContainer is where you can register things directly
</span><span> </span><span> // with Autofac. This runs after ConfigureServices so the things
</span><span> </span><span> // here will override registrations made in ConfigureServices.
</span><span> </span><span> // Don't build the container; that gets done for you by the factory.
</span><span> </span><span> public void ConfigureContainer(ContainerBuilder builder)
</span><span> </span><span> {
</span><span> </span><span>   // Register your own things directly with Autofac here. Don't
</span><span> </span><span>   // call builder.Populate(), that happens in AutofacServiceProviderFactory
</span><span> </span><span>   // for you.
</span></span><span><span>+</span><span>    builder.RegisterModule(new MyApplicationModule());
</span></span><span><span> </span><span> }
</span></span>
<span><span> </span><span> public void Configure(
</span><span> </span><span>   IApplicationBuilder app,
</span><span> </span><span>   ILoggerFactory loggerFactory)
</span><span> </span><span> {
</span></span><span><span>+</span><span>   this.AutofacContainer = app.ApplicationServices.GetAutofacRoot();
</span></span>
<span><span> </span><span>   loggerFactory.AddConsole(this.Configuration.GetSection("Logging"));
</span><span> </span><span>   loggerFactory.AddDebug();
</span><span> </span><span>   app.UseMvc();
</span><span> </span><span> }
</span></span>}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br></div></div><p>å®šä¹‰æ³¨å…¥å®ç°</p>
<div><pre><code><span>public</span> <span>class</span> <span>MyApplicationModule</span> <span>:</span> <span><span>Autofac<span>.</span>Module</span></span>
<span>{</span>
    <span>protected</span> <span>override</span> <span><span>void</span></span> <span>Load</span><span>(</span><span>ContainerBuilder</span> builder<span>)</span>
    <span>{</span>
      builder<span>.</span><span><span>RegisterType</span><span><span>&lt;</span>HttpContextAccessor<span>></span></span></span><span>(</span><span>)</span><span>.</span><span><span>As</span><span><span>&lt;</span>IHttpContextAccessor<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>SingleInstance</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><ul>
<li>æ³¨å†Œæ³›å‹ä»“å‚¨</li>
</ul>
<div><pre><code>builder<span>.</span><span>RegisterGeneric</span><span>(</span><span>typeof</span><span>(</span><span>AuditBaseRepository<span>&lt;</span><span>></span></span><span>)</span><span>)</span><span>.</span><span>As</span><span>(</span><span>typeof</span><span>(</span><span>IAuditBaseRepository<span>&lt;</span><span>></span></span><span>)</span><span>)</span><span>.</span><span>InstancePerLifetimeScope</span><span>(</span><span>)</span><span>;</span>
builder<span>.</span><span>RegisterGeneric</span><span>(</span><span>typeof</span><span>(</span><span>AuditBaseRepository<span>&lt;</span><span>,</span><span>></span></span><span>)</span><span>)</span><span>.</span><span>As</span><span>(</span><span>typeof</span><span>(</span><span>IAuditBaseRepository<span>&lt;</span><span>,</span><span>></span></span><span>)</span><span>)</span><span>.</span><span>InstancePerLifetimeScope</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><ul>
<li>ä¸€ä¸ªæ¥å£å¤šä¸ªå®ç°,ä½¿ç”¨ Namedï¼ŒåŒºåˆ†ã€å‚æ•°ä¸ºå­—ç¬¦ä¸²å³å¯ã€‚</li>
</ul>
<p>æ³¨å†ŒæœåŠ¡</p>
<div><pre><code>builder<span>.</span><span><span>RegisterType</span><span><span>&lt;</span>IdentityServer4Service<span>></span></span></span><span>(</span><span>)</span><span>.</span><span><span>Named</span><span><span>&lt;</span>ITokenService<span>></span></span></span><span>(</span><span>typeof</span><span>(</span><span>IdentityServer4Service</span><span>)</span><span>.</span>Name<span>)</span><span>.</span><span>InstancePerLifetimeScope</span><span>(</span><span>)</span><span>;</span>
builder<span>.</span><span><span>RegisterType</span><span><span>&lt;</span>JwtTokenService<span>></span></span></span><span>(</span><span>)</span><span>.</span><span><span>Named</span><span><span>&lt;</span>ITokenService<span>></span></span></span><span>(</span><span>typeof</span><span>(</span><span>JwtTokenService</span><span>)</span><span>.</span>Name<span>)</span><span>.</span><span>InstancePerLifetimeScope</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>æ ¹æ® Name è·å–å“ªä¸ªæœåŠ¡</p>
<div><pre><code><span>private</span> <span>readonly</span> <span>ITokenService</span> _tokenService<span>;</span>
<span>public</span> <span>AccountController</span><span>(</span><span>IComponentContext</span> componentContext<span>,</span> <span>IConfiguration</span> configuration<span>)</span>
<span>{</span>
    <span><span>bool</span></span> isIdentityServer4 <span>=</span> configuration<span>.</span><span>GetSection</span><span>(</span><span>"Service:IdentityServer4"</span><span>)</span><span>.</span>Value<span>?.</span><span>ToBoolean</span><span>(</span><span>)</span> <span>??</span> <span>false</span><span>;</span>
    _tokenService <span>=</span> componentContext<span>.</span><span><span>ResolveNamed</span><span><span>&lt;</span>ITokenService<span>></span></span></span><span>(</span>isIdentityServer4 <span>?</span> <span>typeof</span><span>(</span><span>IdentityServer4Service</span><span>)</span><span>.</span>Name <span>:</span> <span>typeof</span><span>(</span><span>JwtTokenService</span><span>)</span><span>.</span>Name<span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>å¯é€šè¿‡ appsettings.json ä¸­é…ç½®,å¯å†³å®šæ˜¯å“ªä¸ªæœåŠ¡</p>
<div><pre><code>  <span>"Service"</span><span>:</span> <span>{</span>
    <span>"IdentityServer4"</span><span>:</span> <span>false</span>
  <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><ul>
<li>åŸºäºæ¥å£çš„æ³¨å…¥</li>
</ul>
<p><code>AsImplementedInterfaces</code> Specifies that a type from a scanned assembly is registered as providing all of its implemented interfaces.
æŒ‡å®šå°†æ‰«æç¨‹åºé›†ä¸­çš„ç±»å‹æ³¨å†Œä¸ºæä¾›å…¶æ‰€æœ‰å®ç°çš„æ¥å£ã€‚</p>
<p>æ ¹æ®æ¥å£<code>ITransientDependency</code>å¯ä»¥å¾—åˆ°æœ‰å“ªäº›ç±»ç»§æ‰¿äº†æ­¤æ¥å£ï¼Œå¹¶åˆ¤æ–­æ˜¯ç±»ï¼Œä¸æ˜¯æŠ½è±¡ç±»ï¼Œä¸æ˜¯æ³›å‹ã€‚</p>
<p>æ‰€æœ‰ç»§æ‰¿ç±»æ¥å£çš„ç±»ï¼Œå°†ä»¥æ¥å£çš„æ–¹å¼è‡ªåŠ¨æ³¨å…¥å®ä¾‹ã€‚å¯ç›´æ¥ä½¿ç”¨æ¥å£å³å¯ã€‚</p>
<ul>
<li>InstancePerDependency ç¬æ—¶ ï¼ˆæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼‰</li>
<li>InstancePerLifetimeScope èŒƒå›´ï¼ˆåœ¨åŒä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå†…æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼‰</li>
<li>SingleInstance å•ä¾‹ï¼ˆå…¨å±€å”¯ä¸€å®ä¾‹ï¼‰</li>
</ul>
<div><pre><code>    <span>public</span> <span>class</span> <span>DependencyModule</span> <span>:</span> <span><span>Autofac<span>.</span>Module</span></span>
    <span>{</span>
        <span>protected</span> <span>override</span> <span><span>void</span></span> <span>Load</span><span>(</span><span>ContainerBuilder</span> builder<span>)</span>
        <span>{</span>
            <span>Assembly<span>[</span><span>]</span></span> currentAssemblies <span>=</span> AppDomain<span>.</span>CurrentDomain<span>.</span><span>GetAssemblies</span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>r <span>=></span> r<span>.</span>FullName<span>.</span><span>Contains</span><span>(</span><span>"LinCms."</span><span>)</span><span>)</span><span>.</span><span>ToArray</span><span>(</span><span>)</span><span>;</span>

            <span>//æ¯æ¬¡è°ƒç”¨ï¼Œéƒ½ä¼šé‡æ–°å®ä¾‹åŒ–å¯¹è±¡ï¼›æ¯æ¬¡è¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼›</span>
            <span>Type</span> transientDependency <span>=</span> <span>typeof</span><span>(</span><span>ITransientDependency</span><span>)</span><span>;</span>
            builder<span>.</span><span>RegisterAssemblyTypes</span><span>(</span>currentAssemblies<span>)</span>
                <span>.</span><span>Where</span><span>(</span>t <span>=></span> transientDependency<span>.</span><span>GetTypeInfo</span><span>(</span><span>)</span><span>.</span><span>IsAssignableFrom</span><span>(</span>t<span>)</span> <span>&amp;&amp;</span> t<span>.</span>IsClass <span>&amp;&amp;</span> <span>!</span>t<span>.</span>IsAbstract <span>&amp;&amp;</span> <span>!</span>t<span>.</span>IsGenericType<span>)</span>
                <span>.</span><span>AsImplementedInterfaces</span><span>(</span><span>)</span><span>.</span><span>InstancePerDependency</span><span>(</span><span>)</span><span>;</span>

            <span>//åŒä¸€ä¸ªLifetimeç”Ÿæˆçš„å¯¹è±¡æ˜¯åŒä¸€ä¸ªå®ä¾‹</span>
            <span>Type</span> scopeDependency <span>=</span> <span>typeof</span><span>(</span><span>IScopedDependency</span><span>)</span><span>;</span>
            builder<span>.</span><span>RegisterAssemblyTypes</span><span>(</span>currentAssemblies<span>)</span>
                <span>.</span><span>Where</span><span>(</span>t <span>=></span> scopeDependency<span>.</span><span>GetTypeInfo</span><span>(</span><span>)</span><span>.</span><span>IsAssignableFrom</span><span>(</span>t<span>)</span> <span>&amp;&amp;</span> t<span>.</span>IsClass <span>&amp;&amp;</span> <span>!</span>t<span>.</span>IsAbstract <span>&amp;&amp;</span> <span>!</span>t<span>.</span>IsGenericType<span>)</span>
                <span>.</span><span>AsImplementedInterfaces</span><span>(</span><span>)</span><span>.</span><span>InstancePerLifetimeScope</span><span>(</span><span>)</span><span>;</span>

            <span>//å•ä¾‹æ¨¡å¼ï¼Œæ¯æ¬¡è°ƒç”¨ï¼Œéƒ½ä¼šä½¿ç”¨åŒä¸€ä¸ªå®ä¾‹åŒ–çš„å¯¹è±¡ï¼›æ¯æ¬¡éƒ½ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼›</span>
            <span>Type</span> singletonDependency <span>=</span> <span>typeof</span><span>(</span><span>ISingletonDependency</span><span>)</span><span>;</span>
            builder<span>.</span><span>RegisterAssemblyTypes</span><span>(</span>currentAssemblies<span>)</span>
                <span>.</span><span>Where</span><span>(</span>t <span>=></span> singletonDependency<span>.</span><span>GetTypeInfo</span><span>(</span><span>)</span><span>.</span><span>IsAssignableFrom</span><span>(</span>t<span>)</span> <span>&amp;&amp;</span> t<span>.</span>IsClass <span>&amp;&amp;</span> <span>!</span>t<span>.</span>IsAbstract <span>&amp;&amp;</span><span>!</span>t<span>.</span>IsGenericType<span>)</span>
                <span>.</span><span>AsImplementedInterfaces</span><span>(</span><span>)</span><span>.</span><span>SingleInstance</span><span>(</span><span>)</span><span>;</span>

        <span>}</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br></div></div><p>å¦‚æœä¸å†™ç»§æ‰¿ï¼Œå¦‚ä½•æ‰¹é‡æ³¨å…¥å‘¢ã€‚ 1.ç±»åæœ‰è§„åˆ™ 2.åŸºäºç‰¹æ®Šæ ‡ç­¾ 3.ç»§æ‰¿æ¥å£ã€‚</p>
<ul>
<li>ç±»åæœ‰è§„åˆ™
æ¯”å¦‚ä»“å‚¨åç¼€ï¼Œå…¨æ˜¯<code>Repository</code>,å…¶ä¸­<code>Assembly</code>ä¸ºä»“å‚¨çš„å®ç°æ‰€åœ¨ç¨‹åºé›†ã€‚å°†è‡ªåŠ¨æ³¨å…¥æ‰€æœ‰çš„ä»“å‚¨ï¼Œä»“å‚¨å¿…é¡»æœ‰æ¥å£ã€‚</li>
</ul>
<div><pre><code>    <span>Assembly</span> assemblysRepository <span>=</span> Assembly<span>.</span><span>Load</span><span>(</span><span>"LinCms.Infrastructure"</span><span>)</span><span>;</span>
    builder<span>.</span><span>RegisterAssemblyTypes</span><span>(</span>assemblysRepository<span>)</span>
            <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name<span>.</span><span>EndsWith</span><span>(</span><span>"Repository"</span><span>)</span><span>)</span>
            <span>.</span><span>AsImplementedInterfaces</span><span>(</span><span>)</span>
            <span>.</span><span>InstancePerLifetimeScope</span><span>(</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><ul>
<li>æ³¨å…¥æœåŠ¡åå°±æ‰§è¡Œä¸€æ®µé€»è¾‘</li>
</ul>
<div><pre><code>builder<span>.</span><span><span>RegisterType</span><span><span>&lt;</span>MigrationStartupTask<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>SingleInstance</span><span>(</span><span>)</span><span>;</span>
builder<span>.</span><span>RegisterBuildCallback</span><span>(</span><span>async</span> <span>(</span>c<span>)</span> <span>=></span> <span>await</span> c<span>.</span><span><span>Resolve</span><span><span>&lt;</span>MigrationStartupTask<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>StartAsync</span><span>(</span><span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h3 id="åŠ¨æ€ä»£ç†" tabindex="-1"> åŠ¨æ€ä»£ç†</h3>
<div><pre><code>dotnet <span>add</span> package Autofac<span>.</span>Extras<span>.</span>DynamicProxy
dotnet <span>add</span> package Castle<span>.</span>Core<span>.</span>AsyncInterceptor
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><ul>
<li>æœåŠ¡æ³¨å†Œ</li>
</ul>
<p>AOP+å±æ€§æ³¨å…¥+ä»¥åç¼€ä¸º Service çš„æœåŠ¡å®ç°ï¼Œæ³¨å…¥ Scope èŒƒå›´çš„ç”Ÿå‘½å‘¨æœŸ+å¯ç”¨æ¥å£çš„æ‹¦æˆªå™¨ã€‚</p>
<ul>
<li>ä½¿ç”¨<code>EnableInterfaceInterceptors</code>åˆ›å»ºæ‰§è¡Œæ‹¦æˆªçš„æ¥å£ä»£ç†ï¼Œ</li>
<li>ä½¿ç”¨<code>EnableClassInterceptors()</code> åŠ¨æ€å¯¹å­ç±»è¿›è¡Œé‡å†™, æ‰§è¡Œ virtual æ–¹æ³•çš„æ‹¦æˆª</li>
</ul>
<div><pre><code>builder<span>.</span><span><span>RegisterType</span><span><span>&lt;</span>UnitOfWorkInterceptor<span>></span></span></span><span>(</span><span>)</span><span>;</span>
builder<span>.</span><span><span>RegisterType</span><span><span>&lt;</span>UnitOfWorkAsyncInterceptor<span>></span></span></span><span>(</span><span>)</span><span>;</span>


<span>List<span>&lt;</span>Type<span>></span></span> interceptorServiceTypes <span>=</span> <span>new</span> <span>List<span>&lt;</span>Type<span>></span></span><span>(</span><span>)</span>
<span>{</span>
    <span>typeof</span><span>(</span><span>UnitOfWorkInterceptor</span><span>)</span><span>,</span>
<span>}</span><span>;</span>

<span>Assembly</span> servicesDllFile <span>=</span> Assembly<span>.</span><span>Load</span><span>(</span><span>"LinCms.Application"</span><span>)</span><span>;</span>
builder<span>.</span><span>RegisterAssemblyTypes</span><span>(</span>servicesDllFile<span>)</span>
    <span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>Name<span>.</span><span>EndsWith</span><span>(</span><span>"Service"</span><span>)</span> <span>&amp;&amp;</span> <span>!</span>a<span>.</span>IsAbstract <span>&amp;&amp;</span> <span>!</span>a<span>.</span>IsInterface <span>&amp;&amp;</span> a<span>.</span>IsPublic<span>)</span>
    <span>.</span><span>AsImplementedInterfaces</span><span>(</span><span>)</span><span>//æ¥å£æ³¨å…¥</span>
    <span>.</span><span>InstancePerLifetimeScope</span><span>(</span><span>)</span><span>//ç”Ÿå‘½å‘¨æœŸï¼šèŒƒå›´</span>
    <span>.</span><span>PropertiesAutowired</span><span>(</span><span>)</span><span>// å±æ€§æ³¨å…¥</span>
    <span>.</span><span>InterceptedBy</span><span>(</span>interceptorServiceTypes<span>.</span><span>ToArray</span><span>(</span><span>)</span><span>)</span><span>//å£°æ˜æ‹¦æˆªå™¨</span>
    <span>.</span><span>EnableInterfaceInterceptors</span><span>(</span><span>)</span><span>;</span><span>//å¯ç”¨æ¥å£çš„æ‹¦æˆªå™¨ã€‚</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><p>è¿™äºŒä¸ªç±»ï¼Œè¯·å‚è€ƒå¦‚ä¸‹ä»£ç </p>
<ul>
<li>åŒæ­¥ï¼šUnitOfWorkInterceptor.cs https://github.com/luoyunchong/lin-cms-dotnetcore/blob/master/src/LinCms.Web/Middleware/UnitOfWorkInterceptor.cs</li>
<li>å¼‚æ­¥æ‹¦æˆªï¼šUnitOfWorkAsyncInterceptor.cs https://github.com/luoyunchong/lin-cms-dotnetcore/blob/master/src/LinCms.Web/Middleware/UnitOfWorkInterceptor.cs</li>
</ul>
<p><code>Autofac.Extras.DynamicProxy</code>ä¾èµ– Castle.Core,å³åªæ”¯æŒåŒæ­¥æ–¹æ³•çš„æ‹¦æˆªã€‚
å¼‚æ­¥æ–¹æ³•çš„æ‹¦æˆªéœ€è¦å®‰è£…åŒ…ï¼š<code>Castle.Core.AsyncInterceptor</code>ã€‚</p>
<ul>
<li>å¼‚æ­¥æ–¹æ³•,åˆ†ä¸ºæœ‰/æ— è¿”å›å€¼ï¼š<code>async Task RunAsync()</code>,<code>asyn Task&lt;Result&gt; RunAsync()</code></li>
<li>åŒæ­¥æ–¹æ³•ï¼š<code>void Run()</code>,<code>Result Run()</code></li>
</ul>
<h3 id="åŒæ­¥æ‹¦æˆª" tabindex="-1"> åŒæ­¥æ‹¦æˆª</h3>
<p>1.å®šä¹‰æ‹¦æˆªå™¨</p>
<div><pre><code><span>public</span> <span>class</span> <span>CallLogger</span> <span>:</span> <span><span>IInterceptor</span></span>
<span>{</span>
  <span>TextWriter</span> _output<span>;</span>

  <span>public</span> <span>CallLogger</span><span>(</span><span>TextWriter</span> output<span>)</span>
  <span>{</span>
    _output <span>=</span> output<span>;</span>
  <span>}</span>

  <span>public</span> <span><span>void</span></span> <span>Intercept</span><span>(</span><span>IInvocation</span> invocation<span>)</span>
  <span>{</span>
    _output<span>.</span><span>Write</span><span>(</span><span>"Calling method {0} with parameters {1}... "</span><span>,</span>
      invocation<span>.</span>Method<span>.</span>Name<span>,</span>
      <span>string</span><span>.</span><span>Join</span><span>(</span><span>", "</span><span>,</span> invocation<span>.</span>Arguments<span>.</span><span>Select</span><span>(</span>a <span>=></span> <span>(</span>a <span>??</span> <span>""</span><span>)</span><span>.</span><span>ToString</span><span>(</span><span>)</span><span>)</span><span>.</span><span>ToArray</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span>

    invocation<span>.</span><span>Proceed</span><span>(</span><span>)</span><span>;</span>

    _output<span>.</span><span>WriteLine</span><span>(</span><span>"Done: result was {0}."</span><span>,</span> invocation<span>.</span>ReturnValue<span>)</span><span>;</span>
  <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br></div></div><p>2.æ³¨å†Œæ‹¦æˆªå™¨ã€‚</p>
<div><pre><code><span>// Named registration</span>
builder<span>.</span><span>Register</span><span>(</span>c <span>=></span> <span>new</span> <span>CallLogger</span><span>(</span>Console<span>.</span>Out<span>)</span><span>)</span>
       <span>.</span><span><span>Named</span><span><span>&lt;</span>IInterceptor<span>></span></span></span><span>(</span><span>"log-calls"</span><span>)</span><span>;</span>

<span>// Typed registration</span>
builder<span>.</span><span>Register</span><span>(</span>c <span>=></span> <span>new</span> <span>CallLogger</span><span>(</span>Console<span>.</span>Out<span>)</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>å°†æ‹¦æˆªå™¨ä¸è¦æ‹¦æˆªçš„ç±»å‹ å…³è”</p>
<div><pre><code><span>[</span><span><span>Intercept</span><span><span>(</span><span>typeof</span><span>(</span><span>CallLogger</span><span>)</span><span>)</span></span></span><span>]</span>
<span>public</span> <span>class</span> <span>First</span>
<span>{</span>
  <span>public</span> <span>virtual</span> <span><span>int</span></span> <span>GetValue</span><span>(</span><span>)</span>
  <span>{</span>
    <span>// Do some calculation and return a value</span>
  <span>}</span>
<span>}</span>

<span>// This attribute will look for a NAMED</span>
<span>// interceptor registration:</span>
<span>[</span><span><span>Intercept</span><span><span>(</span><span>"log-calls"</span><span>)</span></span></span><span>]</span>
<span>public</span> <span>class</span> <span>Second</span>
<span>{</span>
  <span>public</span> <span>virtual</span> <span><span>int</span></span> <span>GetValue</span><span>(</span><span>)</span>
  <span>{</span>
    <span>// Do some calculation and return a value</span>
  <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></div></div><h2 id="é“¾æ¥" tabindex="-1"> é“¾æ¥</h2>
<ul>
<li>å®˜ç½‘ https://autofac.org/</li>
<li>GitHub https://github.com/autofac/Autofac</li>
<li>æ–‡æ¡£ https://autofac.readthedocs.io/en/latest/</li>
</ul>
]]></content>
    <published>2021-12-12T10:05:43.000Z</published>
  </entry>
  <entry>
    <title type="html">Scriban æ¨¡æ¿è¯­è¨€</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/scriban-README.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/scriban-README.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="scriban-æ¨¡æ¿è¯­è¨€" tabindex="-1"> Scriban æ¨¡æ¿è¯­è¨€</h1>
<h3 id="ç›®å½•" tabindex="-1"> ç›®å½•</h3>
<ul>
<li><a href="https://www.cnblogs.com/igeekfan/p/13343331.html" target="_blank" rel="noopener noreferrer">ã€ç¿»è¯‘ã€‘Scriban æ˜¯ä¸€ç§å¿«é€Ÿã€å¼ºå¤§ã€å®‰å…¨å’Œè½»é‡çº§çš„æ–‡æœ¬æ¨¡æ¿è¯­è¨€å’Œ.NET å¼•æ“ï¼Œå…·æœ‰è§£æ liquid æ¨¡æ¿çš„å…¼å®¹æ¨¡å¼</a></li>
<li><a href="">ã€ç¿»è¯‘ã€‘ Scriban languageï¼ˆ å¾…å®Œæˆï¼‰</a></li>
<li><a href="">ã€ç¿»è¯‘ã€‘Scriban runtimeï¼ˆ å¾…å®Œæˆï¼‰</a></li>
<li>åŸæ–‡ Githubï¼š<a href="https://github.com/lunet-io/scriban#readme" target="_blank" rel="noopener noreferrer">https://github.com/lunet-io/scriban#readme</a></li>
</ul>
<p><a href="https://github.com/lunet-io/scriban/actions" target="_blank" rel="noopener noreferrer"><img src="https://github.com/lunet-io/scriban/workflows/ci/badge.svg?branch=master" alt="Build Status" loading="lazy"></a> <a href="https://coveralls.io/github/lunet-io/scriban?branch=master" target="_blank" rel="noopener noreferrer"><img src="https://coveralls.io/repos/github/lunet-io/scriban/badge.svg?branch=master" alt="Coverage Status" loading="lazy"></a> <a href="https://www.nuget.org/packages/Scriban/" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/nuget/v/Scriban.svg" alt="NuGet" loading="lazy"></a></p>
<img  width="160px" height="160px" src="@source/dotnetcore/lin-cms/images/scriban.png">
<p>Scriban æ˜¯ä¸€ç§å¿«é€Ÿã€å¼ºå¤§ã€å®‰å…¨å’Œè½»é‡çº§çš„æ–‡æœ¬æ¨¡æ¿è¯­è¨€å’Œ.NET å¼•æ“ï¼Œå…·æœ‰è§£æ<code>liquid</code>æ¨¡æ¿çš„å…¼å®¹æ¨¡å¼</p>
<div><pre><code><span>// Parse a scriban template</span>
<span><span>var</span></span> template <span>=</span> Template<span>.</span><span>Parse</span><span>(</span><span>"Hello {{name}}!"</span><span>)</span><span>;</span>
<span><span>var</span></span> result <span>=</span> template<span>.</span><span>Render</span><span>(</span><span>new</span> <span>{</span> Name <span>=</span> <span>"World"</span> <span>}</span><span>)</span><span>;</span> <span>// => "Hello World!"</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>ä½¿ç”¨ Liquid è¯­è¨€è§£æ Liquid æ¨¡æ¿ï¼š</p>
<div><pre><code><span>// Parse a liquid template</span>
<span><span>var</span></span> template <span>=</span> Template<span>.</span><span>ParseLiquid</span><span>(</span><span>"Hello {{name}}!"</span><span>)</span><span>;</span>
<span><span>var</span></span> result <span>=</span> template<span>.</span><span>Render</span><span>(</span><span>new</span> <span>{</span> Name <span>=</span> <span>"World"</span> <span>}</span><span>)</span><span>;</span> <span>// => "Hello World!"</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>è¯­è¨€éå¸¸é€šç”¨ï¼Œæ˜“äºé˜…è¯»å’Œä½¿ç”¨ï¼Œç±»ä¼¼äº<a href="https://shopify.github.io/liquid/" target="_blank" rel="noopener noreferrer">liquid</a> æ¨¡æ¿:</p>
<div><pre><code><span><span>var</span></span> template <span>=</span> Template<span>.</span><span>Parse</span><span>(</span><span>@"
&lt;ul id='products'>
  {{ for product in products }}
    &lt;li>
      &lt;h2>{{ product.name }}&lt;/h2>
           Price: {{ product.price }}
           {{ product.description | string.truncate 15 }}
    &lt;/li>
  {{ end }}
&lt;/ul>
"</span><span>)</span><span>;</span>
<span><span>var</span></span> result <span>=</span> template<span>.</span><span>Render</span><span>(</span><span>new</span> <span>{</span> Products <span>=</span> <span>this</span><span>.</span>ProductList <span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><blockquote>
<p><strong>æ³¨æ„</strong></p>
<p>é»˜è®¤æƒ…å†µä¸‹, .NET å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ä¼šè‡ªåŠ¨ä»¥å°å†™å’Œ<code>_</code>å‘½åï¼Œè¿™æ„å‘³ç€åƒ<code>MyMethodIsNice</code>è¿™æ ·çš„å±æ€§å°†è¢«å…¬å¼€ä¸º<code>my_method_is_nice</code>.è¿™æ˜¯é»˜è®¤çº¦å®šï¼Œæœ€åˆæ˜¯ä¸ºäº†åŒ¹é…<code>liquid</code>æ¨¡æ¿çš„è¡Œä¸ºã€‚
å¦‚æœè¦æ”¹å˜æ­¤è¡Œä¸ºï¼Œåˆ™éœ€è¦ä½¿ç”¨ <a href="/dotnetcore/lin-cms/doc/runtime.html#member-renamer"><code>MemberRenamer</code></a> å§”æ‰˜</p>
</blockquote>
<h2 id="ç‰¹æ€§" tabindex="-1"> ç‰¹æ€§</h2>
<ul>
<li>éå¸¸<strong>é«˜æ•ˆ</strong>,<strong>å¿«é€Ÿ</strong> è§£æå™¨å’Œ<strong>è½»é‡çº§</strong>çš„è¿è¡Œæ—¶. å¯¹ CPU å’Œåƒåœ¾æ”¶é›†å™¨å‹å¥½. æŸ¥çœ‹</li>
<li><a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/benchmarks.md" target="_blank" rel="noopener noreferrer">benchmarks</a>è·å–æ›´å¤šç»†èŠ‚.</li>
<li>ç”± Lexer / Parser æä¾›ä¸€ä¸ª<strong>å®Œæ•´çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œfast, versatile and robust(å¿«é€Ÿï¼Œé€šç”¨ä¸”å¼ºå¤§)</strong>, æ¯”åŸºäº regex çš„è§£æå™¨æ›´é«˜æ•ˆ
<ul>
<li>é”™è¯¯æŠ¥å‘Š:èƒ½æä¾›ç²¾ç¡®çš„æºä»£ç ä½ç½® ï¼ŒåŒ…æ‹¬(path, column and line)</li>
<li><strong>å°† AST å†™å…¥è„šæœ¬æ–‡æœ¬çš„å½¢å¼</strong>, ä½¿ç”¨ <a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/runtime.md#ast-to-text" target="_blank" rel="noopener noreferrer"><code>Template.ToText</code></a>, å¯ä»¥æ“ä½œå†…å­˜ä¸­çš„è„šæœ¬å¹¶å°†å…¶é‡æ–°ä¿å­˜åˆ°ç£ç›˜, å¯¹äº <strong>roundtripï¼ˆå¾€è¿”ï¼‰çš„è„šæœ¬æ›´æ–°æ–¹æ¡ˆ</strong>æ˜¯æœ‰ç”¨çš„</li>
</ul>
</li>
<li><strong>å…¼å®¹<code>liquid</code></strong> æ¨¡æ¿ å¯ä½¿ç”¨<code>Template.ParseLiquid</code> æ–¹æ³•
<ul>
<li>è™½ç„¶ <code>liquid</code> è¯­è¨€ä¸å¦‚<code>scriban</code>å¼ºå¤§, ä½†è¯¥æ¨¡å¼ä» <code>liquid</code> åˆ™æ›´å®¹æ˜“åœ°è¿ç§»è‡³ <code>scriban</code></li>
<li>åœ¨ <a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/runtime.md#ast-to-text" target="_blank" rel="noopener noreferrer">AST to text</a> æ¨¡å¼ä¸‹,å°†å¯¹æ¨¡æ¿<code>Template.ParseLiquid</code>è¿›è¡Œè§£æï¼Œæ›¿æ¢æˆ<code>Template.ToText</code>,å³å¯å°†<code>liquid</code> è„šæœ¬ è½¬æ¢æˆ <code>scriban</code> è„šæœ¬</li>
<li>ç”±äº liquid è¯­è¨€æ²¡æœ‰ä¸¥æ ¼å®šä¹‰ å¹¶ä¸”å®ƒæœ‰ç€ä¸åŒç‰ˆæœ¬çš„ liquid è¯­æ³•ï¼Œåœ¨ä½¿ç”¨ scriban çš„ liquid æ¨¡æ¿æ—¶ä¼šæœ‰ä¸€äº›é™åˆ¶, æŸ¥çœ‹æ­¤æ–‡æ¡£äº†è§£è¯¦æƒ… <a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/liquid-support.md" target="_blank" rel="noopener noreferrer">liquid support in scriban</a></li>
</ul>
</li>
<li><strong>å¯æ‰©å±•çš„è¿è¡Œæ—¶</strong> æä¾›è®¸å¤šæ‰©å±•ç‚¹</li>
<li>æ”¯æŒ <code>async</code>/<code>await</code> çš„è„šæœ¬æ”¯æŒ (e.g <code>Template.RenderAsync</code>)</li>
<li><a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/language.md#14-whitespace-control" target="_blank" rel="noopener noreferrer">ç²¾ç¡®æ§åˆ¶ç©ºç™½æ–‡æœ¬è¾“å‡º</a></li>
<li><a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/language.md" target="_blank" rel="noopener noreferrer">å®Œæ•´çš„è¯­è¨€ç‰¹æ€§</a> åŒ…æ‹¬ <code>if</code>/<code>else</code>/<code>for</code>/<code>while</code>, <a href="/dotnetcore/lin-cms/doc/language.html#8-expressions">expressions</a> (<code>x = 1 + 2</code>), conditions... etc.</li>
<li><a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/language.md#89-function-call-expression" target="_blank" rel="noopener noreferrer">å‡½æ•°è°ƒç”¨å’Œç®¡é“</a> (<code>myvar | string.capitalize</code>)
<ul>
<li><a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/language.md#7-functions" target="_blank" rel="noopener noreferrer">è‡ªå®šä¹‰å‡½æ•°</a> é€šè¿‡<code>func</code>è¯­å¥ç›´æ¥å°†å‡½æ•°è‡ªå®šä¹‰åˆ°è¯­è¨€ä¸­ é€šè¿‡<code>alias @ directive</code>å¯ä½¿ç”¨<strong>function pointers/delegates</strong></li>
<li>ä» runtime API ç»‘å®š <a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/runtime.md#imports-functions-from-a-net-class" target="_blank" rel="noopener noreferrer">.NET è‡ªå®šä¹‰å‡½æ•°</a>ï¼Œå¹¶æä¾›è®¸å¤šä¸.NET å¯¹è±¡æ¥å£çš„<a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/runtime.md#the-scriptobject" target="_blank" rel="noopener noreferrer">é€‰é¡¹</a> ã€‚</li>
</ul>
</li>
<li><a href="/dotnetcore/lin-cms/doc/language.html#5-objects">Complex objects (å¤æ‚å¯¹è±¡)</a> (javascript/json like objects <code>x = {mymember: 1}</code>) and <a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/language.md#6-arrays" target="_blank" rel="noopener noreferrer">arrays</a> (e.g <code>x = [1,2,3,4]</code>)</li>
<li>é€šå¸¸ç”±<code>wrap</code>è¯­å¥ä½¿ç”¨å¯ä»¥å°† <a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/language.md#98-wrap-function-arg1argn--end" target="_blank" rel="noopener noreferrer">a block of statements ï¼ˆè¯­å¥å—ï¼‰</a> ä¼ é€’ç»™å‡½æ•°,</li>
<li>ä¸€äº›<a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/builtins.md" target="_blank" rel="noopener noreferrer">å†…ç½®å‡½æ•°</a>:
<ul>
<li><a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/builtins.md#array-functions" target="_blank" rel="noopener noreferrer"><code>arrays functions</code></a></li>
<li><a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/builtins.md#date-functions" target="_blank" rel="noopener noreferrer"><code>date</code></a></li>
<li><a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/builtins.md#html-functions" target="_blank" rel="noopener noreferrer"><code>html</code></a></li>
<li><a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/builtins.md#math-functions" target="_blank" rel="noopener noreferrer"><code>maths functions</code></a></li>
<li><a href="/dotnetcore/lin-cms/doc/builtins.html#object-functions"><code>object</code></a></li>
<li><a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/builtins.md#regex-functions" target="_blank" rel="noopener noreferrer"><code>regex functions</code></a></li>
<li><a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/builtins.md#string-functions" target="_blank" rel="noopener noreferrer"><code>string functions</code></a></li>
<li><a href="/dotnetcore/lin-cms/doc/builtins.html#timespan-functions"><code>timespan</code></a></li>
</ul>
</li>
<li><a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/language.md#11-code-block" target="_blank" rel="noopener noreferrer">Multi-line statements å¤šè¡Œè¯­å¥</a> ä¸å¿…åœ¨æ¯è¡Œéƒ½ä½¿ç”¨</li>
</ul>
<div><pre><code><span>{</span><span>{</span><span>..</span><span>.</span><span>}</span><span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><ul>
<li><a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/runtime.md#the-lexer-and-parser" target="_blank" rel="noopener noreferrer">Safe parser</a> and <a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/runtime.md#safe-runtime" target="_blank" rel="noopener noreferrer">safe runtime</a>, ä½¿æ‚¨å¯ä»¥æ§åˆ¶å…¬å¼€å“ªäº›å¯¹è±¡å’ŒåŠŸèƒ½</li>
</ul>
<h2 id="syntax-coloring-è¯­æ³•ç€è‰²" tabindex="-1"> Syntax Coloring(è¯­æ³•ç€è‰²)</h2>
<p>æ‚¨å¯ä»¥å®‰è£… <a href="https://marketplace.visualstudio.com/items?itemName=xoofx.scriban" target="_blank" rel="noopener noreferrer">Scriban Extension for Visual Studio Code</a> è·å– scriban è„šæœ¬ (without HTML) å’Œ scriban html æ–‡ä»¶çš„è¯­æ³•é¢œè‰²æç¤º</p>
<h2 id="æ–‡æ¡£" tabindex="-1"> æ–‡æ¡£</h2>
<ul>
<li>æœ‰å…³<a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/language.md" target="_blank" rel="noopener noreferrer">è¯­è¨€è¯­æ³•</a>çš„è¯´æ˜ï¼Œè¯·å‚é˜…è¯­è¨€æ–‡æ¡£ã€‚</li>
<li>å†…ç½®å‡½æ•°è§æ–‡æ¡£<a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/builtins.md" target="_blank" rel="noopener noreferrer">å†…ç½®å‡½æ•°</a>åˆ—è¡¨ã€‚</li>
<li>æœ‰å…³ç¼–è¯‘å’Œè¿è¡Œæ¨¡æ¿çš„.NET è¿è¡Œæ—¶ API çš„è¯´æ˜ï¼Œè¯·å‚é˜…<a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/runtime.md" target="_blank" rel="noopener noreferrer">è¿è¡Œæ—¶</a>æ–‡æ¡£ã€‚</li>
<li>æœ‰å…³æ”¯æŒ liquid æ¨¡æ¿çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[Liquid support]æ–‡æ¡£ã€‚</li>
<li>è¯·å‚é˜…æˆ‘çš„åšå®¢æ–‡ç« &quot;<a href="http://xoofx.com/blog/2017/11/13/implementing-a-text-templating-language-and-engine-for-dotnet/" target="_blank" rel="noopener noreferrer">å®ç°.NET çš„æ–‡æœ¬æ¨¡æ¿å¼•æ“</a>&quot;ï¼Œäº†è§£ä¸€äº›å¹•åç»†èŠ‚ã€‚</li>
</ul>
<h2 id="äºŒè¿›åˆ¶åŒ…" tabindex="-1"> äºŒè¿›åˆ¶åŒ…</h2>
<p>Scriban æä¾›ä¸€ä¸ªå¯è·å–çš„ NuGet åŒ…: <a href="https://www.nuget.org/packages/Scriban/" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/nuget/v/Scriban.svg" alt="NuGet" loading="lazy"></a></p>
<p>å…¼å®¹ä»¥ä¸‹ .NET framework ç‰ˆæœ¬:</p>
<ul>
<li>.NET Framework 3.5</li>
<li>.NET Framework 4.0</li>
<li>.NET Framework 4.5+ (supports asynchronous code and timeouts for regular expressions)</li>
<li>.NET Standard1.1+ (some features are not available)</li>
<li>.NET Standard1.3+ (which means .NET Core, Xamarin, UWP, Unity etc.)</li>
</ul>
<p>è¿˜æœ‰æä¾›ç­¾åçš„ NuGet åŒ… <a href="https://www.nuget.org/packages/Scriban.Signed/" target="_blank" rel="noopener noreferrer">Scriban.Signed</a></p>
<h2 id="benchmarks-åŸºå‡†æµ‹è¯•" tabindex="-1"> Benchmarksï¼ˆåŸºå‡†æµ‹è¯•ï¼‰</h2>
<p><strong>Scriban é€Ÿåº¦æå¿«</strong>! æ›´å¤šç»†èŠ‚, ä½ å¯ä»¥æŸ¥çœ‹æ­¤æ–‡æ¡£ <a href="https://github.com/lunet-io/scriban/blob/devel-3.0/doc/benchmarks.md" target="_blank" rel="noopener noreferrer">benchmarksï¼ˆåŸºå‡†æµ‹è¯•ï¼‰ æ–‡æ¡£</a>.</p>
<h2 id="license" tabindex="-1"> License</h2>
<p>è¯¥è½¯ä»¶æ˜¯åœ¨<a href="https://opensource.org/licenses/BSD-2-Clause" target="_blank" rel="noopener noreferrer">BSD-Clause 2 license</a>åè®®ä¸‹å‘å¸ƒçš„</p>
<h2 id="ç›¸å…³é¡¹ç›®" tabindex="-1"> ç›¸å…³é¡¹ç›®</h2>
<ul>
<li><a href="https://github.com/dotliquid/dotliquid" target="_blank" rel="noopener noreferrer">dotliquid</a>: Liquid æ¨¡æ¿è¯­è¨€çš„.NET ç«¯å£ã€‚</li>
<li><a href="https://github.com/sebastienros/fluid/" target="_blank" rel="noopener noreferrer">Fluid</a> .NET liquid æ¨¡æ¿å¼•æ“</li>
<li><a href="https://github.com/jdiamond/Nustache" target="_blank" rel="noopener noreferrer">Nustache</a>: .NET æ— é€»è¾‘æ¨¡æ¿ï¼ˆLogic-less templates for .NETï¼‰</li>
<li><a href="https://github.com/rexm/Handlebars.Net" target="_blank" rel="noopener noreferrer">Handlebars.Net</a>: .NET port of handlebars.js</li>
</ul>
<h2 id="åœ¨çº¿ç¤ºä¾‹" tabindex="-1"> åœ¨çº¿ç¤ºä¾‹</h2>
<ul>
<li><a href="https://scribanonline.azurewebsites.net/" target="_blank" rel="noopener noreferrer">https://scribanonline.azurewebsites.net/)</a>: ASP.NET Core Sample.</li>
</ul>
<h2 id="credits" tabindex="-1"> Credits</h2>
<p>Adapted logo <code>Puzzle</code> by <a href="https://thenounproject.com/andydoane/" target="_blank" rel="noopener noreferrer">Andrew Doane</a> from the Noun Project</p>
<h2 id="ä½œè€…" tabindex="-1"> ä½œè€…</h2>
<p>Alexandre Mutel aka <a href="http://xoofx.com" target="_blank" rel="noopener noreferrer">xoofx</a>.</p>
]]></content>
    <published>2021-12-12T10:05:43.000Z</published>
  </entry>
  <entry>
    <title type="html">LinCms.Scaffolding ä»£ç ç”Ÿæˆå™¨</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/lincms-scaffolding.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/lincms-scaffolding.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="lincms-scaffolding-ä»£ç ç”Ÿæˆå™¨" tabindex="-1"> LinCms.Scaffolding ä»£ç ç”Ÿæˆå™¨</h1>
<p><a href="https://github.com/luoyunchong/lin-cms-dotnetcore/tree/dev" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/lin-cms-dotnetcore/tree/dev</a></p>
<p>æ‰“å¼€é¡¹ç›® LinCms.Scaffolding.slnã€‚</p>
<p>çœ‹åˆ° appsettings.json é…ç½®å¦‚ä¸‹</p>
<div><pre><code><span>{</span>
  <span>"SettingOptions"</span><span>:</span> <span>{</span>
    <span>"ProjectName"</span><span>:</span> <span>"LinCms"</span><span>,</span>
    <span>"BaseDirectory"</span><span>:</span> <span>"D:/code/github/lin-cms-dotnetcore/src/LinCms.Core/"</span>
    <span>"EntityFilePath"</span><span>:</span> <span>"Entities/Base/Doc.cs"</span><span>,</span>
    <span>"Areas"</span><span>:</span> <span>"Base"</span><span>,</span>
    <span>"TemplatePath"</span><span>:</span> <span>"./Templates"</span><span>,</span>
    <span>"OutputDirectory"</span><span>:</span> <span>"D:/code/github/lin-cms-dotnetcore/code-scaffolding"</span>
  <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><p>å®Œæˆä¸€ä¸ªç®€å•çš„è¡¨çš„ CRUDï¼Œåªéœ€è¦ï¼Œåˆ›å»ºä¸€ä¸ªå®ä½“ç±»ï¼Œä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„é…ç½®é¡¹ï¼Œå³å¯ç”Ÿæˆä»£ç ã€‚</p>
<ul>
<li>BaseDirectory:BaseDirectory è¯·é…ç½®æˆ LinCms.Core çš„é¡¹ç›®è·¯å¾„ã€‚åç¼€è¦åŠ /</li>
</ul>
<p>ç”±äºé¡¹ç›®ä½¿ç”¨<strong>Microsoft.CodeAnalysis.CSharp</strong>è§£æå‡ºç±»çš„å±æ€§ï¼Œéœ€è¦çŸ¥é“é¡¹ç›®çš„åœ¨å“ªä¸ªä½ç½®ã€‚</p>
<p>å¦å¤–ï¼Œæœ¬é¡¹ç›®ï¼Œä¼šæ ¹æ® LinCms.Core.xml ä¸­çš„å†…å®¹è§£æå‡ºç±»å’Œå±æ€§çš„æ³¨é‡Šã€‚</p>
<ul>
<li>EntityFilePath å®ä½“ç±»æ‰€åœ¨æ–‡ä»¶ä½ç½®</li>
<li>Areas åŒºåŸŸæ¨¡å—å,eg:(Base)</li>
<li>TemplatePath ç›¸å¯¹è·¯å¾„ï¼Œå½“å‰é¡¹ç›®ä¸‹çš„ Templates ç›®å½•,ä¸éœ€è¦ä¿®æ”¹</li>
<li>OutputDirectory ç”Ÿæˆçš„ä»£ç è·¯å¾„ã€‚å¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„</li>
</ul>
<p>æˆ‘ä»¬åœ¨ LinCms.Core ä¸­çš„ Entities ä¸­ Base ç›®å½•ï¼Œæ–°å»ºä¸€ä¸ªç±» Doc.csï¼Œå¹¶å†™ä¸Šæ³¨é‡Šä¿¡æ¯ï¼Œä»¥ä¾¿ç”Ÿæˆåˆ—è¡¨å’Œè¡¨å•ã€‚</p>
<div><pre><code><span>using</span> <span>FreeSql<span>.</span>DataAnnotations</span><span>;</span>
<span>using</span> <span>System</span><span>;</span>
<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>System<span>.</span>Text</span><span>;</span>

<span>namespace</span> <span>LinCms<span>.</span>Entities<span>.</span>Base</span>
<span>{</span>
    <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
    <span>/// æ–‡æ¡£</span>
    <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
    <span>public</span> <span>class</span> <span>Doc</span> <span>:</span> <span><span>FullAduitEntity</span></span>
    <span>{</span>
        <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
        <span>/// æ–‡æ¡£å</span>
        <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
        <span>[</span><span>Column</span><span>(</span>StringLength <span>=</span> <span>50</span><span>)</span><span>]</span>
        <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

        <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
        <span>/// æ˜¾ç¤ºå</span>
        <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
        <span>[</span><span>Column</span><span>(</span>StringLength <span>=</span> <span>50</span><span>)</span><span>]</span>
        <span>public</span> <span><span>string</span></span> DisplayName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br></div></div><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦ï¼Œä¿®æ”¹ä¸Šé¢çš„é…ç½®ä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ‰“å¼€ Lincms çš„é¡¹ç›®ã€‚åˆ é™¤æ‰€æœ‰çš„ Docs ç›¸å…³çš„ä»£ç ã€‚</p>
<p>ç„¶åè¿è¡Œæ­¤ä»£ç ç”Ÿæˆå™¨ã€‚å³å¯ç”Ÿæˆæ‰€æœ‰ CRUD ä»£ç ã€‚ç„¶åã€‚ä»£ç ä¼šè¾“å‡ºåˆ°æ­¤ç›®å½• <strong>&quot;D:/code/github/lin-cms-dotnetcore/code-scaffolding&quot;</strong>,</p>
<p><img src="https://pic.downk.cc/item/5f1da73014195aa594ee9888.jpg" alt="" loading="lazy"></p>
<p>ç„¶åã€‚æˆ‘ä»¬å°†å‰äº”ä¸ªä»£ç ï¼Œä¾æ¬¡å¤åˆ¶åˆ°é¡¹ç›®ä¸­ï¼Œå› ä¸ºå¯èƒ½è¦†ç›–ç°æœ‰çš„ä»£ç ï¼Œæ‰€ä»¥ä¸æ¨èå°†æ­¤ä»£ç çš„è¾“å‡ºç›®å½•å†™æˆ<strong>D:/code/github/lin-cms-dotnetcore/src</strong>ã€‚</p>
<p>ç„¶åå°†æœ€åä¸€ä¸ª lin-cms-vueã€‚æŒ‰æ¨¡å—å¤åˆ¶åˆ°è‡ªå·±é¡¹ç›®ä¸­å³å¯ã€‚</p>
]]></content>
    <published>2020-07-26T16:18:09.000Z</published>
  </entry>
  <entry>
    <title type="html">åç«¯å¿«é€Ÿä¸Šæ‰‹</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/cms-start.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/cms-start.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="åç«¯å¿«é€Ÿä¸Šæ‰‹" tabindex="-1"> åç«¯å¿«é€Ÿä¸Šæ‰‹</h1>
<p>æœ¬å°èŠ‚æˆ‘ä»¬å°†åœ¨ lin-cms çš„åŸºç¡€ä¸Šå¼€å‘ä¸€ä¸ªç®€å•çš„å›¾ä¹¦ç®¡ç† demo,å¸®åŠ©å¤§å®¶æ¥ç†Ÿæ‚‰å’Œå…¥é—¨ lin-cmsã€‚</p>
<p>lin-cms æ˜¯ä¸€ä¸ª lin å›¢é˜Ÿç»æ•°æ‰“ç£¨çš„æ¨¡æ¿é¡¹ç›®ï¼Œæœ¬äººæ˜¯ c#çš„å¼€å‘è€…ï¼Œä¸º lin-cms å®Œå–„åœ¨.net ä¸‹çš„ç”Ÿæ€ï¼Œæ˜¯åŸºäº asp.netcore çš„åŸºç¡€ä¸Šï¼Œæ²‰æ·€ä¸‹æ¥çš„ä¸€å¥—å®è·µï¼Œ å¸®åŠ©å¼€å‘è€…èŠ‚çº¦æ—¶é—´ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæœ¬å°èŠ‚å»ºç«‹åœ¨ä½ æœ‰ä¸€å®šçš„ asp.net mvcï¼Œfreesqlï¼Œ.net core çš„åŸºç¡€ä¸Šã€‚</p>
</blockquote>
<h2 id="æ•°æ®å±‚" tabindex="-1"> æ•°æ®å±‚</h2>
<p>ç”±äºæˆ‘ä»¬ç”¨çš„.net core ä¸­ä¼˜ç§€çš„å¼€æºé¡¹ç›® FreeSql,codefirst æ¨¡å¼ï¼Œä»–èƒ½æ ¹æ®ç±»ç”Ÿæˆè¡¨ç»“æ„ã€‚æ‰€ä»¥ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºè¡¨ç»“æ„ã€‚</p>
<h3 id="book-ä¹¦" tabindex="-1"> book ä¹¦</h3>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>bigint</td>
<td>ä¸»é”® Id</td>
</tr>
<tr>
<td>author</td>
<td>varchar</td>
<td>ä½œè€…</td>
</tr>
<tr>
<td>image</td>
<td>varchar</td>
<td>å›¾ç‰‡</td>
</tr>
<tr>
<td>summary</td>
<td>varchar</td>
<td>ç®€ä»‹</td>
</tr>
<tr>
<td>title</td>
<td>varchar</td>
<td>æ ‡é¢˜</td>
</tr>
</tbody>
</table>
<p>å¯å¢åŠ ä¸€äº›å®¡è®¡å­—æ®µï¼Œå¦‚</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>create_time</td>
<td>datetime</td>
<td>åˆ›å»ºæ—¶é—´</td>
</tr>
<tr>
<td>create_user_id</td>
<td>datetime</td>
<td>åˆ›å»ºè€… ID</td>
</tr>
<tr>
<td>update_time</td>
<td>datetime</td>
<td>ä¿®æ”¹æ—¶é—´</td>
</tr>
<tr>
<td>update_user_id</td>
<td>datetime</td>
<td>æœ€åä¿®æ”¹äºº Id</td>
</tr>
<tr>
<td>delete_time</td>
<td>datetime</td>
<td>åˆ é™¤æ—¶é—´</td>
</tr>
<tr>
<td>delete_user_id</td>
<td>datetime</td>
<td>åˆ é™¤äºº id</td>
</tr>
<tr>
<td>is_deleted</td>
<td>datetime</td>
<td>æ˜¯å¦åˆ é™¤</td>
</tr>
</tbody>
</table>
<p>å®¡è®¡å­—æ®µå¯é€šè¿‡ç»§æ‰¿çˆ¶ç±»<strong>FullAduitEntity</strong>å³å¯,å½“ç„¶ï¼Œä¹Ÿå¯åªæœ‰åˆ›å»ºæ—¶é—´ï¼Œåˆ›å»ºäººäºŒä¸ªå­—æ®µï¼Œç»§æ‰¿<strong>ICreateAduitEntity</strong>æ¥å£ï¼Œå®ç°äºŒä¸ªå­—æ®µå³å¯ã€‚å¦‚æœä¸æƒ³è¦è¿™äº›è®°å½•ï¼Œåªéœ€è¦ç»§æ‰¿<strong>Entity</strong>ç±»ï¼Œä»…æœ‰ä¸€ä¸ª ID å­—æ®µï¼Œæ”¯æŒæ³›å‹ã€‚</p>
<p><strong>is_deleted</strong>å­—æ®µæœ¬èº«æ²¡æœ‰ä»€ä¹ˆç¨€å¥‡çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥é…åˆ FreeSql å®ç°é€»è¾‘åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰ï¼Œåœ¨ LinCms.Web/Configs/DependencyInjectionExtensions.cs æ–‡ä»¶ä¸­ã€‚é…ç½® äº†å¦‚ä¸‹å†…å®¹ï¼Œå¦‚æœæˆ‘ä»¬ç­›é€‰æ•°æ®æ—¶ï¼Œä¼šå…¨å±€å¯ç”¨ <a href="https://github.com/dotnetcore/FreeSql/wiki/%E8%BF%87%E6%BB%A4%E5%99%A8" target="_blank" rel="noopener noreferrer">è¿‡æ»¤å™¨</a>ã€‚åƒåˆ›å»ºæ—¶é—´ï¼Œåˆ›å»ºäººã€‚è¿™äº›å­—æ®µéƒ½ä¸éœ€è¦æˆ‘ä»¬èµ‹å€¼ï¼Œå¦‚æœæˆ‘ä»¬å…¨éƒ¨ä½¿ç”¨ä»“å‚¨<strong>IAuditBaseRepository</strong>è®¿é—®æ•°æ®åº“ï¼Œè¿™äº›å­—æ®µä¼šè‡ªåŠ¨èµ‹å€¼ã€‚</p>
<div><pre><code>fsql.GlobalFilter.Apply&lt;IDeleteAduitEntity>("IsDeleted", a => a.IsDeleted == false);
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="æ¨¡å‹å±‚" tabindex="-1"> æ¨¡å‹å±‚</h2>
<p>æˆ‘ä»¬å»ºç«‹å•çº¯çš„å®ä½“ç±»ï¼ˆEntities)ï¼Œåœ¨è·¯å¾„<strong>lin-cms-dotnetcore\src\LinCms.Core\Entities</strong>,åä¸º Book.cs çš„å®ä½“ç±»</p>
<div><pre><code><span>using</span> <span>FreeSql<span>.</span>DataAnnotations</span><span>;</span>

<span>namespace</span> <span>LinCms<span>.</span>Core<span>.</span>Entities</span>
<span>{</span>
    <span>[</span><span><span>Table</span><span><span>(</span>Name <span>=</span> <span>"book"</span><span>)</span></span></span><span>]</span>
    <span>public</span> <span>class</span> <span>Book</span> <span>:</span> <span><span>FullAduitEntity</span></span>
    <span>{</span>
        <span>[</span><span><span>Column</span><span><span>(</span>DbType <span>=</span> <span>"varchar(30)"</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>string</span></span> Author <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>=</span> <span>string</span><span>.</span>Empty<span>;</span>

        <span>[</span><span><span>Column</span><span><span>(</span>DbType <span>=</span> <span>"varchar(50)"</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>string</span></span> Image <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>=</span> <span>string</span><span>.</span>Empty<span>;</span>

        <span>[</span><span><span>Column</span><span><span>(</span>DbType <span>=</span> <span>"varchar(1000)"</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>string</span></span> Summary <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>=</span> <span>string</span><span>.</span>Empty<span>;</span>

        <span>[</span><span><span>Column</span><span><span>(</span>DbType <span>=</span> <span>"varchar(50)"</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> <span>=</span> <span>string</span><span>.</span>Empty<span>;</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br></div></div><p>æ›´å¤šç‰¹æ€§æ ‡ç­¾æ”¯æŒæƒ…å†µï¼Œè¯·æŸ¥çœ‹<a href="https://github.com/dotnetcore/FreeSql/wiki/%E5%AE%9E%E4%BD%93%E7%89%B9%E6%80%A7" target="_blank" rel="noopener noreferrer">FreeSql å®˜æ–¹æ–‡æ¡£å®ä½“ç‰¹æ€§</a>ã€‚</p>
<p>ç”±äºé»˜è®¤ FreeSql,åªæœ‰è®¿é—®åˆ°è¿™ä¸ªç±»æ—¶æ‰ä¼šç”Ÿæˆè¡¨ï¼Œä½†æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ‰«ææ‰€æœ‰å¸¦æœ‰ Table ç‰¹æ€§æ ‡ç­¾çš„ç±»ï¼ŒåŒæ­¥è¡¨ç»“æ„ã€‚ä»…å»ºè®®å¼€å‘æ—¶å¯åŠ¨è¡¨ç»“æ„å…¨éƒ¨åŒæ­¥ã€‚</p>
<p>LinCms.Web/Configs/DependencyInjectionExtensions.cs
ä¸­çš„ AddContext é…ç½®é¡¹ä¸­.</p>
<div><pre><code>//åœ¨è¿è¡Œæ—¶ç›´æ¥ç”Ÿæˆè¡¨ç»“æ„
fsql.CodeFirst.SyncStructure(ReflexHelper.GetEntityTypes(typeof(IEntity)));
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h2 id="ä¸šåŠ¡å±‚" tabindex="-1"> ä¸šåŠ¡å±‚</h2>
<p>æœ‰äº†å®ä½“ç±»ï¼Œæˆ‘ä»¬åˆ›å»º IBookRepository<code>&lt;Book,long&gt;</code>ï¼Œä¹Ÿå¯ä»¥ä¸åˆ›å»ºï¼Œç›´æ¥ä½¿ç”¨ IAuditBaseRepository<code>&lt;Book&gt;</code>åœ¨ Service å±‚å†™ç›¸åº”çš„ä¸šåŠ¡ã€‚è¿™é‡Œæˆ‘ä»¬å°±ä¸åˆ›å»ºä»“å‚¨æœåŠ¡äº†ï¼Œæ¡†æ¶ä¸­æºå¸¦çš„ä»“å‚¨å·²ç»æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚</p>
<p>ä»“å‚¨æ˜¯ä»€ä¹ˆå‘¢ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç†è§£ DAL,ä¹Ÿç†è§£ä¸ºä»“åº“ï¼Œä»–æä¾›äº†å¯¹å•ä¸ªè¡¨çš„ CURD æ“ä½œæ–¹æ³•ï¼Œæœ‰äº†ä¸€ä¸ªç»Ÿä¸€çš„è§„èŒƒã€‚</p>
<p>ä½œç”¨å³æ•°æ®çš„æŒä¹…åŒ–ï¼Œåº”ç”¨æœåŠ¡é€šè¿‡ä»“å‚¨å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œè®©å¼€å‘è€…ä¸ç”¨å…³æ³¨ä»“å‚¨å†…éƒ¨çš„å®ç°ã€‚</p>
<p>ä¸šåŠ¡å±‚ Servicesï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ä»“å‚¨è®¿é—®æ•°æ®åº“ã€‚</p>
<p>åœ¨ LinCms.Application.Contracts é¡¹ç›®ä¸­ï¼Œåœ¨ v1 æ–‡ä»¶å¤¹æ–°å»ºä¸€ä¸ª Books çš„æ–‡ä»¶å¤¹,ç”¨äºå­˜æ”¾ä¹¦çš„ç›¸å…³æ¥å£ï¼Œåˆ›å»º IBookService çš„æ¥å£</p>
<div><pre><code>using System.Threading.Tasks;
using LinCms.Application.Contracts.v1.Books.Dtos;
using LinCms.Core.Data;

namespace LinCms.Application.Contracts.v1.Books
{
    public interface IBookService
    {
        Task&lt;BookDto> GetAsync(long id);
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>æ–°å»ºä¸€ä¸ª Dtos æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾ä¸šåŠ¡ä¼ è¾“çš„æ•°æ®å¯¹è±¡ï¼Œå†åˆ›å»ºä¸€ä¸ª BookDtoï¼Œä»…åŒ…å«å¿…è¦çš„å­—æ®µï¼Œè€Œéå…¨éƒ¨ã€‚è¯¥ç±»ä»¥ Dto ç»“å°¾ï¼Œä»£è¡¨æ•°æ®ä¼ è¾“å¯¹è±¡ã€‚</p>
<div><pre><code>using System;
using LinCms.Core.Entities;

namespace LinCms.Application.Contracts.v1.Books.Dtos
{
    public class BookDto:EntityDto
    {
        public string Author { get; set; }
        public string Image { get; set; }
        public string Summary { get; set; }
        public string Title { get; set; }
        public DateTime CreateTime { get; set; }
        public DateTime UpdateTime { get; set; }
    }
}

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br></div></div><p>åœ¨ BookService å®ç°å¦‚ä¸‹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æ³¨å…¥ IAuditBaseRepositoryï¼Œé€šè¿‡ è°ƒç”¨ <strong>_bookRepository.Select.Where(a =&gt; a.Id == id).ToOneAsync();</strong> ,æ ¹æ® id å¾—åˆ°ä¹¦çš„å®ä½“å¯¹è±¡ã€‚ç„¶åä½¿ç”¨ AutoMappeer,å°† Book ç±»è½¬æ¢æˆ BookDto ç±»ï¼Œç„¶åè¿”å›ã€‚
è‡³äºä¸ºä»€ä¹ˆ è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ³¨å…¥ IAuditBaseRepositoryï¼ŒIMapper ç±»ï¼Œåé¢æˆ‘ä»¬ä¼šè®²åˆ°ã€‚</p>
<div><pre><code>using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using AutoMapper;
using LinCms.Application.Contracts.v1.Books;
using LinCms.Application.Contracts.v1.Books.Dtos;
using LinCms.Core.Data;
using LinCms.Core.Entities;
using LinCms.Core.Exceptions;
using LinCms.Core.Extensions;
using LinCms.Core.IRepositories;

namespace LinCms.Application.v1.Books
{
    public class BookService : IBookService
    {
        private readonly IAuditBaseRepository&lt;Book> _bookRepository;
        private readonly IMapper _mapper;
        public BookService(IAuditBaseRepository&lt;Book> bookRepository, IMapper mapper)
        {
            _bookRepository = bookRepository;
            _mapper = mapper;
        }


        public async Task&lt;BookDto> GetAsync(long id)
        {
            Book book = await _bookRepository.Select.Where(a => a.Id == id).ToOneAsync();
            return _mapper.Map&lt;BookDto>(book);
        }
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br></div></div><p>å› ä¸ºä½¿ç”¨ AutoMapper ç®€åŒ–äºŒä¸ªå¯¹è±¡çš„æ˜ å°„ï¼Œæˆ‘ä»¬åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªç»§æ‰¿ Profile ç±»çš„é…ç½®é¡¹ã€‚åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é…ç½®äº†è°ƒç”¨ CreateMap æ–¹æ³•ï¼Œä»£è¡¨ï¼Œä» Book-&gt;BookDto çš„æ˜ å°„å…³ç³»ã€‚</p>
<div><pre><code>using AutoMapper;
using LinCms.Application.Contracts.v1.Books.Dtos;
using LinCms.Core.Entities;

namespace LinCms.Application.v1.Books
{
    public class BookProfile:Profile
    {
        public BookProfile()
        {
            CreateMap&lt;Book, BookDto>();
        }
    }
}

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><p>åœ¨ ASP.NET Core ä¸­ï¼Œæˆ‘ä»¬ä¼šæ‰«æè¯¥ç¨‹åºé›†ï¼ˆLinCms.Applicaitonï¼‰ä¸­æ‰€æœ‰ç»§æ‰¿äº† Profile ç±»çš„å­ç±»ï¼Œåœ¨ LinCms.Web ä¸­ ConfiguartionService é…ç½®å¦‚ä¸‹ï¼Œ</p>
<div><pre><code>services.AddAutoMapper(typeof(BookProfile).Assembly);
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>ä¸€ä¸ªé¡¹ç›®å³ä¸€ä¸ªç¨‹åºé›†(ç”Ÿæˆä¸€ä¸ª dll)ï¼Œä»…é…ç½®ä¸€æ¬¡ã€‚</p>
<p>æˆ‘ä»¬å®Œå–„ä¸€ä¸‹æ§åˆ¶å™¨çš„ä»£ç ã€‚</p>
<div><pre><code>using System.Threading.Tasks;
using AutoMapper;
using LinCms.Application.Contracts.v1.Books;
using LinCms.Application.Contracts.v1.Books.Dtos;
using LinCms.Core.Aop;
using LinCms.Core.Aop.Filter;
using LinCms.Core.Data;
using LinCms.Core.Entities;
using LinCms.Core.Exceptions;
using LinCms.Core.Extensions;
using LinCms.Core.IRepositories;
using LinCms.Web.Data.Authorization;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;

namespace LinCms.Web.Controllers.v1
{
    [Route("v1/book")]
    [ApiController]
    [Authorize]
    public class BookController : ControllerBase
    {
        private readonly IBookService _bookService;
        public BookController(IBookService bookService)
        {
            _bookService = bookService;
        }

        [HttpGet("{id}")]
        public async Task&lt;BookDto> GetAsync(int id)
        {
            return await _bookService.GetAsync(id);
        }
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br></div></div><p>åœ¨ LinCms.Web/Controllers/v1 æ–‡ä»¶å¤¹ï¼Œåˆ›å»ºæˆ‘ä»¬çš„ Book æ§åˆ¶å™¨ã€‚
æˆ‘ä»¬ä¾æ—§é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥æœåŠ¡<strong>IBookService</strong>,è¿™é‡Œç”¨åˆ°çš„æ˜¯ async await æ–¹æ³•ï¼Œä¸åŒæ­¥æ–¹æ³•æ‰§è¡Œé¡ºåºä¸€è‡´ï¼Œä»…å¤šäºŒä¸ªå…³é”®å­—ï¼Œå¹¶ä½¿ç”¨ Task&lt;è¿”å›å€¼&gt;æ¥è¿”å›æ•°æ®ï¼Œé€šå¸¸æˆ‘ä»¬ä½¿ç”¨ Async æ ‡è¯†å¼‚æ­¥æ–¹æ³•ã€‚</p>
<p>å¯åŠ¨é¡¹ç›®ï¼Œå¯é€šè¿‡ Visual Studio ç‚¹å‡»ä¸Šæ–¹çš„è¿è¡Œå³å¯ã€‚</p>
<p>è¿˜å¯é€šè¿‡ç»ˆç«¯è¿è¡Œé¡¹ç›®</p>
<p>å…ˆ cd åˆ°ç›®å½• lin-cms-dotnetcore/src/LinCms.Web</p>
<div><pre><code>dotnet run
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æ‰“å¼€æµè§ˆå™¨ï¼Œhttps://localhost:5001/swagger/index.htmlï¼Œ ctrl+f æœç´¢ï¼Œbookï¼Œæ‰¾åˆ° GET /v1/book/{id}ï¼Œç‚¹å‡» try it out,è¾“å…¥ idï¼Œç‚¹å‡» Executeã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬æ²¡ç™»å½•ç™»å½•ï¼Œåœ¨ BookController ä¸Šå†™äº†ç‰¹æ€§æ ‡ç­¾ <strong>[Authorize]</strong> ï¼Œæ‰€ä»¥ä¼šè¿”å›</p>
<div><pre><code>{
  "code": 10000,
  "message": "è¯·å…ˆç™»å½•",
  "request": "GET /v1/book/131"
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>æˆ‘ä»¬å¯ä»¥å…ˆå»æ‰è¿™ä¸ªç‰¹æ€§æ ‡ç­¾ï¼Œä¹Ÿå¯ä»¥èµ°ç™»å½•æµè§ˆï¼ŒæŠŠ Token æ”¾åˆ° Header ä¸­çš„ Authoriaztion ä¸­ã€‚ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å…ˆå»æ‰è¿™è¡Œç‰¹æ€§æ ‡ç­¾ã€‚å»æ‰åï¼Œéœ€è¦ ctrl+cï¼Œå³å‡ºè¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœæ„Ÿè§‰éº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨ <strong>dotnet run watch</strong> å‘½ä»¤ï¼Œä¿®æ”¹åï¼Œè‡ªåŠ¨é‡å¯ï¼Œä¸éœ€è¦æ‰‹åŠ¨é‡å¯ã€‚ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬é‡æ–°æµ‹è¯•ï¼Œæ‰‹åŠ¨ç»™æ•°æ®åº“åŠ ä¸€äº›æ•°æ®ï¼Œè®°å¾— is_deleted è¦æ˜¯ falseï¼Œç„¶åè¾“å…¥å¯¹åº”çš„ idï¼Œä¼šå¾—åˆ°å¯¹åº”çš„å€¼</p>
<div><pre><code>{
  "author": "891dc185-2",
  "image": "f6d0c1e9-fcb2-446a-9093-d773e6515579",
  "summary": "8aea38f8-a6e0-4053-bd7a-ae4476432bdd",
  "title": "2d0c2e44-ee02-4d40-b4b7-eed03bb48aa4",
  "create_time": 1588485910430,
  "update_time": 1588485910430,
  "id": 139
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div>]]></content>
    <published>2020-07-24T17:10:08.000Z</published>
  </entry>
  <entry>
    <title type="html">GitHub Actions</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/github-actions.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/github-actions.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="github-actions" tabindex="-1"> GitHub Actions</h1>
<h2 id="gitee-ä¸-github-è‡ªåŠ¨åŒæ­¥" tabindex="-1"> Gitee ä¸ GitHub è‡ªåŠ¨åŒæ­¥</h2>
<p>å½“ github ä¸Šçš„é¡¹ç›®ä»£ç  master åˆ†æ”¯æäº¤åï¼Œgitee è‡ªåŠ¨åŒæ­¥ã€‚å¦‚ä½•å®ç°å‘¢ã€‚ä¸»è¦é€šè¿‡ github action å®ç°</p>
<p>æˆ‘ä»¬æƒ³å°† luoyunchong/lin-cms-dotnetcore åŒæ­¥åˆ° igeekfan/lin-cms-dotnetcore ä¸Šé¢ï¼Œéœ€è¦åšçš„éå¸¸ç®€å•ï¼Œåªéœ€è¦ 2 æ­¥ï¼š</p>
<p>1.å°† Gitee çš„ç§é’¥ï¼Œä¸Šä¼ åˆ°é¡¹ç›®çš„ setting çš„ Secrets ä¸­ã€‚
<a href="https://pic.downk.cc/item/5e9725f5c2a9a83be5dcdec3.png" target="_blank" rel="noopener noreferrer"><img src="https://pic.downk.cc/item/5e9725f5c2a9a83be5dcdec3.png" alt="" loading="lazy"></a></p>
<p>å‰æï¼Œè¯¥ç§é’¥å¯¹åº”çš„å…¬é’¥åœ¨ gitee ä¸Šï¼Œwindows(C:\Users\Computer.ssh)ï¼Œå…¶ä¸­ id_rsa æ˜¯ç§é’¥ï¼Œid_rsa.pub å†…å®¹æ˜¯å…¬é’¥ï¼Œå…·ä½“åœ¨ gitee ä¸Šå¢åŠ  ssh å…¬é’¥çš„è¿‡ç¨‹ï¼Œè¯·å‚è€ƒ<a href="https://gitee.com/help/articles/4191" target="_blank" rel="noopener noreferrer">SSH å…¬é’¥è®¾ç½®</a></p>
<ol start="2">
<li>æ”¹ source-repoã€destination-repo çš„å€¼</li>
</ol>
<h2 id="lin-cms-dotnetcore-gitee-åŒæ­¥è„šæœ¬" tabindex="-1"> lin-cms-dotnetcore gitee åŒæ­¥è„šæœ¬</h2>
<div><pre><code>name: Publish
on:
    push:
        branches:
            - master

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Sync to Gitee ğŸ’•
              uses: wearerequired/git-mirror-action@master
              env:
                  SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
              with:
                  source-repo: "git@github.com:luoyunchong/lin-cms-dotnetcore.git"
                  destination-repo: "git@gitee.com:igeekfan/lin-cms-dotnetcore.git"
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><p>æ¯ä¸€ä¸ª steps å°±æ˜¯åœ¨ jobs é‡Œæ‰§è¡Œå‘½ä»¤ï¼Œä¸€ä¸ª jobs å¯ä»¥æœ‰å¤šä¸ª steps,
steps å­—æ®µæŒ‡å®šæ¯ä¸ª Job çš„è¿è¡Œæ­¥éª¤çš„ä»‹ç»</p>
<div><pre><code>jobs.&lt;job_id>.steps.name æ­¥éª¤åç§°
jobs.&lt;job_id>.steps.env è¯¥æ­¥éª¤æ‰€éœ€çš„ç¯å¢ƒå˜é‡ã€‚
jobs.&lt;job_id>.steps.uses  ä½¿ç”¨çš„ç»„ä»¶
jobs.&lt;job_id>.steps.with å¤šä¸ªå€¼(è¿™ä¸ªå‚æ•°å…¶å®æ˜¯æäº¤ç»™å®¹å™¨çš„CMD)

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="ci-cd-éƒ¨ç½²" tabindex="-1"> CI/CD éƒ¨ç½²</h2>
<ul>
<li>å®Œæ•´çš„é…ç½®é¡¹</li>
</ul>
<div><pre><code># This workflow will do a clean install of node dependencies, build the source code and run tests across different versions of node
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions

name: Node.js CI

on:
  push:
    branches:
      - master

jobs:
  build:
    name: ç¼–è¯‘
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: ['8','10','12']
    steps:
    - uses: actions/checkout@v2
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v1
      with:
        node-version: ${{ matrix.node-version }}
    - name: å®‰è£…ä¾èµ–
      run: npm i
    - name: ç¼–è¯‘æ–‡ä»¶
      run: |
        npm run lint
        npm run build
  deploy:
    name: éƒ¨ç½²
    runs-on: ubuntu-latest
    steps:
      - name: æ‹‰å–ä»£ç 
        uses: actions/checkout@v2
      - name: å®‰è£… Node.js 12
        uses: actions/setup-node@v1
        with:
          node-version: 12
      - name: å®‰è£…ä¾èµ–
        run: npm i
      - name: ç¼–è¯‘æ–‡ä»¶
        run: |
          npm run lint
          npm run build
      - name: ä¸Šä¼ æ–‡ä»¶
        uses: easingthemes/ssh-deploy@v2.1.4
        env:
          ARGS: "-rltgoDzvO --delete"
          SOURCE: "dist/"
          REMOTE_HOST: ${{ secrets.HOST }}
          REMOTE_USER: ${{ secrets.USER }}
          SSH_PRIVATE_KEY: ${{ secrets.SERVER_SSH_KEY }}
          TARGET: ${{ secrets.REMOTE_TARGET }}

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br></div></div><h3 id="ssh-deploy-æ’ä»¶" tabindex="-1"> ssh-deploy æ’ä»¶</h3>
<ul>
<li>https://github.com/easingthemes/ssh-deploy</li>
</ul>
<p>å¯æŸ¥çœ‹ README äº†è§£å…·ä½“å‚æ•°</p>
<p>ä»¥ä¸Šå…±æœ‰å››ä¸ªå‚æ•°éœ€è¦é…ç½®</p>
<div><pre><code>REMOTE_HOST: ${{ secrets.HOST }}
REMOTE_USER: ${{ secrets.USER }}
SSH_PRIVATE_KEY: ${{ secrets.SERVER_SSH_KEY }}
TARGET: ${{ secrets.REMOTE_TARGET }}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>æ‰“å¼€ Settings-&gt;Secrets-&gt;New secret é…ç½®å¦‚ä¸‹å†…å®¹ã€‚</p>
<ul>
<li>HOST eg: mydomain.com è¿™é‡Œæˆ‘ä»¬é…ç½®äº†æœåŠ¡å™¨çš„ ip 111.231.197.142</li>
<li>USER centos æœåŠ¡å™¨çš„ç”¨æˆ·å</li>
<li>REMOTE_TARGET ç›®æ ‡æœåŠ¡å™¨çš„æ–‡ä»¶å¤¹ä½ç½®ï¼Œ eg: /var/www/lin-cms-vvlog</li>
<li>SERVER_SSH_KEYï¼šSSH å¯†é’¥å¯¹çš„ç§é’¥éƒ¨åˆ†ï¼Œå…¬é’¥åº”è¯¥æ·»åŠ åˆ°æœåŠ¡å™¨ä¸Šçš„ authorized_keys æ–‡ä»¶ä¸­ã€‚ã€‚eg /root/.ssh/authorized_keys</li>
</ul>
<p>æœ€åä¸€ä¸ªå‚æ•°è¯´æ˜ï¼šè¿™ä¸ªç›¸å½“äºæŠŠç§é’¥ç»™ githubï¼Œè®©ä»–èƒ½è¿œç¨‹ä¸Šä¼ æ–‡ä»¶åˆ° centos ä¸­ï¼Œå…¬é’¥æ”¾åˆ°æœåŠ¡å™¨ä¸Šã€‚å…¬é’¥ç”Ÿæˆçš„è¿‡ç¨‹ä¸ BB äº†ï¼Œ</p>
<h3 id="ssh-ç”Ÿæˆ" tabindex="-1"> .ssh ç”Ÿæˆ</h3>
<ul>
<li><a href="https://help.github.com/en/articles/connecting-to-github-with-ssh" target="_blank" rel="noopener noreferrer">https://help.github.com/en/articles/connecting-to-github-with-ssh</a></li>
<li>https://www.ssh.com/ssh/public-key-authentication</li>
</ul>
<p>æœ¬åœ° windows .ssh é»˜è®¤ç”Ÿæˆç›®å½•</p>
<div><pre><code>C:\Users\è®¡ç®—æœºå\.ssh
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æˆ‘çš„.ssh ç›®å½•ä½ç½®</p>
<div><pre><code>C:\Users\Computer\.ssh
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>dir æŸ¥çœ‹æ–‡ä»¶</p>
<div><pre><code>C:\Users\Computer\.ssh>dir
2020/02/22  19:45             3,243 id_rsa
2020/02/22  19:45               750 id_rsa.pub
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>id_rsa æ˜¯ç§é’¥ï¼Œç”¨ vscode ç­‰è®°äº‹æœ¬ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå¹¶å¤åˆ¶é…ç½®åˆ° github ä¸Šã€‚New secret,id_rsa.pub æ˜¯å…¬é’¥ï¼ŒæŠŠä»–å¤åˆ¶åˆ° linux æ–‡ä»¶å¤¹<code>/root/.ssh/</code>ç›®å½•ä¸­ï¼Œè¿™æ—¶æŠŠä»–çš„åå­—ç”±<code>id_rsa.pub</code>æ”¹æˆ<code>authorized_keys</code>å³å¯ã€‚</p>
<p><code>/ç”¨æˆ·å/.ssh</code> æ²¡æœ‰.ssh æ–‡ä»¶å¤¹å°±åˆ›å»ºä¸€ä¸ªã€‚</p>
<h3 id="xsheel-ssh-ç™»å½•" tabindex="-1"> XSheel ssh ç™»å½•</h3>
<p>å¯é€šè¿‡ xshell å·¥å…·éªŒè¯ï¼ŒPublic Key ç™»å½•ã€‚</p>
<p>æ–°å»ºä¼šè¯å±æ€§-&gt;è¾“å…¥ä¸»æœºï¼ˆHï¼‰å³ IP åœ°å€ã€‚</p>
<p>é€‰æ‹©ç”¨æˆ·èº«ä»½éªŒè¯-&gt;æ–¹æ³•é€‰æ‹© public Key,è¾“å…¥ç”¨æˆ·åï¼Œæ¯”å¦‚ root</p>
<ul>
<li>é€‰æ‹©ç§é’¥ç™»å½•
åœ¨ç”¨æˆ·å¯†é’¥å³ä¾§ç‚¹å‡»æµè§ˆ-&gt;ç”¨æˆ·å¯†é’¥-&gt;å¯¼å…¥-&gt;é€‰æ‹© id_rsa.pub ç§é’¥ï¼Œå¯¼å…¥æˆåŠŸåï¼Œé€‰æ‹©æ­¤å¯†é’¥ï¼Œç¡®å®šã€‚å†åœ¨ SSH ç”¨æˆ·èº«ä»½éªŒè¯ç•Œé¢ç¡®å®š,å³å¯ç™»å½•æˆåŠŸã€‚è¡¨æ˜ç§é’¥ï¼Œå…¬é’¥é…ç½®æˆåŠŸ</li>
</ul>
<h2 id="å‚è€ƒ" tabindex="-1"> å‚è€ƒ</h2>
<ul>
<li><a href="https://github.com/marketplace/actions/mirror-a-repository-using-ssh" target="_blank" rel="noopener noreferrer">https://github.com/marketplace/actions/mirror-a-repository-using-ssh</a></li>
<li><a href="https://help.github.com/en/actions" target="_blank" rel="noopener noreferrer">https://help.github.com/en/actions</a></li>
</ul>
]]></content>
    <published>2020-07-24T17:10:08.000Z</published>
  </entry>
  <entry>
    <title type="html">æ–¹æ³•çº§åˆ«çš„æƒé™æ§åˆ¶ï¼ˆAPIçº§åˆ«ï¼‰</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/authorize.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/authorize.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="æ–¹æ³•çº§åˆ«çš„æƒé™æ§åˆ¶-apiçº§åˆ«" tabindex="-1"> æ–¹æ³•çº§åˆ«çš„æƒé™æ§åˆ¶ï¼ˆAPIçº§åˆ«ï¼‰</h1>
<p>Linçš„å®šä½åœ¨äºå®ç°ä¸€æ•´å¥— CMSçš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªè®¾è®¡æ–¹æ¡ˆï¼Œæä¾›äº†ä¸åŒçš„åç«¯ï¼Œä¸åŒçš„å‰ç«¯ï¼Œè€Œä¸”ä¹Ÿæ”¯æŒä¸åŒçš„æ•°æ®åº“</p>
<p>ç›®å‰å®˜æ–¹å›¢é˜Ÿç»´æŠ¤ lin-cms-vue,lin-cms-spring-boot,lin-cms-koa,lin-cms-flask
ç¤¾åŒºç»´æŠ¤äº† lin-cms-tp5,lin-cms-react,lin-cms-dotnetcoreï¼Œå³å·²æ”¯æŒvue,reactäºŒç§å‰ç«¯æ¡†æ¶ï¼Œjava,nodejs,python,php,c#ç­‰äº”ç§åç«¯è¯­è¨€ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥è®²ä¸€ä¸‹.NET Coreè¿™ä¸ªé¡¹ç›®ä¸­æƒé™æ§åˆ¶çš„å®ç°ã€‚</p>
<p>å¯¹äºCMSæ¥è¯´ï¼Œä¸€ä¸ªå®Œå–„çš„æƒé™æ¨¡å—æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œæ˜¯ç³»ç»Ÿå†…ç½®å®ç°çš„ã€‚ä¸ºäº†æ›´åŠ ç®€å•åœ°ç†è§£æƒé™ï¼Œæˆ‘ä»¬å…ˆæ¥ç†è§£ä¸€ä¸‹ASP.NET Coreæœ‰å“ªäº›æƒé™æ§åˆ¶ã€‚</p>
<p>1.<strong>AuthorizeAttribute</strong>çš„ä½œç”¨ï¼Ÿ</p>
<p>è¿™ä¸ªç‰¹æ€§æ ‡ç­¾æˆæƒé€šè¿‡å±æ€§å‚æ•°é…ç½®ï¼Œå¯åº”ç”¨äºæ§åˆ¶å™¨æˆ–æ“ä½œæ–¹æ³•ä¸Šï¼Œå¯¹ç”¨æˆ·çš„èº«ä»½è¿›è¡ŒéªŒè¯ã€‚</p>
<p>å¦‚æœæ²¡æœ‰æˆæƒï¼Œä¼šè¿”å›403çŠ¶æ€ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™ï¼Œæ¥å®ç°è¿”å›JSONå­—ç¬¦ä¸²ï¼Œè®©å‰å°æç¤ºã€‚å‰ææ˜¯è¯·æ±‚ä¸­é—´ä»¶é…ç½®äº†å¦‚ä¸‹äºŒè¡Œã€‚</p>
<ul>
<li>
<p><strong>app.UseAuthentication();</strong> è®¤è¯ï¼Œæ˜ç¡®æ˜¯è°åœ¨æ“ä½œï¼Œè®¤è¯æ–¹å¼å¦‚ç”¨æˆ·åå¯†ç ,ç™»å½•åï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªtokenï¼Œæˆ–è€…å†™å…¥cookiesï¼Œè¿™æ ·å¯ä»¥ç¡®å®šè¿™ä¸ªç”¨æˆ·æ˜¯è°</p>
</li>
<li>
<p><strong>app.UseAuthorization();</strong> æˆæƒä¸­é—´ä»¶ï¼Œæ˜ç¡®ä½ æ˜¯å¦æœ‰æŸä¸ªæƒé™ã€‚åœ¨httpè¯·æ±‚æ—¶ï¼Œä¸­é—´ä»¶ä¼šåœ¨å¸¦æœ‰æƒé™ç‰¹æ€§æ ‡ç­¾ <strong>[Authorize]</strong> çš„æ“ä½œï¼Œè¿›è¡Œæƒé™åˆ¤æ–­ï¼ŒåŒ…æ‹¬è§’è‰²ï¼Œç­–ç•¥ç­‰ã€‚</p>
</li>
</ul>
<p>è¯¥æ§åˆ¶å™¨ä¸‹çš„æ“ä½œéƒ½å¿…é¡»ç»è¿‡èº«ä»½éªŒè¯ï¼Œ</p>
<div><pre><code>[Authorize]
public class AccountController : Controller
{
    public ActionResult Login()
    {
    }

    public ActionResult Logout()
    {
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>è¿™æ ·åªæ˜¾ç¤ºå•ä¸ªæ–¹æ³•å¿…é¡»åº”ç”¨æˆæƒã€‚</p>
<div><pre><code>public class AccountController : Controller
{
   public ActionResult Login()
   {
   }

   [Authorize]
   public ActionResult Logout()
   {
   }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>å¦‚æœæˆ‘ä»¬é€šè¿‡<strong>AllowAnonymous</strong>ç‰¹æ€§æ ‡ç­¾å»æ‰èº«ä»½éªŒè¯ã€‚Loginæ–¹æ³•æ— é¡»è¿›è¡ŒéªŒè¯ã€‚å³å¯åŒ¿åè®¿é—®ã€‚</p>
<div><pre><code>[Authorize]
public class AccountController : Controller
{
    [AllowAnonymous]
    public ActionResult Login()
    {
    }

    public ActionResult Logout()
    {
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><ol start="2">
<li>åŸºäºè§’è‰²çš„æˆæƒ</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™è¿™ä¸ªç‰¹æ€§æ ‡ç­¾åŠ å‚æ•°ï¼Œé…ç½®ï¼ŒæŸä¸ªæ–¹æ³•ï¼Œæ§åˆ¶å™¨æ˜¯å¦æœ‰è¿™ä¸ªè§’è‰²ï¼Œå¦‚æœæœ‰æ­¤è§’è‰²æ‰èƒ½è®¿é—®è¿™äº›èµ„æºã€‚</p>
<p>å•ä¸ªè§’è‰²</p>
<div><pre><code>[Authorize(Roles = "Administrator")]
public class AdministrationController : Controller
{
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å¤šä¸ªè§’è‰²ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·é…ç½®,å³ç”¨é€—å·åˆ†éš”ã€‚ç”¨æˆ·æœ‰å…¶ä¸­ä¸€ä¸ªè§’è‰²å³å¯è®¿é—®ã€‚</p>
<div><pre><code>[Authorize(Roles = "HRManager,Finance")]
public class SalaryController : Controller
{
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å½“æŸä¸ªæ–¹æ³•å¿…é¡»åŒæ—¶æœ‰äºŒä¸ªè§’è‰²æ€ä¹ˆåŠå‘¢ã€‚è¯¥æ§åˆ¶å™¨åªæœ‰åŒæ—¶æœ‰PowerUserï¼Œå’ŒControlPanelUserçš„è§’è‰²æ‰èƒ½è®¿é—®è¿™äº›èµ„æºäº†ã€‚</p>
<div><pre><code>[Authorize(Roles = "PowerUser")]
[Authorize(Roles = "ControlPanelUser")]
public class ControlPanelController : Controller
{
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><ul>
<li>3.æ›´å¤šã€‚è¯·çœ‹å®˜ç½‘ <a href="https://docs.microsoft.com/zh-cn/aspnet/core/security/authorization/roles?view=aspnetcore-3.1" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/aspnet/core/security/authorization/roles?view=aspnetcore-3.1</a></li>
</ul>
<p>æ›´å¤šè¯¥ç‰¹æ€§æ ‡ç­¾çš„ä»‹ç»ï¼Œä¹Ÿå¯å‚è€ƒå®˜ç½‘ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚</p>
<p>é‚£è¿™ä¸ªè§’è‰²ï¼Œåˆ°åº•åœ¨å“ªé…ç½®çš„ï¼Ÿï¼Ÿ</p>
<p>ç™»å½•æ—¶ç”Ÿæˆçš„Token,æ˜¯åŸºäºJWTçš„ï¼Œå…¶ä¸­çš„Claimçš„typeä¸º<strong>ClaimTypes.Role</strong>ï¼ˆæšä¸¾å€¼ï¼‰ï¼Œè§’è‰²åç§°ä¸ºå­—ç¬¦ä¸²ï¼Œä¸ç‰¹æ€§æ ‡ç­¾ä¸­çš„Roleså±æ€§å€¼ç›¸åŒã€‚
å¦‚</p>
<div><pre><code>new Claim(ClaimTypes.Role, "Administrator");
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æœ‰å¤šä¸ªè§’è‰²æ—¶ï¼Œ**List Claim ** å¤šåŠ å‡ ä¸ª <strong>new Claim(ClaimTypes.Role, &quot;PowerUser&quot;);</strong> ä¹Ÿæ˜¯æ”¯æŒçš„ã€‚userä¸ºç”¨æˆ·ä¿¡æ¯ï¼ŒLinGroupsä¸ºå½“å‰ç”¨æˆ·çš„åˆ†ç»„ï¼ˆå¤šä¸ªï¼‰</p>
<p>å³å¦‚ä¸‹ä»£ç ç¤ºä¾‹ï¼Œå¤šä¸ªåˆ†ç»„ï¼ˆè§’è‰²ï¼‰</p>
<div><pre><code>var claims = new List&lt;Claim>()
{
    new Claim(ClaimTypes.NameIdentifier, user.Email ?? ""),
    new Claim(ClaimTypes.GivenName, user.Nickname ?? ""),
    new Claim(ClaimTypes.Name, user.Username ?? ""),
};

user.LinGroups?.ForEach(r =>
 {
     claims.Add(new Claim(ClaimTypes.Role, r.Name));
 });
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h3 id="authorizeattributeæºç " tabindex="-1"> AuthorizeAttributeæºç </h3>
<div><pre><code> [AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, AllowMultiple = true, Inherited = true)]
  public class AuthorizeAttribute : Attribute, IAuthorizeData
  {
    public AuthorizeAttribute()
    {
    }

    public AuthorizeAttribute(string policy)
    {
      this.Policy = policy;
    }

    public string Policy { get; set; }

    public string Roles { get; set; }

    public string AuthenticationSchemes { get; set; }
  }
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒç»§æ‰¿äº†Attributeï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªç‰¹æ€§æ ‡ç­¾ï¼ŒIAuthorizeDataæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ‰è¿™ä¸‰ä¸ªå±æ€§ï¼Œçº¦æŸäº† ä¸€ä¸ªè§„èŒƒï¼Œå³æœ‰è§’è‰²Rolesï¼Œæœ‰ç­–ç•¥Policyï¼Œæœ‰èº«ä»½éªŒè¯æ–¹æ¡ˆAuthenticationSchemesï¼Œè¯¥ç‰¹æ€§æ”¯æŒClass,æ”¯æŒæ–¹æ³•ï¼Œè¯¥ç‰¹æ€§æ ‡ç­¾æ”¯æŒå¤šä¸ªå…±ç”¨ï¼Œè¯¥ç‰¹æ€§æ ‡ç­¾æ”¯æŒè¢«ç»§æ‰¿ã€‚</p>
<p>åŸºäºè§’è‰²çš„æˆæƒå’ŒåŸºäºå£°æ˜çš„æˆæƒæ˜¯ä¸€ç§é¢„é…ç½®çš„ç­–ç•¥ï¼Œå³å›ºå®šçš„è§’è‰²ï¼Œå›ºå®šçš„ClaimséªŒè¯ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åŸºäºè‡ªå®šä¹‰ç­–ç•¥çš„å®ç°æ›´å¤šçš„æƒé™éªŒè¯æˆ–æŸäº›è§„åˆ™éªŒè¯ã€‚</p>
<p>AuthorizeAttributeèƒ½åšçš„æƒé™æ§åˆ¶å¦‚ä¸‹</p>
<ul>
<li>åŸºäºè§’è‰²çº§åˆ«çš„æƒé™æ§åˆ¶ï¼ˆå¤šä¸ªè§’è‰²ï¼Œå•ä¸ªè§’è‰²ï¼‰</li>
<li>åŸºäºå£°æ˜çš„æˆæƒï¼šå¯è‡ªå®šä¹‰å£°æ˜ç‰¹æ€§ã€‚</li>
<li>åŸºäºç­–ç•¥çš„æˆæƒï¼š</li>
</ul>
<h2 id="lin-cms-dotnetcoreä¸­çš„æƒé™è®¾è®¡" tabindex="-1"> lin-cms-dotnetcoreä¸­çš„æƒé™è®¾è®¡</h2>
<p>è¯´äº†è¿™ä¹ˆå¤šå®˜æ–¹æä¾›çš„ï¼Œæˆ‘ä»¬è®²ä¸€ä¸‹lin-cms-dotnetcoreä¸­çš„æƒé™è®¾è®¡</p>
<p>å®Œæ•´çš„è¡¨ç»“æ„å¦‚ä¸‹
<a href="https://luoyunchong.github.io/igeekfan-docs/dotnetcore/lin-cms/table.html" target="_blank" rel="noopener noreferrer">https://luoyunchong.github.io/igeekfan-docs/dotnetcore/lin-cms/table.html</a></p>
<h4 id="lincmsauthorizeattribute" tabindex="-1"> LinCmsAuthorizeAttribute</h4>
<div><pre><code> [AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, AllowMultiple = true)]
    public class LinCmsAuthorizeAttribute : Attribute, IAsyncAuthorizationFilter
    {
        public string Permission { get; }
        public string Module { get; }

        public LinCmsAuthorizeAttribute(string permission, string module)
        {
            Permission = permission;
            Module = module;
        }

        public async Task OnAuthorizationAsync(AuthorizationFilterContext context)
        {
            ClaimsPrincipal claimsPrincipal = context.HttpContext.User;

            if (!claimsPrincipal.Identity.IsAuthenticated)
            {
                HandlerAuthenticationFailed(context, "è®¤è¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¯·æ±‚å¤´æˆ–è€…é‡æ–°ç™»é™†", ErrorCode.AuthenticationFailed);
                return;
            }

            IAuthorizationService authorizationService = (IAuthorizationService)context.HttpContext.RequestServices.GetService(typeof(IAuthorizationService));
            AuthorizationResult authorizationResult = await authorizationService.AuthorizeAsync(context.HttpContext.User, null, new OperationAuthorizationRequirement() { Name = Permission });
            if (!authorizationResult.Succeeded)
            {
                HandlerAuthenticationFailed(context, $"æ‚¨æ²¡æœ‰æƒé™ï¼š{Module}-{Permission}", ErrorCode.NoPermission);
            }
        }

        public void HandlerAuthenticationFailed(AuthorizationFilterContext context, string errorMsg, ErrorCode errorCode)
        {
            context.HttpContext.Response.StatusCode = StatusCodes.Status401Unauthorized;
            context.Result = new JsonResult(new UnifyResponseDto(errorCode, errorMsg, context.HttpContext));
        }
    }
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br></div></div><p>ä¸Šé¢çš„å®ç°éå¸¸ç®€å•,LinCmsAuthorizeAttributeç»§æ‰¿äºAttributeï¼Œè¯´æ˜æ˜¯ä¸€ä¸ªç‰¹æ€§æ ‡ç­¾ï¼Œæœ‰äºŒä¸ªå±æ€§Permissionï¼ŒModuleï¼Œä»£è¡¨æƒé™åï¼Œæ¨¡å—åï¼ˆç”¨äºåŒºåˆ†å“ªä¸ªåŠŸèƒ½æ¨¡å—ï¼‰ï¼Œç„¶åå°†æƒé™åç§°è½¬åŒ–ä¸ºOperationAuthorizationRequirementï¼Œç„¶åè°ƒç”¨authorizationServiceä¸­çš„æ–¹æ³•AuthorizeAsyncæ¥å®Œæˆæˆæƒã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨æ§åˆ¶å™¨ä¸Šä½¿ç”¨LinCmsAuthorizeAttribute,é‚£ä¹ˆæˆ‘ä»¬</p>
<div><pre><code>[Route("cms/admin/group")]
[ApiController]
public class GroupController : ControllerBase
{
    private readonly IGroupService _groupService;
    public GroupController(IGroupService groupService)
    {
        _groupService = groupService;
    }

    [HttpGet("all")]
    [LinCmsAuthorize("æŸ¥è¯¢æ‰€æœ‰æƒé™ç»„","ç®¡ç†å‘˜")]
    public Task&lt;List&lt;LinGroup>> GetListAsync()
    {
        return _groupService.GetListAsync();
    }

    [HttpGet("{id}")]
    [LinCmsAuthorize("æŸ¥è¯¢ä¸€ä¸ªæƒé™ç»„åŠå…¶æƒé™","ç®¡ç†å‘˜")]
    public async Task&lt;GroupDto> GetAsync(long id)
    {
        GroupDto groupDto = await _groupService.GetAsync(id);
        return groupDto;
    }

    [HttpPost]
    [LinCmsAuthorize("æ–°å»ºæƒé™ç»„","ç®¡ç†å‘˜")]
    public async Task&lt;UnifyResponseDto> CreateAsync([FromBody] CreateGroupDto inputDto)
    {
        await _groupService.CreateAsync(inputDto);
        return UnifyResponseDto.Success("æ–°å»ºåˆ†ç»„æˆåŠŸ");
    }

    [HttpPut("{id}")]
    [LinCmsAuthorize("æ›´æ–°ä¸€ä¸ªæƒé™ç»„","ç®¡ç†å‘˜")]
    public async Task&lt;UnifyResponseDto> UpdateAsync(long id, [FromBody] UpdateGroupDto updateGroupDto)
    {
        await _groupService.UpdateAsync(id, updateGroupDto);
        return UnifyResponseDto.Success("æ›´æ–°åˆ†ç»„æˆåŠŸ");
    }

    [HttpDelete("{id}")]
    [LinCmsAuthorize("åˆ é™¤ä¸€ä¸ªæƒé™ç»„","ç®¡ç†å‘˜")]
    public async Task&lt;UnifyResponseDto> DeleteAsync(long id)
    {
        await _groupService.DeleteAsync(id);
        return UnifyResponseDto.Success("åˆ é™¤åˆ†ç»„æˆåŠŸ");
    }

}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br></div></div><p>è¿™æ ·åœ¨æ–¹æ³•ä¸Šå·²ç»åŠ äº†æƒé™çš„æ ‡ç­¾ï¼Œä½†æˆ‘ä»¬æ€ä¹ˆå¾—åˆ°ç³»ç»Ÿä¸­çš„æ‰€æœ‰æƒé™ï¼Œè®©ç”¨æˆ·é…ç½®å‘¢ã€‚
<a href="https://igeekfan.gitee.io/igeekfan-docs/dotnetcore/lin-cms/reflex-assembly-get-controller-methods-attribute.html#%E8%8E%B7%E5%8F%96%E6%8E%A7%E5%88%B6%E5%99%A8%E5%8F%8A%E6%96%B9%E6%B3%95%E7%89%B9%E6%80%A7%E6%A0%87%E7%AD%BE" target="_blank" rel="noopener noreferrer">è·å–æ§åˆ¶å™¨åŠæ–¹æ³•ç‰¹æ€§æ ‡ç­¾</a>ã€‚æœ¬è´¨ä¸Šï¼Œæ˜¯é€šè¿‡åå°„,æ‰«æå½“å‰ç¨‹åºé›†ï¼Œä¼šè·å–åˆ°ä¸€ä¸ªListï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶æŠŠè¿™äº›æ•°æ®å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p>
<p>æœ€æ–°çš„æ–¹å¼æ˜¯é‡‡ç”¨æ­¤æ–¹æ³•ï¼ŒåŸç†éƒ½ç›¸åŒã€‚nameï¼Œmoduleå”¯ä¸€å€¼ã€‚å­˜å…¥lin_permissionè¡¨ä¸­ï¼Œè¿™æ—¶å°±æœ‰idå€¼äº†ã€‚lin_group_permissionå°±èƒ½ç”¨åˆ†ç»„å…³è”äº†ã€‚</p>
<div><pre><code>public async Task SeedAsync()
{
    List&lt;PermissionDefinition> linCmsAttributes = ReflexHelper.GeAssemblyLinCmsAttributes();

    List&lt;LinPermission> insertPermissions = new List&lt;LinPermission>();
    List&lt;LinPermission>allPermissions=await  _permissionRepository.Select.ToListAsync();
    
    linCmsAttributes.ForEach(r =>
    {
        bool exist = allPermissions.Any(u => u.Module == r.Module &amp;&amp; u.Name == r.Permission);
        if (!exist)
        {
            insertPermissions.Add(new LinPermission(r.Permission, r.Module));
        }
    });
    await _permissionRepository.InsertAsync(insertPermissions);
 }
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><h3 id="å®ç°æ–¹æ³•çº§çš„æƒé™æ§åˆ¶æºç è§£æ" tabindex="-1"> å®ç°æ–¹æ³•çº§çš„æƒé™æ§åˆ¶æºç è§£æ</h3>
<p>åŸç†å¯ä»¥çœ‹è¿™ä¸ªæ–‡ç« <a href="https://www.cnblogs.com/RainingNight/p/dynamic-authorization-in-asp-net-core.html" target="_blank" rel="noopener noreferrer">ASP.NET Core è®¤è¯ä¸æˆæƒ[7]:åŠ¨æ€æˆæƒ</a>ä¸­çš„<strong>è‡ªå®šä¹‰æˆæƒè¿‡æ»¤å™¨</strong></p>
<p>æˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹è¿™äº›ç±»/æ¥å£/æŠ½è±¡ç±»</p>
<div><pre><code>- IAuthorizationService(interface)
- AuthorizationService(class)
- IAuthorizationHandler(interface)
- AuthorizationHandler&lt;TRequirement>(abstract class)
- PermissionAuthorizationHandlerï¼ˆclass è‡ªå®šä¹‰çš„ç±»,ç»§æ‰¿AuthorizationHandlerï¼‰
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h3 id="æ€»ç»“è°ƒç”¨é“¾å¦‚ä¸‹" tabindex="-1"> æ€»ç»“è°ƒç”¨é“¾å¦‚ä¸‹</h3>
<div><pre><code>LinCmsAuthorizeAttributeï¼ˆç»§æ‰¿äº†IAsyncAuthorizationFilterçš„ç‰¹æ€§æ ‡ç­¾ï¼‰
è°ƒç”¨äº†---->
IAuthorizationServiceä¸­çš„AuthorizeAsyncæ–¹æ³•
è°ƒç”¨äº†---->
IAuthorizationHandlerä¸­çš„HandleAsync
è°ƒç”¨äº†---->
AuthorizationHandlerä¸­çš„HandleRequirementAsyncæŠ½è±¡æ–¹æ³•
ç›¸å½“äºè°ƒç”¨---->
PermissionAuthorizationHandlerç±»ä¸­çš„å®ç°æ–¹æ³•HandleRequirementAsync
è°ƒç”¨äº†---->
IPermissionServiceç±»ä¸­çš„CheckPermissionAsyncæ–¹æ³•ã€‚
è°ƒç”¨äº†---->
IAuditBaseRepository&lt;LinPermission,long>
IAuditBaseRepository&lt;LinGroupPermission, long>
ä½¿ç”¨FreeSql,åˆ¤æ–­å½“å‰ç”¨æˆ·æ‰€åœ¨åˆ†ç»„æ˜¯å¦æ‹¥æœ‰æ­¤æƒé™ã€‚
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><p>IAuthorizationServiceæ˜¯ä»€ä¹ˆå‘¢ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼ŒéªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰å¯¹åº”çš„èµ„æºæƒé™ã€‚ç³»ç»Ÿé»˜è®¤å®ç°äº†è¯¥æ–¹æ³•</p>
<div><pre><code>public interface IAuthorizationService
{
    Task&lt;AuthorizationResult> AuthorizeAsync(ClaimsPrincipal user, object resource, IEnumerable&lt;IAuthorizationRequirement> requirements);

    Task&lt;AuthorizationResult> AuthorizeAsync(ClaimsPrincipal user, object resource, string policyName);
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>AuthorizationServiceæ˜¯ä»€ä¹ˆå‘¢.ä»–å®ç°äº†IAuthorizationServiceæ¥å£.
é€šè¿‡æºç æˆ‘ä»¬çŸ¥é“ï¼Œå®ƒè°ƒç”¨ <strong>await authorizationHandler.HandleAsync(authContext);</strong></p>
<div><pre><code> public async Task&lt;AuthorizationResult> AuthorizeAsync(
  ClaimsPrincipal user,
  object resource,
  IEnumerable&lt;IAuthorizationRequirement> requirements)
{
  if (requirements == null)
    throw new ArgumentNullException(nameof (requirements));
  AuthorizationHandlerContext authContext = this._contextFactory.CreateContext(requirements, user, resource);
  foreach (IAuthorizationHandler authorizationHandler in await this._handlers.GetHandlersAsync(authContext))
  {
    await authorizationHandler.HandleAsync(authContext);
    if (!this._options.InvokeHandlersAfterFailure)
    {
      if (authContext.HasFailed)
        break;
    }
  }
  AuthorizationResult authorizationResult = this._evaluator.Evaluate(authContext);
  if (authorizationResult.Succeeded)
    this._logger.UserAuthorizationSucceeded();
  else
    this._logger.UserAuthorizationFailed();
  return authorizationResult;
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br></div></div><p>IAuthorizationHandler ä»…ä¸€ä¸ªæ¥å£ã€‚</p>
<div><pre><code>public interface IAuthorizationHandler
{
    /// &lt;summary>
    /// Makes a decision if authorization is allowed.
    /// &lt;/summary>
    /// &lt;param name="context">The authorization information.&lt;/param>
    Task HandleAsync(AuthorizationHandlerContext context);
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>AuthorizationHandlerï¼Œå®ƒç»§æ‰¿<strong>IAuthorizationHandler</strong>
è€Œä¸”ä»–æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé»˜è®¤å®ç°äº†HandleAsyncæ–¹æ³•ï¼Œå­ç±»åªç”¨å®ç°HandleRequirementAsyncå³å¯ã€‚</p>
<div><pre><code>  public abstract class AuthorizationHandler&lt;TRequirement> : IAuthorizationHandler
    where TRequirement : IAuthorizationRequirement
  {
    public virtual async Task HandleAsync(AuthorizationHandlerContext context)
    {
      foreach (TRequirement requirement in context.Requirements.OfType&lt;TRequirement>())
        await this.HandleRequirementAsync(context, requirement);
    }

    protected abstract Task HandleRequirementAsync(
      AuthorizationHandlerContext context,
      TRequirement requirement);
  }
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><p>æˆ‘ä»¬å°±å¯ä»¥ç»§æ‰¿AuthorizationHandlerï¼Œå­ç±»å®ç°ä»æ•°æ®åº“ä¸­å–æ•°æ®åšå¯¹æ¯”ï¼Œå…¶ä¸­æ³›å‹å‚æ•°ä½¿ç”¨ç³»ç»Ÿå†…ç½®çš„ä¸€ä¸ªåªæœ‰Nameçš„ç±»OperationAuthorizationRequirementï¼Œå½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ›´å¤šçš„å‚æ•°ï¼Œå¯ä»¥ç»§æ‰¿IAuthorizationRequirementï¼Œå¢åŠ æ›´å¤šçš„å‚æ•°ã€‚</p>
<p>åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ä¸ºnull,å½“è°ƒç”¨CheckPermissionAsyncï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æ­¤æƒé™ã€‚</p>
<div><pre><code>   public class PermissionAuthorizationHandler : AuthorizationHandler&lt;OperationAuthorizationRequirement>
    {
        private readonly IPermissionService _permissionService;

        public PermissionAuthorizationHandler(IPermissionService permissionService)
        {
            _permissionService = permissionService;
        }

        protected override async Task HandleRequirementAsync(AuthorizationHandlerContext context, OperationAuthorizationRequirement requirement)
        {
            Claim userIdClaim = context.User?.FindFirst(_ => _.Type == ClaimTypes.NameIdentifier);
            if (userIdClaim != null)
            {
                if (await _permissionService.CheckPermissionAsync(requirement.Name))
                {
                    context.Succeed(requirement);
                }
            }
        }
    }
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><p>å¦å¤–æˆ‘ä»¬è¿˜éœ€è¦æŠŠè¿™ä¸ªHandleræ³¨å…¥åˆ°æˆ‘ä»¬çš„DIä¸­ï¼Œåœ¨ConfigureServicesä¸­æ›¿æ¢å¦‚ä¸‹æœåŠ¡</p>
<div><pre><code>services.AddScoped&lt;IAuthorizationHandler, PermissionAuthorizationHandler>();
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å…¶ä¸­çš„PermssionAppServiceä¸­çš„å®ç°,æ£€æŸ¥å½“å‰ç™»å½•çš„ç”¨æˆ·çš„æ˜¯å¦æœ‰æ­¤æƒé™</p>
<div><pre><code>public async Task&lt;bool> CheckPermissionAsync(string permission)
{
    long[] groups = _currentUser.Groups;

    LinPermission linPermission = await _permissionRepository.Where(r => r.Name == permission).FirstAsync();

    bool existPermission = await _groupPermissionRepository.Select
        .AnyAsync(r => groups.Contains(r.GroupId) &amp;&amp; r.PermissionId == linPermission.Id);

    return existPermission;
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h3 id="æ›´å¤šå‚è€ƒ" tabindex="-1"> æ›´å¤šå‚è€ƒ</h3>
<ul>
<li><a href="https://www.cnblogs.com/RainingNight/p/introduce-basic-authentication-in-asp-net-core.html" target="_blank" rel="noopener noreferrer">ASP.NET Core è®¤è¯ä¸æˆæƒ[1]:åˆè¯†è®¤è¯</a></li>
</ul>
<h2 id="å¼€æºåœ°å€" tabindex="-1"> å¼€æºåœ°å€</h2>
<ul>
<li>åç«¯æ¥å£Gitee é“¾æ¥ <a href="https://gitee.com/igeekfan/lin-cms-dotnetcore" target="_blank" rel="noopener noreferrer">https://gitee.com/igeekfan/lin-cms-dotnetcore</a></li>
<li>åç«¯æ¥å£GitHub é“¾æ¥ <a href="https://github.com/luoyunchong/lin-cms-dotnetcore" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/lin-cms-dotnetcore</a></li>
<li>ç®¡ç†ç«¯UI <a href="https://github.com/luoyunchong/lin-cms-vue" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/lin-cms-vue</a></li>
<li>ç”¨æˆ·ç«¯UI <a href="https://github.com/luoyunchong/lin-cms-vvlog" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/lin-cms-vvlog</a></li>
</ul>
]]></content>
    <published>2020-05-28T06:06:11.000Z</published>
  </entry>
  <entry>
    <title type="html">æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿ</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/file-upload.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/file-upload.html"/>
    <updated>2020-07-24T17:10:08.000Z</updated>
    <content type="html"><![CDATA[<h1 id="æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿ" tabindex="-1"> æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿ</h1>
<p>lin-cms-dotnetcore é»˜è®¤é›†æˆäº†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œå¹¶å¯è‡ªç”±åˆ‡æ¢å­˜å‚¨ä½ç½®ï¼Œå‰ç«¯ä¹Ÿæœ‰ç›¸åº”çš„ç»„ä»¶åŒ¹é…ä½¿ç”¨.</p>
<p>ç›®å‰åç«¯å®ç°äº†ä¸ƒç‰›äº‘æ–‡ä»¶ï¼ˆQiniuServiceï¼‰ä¸Šä¼ ï¼Œæœ¬åœ°æ–‡ä»¶ï¼ˆLocalFileServiceï¼‰ä¸Šä¼ ã€‚</p>
<p>æ¥å£ <strong>IFileService</strong></p>
<div><pre><code>public interface IFileService
{
    /// &lt;summary>
    /// å•æ–‡ä»¶ä¸Šä¼ ï¼Œé”®ä¸ºfile
    /// &lt;/summary>
    /// &lt;param name="file">&lt;/param>
    /// &lt;param name="key">&lt;/param>
    /// &lt;returns>&lt;/returns>
    Task&lt;FileDto> UploadAsync(IFormFile file, int key = 0);
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><p>é…ç½®é¡¹ appsettings.json</p>
<h2 id="æœ¬åœ°æ–‡ä»¶ä¸Šä¼ " tabindex="-1"> æœ¬åœ°æ–‡ä»¶ä¸Šä¼ </h2>
<ul>
<li>PrefixPathï¼šé»˜è®¤ä¸ºwwwrootä¸‹çš„æ–‡ä»¶ç›®å½•é…ç½®é¡¹ï¼Œassetsï¼Œå¤šçº§ç›®å½•ï¼Œå‰åä¸è¦åŠ **/**ï¼Œå¦‚assets/file</li>
<li>Host:  æ–‡ä»¶ä¸Šä¼ åï¼Œè®¿é—®åŸŸåé…ç½®ï¼Œè¿™é‡Œé…ç½®https://localhost:5001/</li>
<li>ServiceName :é…ç½®å½“å‰ç³»ç»Ÿä¸Šä¼ æ—¶ä½¿ç”¨å“ªä¸ªå®ç°ï¼Œå¯é€‰é…ç½®é¡¹ï¼ˆLocalFileServiceã€QiniuServiceï¼‰
<ul>
<li>å½“ä¸ºLocalFileServiceæ—¶ï¼Œæ–‡ä»¶ä¿å­˜è·¯å¾„ä¸º<strong>wwwroot</strong>é™æ€æ–‡ä»¶ç›®å½•ä¸‹ï¼Œä¸Šä¼ è‡³æœ¬åœ°ï¼Œ</li>
<li>QiniuService ä¸Šä¼ è‡³ä¸ƒç‰›äº‘</li>
</ul>
</li>
</ul>
<p>å®é™…æ–‡ä»¶è·¯å¾„</p>
<p><strong>/assets/2020/5/8/xxxxxx-1111-12-12-12--1-21.png</strong></p>
<p>å‚æ•°åŒ–</p>
<p><strong>/{STORE_DIR}/{year}/{month}/{day}/{guid}.æ–‡ä»¶åç¼€</strong></p>
<div><pre><code>  "FileStorage": {
    "ServiceName": "LocalFileService",//LocalFileServiceã€QiniuService
    "LocalFile":{
      "PrefixPath": "assets",
      "Host": "https://localhost:5001/"
    }
  },
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><h2 id="ä¸ƒç‰›äº‘æ–‡ä»¶ä¸Šä¼ " tabindex="-1"> ä¸ƒç‰›äº‘æ–‡ä»¶ä¸Šä¼ </h2>
<p>SERVICEä¸ºQiniuServiceæ—¶ï¼Œç³»ç»Ÿå°†éœ€è¦ä½¿ç”¨å¦‚ä¸‹é…ç½®é¡¹ï¼Œ</p>
<ul>
<li>AK :ä¸ƒç‰›äº‘å¯†é’¥AccessKey</li>
<li>SK :ä¸ƒç‰›äº‘å¯†é’¥SecretKey</li>
<li>Bucket :ä¸ƒç‰›äº‘æ–°å»ºå­˜å‚¨ç©ºé—´çš„åç§°ï¼ˆå”¯ä¸€å€¼ï¼‰</li>
<li>PrefixPath æ–‡ä»¶æ ¹ç›®å½•å‰ç¼€</li>
<li>Host:ä¸ƒç‰›äº‘é…ç½®çš„CDN åŠ é€ŸåŸŸåï¼Œå¯ä½¿ç”¨ä¸´æ—¶åˆ†é…çš„åŸŸåï¼Œä»…ä¸€ä¸ªæœˆæœ‰æ•ˆæœŸï¼Œç»‘å®šè‡ªå·±çš„åŸŸåï¼Œå¯é…ç½®æ³›å­åŸŸå</li>
<li>UseHttpsï¼šä½¿ç”¨httpsï¼Œè¿™ä¸ªå‚æ•°å¥½åƒæ²¡å•¥ç”¨ã€‚</li>
</ul>
<p>ä¸Šä¼ æ–‡ä»¶å</p>
<p><strong>assets/20191218150043868887.jpg</strong></p>
<p>å‚æ•°</p>
<p><strong>{PrefixPath}/{yyyyMMddHHmmssffffff}.æ–‡ä»¶åç¼€</strong></p>
<div><pre><code>  "FileStorage": {
   "ServiceName": "QiniuService",
    "Qiniu": {
      "AK": "",
      "SK": "",
      "Bucket": "vvv",
      "PrefixPath": "assets",
      "Host": "http://images.igeekfan.cn/",
      "UseHttps": false
    }
  },
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>lin-cms é»˜è®¤å¯¹å¤–æš´éœ²äº†cms/file/ä½œä¸ºæ–‡ä»¶ä¸Šä¼ æ¥å£ï¼Œé€šè¿‡è¯¥æ¥å£å¯ä»¥ç›´æ¥ä½¿ç”¨ HTTP post æ–¹æ³•ä¸Šä¼ æ–‡ä»¶ã€‚</p>
<p>è¿è¡Œé¡¹ç›®åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°swaggerï¼Œæ‰¾åˆ°cms/file
<a href="https://localhost:5001/swagger/index.html" target="_blank" rel="noopener noreferrer">https://localhost:5001/swagger/index.html</a></p>
<table>
<thead>
<tr>
<th>è¯·æ±‚æ–¹å¼</th>
<th>è·¯å¾„</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td>HttpPost</td>
<td>/cms/file/upload</td>
<td>å•æ–‡ä»¶ä¸Šä¼ </td>
</tr>
</tbody>
</table>
<p>ç›´æ¥å¯é€šè¿‡swaggeré€‰æ‹©æ–‡ä»¶åï¼Œè¾“å…¥keyä¸º0ï¼Œæ‰§è¡ŒExecute</p>
<div><pre><code>{
  "key": "file_0",
  "path": "assets/2020/05/08/64263e57-9a24-4933-9116-25616c801e93.png",
  "url": "https://localhost:5001/assets/2020/05/08/64263e57-9a24-4933-9116-25616c801e93.png",
  "id": 19
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><table>
<thead>
<tr>
<th>è¯·æ±‚æ–¹å¼</th>
<th>è·¯å¾„</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td>HttpPost</td>
<td>/cms/file</td>
<td>å¤šæ–‡ä»¶ä¸Šä¼ </td>
</tr>
</tbody>
</table>
<p>ç”±äºswagger-uiçš„è§„èŒƒï¼Œç›®å‰å¤šæ–‡ä»¶æ— æ³•æ­£ç¡®æ˜¾ç¤ºï¼Œå³æ—¶æ­£å¸¸æ˜¾ç¤ºå‡ºé€‰æ‹©å¤šæ–‡ä»¶ï¼Œåå°å´å¾—ä¸åˆ°è¯·æ±‚çš„æ•°æ®ã€‚ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡postmanä¸Šä¼ å¤šæ–‡ä»¶ã€‚</p>
<p><a href="https://pic.downk.cc/item/5ebaba6bc2a9a83be5afe50b.png" target="_blank" rel="noopener noreferrer"><img src="https://pic.downk.cc/item/5ebaba6bc2a9a83be5afe50b.png" alt="" loading="lazy"></a></p>
<p>ç”±äºä¸Šä¼ äº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å¾—åˆ°äº†ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œå®ƒä»¬çš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<div><pre><code>[
    {
        "key": "file_0",
        "path": "assets/20200512234540511428.png",
        "url": "http://images.igeekfan.cn/assets/20200512234540511428.png",
        "id": 38
    },
    {
        "key": "file_1",
        "path": "assets/20200512234540321269.jpg",
        "url": "http://images.igeekfan.cn/assets/20200512234540321269.jpg",
        "id": 37
    }
]
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><table>
<thead>
<tr>
<th>name</th>
<th>è¯´æ˜</th>
<th>ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>key</td>
<td>æ–‡ä»¶ä¸Šä¼ çš„key</td>
<td>string</td>
</tr>
<tr>
<td>id</td>
<td>æ–‡ä»¶å­˜å‚¨åˆ°æ•°æ®åº“çš„id</td>
<td>string</td>
</tr>
<tr>
<td>path</td>
<td>æ–‡ä»¶å­˜å‚¨çš„è·¯å¾„path</td>
<td>string</td>
</tr>
<tr>
<td>url</td>
<td>å¯è®¿é—®çš„ url</td>
<td>string</td>
</tr>
</tbody>
</table>
<blockquote>
<p>TIP
ç³»ç»Ÿä¼šè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶åšmd5ï¼Œå› æ­¤ä½ å¤§å¯ä¸å¿…æ‹…å¿ƒæ–‡ä»¶é‡å¤ä¸Šä¼ ï¼Œå¦‚æœä½ ä¸Šä¼ äº† é‡å¤çš„æ–‡ä»¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›å·²ä¼ æ–‡ä»¶çš„æ•°æ®ã€‚</p>
</blockquote>
<h2 id="å…¶ä»–ç‰¹æ€§" tabindex="-1"> å…¶ä»–ç‰¹æ€§</h2>
<p>Kestrelæ˜¯å†…ç½®çš„ASP.NET Coreçš„å†…ç½®WEBæœåŠ¡å™¨ï¼Œæ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œæ”¯æŒè·¨å¹³å°</p>
<p>1.è¿è¡Œç¤ºæ„ï¼šInternet---(é€šè¿‡HTTPè®¿é—®)---&gt;Kestrel(Kestrel WEB Server Port 5001)--å†…éƒ¨HttpContexté€šè¿‡---&gt;&gt;è®¿é—®åˆ°ApplicationCode</p>
<ol start="2">
<li>åœ¨Internetåˆ°Kesterlä¸­é—´åŠ ä¸€ä¸ªåå‘ä»£ç†ï¼ˆnginx,iis,apache)</li>
</ol>
<p>ç¬¬ä¸€ç§æ–¹å¼ï¼Œæ–‡ä»¶å¤§å°çš„é…ç½®ä¸Kestrelæœ‰å…³ã€‚ä¹Ÿå’Œåº”ç”¨ä»£ç æœ‰å…³ã€‚</p>
<p>Kestrelé»˜è®¤çš„æœ€å¤§è¯·æ±‚æ­£æ–‡å¤§å°ä¸º 30,000,000 ä¸ªå­—èŠ‚ï¼Œçº¦ä¸º 28.6 MB.</p>
<p>åœ¨Program.csä¸­é…ç½®Kestrelçš„æ–‡ä»¶å¤§å°</p>
<div><pre><code>webBuilder.ConfigureKestrel((context, options) =>
{
    //è®¾ç½®åº”ç”¨æœåŠ¡å™¨Kestrelè¯·æ±‚ä½“æœ€å¤§ä¸º8MB
    
    options.Limits.MaxRequestBodySize = 1024*1024*8;
});
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>æˆ–è€…åœ¨StartUpä¸­é…ç½®åº”ç”¨ç¨‹åºçº§åˆ«çš„è®¾ç½®</p>
<div><pre><code>services.Configure&lt;FormOptions>(options =>
{
    //å•ä¸ªæ–‡ä»¶ä¸Šä¼ çš„å¤§å°é™åˆ¶ä¸º8 MB      é»˜è®¤134217728 åº”è¯¥æ˜¯128MB
    options.MultipartBodyLengthLimit = 1024 * 1024 * 8;     //8MB
});
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>å¦‚æœéƒ¨ç½²åœ¨åå‘ä»£ç†åï¼Œè¿˜ä¸ä»£ç†æœåŠ¡å™¨æœ‰å…³ã€‚</p>
<h2 id="æ–‡ä»¶ä¸Šä¼ å…¶ä»–é…ç½®é¡¹" tabindex="-1"> æ–‡ä»¶ä¸Šä¼ å…¶ä»–é…ç½®é¡¹</h2>
<ul>
<li>MaxFileSize:ä¸Šä¼ æ–‡ä»¶æ€»å¤§å°,<code>1024*1024*80=83886080=80MB</code></li>
<li>NumLimit:ä¸Šä¼ æ–‡ä»¶æ€»æ•°é‡</li>
<li>Includeï¼Œå…è®¸æŸäº›ç±»å‹æ–‡ä»¶ä¸Šä¼ ,æ–‡ä»¶æ ¼å¼ä»¥,éš”å¼€</li>
<li>Excludeï¼šç¦æ­¢æŸäº›ç±»å‹æ–‡ä»¶ä¸Šä¼ ï¼Œæ–‡ä»¶æ ¼å¼ä»¥,éš”å¼€</li>
</ul>
<div><pre><code>"FileStorage": {
    "MaxFileSize": 83886080,
    "NumLimit": 3,
    "Include": "",
    "Exclude": ".exe,.dll",
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p><strong>exclude</strong>å’Œ<strong>include</strong>è¿™ä¸¤é¡¹é…ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸¤è€…åªä¼šæœ‰ä¸€ é¡¹ç”Ÿæ•ˆï¼›è‹¥è¿™äºŒè€…ä¸­æœ‰ä¸€é¡¹ä¸ºç©ºï¼Œåˆ™å¦ä¸€é¡¹ä¸ä¸ºç©ºçš„é…ç½®ä¼šç”Ÿæ•ˆï¼›å¦‚æœä¸¤é¡¹çš†ä¸ºç©ºçš„è¯ï¼Œä¼š é€šè¿‡æ‰€æœ‰æ–‡ä»¶ç±»å‹ï¼›å¦‚æœäºŒè€…éƒ½ä¸ä¸ºç©ºï¼Œåˆ™<strong>include</strong>ä¸ºæœ‰æ•ˆé…ç½®ï¼Œè€Œexcludeä¼šå¤±æ•ˆï¼›æ€» è€Œè¨€ä¹‹ï¼Œç³»ç»Ÿåªä¼šæ”¯æŒä½¿ç”¨ä¸€é¡¹ï¼ŒäºŒè€…éƒ½ä¸ºä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œåˆ™é€šè¿‡æ‰€æœ‰æ–‡ä»¶ç±»å‹ã€‚</p>
<p>å®Œæ•´é…ç½®é¡¹</p>
<div><pre><code> "FileStorage": {
    "MaxFileSize": 83886080,
    "NumLimit": 3,
    "Include": ".png,.jpg",
    "Exclude": ".exe,.dll",
    "ServiceName": "LocalFileService",//LocalFileServiceã€QiniuService
    "LocalFile":{
      "PrefixPath": "assets",
      "Host": "https://localhost:5001/"
    },
    "Qiniu": {
      "AK": "eUH1O-ft66S4XM2GIK7FGmj7czuYkcAyNGDAc-wq",
      "SK": "4dOi1daSr2-YgofhAfWb8JaLrbgozCmgD6AUmmM9",
      "Bucket": "vvv",
      "PrefixPath": "assets",
      "Host": "http://images.igeekfan.cn/",
      "UseHttps": false
    }
  },
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></div></div><ul>
<li>å®˜ç½‘ https://docs.microsoft.com/zh-cn/aspnet/core/mvc/models/file-uploads?view=aspnetcore-3.1</li>
</ul>
]]></content>
    <published>2020-05-13T11:18:08.000Z</published>
  </entry>
  <entry>
    <title type="html">è¡Œä¸ºæ—¥å¿—</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/logger.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/logger.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="è¡Œä¸ºæ—¥å¿—" tabindex="-1"> è¡Œä¸ºæ—¥å¿—</h1>
]]></content>
    <published>2020-05-13T11:18:08.000Z</published>
  </entry>
  <entry>
    <title type="html">å¼€æºä»‹ç»</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/open-source-road.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/open-source-road.html"/>
    <updated>2020-07-24T17:10:08.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å¼€æºä»‹ç»" tabindex="-1"> å¼€æºä»‹ç»</h1>
<ul>
<li>åœ°å€ï¼š<a href="https://github.com/luoyunchong/lin-cms-dotnetcore" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/lin-cms-dotnetcore</a></li>
</ul>
<p>1.ä»€ä¹ˆæ˜¯cmsï¼Ÿ</p>
<p>Content Management Systemï¼Œå†…å®¹ç®¡ç†ç³»ç»Ÿã€‚</p>
<p>2.dotnetcoreæ˜¯ä»€ä¹ˆ</p>
<p>.NET Coreï¼Œæ˜¯ç”±Microsoftå¼€å‘ï¼Œç›®å‰åœ¨.NET Foundation(ä¸€ä¸ªéè¥åˆ©çš„å¼€æºç»„ç»‡)ä¸‹è¿›è¡Œç®¡ç†ï¼Œé‡‡ç”¨å®½æ¾çš„MITåè®®ï¼Œå¯æ„å»ºå„ç§è½¯ä»¶ï¼ŒåŒ…æ‹¬Webåº”ç”¨ç¨‹åºã€ç§»åŠ¨åº”ç”¨ç¨‹åºã€æ¡Œé¢åº”ç”¨ç¨‹åºã€äº‘æœåŠ¡ã€å¾®æœåŠ¡ã€APIã€æ¸¸æˆå’Œç‰©è”ç½‘åº”ç”¨ç¨‹åº</p>
<p>3.lin-cms æ˜¯ä»€ä¹ˆ</p>
<p>Lin-CMS æ˜¯æ—é—´æœ‰é£å›¢é˜Ÿç»è¿‡å¤§é‡é¡¹ç›®å®è·µæ‰€æç‚¼å‡ºçš„ä¸€å¥—å†…å®¹ç®¡ç†ç³»ç»Ÿæ¡†æ¶ã€‚Lin-CMS å¯ä»¥æœ‰æ•ˆçš„å¸®åŠ©å¼€å‘è€…æé«˜ CMS çš„å¼€å‘æ•ˆç‡, éœ€è¦å‰ç«¯ï¼Ÿè¯·è®¿é—®å‰ç«¯ä»“åº“ã€‚å®˜æ–¹å›¢é˜Ÿäº§å“äº†è§£è¯·è®¿é—®TaleLin</p>
<p>4.lin-cms-dotnetcoreæœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ</p>
<p>å‰åç«¯åˆ†ç¦»ï¼Œæä¾›åç«¯æ¥å£ï¼Œæ›´å°‘çš„ä¾èµ–ï¼Œåç»­å°†å®ç°æ¨¡å—åŒ–å®‰è£…ä¸å¸è½½ã€‚</p>
<ul>
<li>ç”¨æˆ·ç®¡ç†ã€åˆ†ç»„ç®¡ç†ã€åˆ†ç»„æƒé™ç®¡ç†ã€æ—¥å¿—ç³»ç»Ÿã€æ–‡ä»¶ä¸Šä¼ ç­‰</li>
<li>æ›´å¤šåŠŸèƒ½ï¼ˆè‡ªå®šä¹‰æ‰©å±•-æ¨¡å—ç³»ç»Ÿï¼‰</li>
<li>åšå®¢æ¨¡å—ï¼Œç±»æ˜é‡‘ä¸“æ ï¼Œç”¨æˆ·ä¸­å¿ƒï¼Œæ ‡ç­¾ã€ä¸ªäººä¸“æ ã€æŠ€æœ¯é¢‘é“ï¼ˆé¦–é¡µåˆ†ç±»ï¼‰</li>
</ul>
<h2 id="è®¾è®¡å¦‚ä¸‹" tabindex="-1"> è®¾è®¡å¦‚ä¸‹</h2>
<h4 id="å­—å…¸ç®¡ç†" tabindex="-1"> å­—å…¸ç®¡ç†</h4>
<h3 id="æˆ‘åŸæœ¬æƒ³å®ç°è¿™æ ·çš„åŠŸèƒ½" tabindex="-1"> æˆ‘åŸæœ¬æƒ³å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼š</h3>
<p>BaseType 1 å¯¹BaseItemå¤šã€‚</p>
<p>å¦‚ï¼šæ ‡ç­¾ç®¡ç†ï¼Œä¸€ä¸ªæ–‡ç« ä¸‹å¯ä»¥è®¾ç½®å¤šä¸ªæ ‡ç­¾ï¼ŒåŸæœ¬éœ€è¦è®¾è®¡è¡¨Tag,å­—æ®µä¹Ÿå¤§æŠµä¸ºId,Name,SortåŠå…³è”è¡¨ã€‚
æˆ‘ä»¬ä½¿ç”¨BaseTypeã€BaseItemå®ç°ã€‚
BaseTypeä¸­TypeCodeä¸ºtag,FullNameä¸ºæ ‡ç­¾ï¼Œidä¸º1æ—¶ã€‚
BaseItemä¸­BaseTypeIdä¸º1ï¼ŒItemCodeä¸ºç¼–ç ,ItemNameä¸ºæ ‡ç­¾ã€‚ItemCodeä¸ºä¸é‡å¤çš„å­—ç¬¦ä¸²å³å¯ã€‚</p>
<p>å¦Tagä¸Articleçš„å…³è”è¡¨ï¼Œéœ€è¦å¦è®¾è®¡ä¸€ä¸ªè¡¨ã€‚</p>
<p>å½“æˆ‘ä»¬è¦å®ç°æ–‡ç« ç±»åˆ«çš„ä¸‹æ‹‰ï¼ŒåŸæœ¬éœ€è¦è®¾è®¡ä¸€ä¸ªè¡¨ArticleTypeï¼Œæœ‰å­—æ®µ,id,name,sortç­‰ã€‚
æˆ‘ä»¬å¯ä»¥é€šè¿‡BaseTypeã€BaseItemæ¥å®ç°ï¼Œä»è€Œç®€åŒ–è¿™äº›åŸºç¡€æ•°æ®ã€‚
BaseTypeæœ‰ä¸€æ¡æ•°æ®ï¼ŒTypeCodeä¸º å­—ç¬¦ä¸²categoryã€FullNameæ–‡ç« ç±»åˆ«ï¼ŒBaseItemå­˜å¤šä¸ªæ–‡ç« ç±»åˆ«(Javaã€å¤§æ•°æ®ã€Pythonã€C#ç­‰)ï¼Œç¼–ç ä¸åŒå³å¯ã€‚</p>
<ol>
<li>è¡¨ç»“æ„</li>
</ol>
<h4 id="base-type-å­—å…¸ç±»åˆ«ç®¡ç†" tabindex="-1"> base_type ï¼ˆå­—å…¸ç±»åˆ«ç®¡ç†ï¼‰</h4>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td></td>
</tr>
<tr>
<td>type_code</td>
<td>varchar(50)</td>
<td>ç±»åˆ«ç¼–ç </td>
</tr>
<tr>
<td>full_name</td>
<td>varchar(50)</td>
<td>å…¨ç§°</td>
</tr>
<tr>
<td>sort_code</td>
<td>int</td>
<td>æ’åºç </td>
</tr>
</tbody>
</table>
<h4 id="base-item-å­—å…¸ç®¡ç†" tabindex="-1"> base_item ï¼ˆå­—å…¸ç®¡ç†ï¼‰</h4>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td></td>
</tr>
<tr>
<td>base_type_id</td>
<td>int</td>
<td>ç±»åˆ«id(å…³è”base_typeçš„id)</td>
</tr>
<tr>
<td>item_code</td>
<td>varchar(50)</td>
<td>å­—å…¸ç¼–ç </td>
</tr>
<tr>
<td>item_name</td>
<td>varchar(50)</td>
<td>å­—å…¸å…¨ç§°</td>
</tr>
<tr>
<td>sort_code</td>
<td>int</td>
<td>æ’åºç </td>
</tr>
</tbody>
</table>
<h4 id="ä½†ç°å®æ€»æ˜¯äº‹ä¸æ„¿è¿" tabindex="-1"> ä½†ç°å®æ€»æ˜¯äº‹ä¸æ„¿è¿</h4>
<blockquote>
<p>åå°å–æ–‡ç« åˆ—è¡¨æ—¶ï¼Œæƒ³è¦å–å‡ºæ–‡ç« å¯¹åº”çš„åˆ†ç±»ï¼Œæ‰‹åŠ¨joinæ—¶ï¼Œæ€»è§‰å¾—joinçš„è¡¨ä¼šæœ‰äº›å¥‡æ€ªã€‚</p>
</blockquote>
<p>å½“ç„¶è¿˜æœ‰å…¶ä»–åŸå› ï¼Œ<strong>å±€é™æ€§</strong>ï¼š</p>
<ol>
<li>æ¯”å¦‚ä½¿ç”¨äº†è¿™ä¸ªå­—å…¸ï¼Œåˆ†ç±»éœ€è¦å¢åŠ ä¸€ä¸ªå›¾ç‰‡å­—æ®µï¼Œå°±ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Œåšä¸äº†ã€‚</li>
<li>æ¯”å¦‚æ ‡ç­¾éœ€è¦å®ç°è¿™ä¸ªæ ‡ç­¾ä¸‹æœ‰å¤šå°‘ä¸ªæ–‡ç« ï¼Œé€šè¿‡ç»Ÿè®¡ä¹Ÿèƒ½å®ç°ï¼Œ</li>
</ol>
<p>ä½¿ç”¨FreeSqlå®ç°æ—¶ï¼Œå¦‚æœäºŒä¸ªè¡¨ä¹‹é—´æ²¡æœ‰å¯¼èˆªå±æ€§ï¼Œæ˜¯æ›´å¤æ‚çš„ã€‚</p>
]]></content>
    <published>2020-05-13T11:18:08.000Z</published>
  </entry>
  <entry>
    <title type="html">QQç¬¬ä¸‰æ–¹æˆæƒç™»å½•</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/qq-login.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/qq-login.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="qqç¬¬ä¸‰æ–¹æˆæƒç™»å½•" tabindex="-1"> QQç¬¬ä¸‰æ–¹æˆæƒç™»å½•</h1>
<h2 id="å®‰è£…åŒ…" tabindex="-1"> å®‰è£…åŒ…</h2>
<div><pre><code>dotnet add package AspNet.Security.OAuth.QQ
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><ul>
<li><a href="https://luoyunchong.github.io/igeekfan-docs/dotnetcore/lin-cms/spa-github-login.html" target="_blank" rel="noopener noreferrer">æ¥ä¸Šæ–‡GitHubç¬¬ä¸‰æ–¹æˆæƒç™»å½•</a></li>
</ul>
<p>ç”³è¯·è¿‡ç¨‹ä¸ä»‹ç»äº†ï¼Œ<a href="https://wiki.connect.qq.com/%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C_oauth2-0" target="_blank" rel="noopener noreferrer">ç”³è¯·è€…èµ„æ–™</a>,ä¸ªäººä¹Ÿæ˜¯å¯ä»¥ç”³è¯·æˆåŠŸçš„ã€‚</p>
<p>è¿™æ—¶å€™æœ‰äºŒä¸ªå‚æ•°å°±æ˜¯clientid clientsecret</p>
<div><pre><code>APP IDï¼šxxxx
APP Keyï¼šxxxxxx
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>å…¶ä¸­<strong>å¹³å°ä¿¡æ¯</strong>ï¼Œè¿™ä¸ªç”³è¯·å®¡æ ¸é€šè¿‡åï¼Œ<strong>ä¸è¦ä¿®æ”¹ï¼Œåƒä¸‡ä¸è¦éšä¾¿ä¿®æ”¹</strong>ï¼Œä¸€ä¿®æ”¹å°±è¦é‡æ–°å®¡æ ¸ã€‚</p>
<p>ç½‘ç«™å›è°ƒåŸŸ:å¯ä»¥éšä¾¿ä¿®æ”¹ï¼Œå¹¶ä¸”å¯ä»¥å†™å¤šä¸ªï¼Œä¸­é—´ç”¨è‹±æ–‡é€—å·åˆ†éš”å³å¯ã€‚
æ¯”å¦‚ï¼Œç½‘ç«™åœ°å€å¡«çš„ï¼šhttps://api.igeekfan.cnï¼Œä¸‹é¢å¦‚æœæ˜¯localhostï¼Œæ˜¯å¯ä»¥çš„ï¼Œä½†å¦‚æœæ˜¯åŸŸå,ä¾¿åªèƒ½æ˜¯https://api.igeekfan.cnè¿™ä¸ªåŸŸåä¸‹çš„è·¯å¾„ã€‚</p>
<p>ç½‘ç«™å›è°ƒåŸŸé…ç½®,åå°æ˜¯è¿è¡Œåœ¨https://localhost:5001ç«¯å£ä¸Šã€‚</p>
<div><pre><code>https://api.igeekfan.cn/signin-qq;https://localhost:5001/signin-qq
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="æ¥å£ä»‹ç»" tabindex="-1"> æ¥å£ä»‹ç»</h2>
<p>server-sideæ¨¡å¼ï¼Œæ˜¯OAuth2.0è®¤è¯çš„ä¸€ç§æ¨¡å¼ï¼Œåˆç§°Web Server Flowï¼›</p>
<p><img src="http://qzonestyle.gtimg.cn/qzone/vas/opensns/res/img/OAuth_guide_V2_1.png" alt="image" loading="lazy"></p>
<p>è·å–Authorization Code
https://graph.qq.com/oauth2.0/authorize</p>
<p>é€šè¿‡Authorization Codeè·å–Access Token
https://graph.qq.com/oauth2.0/token</p>
<p>è·å–ç”¨æˆ·OpenID_OAuth2.0
https://graph.qq.com/oauth2.0/me</p>
<p>è·å–ç”¨æˆ·ä¸ªäººä¿¡æ¯
https://graph.qq.com/user/get_user_info</p>
<h2 id="ä½¿ç”¨authorization-codeè·å–access-token" tabindex="-1"> <a href="https://wiki.connect.qq.com/%E4%BD%BF%E7%94%A8authorization_code%E8%8E%B7%E5%8F%96access_token" target="_blank" rel="noopener noreferrer">ä½¿ç”¨Authorization_Codeè·å–Access_Token</a></h2>
<p>æ¥å…¥æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å…ˆè·å–Authorization Codeï¼›</li>
<li>é€šè¿‡Authorization Codeè·å–Access Token</li>
</ol>
<p>1.Step1ï¼šè·å–Authorization Code</p>
<p>GET</p>
<p>https://graph.qq.com/oauth2.0/authorize?response_type=code&amp;client_id=client_id&amp;redirect_uri=https://localhost:5001/signin-qq&amp;state=123abc</p>
<p>å…·ä½“å‚æ•°å¯æŸ¥çœ‹å®˜ç½‘ã€‚</p>
<p>stateç”±ç”¨æˆ·è‡ªå·±åˆ›å»ºä¸€ä¸ªéšæœºæ•°ï¼Œä»¥é˜²æ­¢CSRFæ”»å‡»ã€‚</p>
<p>å¦‚æœç”¨æˆ·æˆåŠŸç™»å½•å¹¶æˆæƒï¼Œåˆ™ä¼šè·³è½¬åˆ°æŒ‡å®šçš„å›è°ƒåœ°å€ï¼Œå¹¶åœ¨redirect_uriåœ°å€åå¸¦ä¸ŠAuthorization Codeå’ŒåŸå§‹çš„stateå€¼ã€‚å¦‚ï¼š</p>
<p>https://localhost:5001/signin-qq?code=B6D497755EACE4635115FC82BE24F280&amp;state=123abc</p>
<p>åå°å…ˆæ ¹æ®stateéªŒè¯æ˜¯è‡ªå·±å‘å‡ºçš„è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦ç›¸åŒï¼Œä¸ç›¸åŒï¼Œåˆ™ä»£è¡¨éæœ¬é¡¹ç›®å‘å‡ºçš„æˆæƒç™»å½•è¯·æ±‚ã€‚</p>
<ol start="2">
<li>æ ¹æ®codeè·å–access_token</li>
</ol>
<p>GET</p>
<p>https://graph.qq.com/oauth2.0/token?grant_type=authorization_code&amp;client_id=client_id&amp;client_secret=client_secret&amp;code=B6D497755EACE4635115FC82BE24F280&amp;redirect_uri=https://localhost:5001/signin-qq</p>
<p>è¿™æ—¶å€™ä½ ä¼šå¾—åˆ°</p>
<div><pre><code>access_token=1B6E45FA99BA3D6B347713440C9BCEFE&amp;expires_in=7776000&amp;refresh_token=8DB1D48D95C85D3EF593936B8ACE5EE0
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="è·å–ç”¨æˆ·openid-oauth2-0" tabindex="-1"> è·å–ç”¨æˆ·OpenID_OAuth2.0</h2>
<p>GET</p>
<p>https://graph.qq.com/oauth2.0/me?access_token=1B6E45FA99BA3D6B347713440C9BCEFE</p>
<p>openidæ˜¯æ­¤ç½‘ç«™ä¸Šå”¯ä¸€å¯¹åº”ç”¨æˆ·èº«ä»½çš„æ ‡è¯†</p>
<div><pre><code>callback( {"client_id":"101867513","openid":"951560F5C7A5AA9E5E599CF9B4ECFFB2"} );
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="è·å–ç”¨æˆ·çš„å…¶ä»–ä¿¡æ¯" tabindex="-1"> è·å–ç”¨æˆ·çš„å…¶ä»–ä¿¡æ¯</h2>
<p>ç”¨æˆ·ä¿¡æ¯</p>
<p>https://graph.qq.com/user/get_user_info?access_token=1B6E45FA99BA3D6B347713440C9BCEFE&amp;oauth_consumer_key=YOUR_APP_ID&amp;openid=951560F5C7A5AA9E5E599CF9B4ECFFB2</p>
<div><pre><code><span>{</span>
<span>"ret"</span><span>:</span> <span>0</span><span>,</span> 
<span>"msg"</span><span>:</span> <span>""</span><span>,</span> 
<span>"is_lost"</span><span>:</span><span>0</span><span>,</span> 
<span>"nickname"</span><span>:</span> <span>"ã€å¤©ä¸Šæœ‰æœ¨æœˆOvO"</span><span>,</span> 
<span>"gender"</span><span>:</span> <span>"xxx"</span><span>,</span> 
<span>"gender_type"</span><span>:</span> <span>1</span><span>,</span> 
<span>"province"</span><span>:</span> <span>"xxx"</span><span>,</span> 
<span>"city"</span><span>:</span> <span>"xxx"</span><span>,</span> 
<span>"year"</span><span>:</span> <span>"2019"</span><span>,</span> 
<span>"constellation"</span><span>:</span> <span>""</span><span>,</span> 
<span>"figureurl"</span><span>:</span> <span>"http:\/\/qzapp.qlogo.cn\/qzapp\/101867513\/951560F5C7A5AA9E5E599CF9B4ECFFB2\/30"</span><span>,</span> 
<span>"figureurl_1"</span><span>:</span> <span>"http:\/\/qzapp.qlogo.cn\/qzapp\/101867513\/951560F5C7A5AA9E5E599CF9B4ECFFB2\/50"</span><span>,</span> 
<span>"figureurl_2"</span><span>:</span> <span>"http:\/\/qzapp.qlogo.cn\/qzapp\/101867513\/951560F5C7A5AA9E5E599CF9B4ECFFB2\/100"</span><span>,</span> 
<span>"figureurl_qq_1"</span><span>:</span> <span>"http://thirdqq.qlogo.cn/g?b=oidb&amp;k=bjXoWmdlu8fk1m80MCkibMg&amp;s=40&amp;t=1559108425"</span><span>,</span> 
<span>"figureurl_qq_2"</span><span>:</span> <span>"http://thirdqq.qlogo.cn/g?b=oidb&amp;k=bjXoWmdlu8fk1m80MCkibMg&amp;s=100&amp;t=1559108425"</span><span>,</span> <span>"figureurl_qq"</span><span>:</span> <span>"http://thirdqq.qlogo.cn/g?b=oidb&amp;k=bjXoWmdlu8fk1m80MCkibMg&amp;s=640&amp;t=1559108425"</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><h2 id="ä»£ç " tabindex="-1"> ä»£ç </h2>
<div><pre><code>services.AddAuthentication(xxx)
.AddGitHub(xxx)
åŠ ä¸ŠAddQQçš„é…ç½®é¡¹
.AddQQ(options =>
{
   options.ClientId = Configuration["Authentication:QQ:ClientId"];
   options.ClientSecret = Configuration["Authentication:QQ:ClientSecret"];
})
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>appsettings.jsonä¸­é…ç½®é¡¹</p>
<div><pre><code>  "Authentication": {
   //ä¸‹é¢ä¸ºæ–°å¢é¡¹
   "QQ": {
     "ClientId": "xx",
     "ClientSecret": "xxx"
   }
 }
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>å¯¹ï¼Œæ²¡é”™ï¼ŒQQç™»å½•ï¼Œå·²ç»ç»“æŸäº†ã€‚æ¥ä¸‹æ¥å°±æ˜¯æŠŠè¿™äº›ç”¨æˆ·çš„ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ï¼Œç”Ÿæˆtokençš„è¿‡ç¨‹ã€‚</p>
<p>è¿™é‡Œ</p>
<div><pre><code>[HttpGet("signin-callback")]
public async Task&lt;IActionResult> Home(string provider, string redirectUrl = "")
{

   AuthenticateResult authenticateResult = await _contextAccessor.HttpContext.AuthenticateAsync(provider);
   if (!authenticateResult.Succeeded) return Redirect(redirectUrl);
   var openIdClaim = authenticateResult.Principal.FindFirst(ClaimTypes.NameIdentifier);
   if (openIdClaim == null || string.IsNullOrWhiteSpace(openIdClaim.Value))
       return Redirect(redirectUrl);
       
       
   ClaimsPrincipal principal=authenticateResult.Principal;
   //æ ¹æ®providerï¼Œå¤„ç†ç”¨æˆ·çš„åŸºç¡€ä¿¡æ¯ï¼Œ
   
   long id =SaveQQAsync(principal, openIdClaim.Value)
   
   //xxx
   
}       
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></div></div><p>openIdClaimopenIdClaimæ˜¯å”¯ä¸€å€¼</p>
<h3 id="lin-userè¡¨" tabindex="-1"> lin_userè¡¨</h3>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>Id</td>
<td>long</td>
<td>ä¸»é”®</td>
</tr>
<tr>
<td>Username</td>
<td>varchar(50)</td>
<td>ç”¨æˆ·å</td>
</tr>
<tr>
<td>Avatar</td>
<td>varchar(50)</td>
<td>å¤´åƒ</td>
</tr>
</tbody>
</table>
<h3 id="lin-user-identityè¡¨" tabindex="-1"> lin_user_identityè¡¨</h3>
<p>ç”¨æˆ·æˆæƒä¿¡æ¯è¡¨ï¼Œç”¨äºå­˜å‚¨ä¸åŒç™»å½•ç±»å‹çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æ‰‹æœºå·ã€é‚®ä»¶ã€ç”¨æˆ·åã€ç¬¬ä¸‰æ–¹åº”ç”¨ï¼ˆå¾®ä¿¡ã€QQã€GitHubï¼‰çš„ç™»å½•</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>Id</td>
<td>long</td>
<td>ä¸»é”®</td>
</tr>
<tr>
<td>IdentityType</td>
<td>varchar(50)</td>
<td>è®¤è¯ç±»å‹ï¼Œå¦‚ Passwordï¼ŒGitHubã€QQã€WeiXinç­‰</td>
</tr>
<tr>
<td>Identifier</td>
<td>varchar(24)</td>
<td>è®¤è¯è€…ï¼Œä¾‹å¦‚ ç”¨æˆ·åï¼ˆPassWordè®¤è¯ç±»å‹ï¼‰,æˆæƒå¾—åˆ°çš„æ˜µç§°(QQ),æˆæƒå¾—åˆ°çš„ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼ŒGitHub)</td>
</tr>
<tr>
<td>Credential</td>
<td>varchar(50)</td>
<td>å‡­è¯ï¼Œä¾‹å¦‚ å¯†ç ,å­˜OpenIdã€Idï¼ŒåŒä¸€IdentityTypeçš„OpenIdçš„å€¼æ˜¯å”¯ä¸€çš„</td>
</tr>
<tr>
<td>CreateUserId</td>
<td>long</td>
<td>ç»‘å®šçš„ç”¨æˆ·Id</td>
</tr>
</tbody>
</table>
<p>æ ¹æ®openId,åˆ¤æ–­lin_user_identityè¡¨ä¸­æ˜¯å¦å­˜åœ¨è¿™ä¸€ç¬¬ä¸‰æ–¹æˆæƒä¿¡æ¯ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›å½“å‰ç”¨æˆ·lin_userè¡¨ä¸­çš„idï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ’å…¥lin_userã€lin_user_identityè¡¨ä¸­ã€‚</p>
<div><pre><code>
public async Task&lt;long> SaveQQAsync(ClaimsPrincipal principal, string openId)
{
   string nickname = principal.FindFirst(ClaimTypes.Name)?.Value;
   string gender = principal.FindFirst(ClaimTypes.Gender)?.Value;
   string picture = principal.FindFirst(QQAuthenticationConstants.Claims.PictureUrl)?.Value;
   string picture_medium = principal.FindFirst(QQAuthenticationConstants.Claims.PictureMediumUrl)?.Value;
   string picture_full = principal.FindFirst(QQAuthenticationConstants.Claims.PictureFullUrl)?.Value;
   string avatar = principal.FindFirst(QQAuthenticationConstants.Claims.AvatarUrl)?.Value;
   string avatar_full = principal.FindFirst(QQAuthenticationConstants.Claims.AvatarFullUrl)?.Value;
   
    Expression&lt;Func&lt;LinUserIdentity, bool>> expression = r => 
               r.IdentityType == LinUserIdentity.QQ&amp;&amp; r.Credential == openId;

   LinUserIdentity linUserIdentity =await _userIdentityRepository.Where(expression).FirstAsync();

   long userId = 0;
   if (linUserIdentity == null)
   {
       LinUser user = new LinUser
       {
           Avatar = avatar_full,
           Nickname = nickname,
           Username = "",
           LinUserIdentitys = new List&lt;LinUserIdentity>()
           {
               new LinUserIdentity
               {
                   CreateTime = DateTime.Now,
                   Credential = openId,
                   IdentityType = LinUserIdentity.GitHub,
                   Identifier = nickname,
               }
           }
       };
       await _userRepository.InsertAsync(user);
       userId = user.Id;
   }
   else
   {
       userId = linUserIdentity.CreateUserId;
   }
   return userId;
}

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br></div></div><p>ä¸Šæ–‡ä¸­çš„CreateTokenï¼Œç›´æ¥å°† authenticateResult.Principal.Claims.ToList()ï¼Œç”Ÿæˆtokenå€¼ï¼Œä¼šç¼ºå°‘ä¸€äº›ç³»ç»Ÿéœ€è¦çš„å€¼ï¼Œæ¯”å¦‚é”®ä¸ºClaimTypes.NameIdentifierï¼Œåº”ä¸ºç”¨æˆ·çš„idï¼Œç”¨æˆ·çš„å…¶ä»–ä¿¡æ¯ï¼Œå¦‚è§’è‰²/åˆ†ç»„ï¼Œæ˜µç§°ã€‚ä¸åŒå¹³å°çš„æˆæƒç™»å½•ï¼Œé”®æœ‰æ‰€ä¸åŒï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦äºŒæ¬¡å¤„ç†ã€‚</p>
<div><pre><code>[HttpGet("signin-callback")]
public async Task&lt;IActionResult> Home(string provider, string redirectUrl = "")
{
 
    //xxx
        
        
    ClaimsPrincipal principal=authenticateResult.Principal;
    
    List&lt;Claim> authClaims = principal.Claims.ToList();
    
    long id =SaveQQAsync(principal, openIdClaim.Value)
    
    LinUser user =await _userRepository.Select.IncludeMany(r => r.LinGroups)
        .WhereCascade(r => r.IsDeleted == false).Where(r => r.Id == id).FirstAsync();

    List&lt;Claim> claims = new List&lt;Claim>()
    {
        new Claim(ClaimTypes.NameIdentifier,user.Id.ToString()),
        new Claim(ClaimTypes.GivenName,user.Nickname??""),
        new Claim(ClaimTypes.Name,user.Username??""),
    };
        
    user.LinGroups?.ForEach(r =>
    {
        claims.Add(new Claim(LinCmsClaimTypes.Groups, r.Id.ToString()));
    });

    claims.AddRange(authClaims);
    string token = this.CreateToken(claims);
    return Redirect($"{redirectUrl}?token={token}#login-result");
 }       
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br></div></div><p>å‰å°login-resultè·¯ç”±ï¼Œè§£æåˆ°tokenå€¼ï¼Œå¹¶ä¿å­˜èµ·æ¥ï¼Œä¸ç”¨æˆ·å¯†ç ç™»å½•åçš„æµç¨‹ç›¸åŒã€‚</p>
<h2 id="é¡¹ç›®æºç " tabindex="-1"> <a href="https://github.com/luoyunchong/lin-cms-dotnetcore/blob/master/src/LinCms.Web/Controllers/Cms/Oauth2Controller.cs" target="_blank" rel="noopener noreferrer">é¡¹ç›®æºç </a></h2>
]]></content>
    <published>2020-05-13T11:18:08.000Z</published>
  </entry>
  <entry>
    <title type="html">åŸºäº RBAC å®ç°æƒé™è®¾è®¡</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/table.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/table.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="åŸºäº-rbac-å®ç°æƒé™è®¾è®¡" tabindex="-1"> åŸºäº RBAC å®ç°æƒé™è®¾è®¡</h1>
<p>åŠŸèƒ½ï¼šå®ç°ä¸€ä¸ªç”¨æˆ·è®¾ç½®å¤šä¸ªåˆ†ç»„ï¼Œåˆ†ç»„å¯ä»¥è®¾ç½®å¤šä¸ªæƒé™ï¼Œæƒé™ä¸åå° API æ–¹æ³•å¯¹åº”ï¼Œå‰ç«¯èœå•ç»‘å®šæƒé™ç¼–ç ï¼Œå‰ç«¯æŒ‰é’®ç»‘å®šæƒé™ç¼–ç ï¼Œä»è€Œå®ç°ç”¨æˆ·å¯é…ç½®æƒé™ï¼Œä»è€Œæ§åˆ¶ç•Œé¢ä¸Šçš„å…ƒç´ ç­‰ã€‚</p>
<h3 id="_1-ç”¨æˆ·è¡¨-lin-user" tabindex="-1"> 1. ç”¨æˆ·è¡¨ lin_user</h3>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>å¤‡æ³¨</th>
<th>ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>ä¸»é”® Id</td>
<td>bigint</td>
</tr>
<tr>
<td>username</td>
<td>ç”¨æˆ·å</td>
<td>varchar</td>
</tr>
<tr>
<td>nickname</td>
<td>æ˜µç§°</td>
<td>varchar</td>
</tr>
<tr>
<td>phone_number</td>
<td>æ‰‹æœºå·</td>
<td>varchar</td>
</tr>
<tr>
<td>avatar</td>
<td>ç”¨æˆ·é»˜è®¤ç”Ÿæˆå›¾åƒï¼Œä¸º nullã€å¤´åƒ url</td>
<td>varchar</td>
</tr>
<tr>
<td>email</td>
<td>ç”µå­é‚®ç®±</td>
<td>varchar</td>
</tr>
<tr>
<td>active</td>
<td>1 æ¿€æ´» 2 éæ¿€æ´»</td>
<td>int</td>
</tr>
</tbody>
</table>

<h3 id="_2-åˆ†ç»„è¡¨-lin-group" tabindex="-1"> 2. åˆ†ç»„è¡¨ lin_group</h3>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>å¤‡æ³¨</th>
<th>ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>ä¸»é”® Id</td>
<td>bigint</td>
</tr>
<tr>
<td>name</td>
<td>æƒé™ç»„åç§°</td>
<td>varchar</td>
</tr>
<tr>
<td>info</td>
<td>æƒé™ç»„æè¿°</td>
<td>varchar</td>
</tr>
<tr>
<td>is_static</td>
<td>æ˜¯å¦æ˜¯é™æ€åˆ†ç»„</td>
<td>bit</td>
</tr>
</tbody>
</table>
<h3 id="_3-ç”¨æˆ·åˆ†ç»„è¡¨-lin-user-group" tabindex="-1"> 3. ç”¨æˆ·åˆ†ç»„è¡¨ lin_user_group</h3>
<p>ç”¨æˆ·åˆ†ç»„è¡¨ã€‚ç”¨äºç”¨æˆ·å’Œåˆ†ç»„è¡¨çš„å…³è”ã€‚å¯é…ç½®ä¸€ä¸ªç”¨æˆ·å±äºå¤šä¸ªåˆ†ç»„ã€‚</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>å¤‡æ³¨</th>
<th>ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>ä¸»é”® Id</td>
<td>bigint</td>
</tr>
<tr>
<td>user_id</td>
<td>ç”¨æˆ· ID</td>
<td>bigint</td>
</tr>
<tr>
<td>group_id</td>
<td>åˆ†ç»„ ID</td>
<td>bigint</td>
</tr>
</tbody>
</table>
<h3 id="_4-æƒé™è¡¨-lin-permission" tabindex="-1"> 4. æƒé™è¡¨ lin_permission</h3>
<p>æƒé™è¡¨ï¼Œæœ¬ç³»ç»Ÿé€šè¿‡åå°„åœ¨ç³»ç»Ÿåˆæ¬¡å¯åŠ¨æ—¶ï¼Œå¯åŠ¨å¼‚æ­¥ä»»åŠ¡ï¼Œå°†ä¸å­˜åœ¨çš„æƒé™æ–°å¢åˆ°æ­¤è¡¨ä¸­ã€‚</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>å¤‡æ³¨</th>
<th>ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>ä¸»é”® Id</td>
<td>bigint</td>
</tr>
<tr>
<td>module</td>
<td>æƒé™æ‰€å±æ¨¡å—ï¼Œä¾‹å¦‚ï¼šäººå‘˜ç®¡ç†</td>
<td>varchar</td>
</tr>
<tr>
<td>name</td>
<td>æ‰€å±æƒé™ã€æƒé™åç§°ï¼Œä¾‹å¦‚ï¼šè®¿é—®é¦–é¡µ</td>
<td>varchar</td>
</tr>
</tbody>
</table>
<h3 id="_5-åˆ†ç»„æƒé™è¡¨-lin-group-permission" tabindex="-1"> 5. åˆ†ç»„æƒé™è¡¨ lin_group_permission</h3>
<p>åˆ†ç»„æƒé™è¡¨ï¼Œç”¨äºåˆ†ç»„ä¸æƒé™è¡¨çš„å…³è”</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>å¤‡æ³¨</th>
<th>ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>ä¸»é”® Id</td>
<td>bigint</td>
</tr>
<tr>
<td>group_id</td>
<td>åˆ†ç»„ Id</td>
<td>bigint</td>
</tr>
<tr>
<td>permission_id</td>
<td>æƒé™ Id</td>
<td>bigint</td>
</tr>
</tbody>
</table>
<h3 id="_6-ç”¨æˆ·èº«ä»½è®¤è¯ç™»å½•è¡¨-lin-user-identity" tabindex="-1"> 6. ç”¨æˆ·èº«ä»½è®¤è¯ç™»å½•è¡¨ lin_user_identity</h3>
<p>ç”¨æˆ·æˆæƒä¿¡æ¯è¡¨ï¼Œç”¨äºå­˜å‚¨ä¸åŒç™»å½•ç±»å‹çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æ‰‹æœºå·ã€é‚®ä»¶ã€ç”¨æˆ·åã€ç¬¬ä¸‰æ–¹åº”ç”¨ï¼ˆå¾®ä¿¡ã€QQã€GitHubï¼‰çš„ç™»å½•</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>å¤‡æ³¨</th>
<th>ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>char</td>
<td>ä¸»é”® Id</td>
</tr>
<tr>
<td>identity_type</td>
<td>varchar</td>
<td>è®¤è¯ç±»å‹ Passwordï¼ŒGitHubã€QQã€WeiXin ç­‰</td>
</tr>
<tr>
<td>identifier</td>
<td>varchar</td>
<td>è®¤è¯è€…ï¼Œä¾‹å¦‚ ç”¨æˆ·å,æ‰‹æœºå·ï¼Œé‚®ä»¶ç­‰ï¼Œ</td>
</tr>
<tr>
<td>credential</td>
<td>varchar</td>
<td>å‡­è¯ï¼Œä¾‹å¦‚ å¯†ç ,å­˜ OpenIdã€Idï¼ŒåŒä¸€ IdentityType çš„ OpenId çš„å€¼æ˜¯å”¯ä¸€çš„</td>
</tr>
<tr>
<td>create_user_id</td>
<td>bigint</td>
<td>ç»‘å®šçš„ç”¨æˆ· Id</td>
</tr>
<tr>
<td>create_time</td>
<td>datetime</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="å­—å…¸ç®¡ç†" tabindex="-1"> å­—å…¸ç®¡ç†</h2>
<p>ä¸»è¦åŠŸèƒ½ï¼šä»…é™äºé€šç”¨çš„ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©ï¼Œæœ‰å˜åŒ–çš„å¯èƒ½æ€§ã€‚æŠ½è±¡æˆç»Ÿä¸€çš„é…ç½®é¡¹ã€‚</p>
<p>æ¯”å¦‚ï¼šæ–‡ç« æ˜¯ï¼ˆåŸåˆ›ï¼Œè½¬è½½ï¼Œç¿»è¯‘),æ€§åˆ«æ˜¯ï¼ˆç”·ï¼Œå¥³ï¼‰ã€‚å½“ç„¶æ›´å¤šï¼Œåœ¨ä¸‹æ–‡ä¼šæœ‰ä»‹ç»ã€‚</p>
<h3 id="_1-base-type-å­—å…¸ç±»åˆ«ç®¡ç†" tabindex="-1"> 1.base_type ï¼ˆå­—å…¸ç±»åˆ«ç®¡ç†ï¼‰</h3>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td></td>
</tr>
<tr>
<td>type_code</td>
<td>varchar(50)</td>
<td>ç±»åˆ«ç¼–ç </td>
</tr>
<tr>
<td>full_name</td>
<td>varchar(50)</td>
<td>å…¨ç§°</td>
</tr>
<tr>
<td>sort_code</td>
<td>int</td>
<td>æ’åºç </td>
</tr>
</tbody>
</table>
<h3 id="_2-base-item-å­—å…¸ç®¡ç†" tabindex="-1"> 2.base_item ï¼ˆå­—å…¸ç®¡ç†ï¼‰</h3>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td></td>
</tr>
<tr>
<td>base_type_id</td>
<td>int</td>
<td>ç±»åˆ« id(å…³è” base_type çš„ id)</td>
</tr>
<tr>
<td>item_code</td>
<td>varchar(50)</td>
<td>å­—å…¸ç¼–ç </td>
</tr>
<tr>
<td>item_name</td>
<td>varchar(50)</td>
<td>å­—å…¸å…¨ç§°</td>
</tr>
<tr>
<td>sort_code</td>
<td>int</td>
<td>æ’åºç </td>
</tr>
</tbody>
</table>
<p>BaseType 1 å¯¹ BaseItem å¤šã€‚</p>
<p>å¦‚ï¼šæ ‡ç­¾ç®¡ç†ï¼Œä¸€ä¸ªæ–‡ç« ä¸‹å¯ä»¥è®¾ç½®å¤šä¸ªæ ‡ç­¾ï¼ŒåŸæœ¬éœ€è¦è®¾è®¡è¡¨ Tag,å­—æ®µä¹Ÿå¤§æŠµä¸º Id,Name,Sort åŠå…³è”è¡¨ã€‚
æˆ‘ä»¬ä½¿ç”¨ BaseTypeã€BaseItem å®ç°ã€‚
BaseType ä¸­ TypeCode ä¸º tag,FullName ä¸ºæ ‡ç­¾ï¼Œid ä¸º 1 æ—¶ã€‚
BaseItem ä¸­ BaseTypeId ä¸º 1ï¼ŒItemCode ä¸ºç¼–ç ,ItemName ä¸ºæ ‡ç­¾ã€‚ItemCode ä¸ºä¸é‡å¤çš„å­—ç¬¦ä¸²å³å¯ã€‚</p>
<p>å¦ Tag ä¸ Article çš„å…³è”è¡¨ï¼Œéœ€è¦å¦è®¾è®¡ä¸€ä¸ªè¡¨ã€‚</p>
<p>å½“æˆ‘ä»¬è¦å®ç°æ–‡ç« ç±»åˆ«çš„ä¸‹æ‹‰ï¼ŒåŸæœ¬éœ€è¦è®¾è®¡ä¸€ä¸ªè¡¨ ArticleTypeï¼Œæœ‰å­—æ®µ,id,name,sort ç­‰ã€‚
æˆ‘ä»¬å¯ä»¥é€šè¿‡ BaseTypeã€BaseItem æ¥å®ç°ï¼Œä»è€Œç®€åŒ–è¿™äº›åŸºç¡€æ•°æ®ã€‚
BaseType æœ‰ä¸€æ¡æ•°æ®ï¼ŒTypeCode ä¸º å­—ç¬¦ä¸² categoryã€FullName æ–‡ç« ç±»åˆ«ï¼ŒBaseItem å­˜å¤šä¸ªæ–‡ç« ç±»åˆ«(Javaã€å¤§æ•°æ®ã€Pythonã€C#ç­‰)ï¼Œç¼–ç ä¸åŒå³å¯ã€‚</p>
<p><strong>ä½†ç°å®æ€»æ˜¯äº‹ä¸æ„¿è¿</strong>,åå°å–æ–‡ç« åˆ—è¡¨æ—¶ï¼Œæƒ³è¦å–å‡ºæ–‡ç« å¯¹åº”çš„åˆ†ç±»ï¼Œæ‰‹åŠ¨ join æ—¶ï¼Œæ€»è§‰å¾— join çš„è¡¨ä¼šæœ‰äº›å¥‡æ€ªã€‚</p>
<p>å½“ç„¶è¿˜æœ‰å…¶ä»–åŸå› ï¼Œ<strong>å±€é™æ€§</strong>ï¼š</p>
<ol>
<li>æ¯”å¦‚ä½¿ç”¨äº†è¿™ä¸ªå­—å…¸ï¼Œåˆ†ç±»éœ€è¦å¢åŠ ä¸€ä¸ªå›¾ç‰‡å­—æ®µï¼Œå°±ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Œåšä¸äº†ã€‚</li>
<li>æ¯”å¦‚æ ‡ç­¾éœ€è¦å®ç°è¿™ä¸ªæ ‡ç­¾ä¸‹æœ‰å¤šå°‘ä¸ªæ–‡ç« ï¼Œé€šè¿‡ç»Ÿè®¡ä¹Ÿèƒ½å®ç°ï¼Œ</li>
</ol>
<p>ä½¿ç”¨ FreeSql å®ç°æ—¶ï¼Œå¦‚æœäºŒä¸ªè¡¨ä¹‹é—´æ²¡æœ‰å¯¼èˆªå±æ€§ï¼Œæ˜¯æ›´å¤æ‚çš„ã€‚</p>
<h2 id="" tabindex="-1"> </h2>
<h3 id="lin-file-æ–‡ä»¶å­˜å‚¨" tabindex="-1"> lin_file æ–‡ä»¶å­˜å‚¨</h3>
<p>| å­—æ®µ           | ç±»å‹     | å¤‡æ³¨                                     |
| -------------- | -------- | ---------------------------------------- | ------- |
| id             |          | bigint                                   | ä¸»é”® Id |
| extension      | varchar  | åç¼€                                     |
| md5            | varchar  | å›¾ç‰‡ md5 å€¼ï¼Œé˜²æ­¢ä¸Šä¼ é‡å¤å›¾ç‰‡            |
| name           | varchar  | åç§°                                     |
| path           | varchar  | è·¯å¾„                                     |
| size           | bigint   | å¤§å°                                     |
| type           | smallint | 1 localï¼Œ2 ä»£è¡¨ä¸ƒç‰›äº‘ 3 å…¶ä»–è¡¨ç¤ºå…¶ä»–åœ°æ–¹ |
| create_user_id | bigint   | åˆ›å»ºè€… ID                                |</p>
<h3 id="lin-log-æ—¥å¿—è®°å½•" tabindex="-1"> lin_log æ—¥å¿—è®°å½•</h3>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>bigint</td>
<td>ä¸»é”® Id</td>
</tr>
<tr>
<td>authority</td>
<td>varchar</td>
<td>è®¿é—®å“ªä¸ªæƒé™</td>
</tr>
<tr>
<td>message</td>
<td>varchar</td>
<td>æ—¥å¿—ä¿¡æ¯</td>
</tr>
<tr>
<td>method</td>
<td>varchar</td>
<td>è¯·æ±‚æ–¹æ³•</td>
</tr>
<tr>
<td>path</td>
<td>varchar</td>
<td>è¯·æ±‚è·¯å¾„</td>
</tr>
<tr>
<td>status_code</td>
<td>int</td>
<td>è¯·æ±‚çš„ http è¿”å›ç </td>
</tr>
<tr>
<td>time</td>
<td>datetime</td>
<td>æ—¥å¿—åˆ›å»ºæ—¶é—´</td>
</tr>
<tr>
<td>user_id</td>
<td>bigint</td>
<td>ç”¨æˆ· id</td>
</tr>
<tr>
<td>user_name</td>
<td>varchar</td>
<td>ç”¨æˆ·å½“æ—¶çš„æ˜µç§°</td>
</tr>
<tr>
<td>other_message</td>
<td>longtext</td>
<td></td>
</tr>
</tbody>
</table>
]]></content>
    <published>2020-05-13T11:18:08.000Z</published>
  </entry>
  <entry>
    <title type="html">FreeSql+ASP.NET Core</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/freesql-in-aspnetcore-webapi-how-to-use.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/freesql-in-aspnetcore-webapi-how-to-use.html"/>
    <updated>2020-05-08T15:01:00.000Z</updated>
    <content type="html"><![CDATA[<h1 id="freesql-asp-net-core" tabindex="-1"> FreeSql+ASP.NET Core</h1>
<h2 id="æ–‡ç« æ¦‚è¿°" tabindex="-1"> æ–‡ç« æ¦‚è¿°</h2>
<p>ä¸»è¦åœ¨ä»‹ç»FreeSqlåœ¨ASP.NTE Core WebApiä¸­å¦‚ä½•ä½¿ç”¨çš„è¿‡ç¨‹ï¼Œå®Œæˆä¸€ä¸ªæœ€ç®€å•çš„åšå®¢ç³»ç»Ÿçš„åç«¯æ¥å£ã€‚</p>
<h2 id="freesql-ç®€ä»‹" tabindex="-1"> FreeSql ç®€ä»‹</h2>
<p>å›½äººå†™çš„ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ORM,FreeSql æ”¯æŒ MySql/SqlServer/PostgreSQL/Oracle/Sqliteï¼Œç‰¹ç‚¹ï¼šè½»é‡çº§ã€å¯æ‰©å±•ã€åŸºäº .NET Standard è·¨å¹³å°ã€‚</p>
<h2 id="æºç " tabindex="-1"> æºç </h2>
<p>ä»£ç æ‰˜ç®¡åœ¨GitHubä¸Š <a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-freesql" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-freesql</a></p>
<h2 id="å‚è€ƒ" tabindex="-1"> å‚è€ƒ</h2>
<ul>
<li>FreeSql github <a href="https://github.com/2881099/FreeSql" target="_blank" rel="noopener noreferrer">https://github.com/2881099/FreeSql</a></li>
<li><a href="https://docs.microsoft.com/zh-cn/dotnet/core/tools/dotnet-new?tabs=netcore22" target="_blank" rel="noopener noreferrer">å…³äº.net core cliä¸­å¦‚ä½•ä½¿ç”¨dotnet new</a></li>
<li><a href="https://docs.microsoft.com/zh-cn/aspnet/core/web-api/?view=aspnetcore-2.2" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ ASP.NET Core åˆ›å»º Web API</a></li>
<li><a href="https://docs.microsoft.com/zh-cn/aspnet/core/tutorials/web-api-help-pages-using-swagger?view=aspnetcore-2.2" target="_blank" rel="noopener noreferrer">Swagger/OpenAPI ç”Ÿæˆæ¥å£æ–‡æ¡£</a></li>
<li><a href="https://github.com/domaindrivendev/Swashbuckle.AspNetCore" target="_blank" rel="noopener noreferrer">Swagger GitHub (Swashbuckle.AspNetCore)</a></li>
</ul>
<h2 id="é¡¹ç›®å‡†å¤‡" tabindex="-1"> é¡¹ç›®å‡†å¤‡</h2>
<ul>
<li>Mysql 5.6</li>
<li>Visual Studio 2019æˆ–2017ã€Visual Studio code</li>
<li>.NET Core 3.1+</li>
<li>PowerShell</li>
<li>æ‡‚ç‚¹mvcï¼Œè¯¥æ•™ç¨‹ä¸ä¼šæ•™ä½ å¦‚ä½•ä½¿ç”¨ ASP .NET Core MVCã€RESTful</li>
</ul>
<h3 id="åˆ›å»ºé¡¹ç›®" tabindex="-1"> åˆ›å»ºé¡¹ç›®</h3>
<p>ä½¿ç”¨dotnet å‘½ä»¤è¡Œåˆ›å»ºä¸€ä¸ªwebapié¡¹ç›®ï¼Œèµ·åä¸ºOvOv.FreeSql</p>
<div><pre><code>PS dotnetcore-examples\aspnetcore-freesql> dotnet new webapi -n OvOv.FreeSql
The template "ASP.NET Core Web API" was created successfully.
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>ç„¶åcd åˆ°OvOv.FreeSqlç›®å½•ï¼Œé€šè¿‡dotnet run å‘½ä»¤è¿è¡Œé¡¹ç›®</p>
<div><pre><code>PS dotnetcore-examples\aspnetcore-freesql&gt; cd .\OvOv.FreeSql\
PS dotnetcore-examples\aspnetcore-freesql\OvOv.FreeSql&gt; dotnet run

info: Microsoft.Hosting.Lifetime[0]
      Now listening on: https://localhost:5001
info: Microsoft.Hosting.Lifetime[0]
      Now listening on: http://localhost:5000
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: D:\code\github\dotnetcore-examples\aspnetcore-freesql\OvOv.FreeSql
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><p>æ‰“å¼€æµè§ˆå™¨ https://localhost:5001 ä¼šå‡ºç°404</p>
<p>è¯·æ‰“å¼€è¿™ä¸ªåœ°å€ https://localhost:5001/api/values ï¼Œå¯çœ‹åˆ°å¦‚ä¸‹å†…å®¹ã€‚</p>
<div><pre><code>["value1","value2"]
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥é›†æˆFreeSqlï¼Œæˆ‘ä»¬ä»¥æœ€ç®€å•çš„å‘½ä»¤å’Œè¯´æ˜ï¼Œè¯¦ç»†å†…å®¹å»å®˜ç½‘çœ‹å…·ä½“å†…å®¹</p>
<ul>
<li>å®˜ç½‘æ–‡æ¡£ <a href="http://freesql.net/doc" target="_blank" rel="noopener noreferrer">http://freesql.net/doc</a></li>
</ul>
<h2 id="install" tabindex="-1"> Install</h2>
<p>è¦å…ˆcdåˆ°OvOv.FreeSqlç›®å½•ä¸­ã€‚</p>
<div><pre><code>PS \aspnetcore-freesql\OvOv.FreeSql&gt; dotnet add package FreeSql
PS \aspnetcore-freesql\OvOv.FreeSql&gt; dotnet add package FreeSql.Provider.MySql
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><h2 id="code-first" tabindex="-1"> code first</h2>
<ul>
<li><a href="https://github.com/2881099/FreeSql/blob/master/Docs/codefirst.md" target="_blank" rel="noopener noreferrer">å…³äºCodeFirstï¼Œå®˜æ–¹æ–‡æ¡£çš„ä»‹ç»</a></li>
</ul>
<p>ä»£ç ä¼˜å…ˆï¼Œä½¿ç”¨è¿‡EntityFrameworkçš„åº”è¯¥å¾ˆæ¸…æ¥šè¿™ä¸€æ¦‚å¿µï¼Œæˆ‘çš„ç†è§£å°±æ˜¯ï¼šåœ¨åˆ†ææ•°æ®åº“è¡¨å…³ç³»æ—¶ï¼Œä¸é€šè¿‡åœ¨æ•°æ®åº“ä¸­è®¾è®¡è¡¨ï¼Œè€Œæ˜¯ç›´æ¥åœ¨ä»£ç ä¸­å£°æ˜å¯¹åº”çš„ç±»ï¼Œä½¿ç”¨å¯¼èˆªå±æ€§ä»£æ›¿å¤–é”®å…³è”ï¼Œé€šè¿‡æ•°æ®è¡¨å­—æ®µä¸C#ä¸­çš„ç±»åº“å¯¹åº”ï¼Œä»è€Œè‡ªåŠ¨ç”Ÿæˆæ•°æ®è¡¨ã€‚</p>
<h2 id="db-first" tabindex="-1"> db first</h2>
<p>æ•°æ®åº“ä¼˜å…ˆï¼šéœ€æ±‚åˆ†æåï¼Œç›´æ¥è®¾è®¡æ•°æ®åº“ï¼Œé€šè¿‡æ•°æ®åº“ä¸­çš„è¡¨ï¼Œç›´æ¥ç”Ÿæˆä»£ç ï¼Œç±»ã€‚</p>
<h2 id="å¼€å§‹" tabindex="-1"> å¼€å§‹</h2>
<h3 id="åˆ†æéœ€æ±‚" tabindex="-1"> åˆ†æéœ€æ±‚</h3>
<p>æˆ‘ä»¬ä»¥code first ä¸ºç¤ºä¾‹ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨freesqlï¼Œå®ç°ä¸€ä¸ªç®€å•çš„åšå®¢ã€‚å°†è¡¨å†…å®¹åˆ†ä¸ºåšå®¢è¡¨ï¼ˆBlog)å’Œè¯„è®ºè¡¨ï¼ˆPost)</p>
<h4 id="blog-è¡¨" tabindex="-1"> Blog è¡¨</h4>
<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>BlogId</td>
<td>int</td>
<td>åšå®¢id</td>
</tr>
<tr>
<td>Title</td>
<td>varchar(50)</td>
<td>åšå®¢æ ‡é¢˜</td>
</tr>
<tr>
<td>Content</td>
<td>varchar(500)</td>
<td>åšå®¢å†…å®¹</td>
</tr>
<tr>
<td>CreateTime</td>
<td>DateTime</td>
<td>å‘å¸ƒæ—¶é—´</td>
</tr>
</tbody>
</table>
<h4 id="post-è¡¨" tabindex="-1"> Post è¡¨</h4>
<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>PostId</td>
<td>int</td>
<td>è¯„è®ºid</td>
</tr>
<tr>
<td>ReplyContent</td>
<td>varchar(50)</td>
<td>æ ‡é¢˜</td>
</tr>
<tr>
<td>BlogId</td>
<td>int</td>
<td>åšå®¢id</td>
</tr>
<tr>
<td>ReplyTime</td>
<td>DateTime</td>
<td>å›å¤æ—¶é—´</td>
</tr>
</tbody>
</table>
<p>å»ºä¸€ä¸ªDomainæ–‡ä»¶å¤¹,ç”¨äºå­˜æ”¾æ•°æ®åº“è¡¨ä¸­å¯¹åº”çš„å®ä½“ç±»ã€‚</p>
<h3 id="åŸºç¡€ä»‹ç»" tabindex="-1"> åŸºç¡€ä»‹ç»</h3>
<h4 id="_1-columnå±æ€§ä»‹ç»-å¤§å®¶å¯ä»¥çœ‹æºç -è§£æ" tabindex="-1"> 1. Columnå±æ€§ä»‹ç»ï¼Œå¤§å®¶å¯ä»¥çœ‹<a href="https://github.com/2881099/FreeSql/blob/f8c3608fdac2933b528605cc46b21b71c79eaacb/FreeSql/DataAnnotations/ColumnAttribute.cs" target="_blank" rel="noopener noreferrer">æºç ï¼Œè§£æ</a></h4>
<p>1). æ¯”å¦‚ï¼šBlogè¡¨ä¸­æŒ‡å®šäº†Titleä¸ºvarchar(50),æˆ‘ä»¬å¦‚ä½•é€šè¿‡ä»£ç æŒ‡å®šäº†ä¸»é”®ï¼Œå”¯ä¸€å€¼ï¼Œå­—å½¢ã€‚</p>
<div><pre><code>    <span>public</span> <span>class</span> <span>Blog</span>
    <span>{</span>
        <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>int</span></span> BlogId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>[</span><span><span>Column</span><span><span>(</span>DbType <span>=</span> <span>"varchar(50)"</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>2). Columnçš„å‘½åç©ºé—´åœ¨</p>
<div><pre><code><span>using</span> <span>FreeSql<span>.</span>DataAnnotations</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æ›´å¤šå±æ€§ä»‹ç»</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>æ•°æ®åº“åˆ—å</td>
</tr>
<tr>
<td>OldName</td>
<td>æŒ‡å®šæ•°æ®åº“æ—§çš„åˆ—åï¼Œä¿®æ”¹å®ä½“å±æ€§å‘½åæ—¶ï¼ŒåŒæ—¶è®¾ç½®æ­¤å‚æ•°ä¸ºä¿®æ”¹ä¹‹å‰çš„å€¼ï¼ŒCodeFirstæ‰å¯ä»¥æ­£ç¡®ä¿®æ”¹æ•°æ®åº“å­—æ®µï¼›å¦åˆ™å°†è§†ä¸ºã€æ–°å¢å­—æ®µã€‘</td>
</tr>
<tr>
<td>DbType</td>
<td>æ•°æ®åº“ç±»å‹ï¼Œå¦‚ï¼š varchar(255)</td>
</tr>
<tr>
<td>IsPrimary</td>
<td>ä¸»é”®</td>
</tr>
<tr>
<td>IsIdentity</td>
<td>è‡ªå¢æ ‡è¯†</td>
</tr>
<tr>
<td>IsNullable</td>
<td>æ˜¯å¦å¯DBNull</td>
</tr>
<tr>
<td>IsIgnore</td>
<td>å¿½ç•¥æ­¤åˆ—ï¼Œä¸è¿ç§»ã€ä¸æ’å…¥</td>
</tr>
<tr>
<td>IsVersion</td>
<td>è®¾ç½®è¡Œé”ï¼ˆä¹è§‚é”ï¼‰ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ›´æ–°ç´¯åŠ ç‰ˆæœ¬å·ï¼Œè‹¥æ›´æ–°æ•´ä¸ªå®ä½“æ—¶ä¼šé™„å¸¦å½“å‰çš„ç‰ˆæœ¬å·åˆ¤æ–­ï¼ˆä¿®æ”¹å¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼‰</td>
</tr>
<tr>
<td>DbDefautValue</td>
<td>æ•°æ®åº“é»˜è®¤å€¼</td>
</tr>
<tr>
<td>MapType</td>
<td>ç±»å‹æ˜ å°„ï¼Œæ¯”å¦‚ï¼šå¯å°† enum å±æ€§æ˜ å°„æˆ typeof(string)</td>
</tr>
<tr>
<td>Uniques</td>
<td>å”¯ä¸€é”®ï¼Œåœ¨å¤šä¸ªå±æ€§æŒ‡å®šç›¸åŒçš„æ ‡è¯†ï¼Œä»£è¡¨è”åˆé”®ï¼›å¯ä½¿ç”¨é€—å·åˆ†å‰²å¤šä¸ª UniqueKey åã€‚</td>
</tr>
</tbody>
</table>
<h4 id="_2-table-çš„ä½¿ç”¨-ç”¨äºåœ¨ç±»çš„ä¸Šé¢æŒ‡å®šè¿™ä¸ªè¡¨çš„å±æ€§" tabindex="-1"> 2. Table çš„ä½¿ç”¨ï¼šç”¨äºåœ¨ç±»çš„ä¸Šé¢æŒ‡å®šè¿™ä¸ªè¡¨çš„å±æ€§</h4>
<div><pre><code><span>[</span><span><span>Table</span><span><span>(</span>Name <span>=</span> <span>"t_blog"</span><span>)</span></span></span><span>]</span>
<span>public</span> <span>class</span> <span>Blog</span> <span>{</span>
  <span>//...</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>æ›´å¤šå±æ€§ä»‹ç»</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>æ•°æ®åº“è¡¨å</td>
</tr>
<tr>
<td>OldName</td>
<td>æŒ‡å®šæ•°æ®åº“æ—§çš„è¡¨åï¼Œä¿®æ”¹å®ä½“å‘½åæ—¶ï¼ŒåŒæ—¶è®¾ç½®æ­¤å‚æ•°ä¸ºä¿®æ”¹ä¹‹å‰çš„å€¼ï¼ŒCodeFirstæ‰å¯ä»¥æ­£ç¡®ä¿®æ”¹æ•°æ®åº“è¡¨ï¼›å¦åˆ™å°†è§†ä¸ºã€åˆ›å»ºæ–°è¡¨ã€‘</td>
</tr>
<tr>
<td>SelectFilter</td>
<td>æŸ¥è¯¢è¿‡æ»¤SQLï¼Œå®ç°ç±»ä¼¼ a.IsDeleted = 1 åŠŸèƒ½</td>
</tr>
<tr>
<td>DisableSyncStructure</td>
<td>ç¦ç”¨ CodeFirst åŒæ­¥ç»“æ„è¿ç§»</td>
</tr>
</tbody>
</table>
<h4 id="_3-å…¶ä»–çš„è¿˜æ˜¯çœ‹-https-github-com-2881099-freesql-blob-master-docs-codefirst-md" tabindex="-1"> 3. å…¶ä»–çš„è¿˜æ˜¯çœ‹ https://github.com/2881099/FreeSql/blob/master/Docs/codefirst.md</h4>
<h4 id="blog-cs" tabindex="-1"> Blog.cs</h4>
<div><pre><code><span>using</span> <span>FreeSql<span>.</span>DataAnnotations</span><span>;</span>
<span>using</span> <span>System</span><span>;</span>

<span>namespace</span> <span>OvOv<span>.</span>FreeSql<span>.</span>Domain</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>Blog</span>
    <span>{</span>
        <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>int</span></span> BlogId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>[</span><span><span>Column</span><span><span>(</span>DbType <span>=</span> <span>"varchar(50)"</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>[</span><span><span>Column</span><span><span>(</span>DbType <span>=</span> <span>"varchar(500)"</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>string</span></span> Content <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>


    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><h4 id="post-cs" tabindex="-1"> Post.cs</h4>
<div><pre><code>
<span>using</span> <span>FreeSql<span>.</span>DataAnnotations</span><span>;</span>
<span>using</span> <span>System</span><span>;</span>

<span>namespace</span> <span>OvOv<span>.</span>FreeSql<span>.</span>Domain</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>Post</span>
    <span>{</span>
        <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>int</span></span> PostId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>[</span><span><span>Column</span><span><span>(</span>DbType <span>=</span> <span>"varchar(50)"</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>string</span></span> ReplyContent <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>int</span></span> BlogId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span>DateTime</span> ReplyTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span>Blog</span> Blog <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><h4 id="startup-cs" tabindex="-1"> Startup.cs</h4>
<p>éå…¨éƒ¨ä»£ç ï¼Œè¿™é‡Œæ³¨æ„ç‚¹ï¼šè¦å…ˆåœ¨mysqlä¸­åˆ›å»ºæ•°æ®åº“<strong>FreeSql_Blog</strong>ï¼Œå¦åˆ™ä¸€ç›´æç¤º<strong>ä¸»åº“xxxxx</strong>,å®˜ç½‘æœªæ‰¾åˆ°ç›¸å…³æè¿°ã€‚</p>
<p>è¿™é‡Œåˆå§‹åŒ–FreeSqlï¼Œå¹¶ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œæ³¨å…¥åˆ°é»˜è®¤çš„ä¾èµ–ä¸­ï¼Œè¿™æ ·åœ¨Controllerä¸­å³å¯ç›´æ¥æ³¨å…¥ã€‚</p>
<div><pre><code><span>namespace</span> <span>OvOv<span>.</span>FreeSql</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>Startup</span>
    <span>{</span>
        <span>public</span> <span>Startup</span><span>(</span><span>IConfiguration</span> configuration<span>)</span>
        <span>{</span>
            Fsql <span>=</span> <span>new</span> <span>FreeSqlBuilder</span><span>(</span><span>)</span>
                        <span>.</span><span>UseConnectionString</span><span>(</span>DataType<span>.</span>MySql<span>,</span> <span>@"Data Source=127.0.0.1;Port=3306;User ID=root;Password=123456;Initial Catalog=FreeSql_Blog;Charset=utf8;SslMode=none;Max pool size=10"</span><span>)</span>
                        <span>.</span><span>UseAutoSyncStructure</span><span>(</span><span>true</span><span>)</span>
                        <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>

        <span>public</span> <span>IFreeSql</span> Fsql <span>{</span> <span>get</span><span>;</span> <span>}</span>

        <span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
        <span>{</span>
            services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>IFreeSql<span>></span></span></span><span>(</span>Fsql<span>)</span><span>;</span>

        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><h4 id="blogcontroller" tabindex="-1"> BlogController</h4>
<p>åœ¨controllersæ–‡ä»¶å¤¹æ–°å»ºä¸€ä¸ªæ§åˆ¶å™¨BlogController</p>
<div><pre><code><span>using</span> <span>System</span><span>;</span>
<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>System<span>.</span>Linq</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading<span>.</span>Tasks</span><span>;</span>
<span>using</span> <span>FreeSql</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>
<span>using</span> <span>OvOv<span>.</span>FreeSql<span>.</span>Domain</span><span>;</span>

<span>namespace</span> <span>OvOv<span>.</span>FreeSql<span>.</span>Controllers</span>
<span>{</span>
    <span>[</span><span><span>Route</span><span><span>(</span><span>"api/[controller]"</span><span>)</span></span></span><span>]</span>
    <span>[</span><span><span>ApiController</span></span><span>]</span>
    <span>public</span> <span>class</span> <span>BlogController</span> <span>:</span> <span><span>ControllerBase</span></span>
    <span>{</span>
        <span>// GET api/Blog</span>

        <span>IFreeSql</span> _fsql<span>;</span>
        <span>public</span> <span>BlogController</span><span>(</span><span>IFreeSql</span> fsql<span>)</span>
        <span>{</span>
            _fsql <span>=</span> fsql<span>;</span>
        <span>}</span>

        <span>[</span><span><span>HttpGet</span></span><span>]</span>
        <span>public</span> <span>ActionResult<span>&lt;</span>IEnumerable<span>&lt;</span>Blog<span>></span><span>></span></span> <span>Get</span><span>(</span><span>)</span>
        <span>{</span>
            <span>List<span>&lt;</span>Blog<span>></span></span> blogs <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>OrderByDescending</span><span>(</span>r <span>=></span> r<span>.</span>CreateTime<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

            <span>return</span> blogs<span>;</span>
        <span>}</span>

        <span>// GET api/blog/5</span>
        <span>[</span><span>HttpGet</span><span>(</span><span>"{id}"</span><span>)</span><span>]</span>
        <span>public</span> <span>ActionResult<span>&lt;</span>Blog<span>></span></span> <span>Get</span><span>(</span><span><span>int</span></span> id<span>)</span>
        <span>{</span>
            <span>return</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span>id<span>)</span><span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>


        <span>// DELETE api/blog/5</span>
        <span>[</span><span>HttpDelete</span><span>(</span><span>"{id}"</span><span>)</span><span>]</span>
        <span>public</span> <span><span>void</span></span> <span>Delete</span><span>(</span><span><span>int</span></span> id<span>)</span>
        <span>{</span>
            _fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>new</span> <span>{</span> BlogId <span>=</span> id <span>}</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br></div></div><p>é‡æ–°è¿è¡Œï¼Œæ‰“å¼€åœ°å€ http://localhost:5001/api/blog ä¼šå‘ç°æ•°æ®åº“ä¸­ç”Ÿæˆäº†è¡¨blogï¼Œè¿™æ—¶å€™è¡¨postå¹¶æ²¡æœ‰ç”Ÿæˆã€‚æ‰€ä»¥æˆ‘ä»¬åˆ¤æ–­ï¼Œåªæœ‰åœ¨è®¿é—®åˆ°å®ä½“ç±»æ‰æ£€æŸ¥æ˜¯å¦å­˜åœ¨è¡¨ç»“æ„ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„å¤„ç†ã€‚</p>
<p>æ‰‹åŠ¨å‘blogè¡¨ä¸­åŠ ä¸€äº›æ•°æ®ï¼Œç„¶åå†æ¬¡è¯·æ±‚</p>
<ul>
<li>http://localhost:5001/api/blogï¼Œ å¯çœ‹åˆ°ç›¸åº”çš„æ•°æ®ã€‚</li>
<li>http://localhost:5001/api/blog/1  å¯å¾—åˆ°å•ä¸ªæ•°æ®ã€‚</li>
</ul>
<h3 id="è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„ã€å¼€å‘ç¯å¢ƒå¿…å¤‡ã€‘" tabindex="-1"> è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„ã€å¼€å‘ç¯å¢ƒå¿…å¤‡ã€‘</h3>
<p>æ­¤åŠŸèƒ½é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ï¼Œå‘å¸ƒæ­£å¼ç¯å¢ƒåï¼Œè¯·ä¿®æ”¹æ­¤è®¾ç½®</p>
<div><pre><code>Fsql = new FreeSqlBuilder()
          .UseConnectionString(DataType.MySql, @"è¿æ¥å­—ç¬¦ä¸²")
          .UseAutoSyncStructure(true)
          .Build();
                      
//UseAutoSyncStructure(true/false)ã€å¼€å‘ç¯å¢ƒå¿…å¤‡ã€‘è‡ªåŠ¨åŒæ­¥å®ä½“ç»“æ„åˆ°æ•°æ®åº“ï¼Œç¨‹åºè¿è¡Œä¸­æ£€æŸ¥å®ä½“è¡¨æ˜¯å¦å­˜åœ¨ï¼Œç„¶ååˆ›å»ºæˆ–ä¿®æ”¹

// ä¹Ÿå¯ä½¿ç”¨æ­¤æ–¹æ³•æŒ‡å®šæ˜¯å¦è‡ªåŠ¨åŒæ­¥ç»“æ„ã€‚                  
Fsql.CodeFirst.IsAutoSyncStructure = true;
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div>]]></content>
    <published>2020-05-08T15:01:00.000Z</published>
  </entry>
  <entry>
    <title type="html">ä¾èµ–æ³¨å…¥scrutor</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/dependency-injection-scrutor.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/dependency-injection-scrutor.html"/>
    <updated>2020-05-08T15:01:00.000Z</updated>
    <content type="html"><![CDATA[<h1 id="ä¾èµ–æ³¨å…¥scrutor" tabindex="-1"> ä¾èµ–æ³¨å…¥scrutor</h1>
<p>å®˜ç½‘ä»‹ç»</p>
<p><a href="https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-2.2" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-2.2</a></p>
<ul>
<li>å¼€æºåœ°å€<a href="https://github.com/khellang/Scrutor" target="_blank" rel="noopener noreferrer">https://github.com/khellang/Scrutor</a></li>
<li>å‚è€ƒæ–‡æ¡£ <a href="https://www.cnblogs.com/catcher1994/p/10316928.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/catcher1994/p/10316928.html</a>
æ‰‹åŠ¨ç®¡ç†ä¾èµ–æ³¨å…¥è¿‡äºéº»çƒ¦,å½“æœ‰å¤šä¸ªä»“å‚¨ï¼ŒæœåŠ¡ï¼Œæ— æ³•ç»Ÿä¸€æ³¨å…¥ï¼ŒScrutorèƒ½å¸®åŠ©æˆ‘ä»¬ç®€åŒ–ASP.NET Coreçš„DIæ³¨å†Œã€‚</li>
</ul>
<p>åœ¨ConfigServicesä¸­ï¼Œæˆ‘ä»¬åŸæœ¬éœ€è¦è¿™æ ·å­ä¾æ¬¡æ³¨å…¥ä»“å‚¨ï¼ŒæœåŠ¡å’Œå…¶ä»–æ¥å£åŠå®ç°ï¼Œå½“æœ‰å¤šä¸ªä»“å‚¨æ—¶ï¼Œè¿™æ ·å°±è¿‡äºç¹çã€‚</p>
<div><pre><code>services.AddTransient&lt;IUserRepository, UserRepository>();
services.AddTransient&lt;IUserService, UserService>();
services.AddTransient&lt;ICurrentUser, CurrentUser>();
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><h2 id="serivceåç¼€æœåŠ¡æ³¨å…¥di" tabindex="-1"> Serivceåç¼€æœåŠ¡æ³¨å…¥DI</h2>
<p>å½“æˆ‘ä»¬æœ‰å¤šä¸ªServiceåç¼€çš„æœåŠ¡æ—¶ï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼Œå¯å°†æœåŠ¡æ‰«æåªç•™ä¸‹ä»¥Serivceç»“å°¾çš„ç±»ï¼Œå°†å…¶ç±»å‹æ³¨å†Œä¸ºæä¾›æ‰€æœ‰å…¬å…±æ¥å£ç”ŸæˆæœåŠ¡ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä¸ºTransientï¼Œ</p>
<div><pre><code>services.Scan(scan => scan
        //åŠ è½½Startupè¿™ä¸ªç±»æ‰€åœ¨çš„ç¨‹åºé›†
        .FromAssemblyOf&lt;Startup>()
        // è¡¨ç¤ºè¦æ³¨å†Œé‚£äº›ç±»ï¼Œä¸Šé¢çš„ä»£ç è¿˜åšäº†è¿‡æ»¤ï¼Œåªç•™ä¸‹äº†ä»¥ Service ç»“å°¾çš„ç±»
        .AddClasses(classes => classes.Where(t => t.Name.EndsWith("Service", StringComparison.OrdinalIgnoreCase)))
        //è¡¨ç¤ºå°†ç±»å‹æ³¨å†Œä¸ºæä¾›å…¶æ‰€æœ‰å…¬å…±æ¥å£ä½œä¸ºæœåŠ¡
        .AsImplementedInterfaces()
        //è¡¨ç¤ºæ³¨å†Œçš„ç”Ÿå‘½å‘¨æœŸä¸º Transient
        .WithTransientLifetime()
         );

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="itransientdependency" tabindex="-1"> ITransientDependency</h2>
<p>æ–°å»ºä¸€ä¸ªç©ºæ¥å£ï¼Œå½“å…¶ä»–ç±»ç»§æ‰¿æ­¤æ¥å£åï¼Œç»Ÿä¸€æ³¨å…¥åˆ°DIä¸­ï¼Œä»¥Transientçš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<div><pre><code>namespace LinCms.Zero.Dependency
{
    public interface ITransientDependency
    {
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><h2 id="æ¥å£" tabindex="-1"> æ¥å£</h2>
<div><pre><code>public interface ICurrentUser
{
    int? Id { get; }

    int? GroupId { get; }

    bool? IsAdmin { get; }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><h2 id="æ¨¡æ‹Ÿå®ç°" tabindex="-1"> æ¨¡æ‹Ÿå®ç°</h2>
<div><pre><code>    public class CurrentUser : ICurrentUser, ITransientDependency
    {
     
        public int? Id => 1;
        public int? GroupId => 2;
        public bool? IsAdmin => true;
    }
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>æ‰«ææ‰€æœ‰ç»§æ‰¿ITransientDependencyçš„å®ç°ã€‚</p>
<div><pre><code>   services.Scan(scan => scan
       // We start out with all types in the assembly of ITransientService
        .FromAssemblyOf&lt;ITransientDependency>()
        // AddClasses starts out with all public, non-abstract types in this assembly.
        // These types are then filtered by the delegate passed to the method.
        // In this case, we filter out only the classes that are assignable to ITransientService.
        .AddClasses(classes => classes.AssignableTo&lt;ITransientDependency>())
        // We then specify what type we want to register these classes as.
        // In this case, we want to register the types as all of its implemented interfaces.
        // So if a type implements 3 interfaces; A, B, C, we'd end up with three separate registrations.
        .AsImplementedInterfaces()
        // And lastly, we specify the lifetime of these registrations.
        .WithTransientLifetime()
         );

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><h2 id="å¦‚ä½•ä½¿ç”¨" tabindex="-1"> å¦‚ä½•ä½¿ç”¨</h2>
<p>åœ¨å…¶ä»–ç±»ä¸­ä½¿ç”¨æ­¤æ¥å£</p>
<div><pre><code>[ApiController]
[Route("cms/user")]
public class UserController : ControllerBase
{
    private readonly ICurrentUser _currentUser;

    public UserController(ICurrentUser currentUser)
    {
        _currentUser = currentUser;
    }

    [HttpGet]
    public int GetUser()
    {
        return _currentUser.Id;
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><h2 id="ç»Ÿä¸€æ³¨å…¥" tabindex="-1"> ç»Ÿä¸€æ³¨å…¥</h2>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿä¸€æ³¨å…¥ï¼Œè€Œéå†™äºŒæ¬¡servics.Scan</p>
<div><pre><code>services.Scan(scan => scan
            .FromAssemblyOf&lt;Startup>()
            .AddClasses(classes => classes.Where(t => t.Name.EndsWith("Service",StringComparison.OrdinalIgnoreCase)))
            .AsImplementedInterfaces()
            .WithTransientLifetime()
            .FromAssemblyOf&lt;ITransientDependency>()
            .AddClasses(classes => classes.AssignableTo&lt;ITransientDependency>())
            .AsImplementedInterfaces()
            .WithTransientLifetime()
      );
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div>]]></content>
    <published>2020-05-08T15:01:00.000Z</published>
  </entry>
  <entry>
    <title type="html">è®¤è¯ä¸æˆæƒ</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/dynamic-authorization-in-aspnetcore.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/dynamic-authorization-in-aspnetcore.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="è®¤è¯ä¸æˆæƒ" tabindex="-1"> è®¤è¯ä¸æˆæƒ</h1>
<p>ä¸»è¦å°±<strong>åŸºäºæƒé™çš„æˆæƒ</strong>çš„å®ç°è¿›è¡Œç ”ç©¶ï¼Œå®ç°æ–¹æ³•çº§åˆ«çš„æƒé™éªŒè¯ã€‚</p>
<ul>
<li><a href="https://www.cnblogs.com/RainingNight/p/dynamic-authorization-in-asp-net-core.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/RainingNight/p/dynamic-authorization-in-asp-net-core.html</a></li>
</ul>
<h2 id="è®¤è¯é‰´æƒç›¸å…³" tabindex="-1"> è®¤è¯é‰´æƒç›¸å…³</h2>
<p>IdentityServer4</p>
<ul>
<li><a href="https://blog.csdn.net/jasonsong2008/article/details/89226705" target="_blank" rel="noopener noreferrer">ASP.NET Core WebAPI JWT Bearer è®¤è¯å¤±è´¥è¿”å›è‡ªå®šä¹‰æ•°æ® Json</a></li>
<li><a href="https://www.cnblogs.com/stulzq/p/8119928.html" target="_blank" rel="noopener noreferrer">IdentityServer4 ä¸­æ–‡æ–‡æ¡£ä¸å®æˆ˜</a></li>
</ul>
<h2 id="jwt" tabindex="-1"> JWT</h2>
<p>json web token</p>
]]></content>
    <published>2020-05-08T15:01:00.000Z</published>
  </entry>
  <entry>
    <title type="html">CAPå®ç°EventBus</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/rabbitmq.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/rabbitmq.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="capå®ç°eventbus" tabindex="-1"> CAPå®ç°EventBus</h1>
<p>åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§ï¼Œä½¿ç”¨çš„æ˜¯ <a href="https://github.com/dotnetcore/cap" target="_blank" rel="noopener noreferrer">CAP</a>ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å®ƒå‘¢ã€‚</p>
<p>EventBus:äº‹ä»¶æ€»çº¿ï¼Œæ˜¯ä¸€ä¸ªåŸºäºè§‚å¯Ÿè€…æ¨¡å—çš„äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¡†æ¶ï¼Œå¯ä»¥å°†ä¸€äº›å¤æ‚çš„ï¼Œé‡å¤çš„æ“ä½œï¼Œå¼‚æ­¥çš„æ“ä½œï¼Œäº¤ç»™ç³»ç»Ÿå»å¤„ç†ï¼Œå½“å‰ç³»ç»Ÿç›´æ¥è¿”å›æˆåŠŸçš„æ“ä½œã€‚</p>
<p>ç®€å•çš„è¯´å°±æ˜¯è§£è€¦ï¼Œ</p>
<p>æ¯”å¦‚ç”¨æˆ·å‘å¸ƒæ–‡ç« åï¼Œéœ€è¦å°†æ¶ˆæ¯æ¨é€ç»™å…³æ³¨çš„ç”¨æˆ·ï¼Œè¿™æ—¶å€™ï¼Œæ¨é€ä¼šæµªè´¹è®¸å¤šæ—¶é—´ï¼Œæœ¬æ¥è¿™ä¸ªæ“ä½œä¸å½“å‰ç™»å½•çš„ç”¨æˆ·æ²¡æœ‰å…³ç³»ï¼Œç”¨æˆ·ä¹Ÿåªå…³æ³¨æ–‡ç« å‘å¸ƒæ˜¯å¦æˆåŠŸï¼Œã€‚åç»­ï¼Œå°†æ¨é€ç­‰æ“ä½œï¼Œäº¤ç»™å¦ä¸€ä»¶äº‹ä»¶å»å¤„ç†ï¼Œè¿™æ ·é€Ÿåº¦æ›´å¿«ï¼Œå±è”½äº†ä¸€äº›ç»†èŠ‚ã€‚å°±ç±»ä¼¼ä¸€ç§æ¶ˆæ¯é€šçŸ¥ï¼Œæˆ‘ä¸å…³å¿ƒåç»­æ˜¯ä»€ä¹ˆæ“ä½œï¼Œåªå°†è‡ªå·±çš„ä¸€äº›çŠ¶æ€ä¼ é€’è¿‡å»ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹CAPä¸­çš„EventBusï¼Œä¸»è¦ç‰¹ç‚¹æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œå†…éƒ¨ä½¿ç”¨RabbitMQå®ç°å¼‚æ„ç³»ç»Ÿçš„æ¶ˆæ¯åŒæ­¥ï¼Œé€šè¿‡æœ¬åœ°æ¶ˆæ¯è¡¨å¯¹ä¿¡æ¯æŒä¹…åŒ–ï¼Œä¿è¯ç”±EventBuså‘å‡ºçš„æ¶ˆæ¯æ˜¯å¯é çš„ï¼Œå³é«˜å¯ç”¨ã€‚</p>
<p>å¦‚æœç³»ç»Ÿå¯åŠ¨ååœ¨log/log200xxx.txtæ—¥å¿—é”™è¯¯åŸå› ï¼ŒRabbitMQ</p>
<div><pre><code>DotNetCore.CAP.BrokerConnectionException: Broker Unreachable
 ---> RabbitMQ.Client.Exceptions.BrokerUnreachableException: None of the specified endpoints were reachable
 ---> RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=530, text="- to NOT_ALLOWED access vhost '/admin' refused for user 'admin'", classId=10, methodId=40, cause=
   at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply(TimeSpan timeout)
   at RabbitMQ.Client.Impl.ModelBase.ConnectionOpen(String virtualHost, String capabilities, Boolean insist)
   at RabbitMQ.Client.Framing.Impl.Connection.Open(Boolean insist)
   at RabbitMQ.Client.Framing.Impl.Connection..ctor(IConnectionFactory factory, Boolean insist, IFrameHandler frameHandler, String clientProvidedName)
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.Init(IFrameHandler fh)
   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.Init(IEndpointResolver endpoints)
   at RabbitMQ.Client.ConnectionFactory.CreateConnection(IEndpointResolver endpointResolver, String clientProvidedName)
   --- End of inner exception stack trace ---
   at RabbitMQ.Client.ConnectionFactory.CreateConnection(IEndpointResolver endpointResolver, String clientProvidedName)
   at RabbitMQ.Client.ConnectionFactory.CreateConnection(String clientProvidedName)
   at DotNetCore.CAP.RabbitMQ.ConnectionChannelPool.&lt;>c__DisplayClass19_0.&lt;CreateConnection>b__1()
   at DotNetCore.CAP.RabbitMQ.ConnectionChannelPool.GetConnection()
   at DotNetCore.CAP.RabbitMQ.RabbitMQConsumerClient.Connect()
   at DotNetCore.CAP.RabbitMQ.RabbitMQConsumerClientFactory.Create(String groupId)
   --- End of inner exception stack trace ---
   at DotNetCore.CAP.RabbitMQ.RabbitMQConsumerClientFactory.Create(String groupId)
   at DotNetCore.CAP.Internal.ConsumerRegister.&lt;>c__DisplayClass17_0.&lt;Start>b__0()
2020-04-26 15:59:54.280 +08:00 [DBG] Transport connection checking...
2020-04-26 15:59:54.281 +08:00 [WRN] Transport connection is unhealthy, reconnection...
2020-04-26 15:59:54.467 +08:00 [ERR] Broker Unreachable
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br></div></div><h2 id="å®‰è£…ä¸‹è½½" tabindex="-1"> å®‰è£…ä¸‹è½½</h2>
<p>æˆ‘ä»¬å°±éœ€è¦å®‰è£…rabbitmqäº†åï¼Œé…ç½®å¥½ç”¨æˆ·ï¼Œå¯†ç ï¼Œvirtual_hostsï¼Œå› ä¸ºrabbimqæ˜¯erlangå†™çš„ï¼Œæ‰€ä»¥
å‰æè¦å®‰è£…erlang,å®˜ç½‘ä¸‹è½½æ¯”ç™¾åº¦ç½‘ç›˜è¿˜æ…¢ï¼Œä¹Ÿå¯è‡ªè¡Œå»å®˜ç½‘ä¸‹è½½ã€‚</p>
<p>erlang å®‰è£…åŒ… é“¾æ¥ï¼šhttps://pan.baidu.com/s/1T1_dI7iPMpEgiP8QC5tlaw
æå–ç ï¼š86jm</p>
<p>rabbitmq å®‰è£…åŒ…  é“¾æ¥ï¼šhttps://pan.baidu.com/s/1wD22_gKFX2LW9oOx69rnCA
æå–ç ï¼šohea</p>
<h2 id="é…ç½®rabbitmq" tabindex="-1"> é…ç½®RabbitMQ</h2>
<blockquote>
<p>æœåŠ¡å¼€å¯åï¼Œç®¡ç†åœ°å€ï¼šhttp://localhost:15672/</p>
</blockquote>
<ul>
<li>å¸å·ï¼šguest å¯†ç  : guest</li>
</ul>
<p>å¦‚æœé‡åˆ°RabbitmMQå®‰è£…åï¼Œwebç®¡ç†ç«¯å£http://localhost:15672/ æ— æ³•è®¿é—®çš„è§£å†³</p>
<p>å…ˆè¿›å…¥rabbitMQå®‰è£…ç›®å½•ä¸‹çš„sbinç›®å½•,åœ¨ç›®å½•ä¸‹shift+å³é”®æ‰“å¼€å‘½ä»¤è¡Œ</p>
<p>ä½¿ç”¨rabbitmq-plugins.bat enable rabbitmq_managementå¼€å¯ç½‘é¡µç®¡ç†ç•Œé¢,ç„¶åé‡å¯rabbitMQ</p>
<p>1.<a href="https://blog.csdn.net/sxf359/article/details/78239382" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/sxf359/article/details/78239382</a></p>
<p>2.<img src="https://note.youdao.com/yws/api/personal/file/7FA20220D5454DF9B0788B33E3A41FED?method=download&amp;shareKey=c2e5f279b574304e3bd777a75a4e3045" alt="ç¤ºä¾‹" loading="lazy"></p>
<ol start="3">
<li>æ­¤å‘½ä»¤æ‰§è¡Œè¦å…ˆå®šä½åˆ°rabbitmqçš„å®‰è£…ç›®å½•ä¸‹çš„sbinæ–‡ä»¶å¤¹ä¸‹ã€‚</li>
</ol>
<div><pre><code> rabbitmq-plugins enable rabbitmq_management
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="dockerä¸‹å®‰è£…rabbitmq" tabindex="-1"> dockerä¸‹å®‰è£…rabbitmq</h2>
<p>é€šè¿‡dockeræ¥å®‰è£…rabbitmq,å¹¶å¯åŠ¨
1.æ‹‰å–é•œåƒ</p>
<div><pre><code><span>docker</span> pull rabbitmq:3.7.7-management
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>2.åˆ›å»ºå’Œå¯åŠ¨å®¹å™¨</p>
<div><pre><code>docker run -d --name rabbitmq3.7.7 -p 5672:5672 -p 15672:15672 -v `pwd`/data:/var/lib/rabbitmq --hostname myRabbit -e RABBITMQ_DEFAULT_VHOST=my_vhost  -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin df80af9ca0c9
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>è¯´æ˜ï¼š</p>
<p>-d åå°è¿è¡Œå®¹å™¨ï¼›</p>
<p>--name æŒ‡å®šå®¹å™¨åï¼›</p>
<p>-p æŒ‡å®šæœåŠ¡è¿è¡Œçš„ç«¯å£ï¼ˆ5672ï¼šåº”ç”¨è®¿é—®ç«¯å£ï¼›15672ï¼šæ§åˆ¶å°Webç«¯å£å·ï¼‰ï¼›</p>
<p>-v æ˜ å°„ç›®å½•æˆ–æ–‡ä»¶ï¼›</p>
<p>--hostname  ä¸»æœºåï¼ˆRabbitMQçš„ä¸€ä¸ªé‡è¦æ³¨æ„äº‹é¡¹æ˜¯å®ƒæ ¹æ®æ‰€è°“çš„ â€œèŠ‚ç‚¹åç§°â€ å­˜å‚¨æ•°æ®ï¼Œé»˜è®¤ä¸ºä¸»æœºåï¼‰ï¼›</p>
<p>-e æŒ‡å®šç¯å¢ƒå˜é‡ï¼›ï¼ˆRABBITMQ_DEFAULT_VHOSTï¼šé»˜è®¤è™šæ‹Ÿæœºåï¼›RABBITMQ_DEFAULT_USERï¼šé»˜è®¤çš„ç”¨æˆ·åï¼›RABBITMQ_DEFAULT_PASSï¼šé»˜è®¤ç”¨æˆ·åçš„å¯†ç ï¼‰</p>
<p>å…¶ä»–ï¼Œå¯æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p>
<div><pre><code>docker ps 
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æ‰“å¼€æµè§ˆå™¨ï¼Œè¿›å…¥webç®¡ç†ç«¯:http://Server-IP:15672ï¼Œç”¨æˆ·åå¯†ç éƒ½æ˜¯admin</p>
<h2 id="å¼€å‘é…ç½®é¡¹" tabindex="-1"> å¼€å‘é…ç½®é¡¹</h2>
<p>lin-cms-dotnetcore ä¸­ appsettings.jsonä¸­é…ç½®å¦‚ä¸‹ï¼Œé»˜è®¤guest,ä¸å¤ªå®‰å…¨ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬ç¨å¾®å­¦ä¹ ä¸€ä¸‹rabbitmqçš„å·¥å…·çš„ä½¿ç”¨ã€‚</p>
<div><pre><code> "RabbitMQ": {
    "HostName": "localhost",
    "UserName": "admin",
    "Password": "123456",
    "Port": 5672,
    "VirtualHost": "/admin"
  }
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><ol>
<li>
<p>æ–°å¢ä¸€ä¸ªadminç”¨æˆ·ï¼Œé…ç½®è¿™ä¸ªè´¦å·çš„å¯†ç æ˜¯123455(å¥½åƒä¹Ÿä¸å®‰å…¨)ï¼Œé…ç½®tag,è¿™é‡Œæˆ‘ä»¬é€‰æ‹©management
<img src="https://pic.downk.cc/item/5ea54319c2a9a83be5d27c56.png" alt="" loading="lazy"></p>
</li>
<li>
<p>æ–°å»ºä¸€ä¸ªvirtual hostsï¼Œå•¥æ„æ€å°±ä¸BBäº†ã€‚
<img src="https://pic.downk.cc/item/5ea54392c2a9a83be5d2f596.png" alt="" loading="lazy"></p>
</li>
</ol>
<p>3.ç»™adminè¿™ä¸ªç”¨æˆ·é…ç½®virtual hosts</p>
<p>å…ˆé€‰æ‹©ç¬¬ä¸€ä¸ªå›¾ä¸­çš„adminç”¨æˆ·ã€‚
<img src="https://pic.downk.cc/item/5ea5446ac2a9a83be5d3ab26.jpg" alt="" loading="lazy"></p>
<p>ç„¶åset permissioné€‰æ‹©virtual hosts /admin ç‚¹å‡»set permissionï¼Œä¸‡äº‹å¤§å‰
<img src="https://pic.downk.cc/item/5ea5449bc2a9a83be5d3d674.jpg" alt="" loading="lazy"></p>
<p>é‡æ–°å¯åŠ¨é¡¹ç›®ï¼Œæ—¥å¿—ä¸ä¼šæ˜¾ç¤ºé”™è¯¯ã€‚</p>
<p><img src="https://pic.downk.cc/item/5ea545d8c2a9a83be5d4e4e4.jpg" alt="" loading="lazy"></p>
]]></content>
    <published>2020-05-08T15:01:00.000Z</published>
  </entry>
  <entry>
    <title type="html">ç›¸å…³æŠ€æœ¯</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/technology.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/technology.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="ç›¸å…³æŠ€æœ¯" tabindex="-1"> ç›¸å…³æŠ€æœ¯</h1>
<ul>
<li>æ•°æ®åº“ç›¸å…³ï¼šORM:<a href="https://github.com/2881099/FreeSql" target="_blank" rel="noopener noreferrer">FreeSql</a>+DataBase:MySQL5.6</li>
<li>ASP.NET Core3.1+WebAPI+RESTful</li>
<li>ç®€åŒ–å¯¹è±¡æ˜ å°„ï¼š<a href="https://automapper.org/" target="_blank" rel="noopener noreferrer">AutoMapper</a></li>
<li>èº«ä»½è®¤è¯æ¡†æ¶ï¼š<a href="https://github.com/IdentityServer/IdentityServer4" target="_blank" rel="noopener noreferrer">IdentityServer4</a></li>
<li>Json Web ä»¤ç‰Œ:JWT</li>
<li>æ–‡æ¡£ APIï¼šSwagger(<a href="https://github.com/domaindrivendev/Swashbuckle.AspNetCore" target="_blank" rel="noopener noreferrer">Swashbuckle.AspNetCore</a>)</li>
<li>åºåˆ—åŒ–ï¼šNewtonsoft.Json</li>
<li>æµ‹è¯•æ¡†æ¶ï¼šXunit</li>
<li>æ—¥å¿— NLog</li>
<li>ä¾èµ–æ³¨å…¥æœåŠ¡<a href="https://github.com/autofac/Autofac.Extensions.DependencyInjection" target="_blank" rel="noopener noreferrer">AutoFac</a></li>
<li>é€šç”¨æ‰©å±•æ–¹æ³• Z.ExtensionMethods</li>
<li>äº‘å­˜å‚¨ï¼šä¸ƒç‰›äº‘ <a href="https://github.com/Hello-Mango/MQiniu.Core" target="_blank" rel="noopener noreferrer">MQiniu.Core</a></li>
<li>åˆ†å¸ƒå¼äº‹åŠ¡ã€EventBusï¼š<a href="https://github.com/dotnetcore/CAP" target="_blank" rel="noopener noreferrer">DotNeteCore.CAP</a></li>
<li>GitHub ç¬¬ä¸‰æ–¹æˆæƒç™»å½•<a href="https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers" target="_blank" rel="noopener noreferrer">AspNet.Security.OAuth.GitHub</a></li>
<li>QQ ç¬¬ä¸‰æ–¹æˆæƒç™»å½•<a href="https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers" target="_blank" rel="noopener noreferrer">AspNet.Security.OAuth.QQ</a></li>
<li><a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer">Docker</a></li>
<li><a href="https://dev.azure.com/" target="_blank" rel="noopener noreferrer">Azure DevOps</a></li>
<li>å¥åº·æ£€æŸ¥<a href="https://github.com/xabaril/AspNetCore.Diagnostics.HealthChecks" target="_blank" rel="noopener noreferrer">AspNetCore.HealthChecks.UI.Client</a></li>
<li><a href="https://help.github.com/en/actions" target="_blank" rel="noopener noreferrer">GitHub Action</a></li>
</ul>
<h3 id="å®è·µ" tabindex="-1"> å®è·µ</h3>
<ul>
<li>DDD(Domain-Driven Design)é¢†åŸŸé©±åŠ¨è®¾è®¡</li>
<li>Loggingï¼ˆæ—¥å¿—ï¼‰</li>
<li>DevOps(CI/CD,è‡ªåŠ¨åŒ–æ„å»º)</li>
<li>Database Migrationsï¼ˆæ•°æ®åº“è‡ªåŠ¨è¿ç§»)</li>
<li>Authentication(èº«ä»½è®¤è¯)</li>
<li>Authorizationï¼ˆæˆæƒï¼‰</li>
<li>Separation of Concernsï¼ˆå…³æ³¨ç‚¹åˆ†ç¦»ï¼‰</li>
<li>Repository Patternï¼ˆä»“å‚¨æ¨¡å¼ï¼‰</li>
<li>SOLID Principlesï¼ˆå•ä¸€èŒè´£ï¼‰</li>
<li>Clean Codeï¼ˆä»£ç æ•´æ´ä¹‹é“ï¼‰</li>
</ul>
<h3 id="åˆ†å±‚ç»“æ„-layers" tabindex="-1"> åˆ†å±‚ç»“æ„ï¼ˆLayersï¼‰</h3>
<ul>
<li>identityserver4
<ul>
<li>LinCms.IdentityServer4:ä½¿ç”¨ id4 æˆæƒç™»å½•</li>
</ul>
</li>
<li>src
<ul>
<li>LinCms.Webï¼šæ¥å£ APIï¼ˆASP.NET Core)</li>
<li>LinCms.Application:åº”ç”¨æœåŠ¡</li>
<li>LinCms.Application.Contracts:DTO,æ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œåº”ç”¨æœåŠ¡æ¥å£</li>
<li>LinCms.Infrastructure:åŸºç¡€è®¾æ–½ï¼Œæ•°æ®åº“æŒä¹…æ€§çš„æ“ä½œ</li>
<li>LinCms.Core:è¯¥åº”ç”¨çš„æ ¸å¿ƒï¼Œå®ä½“ç±»ï¼Œé€šç”¨æ“ä½œç±»ï¼ŒAOP æ‰©å±•ï¼Œåˆ†é¡µå¯¹è±¡ï¼ŒåŸºç¡€ä¾èµ–å¯¹è±¡æ¥å£ï¼Œæ—¶é—´æ‰©å±•æ–¹æ³•ï¼Œå½“å‰ç”¨æˆ·ä¿¡æ¯ï¼Œå¼‚å¸¸ç±»ï¼Œå€¼å¯¹è±¡</li>
<li>LinCms.Plugins ä½¿ç”¨å•é¡¹ç›®å®ç°æŸä¸ªä¸šåŠ¡çš„æ‰©å±•ï¼Œä¸éœ€è¦ä¸»è¦é¡¹ç›®ç»“æ„ï¼Œå¯æš‚æ—¶å¿½ç•¥ã€‚</li>
</ul>
</li>
<li>test
<ul>
<li>LinCms.Test:å¯¹ä»“å‚¨ï¼Œåº”ç”¨æœåŠ¡æˆ–å·¥å…·ç±»è¿›è¡Œæµ‹è¯•</li>
</ul>
</li>
</ul>
]]></content>
    <published>2020-05-08T05:46:31.000Z</published>
  </entry>
  <entry>
    <title type="html">åˆ›å»ºç®€å•Hello World</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/console-hello-world.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/console-hello-world.html"/>
    <updated>2022-06-02T11:44:24.000Z</updated>
    <content type="html"><![CDATA[<h1 id="åˆ›å»ºç®€å•hello-world" tabindex="-1"> åˆ›å»ºç®€å•Hello World</h1>
<h2 id="æºç " tabindex="-1"> æºç </h2>
<p>ä»£ç æ‰˜ç®¡åœ¨GitHubä¸Š <a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/console-hello-world" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/console-hello-world</a></p>
<h2 id="ç›¸å…³é˜…è¯»" tabindex="-1"> ç›¸å…³é˜…è¯»</h2>
<ul>
<li><a href="https://docs.microsoft.com/zh-cn/dotnet/core/tutorials/with-visual-studio-code" target="_blank" rel="noopener noreferrer">C# å’Œ Visual Studio Code å…¥é—¨æ•™ç¨‹</a></li>
<li><a href="https://blog.csdn.net/qq_40346899/article/details/80955788" target="_blank" rel="noopener noreferrer">vscodeè°ƒè¯•è¿è¡Œc#è¯¦ç»†æ“ä½œè¿‡ç¨‹</a></li>
<li><strong><a href="https://blog.csdn.net/qin_yu_2010/article/details/83978244" target="_blank" rel="noopener noreferrer">ä½¿ç”¨Visual Studio Codeå¼€å‘.NET Coreçœ‹è¿™ç¯‡å°±å¤Ÿäº†</a></strong> å¼ºçƒˆæ¨èã€‚</li>
</ul>
<h2 id="å¼€å§‹" tabindex="-1"> å¼€å§‹</h2>
<p>åˆ›å»ºä¸€ä¸ªhello-wordçš„consoleï¼Œä¼šè¾“å‡ºHello World!</p>
<div><pre><code><span>mkdir</span> console-hello-world
<span>cd</span> console-hello-world
dotnet new console
dotnet run
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>console-hello-world.csproj</p>
<p><strong>OutputType</strong> æ ‡è®°æŒ‡å®šæˆ‘ä»¬è¦ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå³æ§åˆ¶å°åº”ç”¨ç¨‹åºã€‚</p>
<p><strong>TargetFramework</strong> æ ‡è®°æŒ‡å®šè¦å®šä½çš„ .NET å®ç°ä»£ç ã€‚ åœ¨é«˜çº§æ–¹æ¡ˆä¸­ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªç›®æ ‡æ¡†æ¶ï¼Œå¹¶åœ¨å•ä¸ªæ“ä½œä¸­ç”Ÿæˆæ‰€æœ‰ç›®æ ‡æ¡†æ¶ã€‚</p>
<div><pre><code><span><span><span>&lt;</span>Project</span> <span>Sdk</span><span><span>=</span><span>"</span>Microsoft.NET.Sdk<span>"</span></span><span>></span></span>

  <span><span><span>&lt;</span>PropertyGroup</span><span>></span></span>
    <span><span><span>&lt;</span>OutputType</span><span>></span></span>Exe<span><span><span>&lt;/</span>OutputType</span><span>></span></span>
    <span><span><span>&lt;</span>TargetFramework</span><span>></span></span>netcoreapp3.0<span><span><span>&lt;/</span>TargetFramework</span><span>></span></span>
    <span><span><span>&lt;</span>RootNamespace</span><span>></span></span>console_hello_world<span><span><span>&lt;/</span>RootNamespace</span><span>></span></span>
  <span><span><span>&lt;/</span>PropertyGroup</span><span>></span></span>

<span><span><span>&lt;/</span>Project</span><span>></span></span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><p>åœ¨ console-hello-world/bin/Debug/netcoreapp3.0ä¸­ç”Ÿæˆäº†console-hello-world.dll</p>
<div><pre><code>cd console-hello-world #è¦å…ˆåœ¨console-hello-worldç›®å½•ä¸­
dotnet bin/Debug/netcoreapp3.0/console-hello-world.dll
Hello World
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>ä¿®æ”¹mainå‡½æ•°</p>
<div><pre><code><span>using</span> <span>System</span><span>;</span>

<span>namespace</span> <span>console_hello_world</span>
<span>{</span>
    <span>class</span> <span>Program</span>
    <span>{</span>
        <span>static</span> <span><span>void</span></span> <span>Main</span><span>(</span><span><span>string</span><span>[</span><span>]</span></span> args<span>)</span>
        <span>{</span>
            <span>if</span> <span>(</span>args<span>.</span>Length <span>></span> <span>0</span><span>)</span>
            <span>{</span>
                Console<span>.</span><span>WriteLine</span><span>(</span><span><span>$"Hello </span><span><span>{</span><span>args<span>[</span><span>0</span><span>]</span></span><span>}</span></span><span>!"</span></span><span>)</span><span>;</span>
            <span>}</span>
            <span>else</span>
            <span>{</span>
                Console<span>.</span><span>WriteLine</span><span>(</span><span>"Hello!"</span><span>)</span><span>;</span>
            <span>}</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></div></div><div><pre><code>$ dotnet run -- John
Hello John!
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div>]]></content>
    <published>2020-04-15T17:09:07.000Z</published>
  </entry>
  <entry>
    <title type="html">.NET Core ç®€å•æµ‹è¯•é¡¹ç›®</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/console-news-types.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/console-news-types.html"/>
    <updated>2022-06-02T11:44:24.000Z</updated>
    <content type="html"><![CDATA[<h1 id="net-core-ç®€å•æµ‹è¯•é¡¹ç›®" tabindex="-1"> .NET Core ç®€å•æµ‹è¯•é¡¹ç›®</h1>
<p>ä½¿ç”¨PowerShellçš„dotnet cliå‘½ä»¤è¡Œåˆ›å»ºæ§åˆ¶å°é¡¹ç›®ï¼Œæµ‹è¯•é¡¹ç›®ï¼Œæµ‹è¯•é¡¹ç›®å¼•ç”¨æ§åˆ¶å°é¡¹ç›®ã€‚</p>
<h2 id="æºç " tabindex="-1"> æºç </h2>
<p>ä»£ç æ‰˜ç®¡åœ¨GitHubä¸Š <a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/console-news-types" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/console-news-types</a></p>
<h2 id="ç›¸å…³å‚è€ƒ" tabindex="-1"> ç›¸å…³å‚è€ƒ</h2>
<p>code :<a href="https://github.com/dotnet/samples/blob/master/core/console-apps/NewTypesMsBuild/README.md" target="_blank" rel="noopener noreferrer">https://github.com/dotnet/samples/blob/master/core/console-apps/NewTypesMsBuild/README.md</a></p>
<p>docs: <a href="https://docs.microsoft.com/zh-cn/dotnet/core/tutorials/testing-with-cli" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/dotnet/core/tutorials/testing-with-cli</a></p>
<p>dotnet-add-reference ä½¿ç”¨æ–‡æ¡£ <a href="https://docs.microsoft.com/zh-cn/dotnet/core/tools/dotnet-add-reference" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/dotnet/core/tools/dotnet-add-reference</a></p>
<p>æ€»ç»“å¦‚ä¸‹å‘½ä»¤è¡Œ</p>
<div><pre><code>PS dotnetcore-examples&gt; mkdir console-news-types
PS dotnetcore-examples&gt; cd .\console-news-types\ 
PS dotnetcore-examples\console-news-types&gt; mkdir src

PS dotnetcore-examples\console-news-types&gt; mkdir test
PS dotnetcore-examples\console-news-types&gt; ls
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d----           2019/6/27    20:51                src
d----           2019/6/27    20:51                test

PS dotnetcore-examples\console-news-types&gt; cd .\src\
PS dotnetcore-examples\console-news-types\src&gt; dotnet new console -n NewTypes
PS dotnetcore-examples\console-news-types\src&gt; cd ..\test\  
PS dotnetcore-examples\console-news-types\test&gt; dotnet new xunit -n NewTypesTests 
PS dotnetcore-examples\console-news-types\test&gt; cd .\NewTypesTests\
PS dotnetcore-examples\console-news-types\test\NewTypesTests&gt; dotnet add reference ../../src/NewTypes/NewTypes.csproj
#Reference `..\..\src\NewTypes\NewTypes.csproj` added to the project.
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><p>å…¶ä»–çš„ä»£ç å°±çœ‹ä¸Šé¢çš„äºŒä¸ªé“¾æ¥ï¼ŒæŠŠä»£ç å¤åˆ¶è¿›å»ï¼Œä»£ç å¾ˆç®€å•ï¼Œä¸€ä¸ªæ¥å£ï¼ŒäºŒä¸ªå®ç°ï¼Œmainå‡½æ•°è°ƒç”¨ï¼Œæµ‹è¯•é¡¹ç›®å¼•ç”¨æ§åˆ¶å°é¡¹ç›®ï¼Œ</p>
<p>å…ˆcd åˆ°src\NewTypesç›®å½•ä¸­ï¼Œæ‰§è¡Œ <strong>dotnet run</strong></p>
<div><pre><code>PS dotnetcore-examples\console-news-types\src\NewTypes&gt; dotnet run
Woof!
Meow!
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>å…ˆcd åˆ°test\NewTypesTestsç›®å½•ä¸­ï¼Œæ‰§è¡Œ <strong>dotnet test</strong>ï¼Œçœ‹å¥½ä»£ç ï¼Œæµ‹è¯•ç±» Assert.Equal() æ˜¯æˆåŠŸçš„ï¼Œå¦‚æœæ˜¯Assert.NotEqual() åˆ™Failure</p>
<div><pre><code>PS dotnetcore-examples\console-news-types\test\NewTypesTests&gt; dotnet test
dotnetcore-examples\console-news-types\test\NewTypesTests\bin\Debug\netcoreapp3.0\NewTypesTests.dll çš„æµ‹è¯•è¿è¡Œ(.NETCoreApp,Version=v3.0)
Microsoft (R) æµ‹è¯•æ‰§è¡Œå‘½ä»¤è¡Œå·¥å…·ç‰ˆæœ¬ 16.0.1
ç‰ˆæƒæ‰€æœ‰ (C) Microsoft Corporationã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚

æ­£åœ¨å¯åŠ¨æµ‹è¯•æ‰§è¡Œï¼Œè¯·ç¨å€™...

æ€»æµ‹è¯•: 2ã€‚å·²é€šè¿‡: 2ã€‚å¤±è´¥: 0ã€‚å·²è·³è¿‡: 0ã€‚
æµ‹è¯•è¿è¡ŒæˆåŠŸã€‚
æµ‹è¯•æ‰§è¡Œæ—¶é—´: 1.5134 ç§’
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div>]]></content>
    <published>2020-04-15T17:09:07.000Z</published>
  </entry>
  <entry>
    <title type="html">RESTful+FreeSql+AutoMapper</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/freesql-sample-blog-restful-use-automapper.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/freesql-sample-blog-restful-use-automapper.html"/>
    <updated>2020-05-08T15:01:00.000Z</updated>
    <summary type="html"><![CDATA[<h1 id="restful-freesql-automapper" tabindex="-1"> RESTful+FreeSql+AutoMapper</h1>
<h2 id="æ–‡ç« æ¦‚è¿°" tabindex="-1"> æ–‡ç« æ¦‚è¿°</h2>
<p>æœ¬æ–‡ä½¿ç”¨ASP .NET Coreçš„WEB APIï¼Œæ„å»ºä¸€ä¸ªRESTfulé£æ ¼çš„æ¥å£ï¼Œä½¿ç”¨Freesqlè®¿é—®MySQLæ•°æ®åº“ï¼Œå®ç°äºŒä¸ªè¡¨çš„ç®€å•åšå®¢ï¼Œå¹¶é›†æˆAutoMapperã€‚</p>
<p>æ¥ä¸Šä¸€ç¯‡</p>
<ul>
<li>
<p><a href="http://blog.igeekfan.cn/2019/06/30/re-start/FreeSql-aspnetcore-how-to-use/" target="_blank" rel="noopener noreferrer">FreeSqlåœ¨ASP.NTE Core WebApiä¸­å¦‚ä½•ä½¿ç”¨çš„æ•™ç¨‹</a></p>
</li>
<li>
<p>é¡¹ç›®æºç  <a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-freesql" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-freesql</a></p>
</li>
</ul>
]]></summary>
    <content type="html"><![CDATA[<h1 id="restful-freesql-automapper" tabindex="-1"> RESTful+FreeSql+AutoMapper</h1>
<h2 id="æ–‡ç« æ¦‚è¿°" tabindex="-1"> æ–‡ç« æ¦‚è¿°</h2>
<p>æœ¬æ–‡ä½¿ç”¨ASP .NET Coreçš„WEB APIï¼Œæ„å»ºä¸€ä¸ªRESTfulé£æ ¼çš„æ¥å£ï¼Œä½¿ç”¨Freesqlè®¿é—®MySQLæ•°æ®åº“ï¼Œå®ç°äºŒä¸ªè¡¨çš„ç®€å•åšå®¢ï¼Œå¹¶é›†æˆAutoMapperã€‚</p>
<p>æ¥ä¸Šä¸€ç¯‡</p>
<ul>
<li>
<p><a href="http://blog.igeekfan.cn/2019/06/30/re-start/FreeSql-aspnetcore-how-to-use/" target="_blank" rel="noopener noreferrer">FreeSqlåœ¨ASP.NTE Core WebApiä¸­å¦‚ä½•ä½¿ç”¨çš„æ•™ç¨‹</a></p>
</li>
<li>
<p>é¡¹ç›®æºç  <a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-freesql" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-freesql</a></p>
</li>
</ul>

<h2 id="dtoä½œç”¨" tabindex="-1"> Dtoä½œç”¨</h2>
<p>å½“æˆ‘ä»¬ä½¿ç”¨RESTfulæä¾›æ¥å£æ—¶ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªåšå®¢ï¼Œä¿®æ”¹ä¸€ä¸‹åšå®¢å†…å®¹æ—¶ï¼Œä»–ä»¬çš„å‚æ•°æ˜¯æœ‰åŒºåˆ«çš„ã€‚è‰¯å¥½çš„è®¾è®¡åº”è¯¥æ˜¯</p>
<p>åˆ›å»ºä¸€ä¸ªåšå®¢</p>
<div><pre><code>POST /api/blog
data<span>:</span>
<span>{</span>
  <span>"title"</span><span>:</span> <span>"string"</span><span>,</span>
  <span>"content"</span><span>:</span> <span>"string"</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>ä¿®æ”¹ä¸€ä¸ªåšå®¢å†…å®¹</p>
<div><pre><code>PUT /api/blog
data<span>:</span>
<span>{</span>
  <span>"blogId"</span><span>:</span><span>"int"</span><span>,</span>
  <span>"title"</span><span>:</span> <span>"string"</span><span>,</span>
  <span>"content"</span><span>:</span> <span>"string"</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>ä½†ä¸€ä¸ªblog å®ä½“å¦‚ä¸‹</p>
<div><pre><code>    <span>public</span> <span>class</span> <span>Blog</span>
    <span>{</span>
        <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>int</span></span> BlogId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Content <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span>virtual</span> <span>List<span>&lt;</span>Post<span>></span></span> Posts <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><p>å¦‚æœæˆ‘ä»¬ä»¥Blogä½œä¸ºcontrollersä¸­çš„å‚æ•°æ—¶</p>
<div><pre><code>       <span>// POST api/blog</span>
        <span>[</span>HttpPost<span>]</span>
        <span>public</span> <span><span>void</span></span> <span>Post</span><span>(</span><span>[</span><span><span>FromBody</span></span><span>]</span> <span>Blog</span> blog<span>)</span>
        <span>{</span>
            blog<span>.</span>CreateTime<span>=</span>DateTime<span>.</span>Now<span>;</span>
            _fsql<span>.</span><span><span>Insert</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span>blog<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>è¿™æ—¶ä¿®æ”¹swaggeræ˜¾ç¤ºçš„é»˜è®¤å‚æ•°æ˜¯</p>
<div><pre><code><span>{</span>
  <span>"blogId"</span><span>:</span> <span>0</span><span>,</span>
  <span>"title"</span><span>:</span> <span>"string"</span><span>,</span>
  <span>"content"</span><span>:</span> <span>"string"</span><span>,</span>
  <span>"createTime"</span><span>:</span> <span>"2019-06-30T07:33:05.524Z"</span><span>,</span>
  <span>"posts"</span><span>:</span> <span>[</span>
    <span>{</span>
      <span>"postId"</span><span>:</span> <span>0</span><span>,</span>
      <span>"replyContent"</span><span>:</span> <span>"string"</span><span>,</span>
      <span>"blogId"</span><span>:</span> <span>0</span><span>,</span>
      <span>"replyTime"</span><span>:</span> <span>"2019-06-30T07:33:05.524Z"</span>
    <span>}</span>
  <span>]</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><p>å¦‚æœæˆ‘ä»¬ä¸ä¼ é€’createTimeï¼Œä¼šå‡ºç°å¼‚å¸¸ï¼Œåº”è¯¥createTimeæ˜¯DateTimeï¼Œä¸èƒ½ä¸ºnullï¼Œåªæœ‰DateTime?æ‰èƒ½ä¸ºnull,æœ‰?ä¸ºå¯ç©ºç±»å‹ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä¸ºPOSTæ–¹å¼ä¼ é€’è¿‡æ¥æ—¶ï¼Œæ–°å»ºä¸€ä¸ªå®ä½“ç±»ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºDTO(Data Transfer Object)ï¼Œå³æ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œå› ä¸ºcreateTimeå³ä½¿ä¼ é€’ï¼Œåç«¯ä¸ºä»–èµ‹äº†å€¼ï¼Œå‰å°ä¼ äº†ä¹Ÿæ— æ•ˆã€‚æœ‰äº†DTOï¼Œè¿™æ ·å¯è®©å‰ç«¯æ¸…æ¥šä»–ä»¬åº”è¯¥ä¼ é€’çš„å‚æ•°ï¼Œè€Œä¸ä¼šå‡ºç°æ²¡æœ‰ä½œç”¨çš„å‚æ•°ã€‚</p>
<p>åœ¨æ ¹ç›®å½•åˆ›å»ºModels/Blogsæ–‡ä»¶å¤¹ï¼Œåœ¨Blogsæ–‡ä»¶å¤¹ä¸­åˆ›å»º</p>
<h3 id="createblogdto-cs" tabindex="-1"> CreateBlogDto.cs</h3>
<div><pre><code><span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Blogs</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>CreateBlogDto</span>
    <span>{</span>
        <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Content <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>}</span>
<span>}</span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><h3 id="updateblogdto-cs" tabindex="-1"> UpdateBlogDto.cs</h3>
<div><pre><code><span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Blogs</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>UpdateBlogDto</span>
    <span>{</span>
        <span>public</span> <span><span>int</span></span> BlogId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Content <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
<span>}</span>


</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>æœ‰äº†Dtoåï¼Œæˆ‘ä»¬ä¼šå‘ç°äº†æ–°çš„é—®é¢˜ï¼Œå¾€æ•°æ®åº“æ’å…¥æ—¶ï¼Œå¾€å¾€ä½¿ç”¨äº†ä¸€äº›ORM,ä»–ä»¬åªæ”¯æŒåŸæœ¬çš„å®ä½“ç±»ï¼Œå¦‚Blogï¼ŒPostã€‚ä½†ä¸æ”¯æŒCreateBlogDtoã€UpdateBlogDto,æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ï¼Œå°†ä¸€ä¸ªç±»çš„å€¼ï¼Œèµ‹å€¼ç»™å¦ä¸€ä¸ªç±»ã€‚
å¦‚</p>
<div><pre><code>    <span>CreateBlogDto</span> createBlogDto <span>=</span> <span>new</span> <span>CreateBlogDto</span><span>(</span><span>)</span>
    <span>{</span>
        Title <span>=</span> <span>"æˆ‘æ˜¯title"</span><span>,</span>
        Content <span>=</span> <span>"æˆ‘æ˜¯content"</span>
    <span>}</span><span>;</span>

    <span>Blog</span> newBlog<span>=</span><span>new</span> <span>Blog</span><span>(</span><span>)</span>
    <span>{</span>
        Title <span>=</span> createBlogDto<span>.</span>Title<span>,</span>
        Content <span>=</span> createBlogDto<span>.</span>Content
    <span>}</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>ç°åœ¨åªæ˜¯éå¸¸ç®€å•çš„äºŒä¸ªå±æ€§ï¼Œæˆ‘ä»¬è¿˜èƒ½å¿å—ï¼Œä½†å¦‚æœæ˜¯åä¸ªå±æ€§ã€è€Œä¸”æœ‰ç€å¤§é‡çš„ç±»ä¸ç±»ä¹‹é—´çš„è½¬æ¢å‘¢ã€‚è¿™æ—¶ä¿®æ”¹AutoMapperå°±é—ªäº®ç™»åœºäº†ã€‚</p>
<h2 id="automapper" tabindex="-1"> AutoMapper</h2>
<blockquote>
<p>ä½œç”¨ï¼šA convention-based object-object mapper.</p>
</blockquote>
<p>æˆ‘ä»¬æ˜¯åœ¨ASP .NET Coreä¸‹ä½¿ç”¨AutoMapper <a href="https://automapper.readthedocs.io/en/latest/Dependency-injection.html" target="_blank" rel="noopener noreferrer">å®˜ç½‘ä»‹ç»ï¼Œå¦‚ä½•ä¾èµ–æ³¨å…¥ä¸­ä½¿ç”¨</a></p>
<h3 id="setup" tabindex="-1"> Setup</h3>
<p>å…ˆcdåˆ°dotnetcore-examples\aspnetcore-freesql\RESTful.FreeSqlç›®å½•</p>
<div><pre><code>PS &gt; dotnet add package AutoMapper
PS &gt; dotnet add package AutoMapper.Extensions.Microsoft.DependencyInjection --version 6.1.1
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>åœ¨StartUp.csä¸­çš„ConfigureServicesé…ç½®å¦‚ä¸‹</p>
<div><pre><code>   public void ConfigureServices(IServiceCollection services)
    {
        // .... Ignore code before this
        
        //AddAutoMapperä¼šå»æ‰¾ç»§æ‰¿Profileçš„ç±»ï¼Œ
        services.AddAutoMapper(AppDomain.CurrentDomain.GetAssemblies());

        // .... Ignore code after this
    }
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h3 id="adding-profiles" tabindex="-1"> Adding Profiles</h3>
<p>AutoMapper/BlogProfile.cs</p>
<div><pre><code><span>using</span> <span>AutoMapper</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Domain</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Blogs</span><span>;</span>

<span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>AutoMapper</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>BlogProfile</span> <span>:</span> <span><span>Profile</span></span>
    <span>{</span>
        <span>public</span> <span>BlogProfile</span><span>(</span><span>)</span> 
        <span>{</span>
            <span><span>CreateMap</span><span><span>&lt;</span>CreateBlogDto<span>,</span> Blog<span>></span></span></span><span>(</span><span>)</span><span>;</span>
            <span><span>CreateMap</span><span><span>&lt;</span>UpdateBlogDto<span>,</span> Blog<span>></span></span></span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><p>AutoMapper/BlogProfile.cs</p>
<div><pre><code><span>using</span> <span>AutoMapper</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Domain</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Blogs</span><span>;</span>

<span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>AutoMapper</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>PostProfile</span> <span>:</span> <span><span>Profile</span></span>
    <span>{</span>
        <span>public</span> <span>PostProfile</span><span>(</span><span>)</span>
        <span>{</span>
            <span><span>CreateMap</span><span><span>&lt;</span>CreatePostDto<span>,</span>Post<span>></span></span></span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><p>Models/Posts/SearchPostDto.csæ ¹æ®åšå®¢idï¼Œå¾—åˆ°åˆ†é¡µçš„è¯„è®ºæ—¶ï¼Œé›†æˆåˆ†é¡µç±»</p>
<div><pre><code><span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Web</span><span>;</span>

<span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Posts</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>SearchPostDto</span><span>:</span><span><span>PageDto</span></span>
    <span>{</span>
        <span>public</span> <span><span>int</span></span> BlogId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
<span>}</span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><p>Controlers/BlogController.csæ–‡ä»¶ä¸­ï¼Œæ³¨å…¥IMapper,</p>
<div><pre><code><span>using</span> <span>AutoMapper</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>
<span>using</span> <span>System</span><span>;</span>
<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Domain</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Blogs</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Web</span><span>;</span>

<span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Controllers</span>
<span>{</span>
    <span>[</span><span><span>Route</span><span><span>(</span><span>"api/[controller]"</span><span>)</span></span></span><span>]</span>
    <span>[</span><span><span>ApiController</span></span><span>]</span>
    <span>public</span> <span>class</span> <span>BlogController</span> <span>:</span> <span><span>ControllerBase</span></span>
    <span>{</span>
        <span>// GET api/Blog</span>

        <span>private</span> <span>readonly</span> <span>IFreeSql</span> _fsql<span>;</span>
        <span>private</span> <span>readonly</span> <span>IMapper</span> _mapper<span>;</span>
        <span>public</span> <span>BlogController</span><span>(</span><span>IFreeSql</span> fsql<span>,</span> <span>IMapper</span> mapper<span>)</span>
        <span>{</span>
            _fsql <span>=</span> fsql<span>;</span>
            _mapper <span>=</span> mapper<span>;</span>
        <span>}</span>

        <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
        <span>/// åšå®¢åˆ—è¡¨é¡µ </span>
        <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
        <span>/// <span><span><span>&lt;</span>param</span> <span>name</span><span><span>=</span><span>"</span>pageDto<span>"</span></span><span>></span></span>åˆ†é¡µå‚æ•°<span><span><span>&lt;/</span>param</span><span>></span></span></span>
        <span>/// <span><span><span>&lt;</span>returns</span><span>></span></span><span><span><span>&lt;/</span>returns</span><span>></span></span></span>
        <span>[</span>HttpGet<span>]</span>
        <span>public</span> <span>ActionResult<span>&lt;</span>PagedResultDto<span>&lt;</span>Blog<span>></span><span>></span></span> <span>Get</span><span>(</span><span>[</span><span><span>FromQuery</span></span><span>]</span><span>PageDto</span> pageDto<span>)</span>
        <span>{</span>
            <span>List<span>&lt;</span>Blog<span>></span></span> blogs <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>OrderByDescending</span><span>(</span>r <span>=></span> r<span>.</span>CreateTime<span>)</span><span>.</span><span>Page</span><span>(</span>pageDto<span>.</span>PageNumber<span>,</span> pageDto<span>.</span>PageSize<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
            <span><span>long</span></span> count <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Count</span><span>(</span><span>)</span><span>;</span>
            <span>return</span> <span>new</span> <span>PagedResultDto<span>&lt;</span>Blog<span>></span></span><span>(</span>count<span>,</span> blogs<span>)</span><span>;</span>
        <span>}</span>

        <span>// GET api/blog/5</span>
        <span>[</span><span>HttpGet</span><span>(</span><span>"{id}"</span><span>)</span><span>]</span>
        <span>public</span> <span>ActionResult<span>&lt;</span>Blog<span>></span></span> <span>Get</span><span>(</span><span><span>int</span></span> id<span>)</span>
        <span>{</span>
            <span>// eg.1 return _fsql.Select&lt;Blog>().Where(a => a.Id == id).ToOne();</span>
            <span>// eg.2</span>
            <span>return</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span>id<span>)</span><span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>

        <span>// POST api/blog</span>
        <span>[</span>HttpPost<span>]</span>
        <span>public</span> <span><span>void</span></span> <span>Post</span><span>(</span><span>[</span><span><span>FromBody</span></span><span>]</span> <span>CreateBlogDto</span> createBlogDto<span>)</span>
        <span>{</span>
            <span>Blog</span> blog <span>=</span> _mapper<span>.</span><span><span>Map</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span>createBlogDto<span>)</span><span>;</span>
            blog<span>.</span>CreateTime <span>=</span> DateTime<span>.</span>Now<span>;</span>
            _fsql<span>.</span><span><span>Insert</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span>blog<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>

        <span>// PUT api/blog</span>
        <span>[</span>HttpPut<span>]</span>
        <span>public</span> <span><span>void</span></span> <span>Put</span><span>(</span><span>[</span><span><span>FromBody</span></span><span>]</span> <span>UpdateBlogDto</span> updateBlogDto<span>)</span>
        <span>{</span>

            <span>//eg.1 æ›´æ–°æŒ‡å®šåˆ—</span>
            <span>//_fsql.Update&lt;Blog>(updateBlogDto.BlogId).Set(a => new Blog()</span>
            <span>//{</span>
            <span>//    Title = updateBlogDto.Title,</span>
            <span>//    Content = updateBlogDto.Content</span>
            <span>//}).ExecuteAffrows();</span>

            <span>//eg.2å°†è¿™ä¸ªå®ä½“æ›´æ–°åˆ°æ•°æ®åº“ä¸­ã€‚å½“æ›´æ–°æ—¶ï¼Œä¼šæŠŠå…¶ä»–åˆ—çš„å€¼ï¼Œå¦‚CreateTimeä¹Ÿæ›´æ–°æ‰ã€‚</span>
            <span>//ä½¿ç”¨IgnoreColumnså¯å¿½ç•¥æŸä¸€äº›åˆ—ã€‚</span>

            <span>Blog</span> blog <span>=</span> _mapper<span>.</span><span><span>Map</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span>updateBlogDto<span>)</span><span>;</span>
            _fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>SetSource</span><span>(</span>blog<span>)</span><span>.</span><span>IgnoreColumns</span><span>(</span>r <span>=></span> r<span>.</span>CreateTime<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>

        <span>// DELETE api/blog/5</span>
        <span>[</span><span>HttpDelete</span><span>(</span><span>"{id}"</span><span>)</span><span>]</span>
        <span>public</span> <span><span>void</span></span> <span>Delete</span><span>(</span><span><span>int</span></span> id<span>)</span>
        <span>{</span>
            _fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>new</span> <span>{</span> BlogId <span>=</span> id <span>}</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br><span>73</span><br><span>74</span><br><span>75</span><br><span>76</span><br><span>77</span><br><span>78</span><br><span>79</span><br><span>80</span><br><span>81</span><br><span>82</span><br></div></div><p>Controlers/BlogController.csæ–‡ä»¶ä¸­ï¼Œæ³¨å…¥IMapper,</p>
<div><pre><code><span>using</span> <span>FreeSql</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>
<span>using</span> <span>System</span><span>;</span>
<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading<span>.</span>Tasks</span><span>;</span>
<span>using</span> <span>AutoMapper</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Domain</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Posts</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Web</span><span>;</span>

<span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Controllers</span>
<span>{</span>
    <span>[</span><span><span>Route</span><span><span>(</span><span>"api/[controller]"</span><span>)</span></span></span><span>]</span>
    <span>[</span><span><span>ApiController</span></span><span>]</span>
    <span>public</span> <span>class</span> <span>PostController</span> <span>:</span> <span><span>ControllerBase</span></span>
    <span>{</span>
        <span>// GET: api/Post</span>
        <span>private</span> <span>readonly</span> <span>IFreeSql</span> _fsql<span>;</span>
        <span>private</span> <span>readonly</span> <span>IMapper</span> _mapper<span>;</span>
        <span>public</span> <span>PostController</span><span>(</span><span>IFreeSql</span> fsql<span>,</span> <span>IMapper</span> mapper<span>)</span>
        <span>{</span>
            _fsql <span>=</span> fsql<span>;</span>
            _mapper <span>=</span> mapper<span>;</span>
        <span>}</span>

        <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
        <span>/// æ ¹æ®åšå®¢idã€åˆ†é¡µæ¡ä»¶æŸ¥è¯¢è¯„è®ºä¿¡æ¯</span>
        <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
        <span>/// <span><span><span>&lt;</span>param</span> <span>name</span><span><span>=</span><span>"</span>searchPostDto<span>"</span></span><span>></span></span><span><span><span>&lt;/</span>param</span><span>></span></span></span>
        <span>/// <span><span><span>&lt;</span>returns</span><span>></span></span><span><span><span>&lt;/</span>returns</span><span>></span></span></span>
        <span>[</span>HttpGet<span>]</span>
        <span>public</span> <span>PagedResultDto<span>&lt;</span>Post<span>></span></span> <span>Get</span><span>(</span><span>SearchPostDto</span> searchPostDto<span>)</span>
        <span>{</span>
            <span>ISelect<span>&lt;</span>Post<span>></span></span> selectPost <span>=</span> _fsql
                <span>.</span><span><span>Select</span><span><span>&lt;</span>Post<span>></span></span></span><span>(</span><span>)</span>
                <span>.</span><span>Where</span><span>(</span>r <span>=></span> r<span>.</span>BlogId <span>==</span> searchPostDto<span>.</span>BlogId<span>)</span><span>;</span>

            <span>List<span>&lt;</span>Post<span>></span></span> posts <span>=</span> selectPost<span>.</span><span>OrderByDescending</span><span>(</span>r <span>=></span> r<span>.</span>ReplyTime<span>)</span>
                <span>.</span><span>Page</span><span>(</span>searchPostDto<span>.</span>PageNumber<span>,</span> searchPostDto<span>.</span>PageSize<span>)</span>
                <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

            <span><span>long</span></span> total <span>=</span> selectPost<span>.</span><span>Count</span><span>(</span><span>)</span><span>;</span>

            <span>return</span> <span>new</span> <span>PagedResultDto<span>&lt;</span>Post<span>></span></span><span>(</span>total<span>,</span> posts<span>)</span><span>;</span>
        <span>}</span>

        <span>// GET: api/Post/5</span>
        <span>[</span><span>HttpGet</span><span>(</span><span>"{id}"</span><span>,</span> Name <span>=</span> <span>"Get"</span><span>)</span><span>]</span>
        <span>public</span> <span>Post</span> <span>Get</span><span>(</span><span><span>int</span></span> id<span>)</span>
        <span>{</span>
            <span>return</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Post<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>PostId <span>==</span> id<span>)</span><span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>

        <span>// POST: api/Post</span>
        <span>[</span>HttpPost<span>]</span>
        <span>public</span> <span><span>void</span></span> <span>Post</span><span>(</span><span>[</span><span><span>FromBody</span></span><span>]</span> <span>CreatePostDto</span> createPostDto<span>)</span>
        <span>{</span>
            <span>Post</span> post <span>=</span> _mapper<span>.</span><span><span>Map</span><span><span>&lt;</span>Post<span>></span></span></span><span>(</span>createPostDto<span>)</span><span>;</span>
            post<span>.</span>ReplyTime <span>=</span> DateTime<span>.</span>Now<span>;</span>
            _fsql<span>.</span><span>Insert</span><span>(</span>post<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>


        <span>// DELETE: api/Post/</span>
        <span>[</span><span><span>HttpDelete</span><span><span>(</span><span>"{id}"</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span>async</span> <span>Task</span> <span>DeleteAsync</span><span>(</span><span><span>int</span></span> id<span>)</span>
        <span>{</span>
            <span>await</span> _fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Post<span>></span></span></span><span>(</span><span>new</span> <span>Post</span> <span>{</span> PostId <span>=</span> id <span>}</span><span>)</span><span>.</span><span>ExecuteAffrowsAsync</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br></div></div><h3 id="å‚è€ƒ" tabindex="-1"> å‚è€ƒ</h3>
<ul>
<li>å»ºè®®å¤§å®¶å…ˆçœ‹å®˜ç½‘ <a href="http://automapper.org/" target="_blank" rel="noopener noreferrer">http://automapper.org/</a></li>
<li>å¼€æºåœ°å€ <a href="https://github.com/AutoMapper/AutoMapper" target="_blank" rel="noopener noreferrer">https://github.com/AutoMapper/AutoMapper</a></li>
<li>Getting-started æ–‡æ¡£ <a href="https://automapper.readthedocs.io/en/latest/Getting-started.html#what-is-automapper" target="_blank" rel="noopener noreferrer">https://automapper.readthedocs.io/en/latest/Getting-started.html#what-is-automapper</a></li>
</ul>
]]></content>
    <published>2020-04-15T17:09:07.000Z</published>
  </entry>
  <entry>
    <title type="html">IdentityServer4</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/identityserver4.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/identityserver4.html"/>
    <updated>2022-06-02T11:44:24.000Z</updated>
    <content type="html"><![CDATA[<h1 id="identityserver4" tabindex="-1"> IdentityServer4</h1>
<h2 id="å†™çš„ä¸€äº›identityserver4çš„ç¤ºä¾‹" tabindex="-1"> å†™çš„ä¸€äº›IdentityServer4çš„ç¤ºä¾‹</h2>
<p>IdentityServer4 å®ç°å•ç‚¹ç™»å½•æˆæƒtokenéªŒè¯</p>
<h2 id="æºç " tabindex="-1"> æºç </h2>
<p>ä»£ç æ‰˜ç®¡åœ¨GitHubä¸Š <a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-identityserver4" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-identityserver4</a></p>
<h2 id="å‚è€ƒ" tabindex="-1"> å‚è€ƒ</h2>
<ul>
<li><a href="https://www.cnblogs.com/edisonchou/p/identityserver4_foundation_and_quickstart_01.html" target="_blank" rel="noopener noreferrer">.NET Coreå¾®æœåŠ¡ä¹‹åŸºäºIdentityServerå»ºç«‹æˆæƒä¸éªŒè¯æœåŠ¡</a></li>
</ul>
]]></content>
    <published>2020-04-15T17:09:07.000Z</published>
  </entry>
  <entry>
    <title type="html">ImCore å³æ—¶é€šè®¯</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/imcore-chat.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/imcore-chat.html"/>
    <updated>2022-06-02T11:44:24.000Z</updated>
    <content type="html"><![CDATA[<h1 id="imcore-å³æ—¶é€šè®¯" tabindex="-1"> ImCore å³æ—¶é€šè®¯</h1>
<h2 id="ç®€ä»‹" tabindex="-1"> ç®€ä»‹</h2>
<p>åˆ©ç”¨ webSocket åè®®å®ç°ç®€æ˜“ã€é«˜æ€§èƒ½ã€é›†ç¾¤å³æ—¶é€šè®¯ç»„ä»¶ï¼Œæ”¯æŒç‚¹å¯¹ç‚¹é€šè®¯ã€ç¾¤èŠé€šè®¯ã€ä¸Šçº¿ä¸‹çº¿äº‹ä»¶æ¶ˆæ¯ç­‰ä¼—å¤šå®ç”¨æ€§åŠŸèƒ½ã€‚</p>
<h2 id="å¼€æºåœ°å€" tabindex="-1"> å¼€æºåœ°å€</h2>
<p><a href="https://github.com/2881099/im" target="_blank" rel="noopener noreferrer">https://github.com/2881099/im</a></p>
<h2 id="ç¤ºä¾‹" tabindex="-1"> ç¤ºä¾‹</h2>
<p><a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/dotnet-core-im" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/dotnet-core-im</a></p>
<h2 id="æ¼”ç¤ºæ•ˆæœ" tabindex="-1"> æ¼”ç¤ºæ•ˆæœ</h2>
<p><img src="https://ae01.alicdn.com/kf/Hf8b31f05dbb94f8da565fce29f78aa78Y.png" alt="https://ae01.alicdn.com/kf/Hf8b31f05dbb94f8da565fce29f78aa78Y.png" loading="lazy"></p>
]]></content>
    <published>2020-04-15T17:09:07.000Z</published>
  </entry>
  <entry>
    <title type="html">è®¤è¯é‰´æƒçŠ¶æ€</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/identityserver4-jwt.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/identityserver4-jwt.html"/>
    <updated>2022-06-02T11:44:24.000Z</updated>
    <content type="html"><![CDATA[<h1 id="è®¤è¯é‰´æƒçŠ¶æ€" tabindex="-1"> è®¤è¯é‰´æƒçŠ¶æ€</h1>
<p>è®¤è¯åˆ†ä¸ºä»¥ä¸‹æƒ…å†µï¼šå½“å‰è§’è‰²ä¸ºç®¡ç†å‘˜ï¼Œè¯¥åˆ†ç»„é…ç½®äº†æƒé™ï¼Œè¯¥åˆ†ç»„æœªåˆ†é…æŸä¸€æ–¹æ³•çš„æƒé™.</p>
<p>çŠ¶æ€ç ï¼ˆStatusCode):401 UnAuthorized</p>
<table>
<thead>
<tr>
<th>StatusCode</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>401 UnAuthorized</td>
<td>æœªæˆæƒã€æ— æƒé™ã€æœªç™»å½•</td>
</tr>
<tr>
<td>422  UNPROCESSABLE ENTITY</td>
<td>ä»¤ç‰Œå¤±æ•ˆ</td>
</tr>
<tr>
<td>200</td>
<td>è®¿é—®æ­£å¸¸</td>
</tr>
</tbody>
</table>
<ol>
<li>æœªç™»å½•ï¼Œä¸å¸¦access_tokenï¼Œç›´æ¥è¯·æ±‚éœ€è¦ç™»å½•çš„æ¥å£ã€ç®¡ç†å‘˜æ¥å£ç»“æœä¸€æ ·ã€‚</li>
</ol>
<p>è¿”å›ç»“æœåº”ä¸ºï¼šçŠ¶æ€ç ï¼š401 UNAUTHORIZED</p>
<div><pre><code>{
    "error_code": 10000,
    "msg": "è®¤è¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¯·æ±‚å¤´æˆ–è€…é‡æ–°ç™»é™†",
    "request": "GET  /cms/admin/authority"
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><ol start="2">
<li>æºå¸¦access_tokenï¼Œä½†éè¶…çº§ç®¡ç†å‘˜(adminå­—æ®µä¸º2),è®¿é—®çš„æ–¹æ³•ä¸ºè§’è‰²ä¸ºè¶…ç®¡æ‰æœ‰æƒé™çš„æ–¹æ³•ã€‚</li>
</ol>
<div><pre><code>[LinCmsAuthorize(Roles = LinGroup.Administrator)]
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>è¿”å›ç»“æœåº”ä¸ºï¼šï¼šçŠ¶æ€ç ï¼š401 UNAUTHORIZED</p>
<div><pre><code>{
    "error_code": 10000,
    "msg": "åªæœ‰è¶…çº§ç®¡ç†å‘˜å¯æ“ä½œ",
    "request": "GET  /cms/admin/authority"
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><ol start="3">
<li>æºå¸¦access_token ï¼Œè®¿é—®åªéœ€è¦ç™»å½•çš„æ¥å£ï¼ˆ/cms/user/authsï¼‰</li>
</ol>
<p>æ§åˆ¶å™¨æˆ–æ–¹æ³•ä¸ŠæŒ‡å®š <strong>[Authorize]</strong> æˆ– <strong>[LinCmsAuthorize]</strong> ç‰¹æ€§æ ‡ç­¾æ—¶ï¼Œå¿…é¡»ç™»å½•æ‰èƒ½è®¿é—®ï¼Œå¦åˆ™è¿”å›ç¬¬ä¸€ç§ç»“æœã€‚</p>
<p>è¿”å›ç»“æœåº”ä¸ºï¼šçŠ¶æ€ç ï¼š200</p>
<div><pre><code>{
    "active": 1,
    "admin": 1,
    "auths": [
        {
            "ä¿¡æ¯": [
                {
                    "auth": "æŸ¥çœ‹linçš„ä¿¡æ¯",
                    "module": "ä¿¡æ¯"
                }
            ]
        }
    ],
    "avatar": null,
    "create_time": 1564372600000,
    "email": "acs@acs.com",
    "group_id": 54,
    "id": 112,
    "nickname": "alan",
    "update_time": 1564487059000
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><ol start="4">
<li>æºå¸¦access_tokenï¼Œä½†æ­¤ç”¨æˆ·æ— è®¿é—®æ­¤æ–¹æ³•çš„æƒé™ï¼ˆå³è¯¥ç”¨æˆ·çš„ç»„åˆ«æœªé…ç½®æ­¤æƒé™ï¼‰ã€‚</li>
</ol>
<p>è¿”å›ç»“æœåº”ä¸ºï¼šçŠ¶æ€ç ï¼š401 UNAUTHORIZED</p>
<div><pre><code>{
    "error_code": 10000,
    "msg": "æƒé™ä¸å¤Ÿï¼Œè¯·è”ç³»è¶…çº§ç®¡ç†å‘˜è·å¾—æƒé™",
    "request": "GET  /cms/log/search"
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><ol start="5">
<li>æºå¸¦è¿‡æœŸçš„access_tokenå€¼
è¿”å›ç»“æœåº”ä¸ºï¼šçŠ¶æ€ç ï¼š401 UNAUTHORIZED</li>
</ol>
<div><pre><code>{
    "error_code": 10050,
    "msg": "ä»¤ç‰Œè¿‡æœŸ",
    "request": "GET  /cms/admin/users"
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><ol start="6">
<li>æºå¸¦ä¸æ­£å¸¸çš„access_tokenå€¼ï¼Œåå°æ— æ³•ä¸‹æ­£å¸¸è§£æå‡ºç”¨æˆ·ä¿¡æ¯
è¿”å›ç»“æœåº”ä¸ºï¼šçŠ¶æ€ç ï¼š422 UNPROCESSABLE ENTITY</li>
</ol>
<div><pre><code>{
    "error_code": 10040,
    "msg": "ä»¤ç‰Œå¤±æ•ˆ",
    "request": "GET  /cms/admin/users"
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div>]]></content>
    <published>2020-04-15T17:09:07.000Z</published>
  </entry>
  <entry>
    <title type="html">äº§å“è®¾è®¡</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/production-design.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/production-design.html"/>
    <updated>2022-06-02T11:44:24.000Z</updated>
    <content type="html"><![CDATA[<h1 id="äº§å“è®¾è®¡" tabindex="-1"> äº§å“è®¾è®¡</h1>
<h2 id="äº§å“è®¾è®¡-è¯„è®ºæ¨¡å—çš„è®¾è®¡" tabindex="-1"> äº§å“è®¾è®¡-è¯„è®ºæ¨¡å—çš„è®¾è®¡</h2>
<h3 id="_1-ä¸»é¢˜å¼" tabindex="-1"> 1.ä¸»é¢˜å¼</h3>
<p>å°†è¯„è®ºåˆ†ä¸ºäºŒçº§ï¼Œç¬¬ä¸€çº§é‡‡ç”¨æ—¶é—´å€’åºï¼ŒäºŒçº§æŒ‰ç…§æ—¶é—´æ­£åºï¼Œæœ‰åŠ©äºç†è§£ä¸Šä¸‹æ–‡å…³ç³»ã€‚</p>
<p>ç”¨æˆ·æ“ä½œï¼š</p>
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-0"><label for="task-item-0"> è¯„è®ºéšç¬”(å†…å®¹æ”¯æŒè¶…é“¾æ¥ã€emoji)</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-1"><label for="task-item-1">  ç‚¹èµè¯„è®º/å–æ¶ˆç‚¹èµ</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-2"><label for="task-item-2">  å›å¤è¯„è®º</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-3"><label for="task-item-3">  åˆ é™¤è‡ªå·±çš„è¯„è®º</label></li>
</ul>
<p>è¿è¥æ“ä½œï¼š</p>
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-4"><label for="task-item-4">  å®¡æ ¸é€šè¿‡/æ‹‰é»‘è¯„è®º</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-5"><label for="task-item-5">  åˆ é™¤ä»»ä½•è¯„è®º</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-6"><label for="task-item-6">  æ‹‰é»‘åçš„æ˜¾ç¤ºé€»è¾‘ã€‚ï¼ˆä¿ç•™å½“å‰åŒºå—ã€æ˜¾ç¤ºå†…å®¹ä¸ºï¼šè¯¥è¯„è®ºå› è¿è§„è¢«æ‹‰é»‘ï¼‰</label></li>
<li>åˆ é™¤ï¼šï¼ˆå¦‚æœæ˜¯äºŒçº§è¯„è®ºï¼Œç›´æ¥è½¯åˆ é™¤ï¼Œå¦‚æœæ˜¯ä¸€çº§è¯„è®ºï¼Œè½¯åˆ é™¤å­è¯„è®ºå’Œå½“å‰è¯„è®º-éœ€è¦æå‰æé†’ç”¨æˆ·ï¼‰
äº¤äº’è®¾è®¡</li>
<li>è¯„è®ºçš„å­—æ•°é•¿åº¦ï¼ˆ500ï¼‰ã€emojiã€‚</li>
<li>ç‚¹èµäº¤äº’-åŠ¨ç”»ã€æ¶ˆæ¯é€šçŸ¥/æ¨é€</li>
<li>è¯„è®ºåŒºåŸŸå…ƒç´ ï¼Œéœ€è¦æœ‰æ˜ç¡®å¯ç‚¹å‡»çš„åŒºåŸŸï¼Œä¼šè·³è½¬åˆ°å“ªä¸ªåœ°æ–¹ã€‚</li>
</ul>
<h3 id="ä¼˜åŒ–" tabindex="-1"> ä¼˜åŒ–</h3>
<ul>
<li>ç²¾é€‰è¯„è®º</li>
</ul>
<h2 id="æ’è¡Œæ¦œè§è§£" tabindex="-1"> æ’è¡Œæ¦œè§è§£</h2>
<p>æ’è¡Œæ¦œä»å¿ƒç†å­¦ä¸Šåˆ†æï¼Œä¸»è¦ä»å››ä¸ªæ–¹é¢å½±å“ç€æ‚¨ï¼š<strong>å¯»æ‰¾æƒå¨ ã€å‚ä¸æ¯”è¾ƒ ã€å…³æ³¨ä¸»æµ ã€è‡ªæˆ‘ç¡®è®¤ã€‚</strong></p>
<p>å¦‚ä½•è®¾è®¡ä¸€ä¸ªç®€å•çš„æ’è¡Œæ¦œå‘¢ã€‚ã€‚</p>
<p>åœ¨ä¸€ä¸ªåšå®¢éšç¬”ä¸­ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ª3å¤©ã€ä¸ƒå¤©ï¼ˆå‘¨æ¦œï¼‰ã€30å¤©ï¼ˆæœˆæ¦œï¼‰ã€å…¨éƒ¨çš„æ¦œå•ã€‚ä»¥æµè§ˆé‡ï¼ˆæƒé‡1ï¼‰ã€ç‚¹èµé‡ï¼ˆ20ï¼‰ã€è¯„è®ºé‡ï¼ˆ30)ã€‚æƒé‡å¯è‡ªå·±å®šä¹‰ã€‚</p>
<p>1.é»˜è®¤å–æœ€æ–°çš„éšç¬”</p>
<p>å‰å°ä¼ create_timeæ—¶ï¼Œä½¿ç”¨å¦‚ä¸‹sql</p>
<div><pre><code>select * from `blog_article` order by create_time desc;
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>2.ä¼ æ’åºæ–¹å¼ä¸ºæœ€è¿‘nå¤©çš„çƒ­æ¦œæ—¶ã€‚</p>
<p>å‚æ•°ï¼šTHREE_DAYS_HOTTESTï¼ˆä¸‰å¤©ï¼‰ã€WEEKLY_HOTTEST(ä¸ƒå¤©ï¼‰ã€MONTHLY_HOTTESTï¼ˆä¸€ä¸ªæœˆï¼‰ã€HOTTESTï¼ˆå…¨éƒ¨ï¼‰</p>
<p>mysql æŸ¥è¯¢å½“å‰æ—¥æœŸæ—¶é—´å‰ä¸‰å¤©æ•°æ®</p>
<div><pre><code>select date_sub(now() ,interval 3 day);
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æ ¹æ®æƒé‡æŸ¥è¯¢</p>
<div><pre><code>select * from `blog_article` a 
where a.`create_time`>(select date_sub(now() ,interval 3 day))
order by (a.`view_hits` + a.`likes_quantity` * 20 + a.`comment_quantity` * 30) DESC, a.`create_time` DESC

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="åˆ›ä½œè€…ä¸­å¿ƒ" tabindex="-1"> åˆ›ä½œè€…ä¸­å¿ƒ</h2>
<h3 id="ç”¨æˆ·ä¸»é¡µ" tabindex="-1"> ç”¨æˆ·ä¸»é¡µ</h3>
<p>ç»Ÿè®¡å€¼ï¼šé˜…è¯»æ€»æ•°ï¼Œç‚¹èµæ€»æ•°ï¼Œå…³æ³¨è€…æ€»æ•°</p>
<h3 id="ä¸ªäººè®¾ç½®" tabindex="-1"> ä¸ªäººè®¾ç½®</h3>
<p>ç”¨æˆ·ä¿¡æ¯ã€å¯†ç ä¿®æ”¹</p>
<h2 id="æ›´å¤šå‚è€ƒ" tabindex="-1"> æ›´å¤šå‚è€ƒ</h2>
<ul>
<li><a href="http://www.woshipm.com/pd/1255548.html" target="_blank" rel="noopener noreferrer">ä¸‡å­—é•¿æ–‡æ·±åº¦åˆ†æï¼šäº§å“æ’è¡Œæ¦œçš„è®¾è®¡å’Œç©æ³•</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/52322777" target="_blank" rel="noopener noreferrer">æƒ³çŸ¥é“è°æ˜¯ä½ çš„æœ€ä½³ç”¨æˆ·ï¼ŸåŸºäºRediså®ç°æ’è¡Œæ¦œå‘¨æœŸæ¦œä¸æœ€è¿‘NæœŸæ¦œ</a></li>
</ul>
]]></content>
    <published>2020-04-15T17:09:07.000Z</published>
  </entry>
  <entry>
    <title type="html">å…¨å±€æ•æ„Ÿè¯å¤„ç†</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/stopwords.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/stopwords.html"/>
    <updated>2022-06-02T11:44:24.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å…¨å±€æ•æ„Ÿè¯å¤„ç†" tabindex="-1"> å…¨å±€æ•æ„Ÿè¯å¤„ç†</h1>
<p>åŸºäºToolGood.Wordsç±»åº“ï¼Œé…åˆæ•æ„Ÿå­—çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå†™çš„APIæ¥å£ã€‚</p>
<ul>
<li><a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-stopwords" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-stopwords</a></li>
</ul>
<p>ä¸€å…±äºŒç§æ–¹å¼</p>
<h2 id="_1-toolgood-words" tabindex="-1"> 1.ToolGood.Words</h2>
<p>ç±»åº“é…åˆæ•æ„Ÿåº“</p>
<ul>
<li><a href="https://github.com/toolgood/ToolGood.Words" target="_blank" rel="noopener noreferrer">ToolGood.Words</a></li>
</ul>
<p>ç®€å•ç”¨æ³•</p>
<div><pre><code>[Fact]
public void IssuesTest_17()
{
    var illegalWordsSearch = new IllegalWordsSearch();
    string s = "ä¸­å›½|zgäºº|abc";
    illegalWordsSearch.SetKeywords(s.Split('|'));
    var str = illegalWordsSearch.Replace("æˆ‘æ˜¯ä¸­ç¾å›½äººå‰å®³ä¸­å›½å®Œç¾ï½ï½‚ï½ƒddbå¥½çš„", '*');

    Assert.Equal("æˆ‘æ˜¯ä¸­ç¾å›½äººå‰å®³**å®Œç¾***ddbå¥½çš„", str);
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><p>é…åˆæ•æ„Ÿåº“æ–‡æœ¬æ–‡ä»¶ï¼Œå†™çš„å·¥å…·ç±»</p>
<p>äºŒä¸ªæ–‡ä»¶æ”¾åˆ°wwwroot/_Illegalç›®å½•ä¸‹ï¼Œé€šè¿‡ReplaceStopWordsæ–¹æ³•è°ƒç”¨å³å¯å¯¹</p>
<ul>
<li><a href="https://github.com/toolgood/ToolGood.Words/blob/master/csharp/ToolGood.Words.Test/_Illegal/IllegalKeywords.txt" target="_blank" rel="noopener noreferrer">https://github.com/toolgood/ToolGood.Words/blob/master/csharp/ToolGood.Words.Test/_Illegal/IllegalKeywords.txt</a></li>
<li><a href="https://github.com/toolgood/ToolGood.Words/blob/master/csharp/ToolGood.Words.Test/_Illegal/IllegalUrls.txt" target="_blank" rel="noopener noreferrer">https://github.com/toolgood/ToolGood.Words/blob/master/csharp/ToolGood.Words.Test/_Illegal/IllegalUrls.txt</a></li>
</ul>
<div><pre><code>public class ToolGoodUtils
{
    //æ•æ„Ÿåº“åªè¦è¿™äºŒä¸ªæ–‡ä»¶å­˜åœ¨å³å¯
    //æœ¬åœ°æ•æ„Ÿåº“ç¼“å­˜-https://github.com/toolgood/ToolGood.Words/tree/master/csharp/ToolGood.Words.Test/_Illegal
    //å› ä¸ºéœ€è¦ä¸Šä¼ è‡³githubå¹¶åŒæ­¥gitee,å®‰å…¨èµ·è§ï¼Œæ‰€ä»¥æœªä¸Šä¼ è‡³gitï¼Œéœ€è¦è‡ªè¡Œä¸‹è½½å¹¶å¤åˆ¶
    private const string KeywordsPath = "wwwroot/_Illegal/IllegalKeywords.txt";
    private const string UrlsPath = "wwwroot/_Illegal/IllegalUrls.txt";

    private const string InfoPath = "wwwroot/_Illegal/IllegalInfo.txt";
    private const string BitPath = "wwwroot/_Illegal/IllegalBit.iws";

    private static IllegalWordsSearch _search;
    /// &lt;summary>
    /// æœ¬åœ°æ•æ„Ÿåº“,æ–‡ä»¶ä¿®æ”¹åï¼Œé‡æ–°åˆ›å»ºç¼“å­˜Bit
    /// &lt;/summary>
    /// &lt;returns>&lt;/returns>
    public static IllegalWordsSearch GetIllegalWordsSearch()
    {
        if (_search == null)
        {
            string ipath = Path.GetFullPath(InfoPath);
            if (File.Exists(ipath) == false)
            {
                _search = CreateIllegalWordsSearch();
            }
            else
            {
                var texts = File.ReadAllText(ipath).Split('|');
                if (new FileInfo(Path.GetFullPath(KeywordsPath)).LastWriteTime.ToString("yyyy-MM-dd HH:mm:ss") !=
                    texts[0] ||
                    new FileInfo(Path.GetFullPath(UrlsPath)).LastWriteTime.ToString("yyyy-MM-dd HH:mm:ss") !=
                    texts[1]
                )
                {
                    _search = CreateIllegalWordsSearch();
                }
                else
                {
                    var s = new IllegalWordsSearch();
                    s.Load(Path.GetFullPath(BitPath));
                    _search = s;
                }
            }
        }
        return _search;
    }

    private static IllegalWordsSearch CreateIllegalWordsSearch()
    {
        string[] words1 = File.ReadAllLines(Path.GetFullPath(KeywordsPath), Encoding.UTF8);
        string[] words2 = File.ReadAllLines(Path.GetFullPath(UrlsPath), Encoding.UTF8);
        var words = new List&lt;string>();
        foreach (var item in words1)
        {
            words.Add(item.Trim());
        }
        foreach (var item in words2)
        {
            words.Add(item.Trim());
        }

        var search = new IllegalWordsSearch();
        search.SetKeywords(words);

        search.Save(Path.GetFullPath(BitPath));

        var text = new FileInfo(Path.GetFullPath(KeywordsPath)).LastWriteTime.ToString("yyyy-MM-dd HH:mm:ss") + "|"+ new FileInfo(Path.GetFullPath(UrlsPath)).LastWriteTime.ToString("yyyy-MM-dd HH:mm:ss");
        File.WriteAllText(Path.GetFullPath(InfoPath), text);

        return search;
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br></div></div><h2 id="_2-å¾ªç¯ä½¿ç”¨replace" tabindex="-1"> 2. å¾ªç¯ä½¿ç”¨Replace</h2>
<p>æ–¹æ¡ˆï¼šé€šè¿‡ç»´æŠ¤æ•æ„Ÿåº“ï¼Œå¾ªç¯replace
å¤§ä½¬åˆ†äº«ç»™æˆ‘çš„ï¼Œç¨å¾®æ”¹æˆäº†ä»æ–‡ä»¶ä¸­è·å–æ•æ„Ÿå­—ã€‚</p>
<div><pre><code>public static class StopWords
{

    static readonly ConcurrentDictionary&lt;string, bool> FunNlpDataSensitive = new ConcurrentDictionary&lt;string, bool>();
    static readonly ConcurrentDictionary&lt;int, string> ReplaceNewValue = new ConcurrentDictionary&lt;int, string>();

    private const string KeywordsPath = "wwwroot/_Illegal/IllegalKeywords.txt";
    private const string UrlsPath = "wwwroot/_Illegal/IllegalUrls.txt";


    static StopWords()
    {
        LoadDataFromFile();
    }

    public static void LoadDataFromFile()
    {
        string words1 = File.ReadAllText(Path.GetFullPath(KeywordsPath), Encoding.UTF8);
        string words2 = File.ReadAllText(Path.GetFullPath(UrlsPath), Encoding.UTF8);
        LoadDataFromText(words1);
        LoadDataFromText(words2);
    }


    public static void LoadDataFromText(string text)
    {
        int oldcount = FunNlpDataSensitive.Count;
        foreach (string wd in text.Split('\n'))
        {
            string keykey = wd.Trim().Trim('\r', '\n').Trim();
            if (string.IsNullOrEmpty(keykey)) continue;
            FunNlpDataSensitive.TryAdd(keykey, true);
            if (ReplaceNewValue.ContainsKey(keykey.Length) == false)
                ReplaceNewValue.TryAdd(keykey.Length, "".PadRight(keykey.Length, '*'));
        }
        Console.WriteLine($"æ•æ„Ÿè¯åŠ è½½å®Œæ¯•ï¼Œå¢åŠ æ•°é‡ï¼š{FunNlpDataSensitive.Count - oldcount}");
    }


    /// &lt;summary>
    /// æ›¿æ¢æ‰€æœ‰æ•æ„Ÿè¯ä¸º *
    /// &lt;/summary>
    /// &lt;param name="that">&lt;/param>
    /// &lt;returns>&lt;/returns>
    public static string ReplaceStopWords(this string that)
    {
        foreach (var wd in FunNlpDataSensitive.Keys)
            that = that.Replace(wd, ReplaceNewValue.TryGetValue(wd.Length, out var tryval) ? tryval : "".PadRight(wd.Length, '*'));
        return that;
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br></div></div><h2 id="freesqlå…¨å±€å¤„ç†æ•æ„Ÿè¯" tabindex="-1"> FreeSqlå…¨å±€å¤„ç†æ•æ„Ÿè¯</h2>
<p>ä½¿ç”¨FreeSqlè¿™ä¸ªORMæ—¶ï¼Œå…¨å±€å¤„ç†stringç±»å‹çš„å€¼ï¼Œè¿›è¡Œæ•æ„Ÿè¯å¤„ç†ã€‚ä»£ç åœ¨StartUp.csçš„æ„é€ å‡½æ•°ä¸­ã€‚</p>
<div><pre><code>//æ•æ„Ÿè¯å¤„ç†
IllegalWordsSearch illegalWords = ToolGoodUtils.GetIllegalWordsSearch();

Fsql.Aop.AuditValue += (s, e) =>
{
    if (e.Column.CsType == typeof(string) &amp;&amp; e.Value != null)
    {
        string oldVal = (string)e.Value;
        string newVal = illegalWords.Replace(oldVal);
        //ç¬¬äºŒç§å¤„ç†æ•æ„Ÿè¯çš„æ–¹å¼
        //string newVal = oldVal.ReplaceStopWords();
        if (newVal != oldVal)
        {
            e.Value = newVal;
        }
    }
};
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div>]]></content>
    <published>2020-04-15T17:09:07.000Z</published>
  </entry>
  <entry>
    <title type="html">Newtonsoft.JsonåŸºç¡€é—®é¢˜</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/newtonsoft-json-question.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/newtonsoft-json-question.html"/>
    <updated>2020-04-15T16:23:14.000Z</updated>
    <content type="html"><![CDATA[<h1 id="newtonsoft-jsonåŸºç¡€é—®é¢˜" tabindex="-1"> Newtonsoft.JsonåŸºç¡€é—®é¢˜</h1>
<p>å®ƒæ˜¯.NETä¸‹çš„ä¸€ä¸ªåºåˆ—åŒ–ã€ååºåŒ–çš„åŸºç¡€ç±»åº“ï¼Œæ›´åŸºç¡€çš„ç”¨æ³•è¿˜æ˜¯çœ‹åˆ«äººçš„å§ï¼Œè¿™é‡Œåªè¯´ä¸€äº›é‡åˆ°çš„é—®é¢˜ã€‚</p>
<h2 id="è®¾ç½®ä¸‹åˆ’çº¿" tabindex="-1"> è®¾ç½®ä¸‹åˆ’çº¿</h2>
<p>ContractResolver  é»˜è®¤æ˜¯å°é©¼å³°ï¼Œæˆ‘æƒ³æ”¹æˆä¸‹åˆ’çº¿æ–¹å¼ï¼Œé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œdictionaryçš„é”®æœªæ ¼å¼åŒ–</p>
<p>in controller åˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨</p>
<div><pre><code><span>[</span><span><span>HttpGet</span><span><span>(</span><span>"getDictionary"</span><span>)</span></span></span><span>]</span>
<span>public</span> <span>IDictionary<span>&lt;</span><span>string</span><span>,</span> <span>string</span><span>></span></span> <span>GetDictionary</span><span>(</span><span>)</span>
<span>{</span>
    <span>IDictionary<span>&lt;</span><span>string</span><span>,</span> <span>string</span><span>></span></span> dics <span>=</span> <span>new</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> <span>string</span><span>></span></span><span>(</span><span>)</span><span>;</span>

    dics<span>.</span><span>Add</span><span>(</span><span>"Key"</span><span>,</span> <span>"Value"</span><span>)</span><span>;</span>
    dics<span>.</span><span>Add</span><span>(</span><span>"KeyTest"</span><span>,</span> <span>"Value_Test"</span><span>)</span><span>;</span>
    <span>return</span> dics<span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><p>In Startup.cs</p>
<div><pre><code>services
<span>.</span><span>AddMvc</span><span>(</span><span>)</span>
<span>.</span><span>SetCompatibilityVersion</span><span>(</span>CompatibilityVersion<span>.</span>Version_2_2<span>)</span>
<span>.</span><span>AddJsonOptions</span><span>(</span>opt <span>=></span>
<span>{</span>
    
    <span>// è®¾ç½®ä¸‹åˆ’çº¿æ–¹å¼ï¼Œé¦–å­—æ¯æ˜¯å°å†™</span>
    opt<span>.</span>SerializerSettings<span>.</span>ContractResolver <span>=</span> <span>new</span> <span>DefaultContractResolver</span><span>(</span><span>)</span>
    <span>{</span>
        NamingStrategy <span>=</span> <span>new</span> <span>SnakeCaseNamingStrategy</span><span>(</span><span>)</span>
    <span>}</span><span>;</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><p>æ­¤æ—¶è¿è¡Œåï¼Œå¾—åˆ°çš„æ˜¯Key,è€Œä¸æ˜¯keyï¼Œæˆ‘æƒ³ä»–çš„é”®éƒ½å˜æˆä¸‹åˆ’çº¿æ–¹å¼çš„å°å†™</p>
<div><pre><code><span>{</span>
  <span>"Key"</span><span>:</span> <span>"Value"</span><span>,</span>
  <span>"KeyTest"</span><span>:</span> <span>"Value_Test"</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>å…¶ä»–æµ‹è¯•ï¼Œå¢åŠ å¤šçº§ï¼Œæµ‹è¯•æ­£å¸¸</p>
<div><pre><code><span>[</span><span><span>HttpGet</span><span><span>(</span><span>"get"</span><span>)</span></span></span><span>]</span>
<span>public</span> <span><span>dynamic</span></span> <span>Get</span><span>(</span><span>)</span>
<span>{</span>
 <span>return</span> <span>new</span> <span>{</span>
            Content <span>=</span> <span>new</span> <span>{</span>
                Url<span>=</span>Request<span>.</span>Path<span>.</span>Value<span>,</span>
                NewUrlTest<span>=</span><span>"test in new url test"</span>
            <span>}</span>
        <span>}</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><p>æ­¤æ—¶è¿è¡Œåï¼Œæ»¡è¶³è¦æ±‚ï¼Œå¤šå±‚ç»“æ„ä¹Ÿä¸ä¼šå½±å“</p>
<div><pre><code><span>{</span>
  <span>"content"</span><span>:</span> <span>{</span>
    <span>"url"</span><span>:</span> <span>"/test/get"</span><span>,</span>
    <span>"new_url_test"</span><span>:</span> <span>"test in new url test"</span>
  <span>}</span>
<span>}</span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>çœ‹äº†Newtonsoft.Jsonçš„githubï¼Œå¹¶åœ¨in this repository æœç´¢Dictionaryï¼Œçœ‹issuesä¸­çš„é…ç½®é¡¹å¦‚ä¸‹å³å¯æ»¡è¶³dictionaryçš„é”®ä¹Ÿè½¬å°å†™,
ProcessDictionaryKeys åŠŸèƒ½ï¼šA flag indicating whether dictionary keys should be processed. Defaults to false.</p>
<div><pre><code>services
<span>.</span><span>AddMvc</span><span>(</span><span>)</span>
<span>.</span><span>SetCompatibilityVersion</span><span>(</span>CompatibilityVersion<span>.</span>Version_2_2<span>)</span>
<span>.</span><span>AddJsonOptions</span><span>(</span>opt <span>=></span>
<span>{</span>
    
    <span>// è®¾ç½®ä¸‹åˆ’çº¿æ–¹å¼ï¼Œé¦–å­—æ¯æ˜¯å°å†™</span>
    opt<span>.</span>SerializerSettings<span>.</span>ContractResolver <span>=</span> <span>new</span> <span>DefaultContractResolver</span><span>(</span><span>)</span>
    <span>{</span>
        NamingStrategy <span>=</span> <span>new</span> <span>SnakeCaseNamingStrategy</span>
        <span>{</span>
            ProcessDictionaryKeys <span>=</span> <span>true</span>
        <span>}</span>
    <span>}</span><span>;</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><div><pre><code><span>{</span>
  <span>"key"</span><span>:</span> <span>"Value"</span><span>,</span>
  <span>"key_test"</span><span>:</span> <span>"Value_Test"</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="å®ç°æ—¶é—´æˆ³" tabindex="-1"> å®ç°æ—¶é—´æˆ³</h2>
<p>å‰å°è¦çš„æ ¼å¼ä¸º  <strong>1562904163734</strong>,åªæœ‰ä¸€ä¸ªæ•°å­—ï¼Œæˆ‘æœç´¢äº†ä¸€ä¸‹ï¼Œä¹Ÿæ²¡æ‰¾åˆ°ç›¸å…³çš„æ–‡æ¡£ï¼Œæœ¬èº«è¿™ä¸ªç±»åº“æœ‰ä¸€äº›æ—¶é—´æˆ³ï¼Œä¸è¿‡ä»–ä»¬éƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚/Date(1562904163734)/,å¥½åƒç±»ä¼¼è¿™æ ·ï¼Œä»–å¥½åƒåœ¨é€—æˆ‘ï¼Œä¸ºå•¥ä»–è¦åŠ Dateï¼Œæ€•æ˜¯æœ‰æ¯’å§ã€‚çœ‹åˆ°
ä»–æœ‰Converterså±æ€§å¯é…ç½®ï¼Œå³é…ç½®è‡ªå·±çš„åºåˆ—åŒ–è¿”å›æ ¼å¼ã€‚</p>
<div><pre><code>services<span>.</span><span>AddMvc</span><span>(</span><span>)</span>
<span>.</span><span>SetCompatibilityVersion</span><span>(</span>CompatibilityVersion<span>.</span>Version_2_2<span>)</span>
<span>.</span><span>AddJsonOptions</span><span>(</span>opt <span>=></span>
<span>{</span>
    <span>//opt.SerializerSettings.DateFormatString = "yyyy-MM-dd HH:MM:ss";</span>
    <span>//è®¾ç½®æ—¶é—´æˆ³æ ¼å¼</span>
    opt<span>.</span>SerializerSettings<span>.</span>Converters <span>=</span> <span>new</span> <span>List<span>&lt;</span>JsonConverter<span>></span></span><span>(</span><span>)</span>
    <span>{</span>
        <span>new</span> <span>LinCmsTimeConverter</span><span>(</span><span>)</span>
    <span>}</span><span>;</span>
<span>}</span><span>)</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>è¿™é‡Œçš„æ—¶é—´æˆ³æ˜¯æ¯«ç§’çº§åˆ«</p>
<div><pre><code><span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
<span>/// é…åˆLinCMSä¸­çš„æ—¶é—´æˆ³ åå°åªè¿”å› 1562904163734</span>
<span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
<span>public</span> <span>class</span> <span>LinCmsTimeConverter</span> <span>:</span> <span><span>DateTimeConverterBase</span></span>
<span>{</span>
    <span>public</span> <span>override</span> <span><span>void</span></span> <span>WriteJson</span><span>(</span><span>JsonWriter</span> writer<span>,</span> <span><span>object</span></span> <span>value</span><span>,</span> <span>JsonSerializer</span> serializer<span>)</span>
    <span>{</span>
        <span><span>double</span></span> javaScriptTicks <span>=</span> <span>0</span><span>;</span>
        <span>if</span> <span>(</span><span>value</span> <span>is</span> <span>DateTime</span> dateTime<span>)</span>
        <span>{</span>
            javaScriptTicks <span>=</span> <span>ConvertDateTimeInt</span><span>(</span>dateTime<span>)</span><span>;</span>
        <span>}</span>
        <span>else</span>
        <span>{</span>
            <span>if</span> <span>(</span><span>!</span><span>(</span><span>value</span> <span>is</span> <span>DateTimeOffset</span> dateTimeOffset<span>)</span><span>)</span>
                <span>throw</span> <span>new</span> <span>JsonSerializationException</span><span>(</span><span>"Expected date object value."</span><span>)</span><span>;</span>
            javaScriptTicks <span>=</span> <span>ConvertDateTimeInt</span><span>(</span>dateTimeOffset<span>.</span><span>ToUniversalTime</span><span>(</span><span>)</span><span>.</span>UtcDateTime<span>)</span><span>;</span>

        <span>}</span>
        writer<span>.</span><span>WriteValue</span><span>(</span>javaScriptTicks<span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>override</span> <span><span>object</span></span> <span>ReadJson</span><span>(</span><span>JsonReader</span> reader<span>,</span> <span>Type</span> objectType<span>,</span> <span><span>object</span></span> existingValue<span>,</span> <span>JsonSerializer</span> serializer<span>)</span>
    <span>{</span>
        <span>return</span> <span>ConvertIntDateTime</span><span>(</span><span>double</span><span>.</span><span>Parse</span><span>(</span>reader<span>.</span>Value<span>.</span><span>ToString</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span>
    <span>}</span>
    
    <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
    <span>/// æ—¥æœŸè½¬æ¢ä¸ºæ—¶é—´æˆ³ï¼ˆæ—¶é—´æˆ³å•ä½æ¯«ç§’ï¼‰</span>
    <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
    <span>/// <span><span><span>&lt;</span>param</span> <span>name</span><span><span>=</span><span>"</span>TimeStamp<span>"</span></span><span>></span></span><span><span><span>&lt;/</span>param</span><span>></span></span></span>
    <span>/// <span><span><span>&lt;</span>returns</span><span>></span></span><span><span><span>&lt;/</span>returns</span><span>></span></span> </span>
    <span>public</span> <span>static</span> <span>DateTime</span> <span>ConvertIntDateTime</span><span>(</span><span><span>double</span></span> milliseconds<span>)</span>
    <span>{</span>
        <span>return</span> <span>new</span> <span>DateTime</span><span>(</span><span>1970</span><span>,</span> <span>1</span><span>,</span> <span>1</span><span>)</span><span>.</span><span>AddMilliseconds</span><span>(</span>milliseconds<span>)</span><span>;</span>
    <span>}</span>


    <span>public</span> <span>static</span> <span><span>double</span></span> <span>ConvertDateTimeInt</span><span>(</span><span>DateTime</span> aDt<span>)</span>
    <span>{</span>
        <span>return</span> <span>(</span>aDt <span>-</span> <span>new</span> <span>DateTime</span><span>(</span><span>1970</span><span>,</span> <span>1</span><span>,</span> <span>1</span><span>)</span><span>)</span><span>.</span>TotalMilliseconds<span>;</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br></div></div><h2 id="å‚è€ƒ" tabindex="-1"> å‚è€ƒ</h2>
<ul>
<li><a href="https://github.com/JamesNK/Newtonsoft.Json/issues/2088" target="_blank" rel="noopener noreferrer">https://github.com/JamesNK/Newtonsoft.Json/issues/2088</a></li>
<li><a href="https://www.newtonsoft.com/json/help/html/P_Newtonsoft_Json_Serialization_NamingStrategy_ProcessDictionaryKeys.htm" target="_blank" rel="noopener noreferrer">https://www.newtonsoft.com/json/help/html/P_Newtonsoft_Json_Serialization_NamingStrategy_ProcessDictionaryKeys.htm</a></li>
<li><a href="https://blog.csdn.net/yw1688/article/details/38492583" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/yw1688/article/details/38492583</a></li>
<li><a href="https://www.jianshu.com/p/c53b1a2a121d" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/c53b1a2a121d</a></li>
</ul>
]]></content>
    <published>2020-04-15T16:23:14.000Z</published>
  </entry>
  <entry>
    <title type="html">About</title>
    <id>https://igeekfan.cn/igeekfan-docs/about/</id>
    <link href="https://igeekfan.cn/igeekfan-docs/about/"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="about" tabindex="-1"> About</h1>
<h2 id="æ¬¢è¿" tabindex="-1"> æ¬¢è¿</h2>
<p>ğŸ‘‹ ä½ å¥½ï¼Œæˆ‘æ˜¯ <code>IGeekFan</code> ï¼Œæˆ‘ä¼šå†™<code>c#</code>ï¼Œä¼šå†™ä¸€ç‚¹ç‚¹<code>javascript</code>ã€‚</p>
<h2 id="è”ç³»æˆ‘-ğŸ’¬" tabindex="-1"> è”ç³»æˆ‘ ğŸ’¬</h2>
<ul>
<li><a href="https://github.com/luoyunchong" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong</a></li>
<li><a href="https://www.cnblogs.com/igeekfan" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/igeekfan</a></li>
<li><a href="mailto:luoyunchong@foxmail.com">luoyunchong@foxmail.com</a></li>
</ul>
<p><img src="https://github-readme-stats.vercel.app/api?username=luoyunchong&amp;show_icons=true&amp;theme=radical" alt="Anurag's github stats" loading="lazy">
<img src="https://github-readme-stats.vercel.app/api/top-langs/?username=luoyunchong&amp;theme=dark&amp;layout=compact" alt="Most Used Languages" loading="lazy"></p>
<h2 id="æ¬¢è¿åŠ å…¥-qq-ç¾¤" tabindex="-1"> æ¬¢è¿åŠ å…¥ QQ ç¾¤</h2>
<img  width="258" height="300" src="/images/qq.png">
<h2 id="æ¬¢è¿å¾®ä¿¡å…³æ³¨-dotnet-æ¬ç –é˜Ÿ" tabindex="-1"> æ¬¢è¿å¾®ä¿¡å…³æ³¨ dotNET æ¬ç –é˜Ÿ</h2>
<p>å¾®ä¿¡æœç´¢ï¼šdotNET æ¬ç –é˜Ÿ</p>
<img src="/images/wechat.png">
]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">ColorUI</title>
    <id>https://igeekfan.cn/igeekfan-docs/colorui/docs/</id>
    <link href="https://igeekfan.cn/igeekfan-docs/colorui/docs/"/>
    <updated>2020-02-28T11:10:31.000Z</updated>
    <content type="html"><![CDATA[<h1 id="colorui" tabindex="-1"> ColorUI</h1>
<h2 id="github" tabindex="-1"> github</h2>
<ul>
<li><a href="https://github.com/weilanwl/ColorUI" target="_blank" rel="noopener noreferrer">https://github.com/weilanwl/ColorUI</a></li>
</ul>
<h2 id="ç‰¹ç‚¹" tabindex="-1"> ç‰¹ç‚¹</h2>
<p>*ã€€è¿™æ˜¯ä¸€ä¸ªcssåº“ï¼Œç›¸æ¯”å…¶ä»–vant-weappã€mpvueéƒ½æ˜¯ä¸ä¸€æ ·çš„,éç»„ä»¶åŒ–ï¼Œä¸»è¦å®šä½æˆ‘è§‰å¾—æ˜¯ç¾åŒ–ä¸»é¢˜ï¼Œéç»„ä»¶åŒ–ï¼Œæ”¯æŒuni-appã€mpvueï¼Œå¯ç»“åˆvant-weappä¸€èµ·ä½¿ç”¨ã€‚</p>
<h2 id="è¯¥æ–‡æ¡£ä½œç”¨" tabindex="-1"> è¯¥æ–‡æ¡£ä½œç”¨</h2>
<p>å¾ˆç®€å•ï¼Œå®˜æ–¹è¿˜æ²¡å‡ºæ–‡æ¡£ï¼Œä½¿ç”¨èµ·æ¥ï¼Œéœ€è¦å¼€å‘è€…è‡ªè¡Œå»çœ‹main.cssï¼Œæ‰“å¼€æ‰‹æœºçœ‹å°ç¨‹åºçš„demo,ç„¶åå†å»æ‰¾é¡¹ç›®æºç ï¼Œæˆ‘è§‰å¾—å¤ªéº»çƒ¦ï¼Œä¸çŸ¥é“å…¶ä»–äººçš„æ„Ÿå—å¦‚ä½•ã€‚</p>
]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">Button æŒ‰é’®</title>
    <id>https://igeekfan.cn/igeekfan-docs/colorui/docs/button.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/colorui/docs/button.html"/>
    <updated>2020-02-28T11:10:31.000Z</updated>
    <content type="html"><![CDATA[<h1 id="button-æŒ‰é’®" tabindex="-1"> Button æŒ‰é’®</h1>
<div><pre><code>&lt;button>é»˜è®¤&lt;/button>
&lt;button>åœ†è§’&lt;/button>
&lt;button>
	&lt;text>&lt;/text>
&lt;/button>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><div><pre><code>.cu-btn 
.cu-btn::after
.cu-btn:not([class*="bg-"]) 
.cu-btn[class*="line"] 
.cu-btn[class*="line"]::after
.cu-btn.round[class*="line"]::after 
.cu-btn[class*="lines"]::after 
.cu-btn[class*="bg-"]::after 
.cu-btn.sm 
.cu-btn.lg 
.cu-btn.cuIcon.sm 
.cu-btn.cuIcon 
button.cuIcon.lg 
.cu-btn.shadow-blur::before 
.cu-btn.button-hover 
.block 
.cu-btn.block 
.cu-btn[disabled] 
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><div><pre><code>.cu-bar.btn-group
.cu-bar.btn-group button
.cu-bar.btn-group button
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div>]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">Text æ–‡æœ¬</title>
    <id>https://igeekfan.cn/igeekfan-docs/colorui/docs/text.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/colorui/docs/text.html"/>
    <updated>2020-02-28T11:10:31.000Z</updated>
    <content type="html"><![CDATA[<h1 id="text-æ–‡æœ¬" tabindex="-1"> Text æ–‡æœ¬</h1>
<div><pre><code>.text-xs 
.text-sm 
.text-df 
.text-lg 
.text-xl 
.text-xxl 
.text-sl 
.text-xsl 
.text-Abc 
.text-ABC 
.text-abc 
.text-price::before 
.text-cut 
.text-bold 
.text-center 
.text-content 
.text-left 
.text-right
.text-red
.line-red
.lines-red 
.text-orange
.line-orange
.lines-orange
.text-yellow
.line-yellow
.lines-yellow 
.text-olive
.line-olive
.lines-olive
.text-green
.line-green
.lines-green 
.text-cyan
.line-cyan
.lines-cyan 
.text-blue
.line-blue
.lines-blue 
.text-purple
.line-purple
.lines-purple 
.text-mauve
.line-mauve
.lines-mauve 
.text-pink
.line-pink
.lines-pink 
.text-brown
.line-brown
.lines-brown
.text-grey
.line-grey
.lines-grey 
.text-gray
.line-gray
.lines-gray
.text-black
.line-black
.lines-black 
.text-white
.line-white
.lines-white
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br></div></div>]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">åˆ›å»ºç®€å•Hello World</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/Console-Hello-World.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/Console-Hello-World.html"/>
    <updated>2020-02-28T11:10:31.000Z</updated>
    <content type="html"><![CDATA[<h1 id="åˆ›å»ºç®€å•hello-world" tabindex="-1"> åˆ›å»ºç®€å•Hello World</h1>
<h2 id="æºç " tabindex="-1"> æºç </h2>
<p>ä»£ç æ‰˜ç®¡åœ¨GitHubä¸Š <a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/console-hello-world" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/console-hello-world</a></p>
<h2 id="ç›¸å…³é˜…è¯»" tabindex="-1"> ç›¸å…³é˜…è¯»</h2>
<ul>
<li><a href="https://docs.microsoft.com/zh-cn/dotnet/core/tutorials/with-visual-studio-code" target="_blank" rel="noopener noreferrer">C# å’Œ Visual Studio Code å…¥é—¨æ•™ç¨‹</a></li>
<li><a href="https://blog.csdn.net/qq_40346899/article/details/80955788" target="_blank" rel="noopener noreferrer">vscodeè°ƒè¯•è¿è¡Œc#è¯¦ç»†æ“ä½œè¿‡ç¨‹</a></li>
<li><strong><a href="https://blog.csdn.net/qin_yu_2010/article/details/83978244" target="_blank" rel="noopener noreferrer">ä½¿ç”¨Visual Studio Codeå¼€å‘.NET Coreçœ‹è¿™ç¯‡å°±å¤Ÿäº†</a></strong> å¼ºçƒˆæ¨èã€‚</li>
</ul>
<h2 id="å¼€å§‹" tabindex="-1"> å¼€å§‹</h2>
<p>åˆ›å»ºä¸€ä¸ªhello-wordçš„consoleï¼Œä¼šè¾“å‡ºHello World!</p>
<div><pre><code><span>mkdir</span> console-hello-world
<span>cd</span> console-hello-world
dotnet new console
dotnet run
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>console-hello-world.csproj</p>
<p><strong>OutputType</strong> æ ‡è®°æŒ‡å®šæˆ‘ä»¬è¦ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå³æ§åˆ¶å°åº”ç”¨ç¨‹åºã€‚</p>
<p><strong>TargetFramework</strong> æ ‡è®°æŒ‡å®šè¦å®šä½çš„ .NET å®ç°ä»£ç ã€‚ åœ¨é«˜çº§æ–¹æ¡ˆä¸­ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªç›®æ ‡æ¡†æ¶ï¼Œå¹¶åœ¨å•ä¸ªæ“ä½œä¸­ç”Ÿæˆæ‰€æœ‰ç›®æ ‡æ¡†æ¶ã€‚</p>
<div><pre><code><span><span><span>&lt;</span>Project</span> <span>Sdk</span><span><span>=</span><span>"</span>Microsoft.NET.Sdk<span>"</span></span><span>></span></span>

  <span><span><span>&lt;</span>PropertyGroup</span><span>></span></span>
    <span><span><span>&lt;</span>OutputType</span><span>></span></span>Exe<span><span><span>&lt;/</span>OutputType</span><span>></span></span>
    <span><span><span>&lt;</span>TargetFramework</span><span>></span></span>netcoreapp3.0<span><span><span>&lt;/</span>TargetFramework</span><span>></span></span>
    <span><span><span>&lt;</span>RootNamespace</span><span>></span></span>console_hello_world<span><span><span>&lt;/</span>RootNamespace</span><span>></span></span>
  <span><span><span>&lt;/</span>PropertyGroup</span><span>></span></span>

<span><span><span>&lt;/</span>Project</span><span>></span></span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><p>åœ¨ console-hello-world/bin/Debug/netcoreapp3.0ä¸­ç”Ÿæˆäº†console-hello-world.dll</p>
<div><pre><code>cd console-hello-world #è¦å…ˆåœ¨console-hello-worldç›®å½•ä¸­
dotnet bin/Debug/netcoreapp3.0/console-hello-world.dll
Hello World
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>ä¿®æ”¹mainå‡½æ•°</p>
<div><pre><code><span>using</span> <span>System</span><span>;</span>

<span>namespace</span> <span>console_hello_world</span>
<span>{</span>
    <span>class</span> <span>Program</span>
    <span>{</span>
        <span>static</span> <span><span>void</span></span> <span>Main</span><span>(</span><span><span>string</span><span>[</span><span>]</span></span> args<span>)</span>
        <span>{</span>
            <span>if</span> <span>(</span>args<span>.</span>Length <span>></span> <span>0</span><span>)</span>
            <span>{</span>
                Console<span>.</span><span>WriteLine</span><span>(</span><span><span>$"Hello </span><span><span>{</span><span>args<span>[</span><span>0</span><span>]</span></span><span>}</span></span><span>!"</span></span><span>)</span><span>;</span>
            <span>}</span>
            <span>else</span>
            <span>{</span>
                Console<span>.</span><span>WriteLine</span><span>(</span><span>"Hello!"</span><span>)</span><span>;</span>
            <span>}</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></div></div><div><pre><code>$ dotnet run -- John
Hello John!
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div>]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">.NET Core ç®€å•æµ‹è¯•é¡¹ç›®</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/Console-News-Types.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/Console-News-Types.html"/>
    <updated>2020-02-28T11:10:31.000Z</updated>
    <content type="html"><![CDATA[<h1 id="net-core-ç®€å•æµ‹è¯•é¡¹ç›®" tabindex="-1"> .NET Core ç®€å•æµ‹è¯•é¡¹ç›®</h1>
<p>ä½¿ç”¨PowerShellçš„dotnet cliå‘½ä»¤è¡Œåˆ›å»ºæ§åˆ¶å°é¡¹ç›®ï¼Œæµ‹è¯•é¡¹ç›®ï¼Œæµ‹è¯•é¡¹ç›®å¼•ç”¨æ§åˆ¶å°é¡¹ç›®ã€‚</p>
<h2 id="æºç " tabindex="-1"> æºç </h2>
<p>ä»£ç æ‰˜ç®¡åœ¨GitHubä¸Š <a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/console-news-types" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/console-news-types</a></p>
<h2 id="ç›¸å…³å‚è€ƒ" tabindex="-1"> ç›¸å…³å‚è€ƒ</h2>
<p>code :<a href="https://github.com/dotnet/samples/blob/master/core/console-apps/NewTypesMsBuild/README.md" target="_blank" rel="noopener noreferrer">https://github.com/dotnet/samples/blob/master/core/console-apps/NewTypesMsBuild/README.md</a></p>
<p>docs: <a href="https://docs.microsoft.com/zh-cn/dotnet/core/tutorials/testing-with-cli" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/dotnet/core/tutorials/testing-with-cli</a></p>
<p>dotnet-add-reference ä½¿ç”¨æ–‡æ¡£ <a href="https://docs.microsoft.com/zh-cn/dotnet/core/tools/dotnet-add-reference" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn/dotnet/core/tools/dotnet-add-reference</a></p>
<p>æ€»ç»“å¦‚ä¸‹å‘½ä»¤è¡Œ</p>
<div><pre><code>PS dotnetcore-examples&gt; mkdir console-news-types
PS dotnetcore-examples&gt; cd .\console-news-types\ 
PS dotnetcore-examples\console-news-types&gt; mkdir src

PS dotnetcore-examples\console-news-types&gt; mkdir test
PS dotnetcore-examples\console-news-types&gt; ls
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d----           2019/6/27    20:51                src
d----           2019/6/27    20:51                test

PS dotnetcore-examples\console-news-types&gt; cd .\src\
PS dotnetcore-examples\console-news-types\src&gt; dotnet new console -n NewTypes
PS dotnetcore-examples\console-news-types\src&gt; cd ..\test\  
PS dotnetcore-examples\console-news-types\test&gt; dotnet new xunit -n NewTypesTests 
PS dotnetcore-examples\console-news-types\test&gt; cd .\NewTypesTests\
PS dotnetcore-examples\console-news-types\test\NewTypesTests&gt; dotnet add reference ../../src/NewTypes/NewTypes.csproj
#Reference `..\..\src\NewTypes\NewTypes.csproj` added to the project.
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br></div></div><p>å…¶ä»–çš„ä»£ç å°±çœ‹ä¸Šé¢çš„äºŒä¸ªé“¾æ¥ï¼ŒæŠŠä»£ç å¤åˆ¶è¿›å»ï¼Œä»£ç å¾ˆç®€å•ï¼Œä¸€ä¸ªæ¥å£ï¼ŒäºŒä¸ªå®ç°ï¼Œmainå‡½æ•°è°ƒç”¨ï¼Œæµ‹è¯•é¡¹ç›®å¼•ç”¨æ§åˆ¶å°é¡¹ç›®ï¼Œ</p>
<p>å…ˆcd åˆ°src\NewTypesç›®å½•ä¸­ï¼Œæ‰§è¡Œ <strong>dotnet run</strong></p>
<div><pre><code>PS dotnetcore-examples\console-news-types\src\NewTypes&gt; dotnet run
Woof!
Meow!
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>å…ˆcd åˆ°test\NewTypesTestsç›®å½•ä¸­ï¼Œæ‰§è¡Œ <strong>dotnet test</strong>ï¼Œçœ‹å¥½ä»£ç ï¼Œæµ‹è¯•ç±» Assert.Equal() æ˜¯æˆåŠŸçš„ï¼Œå¦‚æœæ˜¯Assert.NotEqual() åˆ™Failure</p>
<div><pre><code>PS dotnetcore-examples\console-news-types\test\NewTypesTests&gt; dotnet test
dotnetcore-examples\console-news-types\test\NewTypesTests\bin\Debug\netcoreapp3.0\NewTypesTests.dll çš„æµ‹è¯•è¿è¡Œ(.NETCoreApp,Version=v3.0)
Microsoft (R) æµ‹è¯•æ‰§è¡Œå‘½ä»¤è¡Œå·¥å…·ç‰ˆæœ¬ 16.0.1
ç‰ˆæƒæ‰€æœ‰ (C) Microsoft Corporationã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚

æ­£åœ¨å¯åŠ¨æµ‹è¯•æ‰§è¡Œï¼Œè¯·ç¨å€™...

æ€»æµ‹è¯•: 2ã€‚å·²é€šè¿‡: 2ã€‚å¤±è´¥: 0ã€‚å·²è·³è¿‡: 0ã€‚
æµ‹è¯•è¿è¡ŒæˆåŠŸã€‚
æµ‹è¯•æ‰§è¡Œæ—¶é—´: 1.5134 ç§’
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div>]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">RESTful+FreeSql+AutoMapper</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/FreeSql-sample-blog-RESTful-use-automapper.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/FreeSql-sample-blog-RESTful-use-automapper.html"/>
    <updated>2020-05-08T15:01:00.000Z</updated>
    <summary type="html"><![CDATA[<h1 id="restful-freesql-automapper" tabindex="-1"> RESTful+FreeSql+AutoMapper</h1>
<h2 id="æ–‡ç« æ¦‚è¿°" tabindex="-1"> æ–‡ç« æ¦‚è¿°</h2>
<p>æœ¬æ–‡ä½¿ç”¨ASP .NET Coreçš„WEB APIï¼Œæ„å»ºä¸€ä¸ªRESTfulé£æ ¼çš„æ¥å£ï¼Œä½¿ç”¨Freesqlè®¿é—®MySQLæ•°æ®åº“ï¼Œå®ç°äºŒä¸ªè¡¨çš„ç®€å•åšå®¢ï¼Œå¹¶é›†æˆAutoMapperã€‚</p>
<p>æ¥ä¸Šä¸€ç¯‡</p>
<ul>
<li>
<p><a href="http://blog.igeekfan.cn/2019/06/30/re-start/FreeSql-aspnetcore-how-to-use/" target="_blank" rel="noopener noreferrer">FreeSqlåœ¨ASP.NTE Core WebApiä¸­å¦‚ä½•ä½¿ç”¨çš„æ•™ç¨‹</a></p>
</li>
<li>
<p>é¡¹ç›®æºç  <a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-freesql" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-freesql</a></p>
</li>
</ul>
]]></summary>
    <content type="html"><![CDATA[<h1 id="restful-freesql-automapper" tabindex="-1"> RESTful+FreeSql+AutoMapper</h1>
<h2 id="æ–‡ç« æ¦‚è¿°" tabindex="-1"> æ–‡ç« æ¦‚è¿°</h2>
<p>æœ¬æ–‡ä½¿ç”¨ASP .NET Coreçš„WEB APIï¼Œæ„å»ºä¸€ä¸ªRESTfulé£æ ¼çš„æ¥å£ï¼Œä½¿ç”¨Freesqlè®¿é—®MySQLæ•°æ®åº“ï¼Œå®ç°äºŒä¸ªè¡¨çš„ç®€å•åšå®¢ï¼Œå¹¶é›†æˆAutoMapperã€‚</p>
<p>æ¥ä¸Šä¸€ç¯‡</p>
<ul>
<li>
<p><a href="http://blog.igeekfan.cn/2019/06/30/re-start/FreeSql-aspnetcore-how-to-use/" target="_blank" rel="noopener noreferrer">FreeSqlåœ¨ASP.NTE Core WebApiä¸­å¦‚ä½•ä½¿ç”¨çš„æ•™ç¨‹</a></p>
</li>
<li>
<p>é¡¹ç›®æºç  <a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-freesql" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-freesql</a></p>
</li>
</ul>

<h2 id="dtoä½œç”¨" tabindex="-1"> Dtoä½œç”¨</h2>
<p>å½“æˆ‘ä»¬ä½¿ç”¨RESTfulæä¾›æ¥å£æ—¶ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªåšå®¢ï¼Œä¿®æ”¹ä¸€ä¸‹åšå®¢å†…å®¹æ—¶ï¼Œä»–ä»¬çš„å‚æ•°æ˜¯æœ‰åŒºåˆ«çš„ã€‚è‰¯å¥½çš„è®¾è®¡åº”è¯¥æ˜¯</p>
<p>åˆ›å»ºä¸€ä¸ªåšå®¢</p>
<div><pre><code>POST /api/blog
data<span>:</span>
<span>{</span>
  <span>"title"</span><span>:</span> <span>"string"</span><span>,</span>
  <span>"content"</span><span>:</span> <span>"string"</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>ä¿®æ”¹ä¸€ä¸ªåšå®¢å†…å®¹</p>
<div><pre><code>PUT /api/blog
data<span>:</span>
<span>{</span>
  <span>"blogId"</span><span>:</span><span>"int"</span><span>,</span>
  <span>"title"</span><span>:</span> <span>"string"</span><span>,</span>
  <span>"content"</span><span>:</span> <span>"string"</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>ä½†ä¸€ä¸ªblog å®ä½“å¦‚ä¸‹</p>
<div><pre><code>    <span>public</span> <span>class</span> <span>Blog</span>
    <span>{</span>
        <span>[</span><span><span>Column</span><span><span>(</span>IsIdentity <span>=</span> <span>true</span><span>,</span> IsPrimary <span>=</span> <span>true</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span><span>int</span></span> BlogId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Content <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span>DateTime</span> CreateTime <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span>virtual</span> <span>List<span>&lt;</span>Post<span>></span></span> Posts <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><p>å¦‚æœæˆ‘ä»¬ä»¥Blogä½œä¸ºcontrollersä¸­çš„å‚æ•°æ—¶</p>
<div><pre><code>       <span>// POST api/blog</span>
        <span>[</span>HttpPost<span>]</span>
        <span>public</span> <span><span>void</span></span> <span>Post</span><span>(</span><span>[</span><span><span>FromBody</span></span><span>]</span> <span>Blog</span> blog<span>)</span>
        <span>{</span>
            blog<span>.</span>CreateTime<span>=</span>DateTime<span>.</span>Now<span>;</span>
            _fsql<span>.</span><span><span>Insert</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span>blog<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><p>è¿™æ—¶ä¿®æ”¹swaggeræ˜¾ç¤ºçš„é»˜è®¤å‚æ•°æ˜¯</p>
<div><pre><code><span>{</span>
  <span>"blogId"</span><span>:</span> <span>0</span><span>,</span>
  <span>"title"</span><span>:</span> <span>"string"</span><span>,</span>
  <span>"content"</span><span>:</span> <span>"string"</span><span>,</span>
  <span>"createTime"</span><span>:</span> <span>"2019-06-30T07:33:05.524Z"</span><span>,</span>
  <span>"posts"</span><span>:</span> <span>[</span>
    <span>{</span>
      <span>"postId"</span><span>:</span> <span>0</span><span>,</span>
      <span>"replyContent"</span><span>:</span> <span>"string"</span><span>,</span>
      <span>"blogId"</span><span>:</span> <span>0</span><span>,</span>
      <span>"replyTime"</span><span>:</span> <span>"2019-06-30T07:33:05.524Z"</span>
    <span>}</span>
  <span>]</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><p>å¦‚æœæˆ‘ä»¬ä¸ä¼ é€’createTimeï¼Œä¼šå‡ºç°å¼‚å¸¸ï¼Œåº”è¯¥createTimeæ˜¯DateTimeï¼Œä¸èƒ½ä¸ºnullï¼Œåªæœ‰DateTime?æ‰èƒ½ä¸ºnull,æœ‰?ä¸ºå¯ç©ºç±»å‹ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä¸ºPOSTæ–¹å¼ä¼ é€’è¿‡æ¥æ—¶ï¼Œæ–°å»ºä¸€ä¸ªå®ä½“ç±»ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºDTO(Data Transfer Object)ï¼Œå³æ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œå› ä¸ºcreateTimeå³ä½¿ä¼ é€’ï¼Œåç«¯ä¸ºä»–èµ‹äº†å€¼ï¼Œå‰å°ä¼ äº†ä¹Ÿæ— æ•ˆã€‚æœ‰äº†DTOï¼Œè¿™æ ·å¯è®©å‰ç«¯æ¸…æ¥šä»–ä»¬åº”è¯¥ä¼ é€’çš„å‚æ•°ï¼Œè€Œä¸ä¼šå‡ºç°æ²¡æœ‰ä½œç”¨çš„å‚æ•°ã€‚</p>
<p>åœ¨æ ¹ç›®å½•åˆ›å»ºModels/Blogsæ–‡ä»¶å¤¹ï¼Œåœ¨Blogsæ–‡ä»¶å¤¹ä¸­åˆ›å»º</p>
<h3 id="createblogdto-cs" tabindex="-1"> CreateBlogDto.cs</h3>
<div><pre><code><span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Blogs</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>CreateBlogDto</span>
    <span>{</span>
        <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Content <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>}</span>
<span>}</span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><h3 id="updateblogdto-cs" tabindex="-1"> UpdateBlogDto.cs</h3>
<div><pre><code><span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Blogs</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>UpdateBlogDto</span>
    <span>{</span>
        <span>public</span> <span><span>int</span></span> BlogId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Title <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Content <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
<span>}</span>


</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>æœ‰äº†Dtoåï¼Œæˆ‘ä»¬ä¼šå‘ç°äº†æ–°çš„é—®é¢˜ï¼Œå¾€æ•°æ®åº“æ’å…¥æ—¶ï¼Œå¾€å¾€ä½¿ç”¨äº†ä¸€äº›ORM,ä»–ä»¬åªæ”¯æŒåŸæœ¬çš„å®ä½“ç±»ï¼Œå¦‚Blogï¼ŒPostã€‚ä½†ä¸æ”¯æŒCreateBlogDtoã€UpdateBlogDto,æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ï¼Œå°†ä¸€ä¸ªç±»çš„å€¼ï¼Œèµ‹å€¼ç»™å¦ä¸€ä¸ªç±»ã€‚
å¦‚</p>
<div><pre><code>    <span>CreateBlogDto</span> createBlogDto <span>=</span> <span>new</span> <span>CreateBlogDto</span><span>(</span><span>)</span>
    <span>{</span>
        Title <span>=</span> <span>"æˆ‘æ˜¯title"</span><span>,</span>
        Content <span>=</span> <span>"æˆ‘æ˜¯content"</span>
    <span>}</span><span>;</span>

    <span>Blog</span> newBlog<span>=</span><span>new</span> <span>Blog</span><span>(</span><span>)</span>
    <span>{</span>
        Title <span>=</span> createBlogDto<span>.</span>Title<span>,</span>
        Content <span>=</span> createBlogDto<span>.</span>Content
    <span>}</span><span>;</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>ç°åœ¨åªæ˜¯éå¸¸ç®€å•çš„äºŒä¸ªå±æ€§ï¼Œæˆ‘ä»¬è¿˜èƒ½å¿å—ï¼Œä½†å¦‚æœæ˜¯åä¸ªå±æ€§ã€è€Œä¸”æœ‰ç€å¤§é‡çš„ç±»ä¸ç±»ä¹‹é—´çš„è½¬æ¢å‘¢ã€‚è¿™æ—¶ä¿®æ”¹AutoMapperå°±é—ªäº®ç™»åœºäº†ã€‚</p>
<h2 id="automapper" tabindex="-1"> AutoMapper</h2>
<blockquote>
<p>ä½œç”¨ï¼šA convention-based object-object mapper.</p>
</blockquote>
<p>æˆ‘ä»¬æ˜¯åœ¨ASP .NET Coreä¸‹ä½¿ç”¨AutoMapper <a href="https://automapper.readthedocs.io/en/latest/Dependency-injection.html" target="_blank" rel="noopener noreferrer">å®˜ç½‘ä»‹ç»ï¼Œå¦‚ä½•ä¾èµ–æ³¨å…¥ä¸­ä½¿ç”¨</a></p>
<h3 id="setup" tabindex="-1"> Setup</h3>
<p>å…ˆcdåˆ°dotnetcore-examples\aspnetcore-freesql\RESTful.FreeSqlç›®å½•</p>
<div><pre><code>PS &gt; dotnet add package AutoMapper
PS &gt; dotnet add package AutoMapper.Extensions.Microsoft.DependencyInjection --version 6.1.1
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>åœ¨StartUp.csä¸­çš„ConfigureServicesé…ç½®å¦‚ä¸‹</p>
<div><pre><code>   public void ConfigureServices(IServiceCollection services)
    {
        // .... Ignore code before this
        
        //AddAutoMapperä¼šå»æ‰¾ç»§æ‰¿Profileçš„ç±»ï¼Œ
        services.AddAutoMapper(AppDomain.CurrentDomain.GetAssemblies());

        // .... Ignore code after this
    }
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h3 id="adding-profiles" tabindex="-1"> Adding Profiles</h3>
<p>AutoMapper/BlogProfile.cs</p>
<div><pre><code><span>using</span> <span>AutoMapper</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Domain</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Blogs</span><span>;</span>

<span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>AutoMapper</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>BlogProfile</span> <span>:</span> <span><span>Profile</span></span>
    <span>{</span>
        <span>public</span> <span>BlogProfile</span><span>(</span><span>)</span> 
        <span>{</span>
            <span><span>CreateMap</span><span><span>&lt;</span>CreateBlogDto<span>,</span> Blog<span>></span></span></span><span>(</span><span>)</span><span>;</span>
            <span><span>CreateMap</span><span><span>&lt;</span>UpdateBlogDto<span>,</span> Blog<span>></span></span></span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><p>AutoMapper/BlogProfile.cs</p>
<div><pre><code><span>using</span> <span>AutoMapper</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Domain</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Blogs</span><span>;</span>

<span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>AutoMapper</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>PostProfile</span> <span>:</span> <span><span>Profile</span></span>
    <span>{</span>
        <span>public</span> <span>PostProfile</span><span>(</span><span>)</span>
        <span>{</span>
            <span><span>CreateMap</span><span><span>&lt;</span>CreatePostDto<span>,</span>Post<span>></span></span></span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><p>Models/Posts/SearchPostDto.csæ ¹æ®åšå®¢idï¼Œå¾—åˆ°åˆ†é¡µçš„è¯„è®ºæ—¶ï¼Œé›†æˆåˆ†é¡µç±»</p>
<div><pre><code><span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Web</span><span>;</span>

<span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Posts</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>SearchPostDto</span><span>:</span><span><span>PageDto</span></span>
    <span>{</span>
        <span>public</span> <span><span>int</span></span> BlogId <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
<span>}</span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><p>Controlers/BlogController.csæ–‡ä»¶ä¸­ï¼Œæ³¨å…¥IMapper,</p>
<div><pre><code><span>using</span> <span>AutoMapper</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>
<span>using</span> <span>System</span><span>;</span>
<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Domain</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Blogs</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Web</span><span>;</span>

<span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Controllers</span>
<span>{</span>
    <span>[</span><span><span>Route</span><span><span>(</span><span>"api/[controller]"</span><span>)</span></span></span><span>]</span>
    <span>[</span><span><span>ApiController</span></span><span>]</span>
    <span>public</span> <span>class</span> <span>BlogController</span> <span>:</span> <span><span>ControllerBase</span></span>
    <span>{</span>
        <span>// GET api/Blog</span>

        <span>private</span> <span>readonly</span> <span>IFreeSql</span> _fsql<span>;</span>
        <span>private</span> <span>readonly</span> <span>IMapper</span> _mapper<span>;</span>
        <span>public</span> <span>BlogController</span><span>(</span><span>IFreeSql</span> fsql<span>,</span> <span>IMapper</span> mapper<span>)</span>
        <span>{</span>
            _fsql <span>=</span> fsql<span>;</span>
            _mapper <span>=</span> mapper<span>;</span>
        <span>}</span>

        <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
        <span>/// åšå®¢åˆ—è¡¨é¡µ </span>
        <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
        <span>/// <span><span><span>&lt;</span>param</span> <span>name</span><span><span>=</span><span>"</span>pageDto<span>"</span></span><span>></span></span>åˆ†é¡µå‚æ•°<span><span><span>&lt;/</span>param</span><span>></span></span></span>
        <span>/// <span><span><span>&lt;</span>returns</span><span>></span></span><span><span><span>&lt;/</span>returns</span><span>></span></span></span>
        <span>[</span>HttpGet<span>]</span>
        <span>public</span> <span>ActionResult<span>&lt;</span>PagedResultDto<span>&lt;</span>Blog<span>></span><span>></span></span> <span>Get</span><span>(</span><span>[</span><span><span>FromQuery</span></span><span>]</span><span>PageDto</span> pageDto<span>)</span>
        <span>{</span>
            <span>List<span>&lt;</span>Blog<span>></span></span> blogs <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>OrderByDescending</span><span>(</span>r <span>=></span> r<span>.</span>CreateTime<span>)</span><span>.</span><span>Page</span><span>(</span>pageDto<span>.</span>PageNumber<span>,</span> pageDto<span>.</span>PageSize<span>)</span><span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>
            <span><span>long</span></span> count <span>=</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Count</span><span>(</span><span>)</span><span>;</span>
            <span>return</span> <span>new</span> <span>PagedResultDto<span>&lt;</span>Blog<span>></span></span><span>(</span>count<span>,</span> blogs<span>)</span><span>;</span>
        <span>}</span>

        <span>// GET api/blog/5</span>
        <span>[</span><span>HttpGet</span><span>(</span><span>"{id}"</span><span>)</span><span>]</span>
        <span>public</span> <span>ActionResult<span>&lt;</span>Blog<span>></span></span> <span>Get</span><span>(</span><span><span>int</span></span> id<span>)</span>
        <span>{</span>
            <span>// eg.1 return _fsql.Select&lt;Blog>().Where(a => a.Id == id).ToOne();</span>
            <span>// eg.2</span>
            <span>return</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span>id<span>)</span><span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>

        <span>// POST api/blog</span>
        <span>[</span>HttpPost<span>]</span>
        <span>public</span> <span><span>void</span></span> <span>Post</span><span>(</span><span>[</span><span><span>FromBody</span></span><span>]</span> <span>CreateBlogDto</span> createBlogDto<span>)</span>
        <span>{</span>
            <span>Blog</span> blog <span>=</span> _mapper<span>.</span><span><span>Map</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span>createBlogDto<span>)</span><span>;</span>
            blog<span>.</span>CreateTime <span>=</span> DateTime<span>.</span>Now<span>;</span>
            _fsql<span>.</span><span><span>Insert</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span>blog<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>

        <span>// PUT api/blog</span>
        <span>[</span>HttpPut<span>]</span>
        <span>public</span> <span><span>void</span></span> <span>Put</span><span>(</span><span>[</span><span><span>FromBody</span></span><span>]</span> <span>UpdateBlogDto</span> updateBlogDto<span>)</span>
        <span>{</span>

            <span>//eg.1 æ›´æ–°æŒ‡å®šåˆ—</span>
            <span>//_fsql.Update&lt;Blog>(updateBlogDto.BlogId).Set(a => new Blog()</span>
            <span>//{</span>
            <span>//    Title = updateBlogDto.Title,</span>
            <span>//    Content = updateBlogDto.Content</span>
            <span>//}).ExecuteAffrows();</span>

            <span>//eg.2å°†è¿™ä¸ªå®ä½“æ›´æ–°åˆ°æ•°æ®åº“ä¸­ã€‚å½“æ›´æ–°æ—¶ï¼Œä¼šæŠŠå…¶ä»–åˆ—çš„å€¼ï¼Œå¦‚CreateTimeä¹Ÿæ›´æ–°æ‰ã€‚</span>
            <span>//ä½¿ç”¨IgnoreColumnså¯å¿½ç•¥æŸä¸€äº›åˆ—ã€‚</span>

            <span>Blog</span> blog <span>=</span> _mapper<span>.</span><span><span>Map</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span>updateBlogDto<span>)</span><span>;</span>
            _fsql<span>.</span><span><span>Update</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>SetSource</span><span>(</span>blog<span>)</span><span>.</span><span>IgnoreColumns</span><span>(</span>r <span>=></span> r<span>.</span>CreateTime<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>

        <span>// DELETE api/blog/5</span>
        <span>[</span><span>HttpDelete</span><span>(</span><span>"{id}"</span><span>)</span><span>]</span>
        <span>public</span> <span><span>void</span></span> <span>Delete</span><span>(</span><span><span>int</span></span> id<span>)</span>
        <span>{</span>
            _fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Blog<span>></span></span></span><span>(</span><span>new</span> <span>{</span> BlogId <span>=</span> id <span>}</span><span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br><span>73</span><br><span>74</span><br><span>75</span><br><span>76</span><br><span>77</span><br><span>78</span><br><span>79</span><br><span>80</span><br><span>81</span><br><span>82</span><br></div></div><p>Controlers/BlogController.csæ–‡ä»¶ä¸­ï¼Œæ³¨å…¥IMapper,</p>
<div><pre><code><span>using</span> <span>FreeSql</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>
<span>using</span> <span>System</span><span>;</span>
<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading<span>.</span>Tasks</span><span>;</span>
<span>using</span> <span>AutoMapper</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Domain</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Models<span>.</span>Posts</span><span>;</span>
<span>using</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Web</span><span>;</span>

<span>namespace</span> <span>RESTful<span>.</span>FreeSql<span>.</span>Controllers</span>
<span>{</span>
    <span>[</span><span><span>Route</span><span><span>(</span><span>"api/[controller]"</span><span>)</span></span></span><span>]</span>
    <span>[</span><span><span>ApiController</span></span><span>]</span>
    <span>public</span> <span>class</span> <span>PostController</span> <span>:</span> <span><span>ControllerBase</span></span>
    <span>{</span>
        <span>// GET: api/Post</span>
        <span>private</span> <span>readonly</span> <span>IFreeSql</span> _fsql<span>;</span>
        <span>private</span> <span>readonly</span> <span>IMapper</span> _mapper<span>;</span>
        <span>public</span> <span>PostController</span><span>(</span><span>IFreeSql</span> fsql<span>,</span> <span>IMapper</span> mapper<span>)</span>
        <span>{</span>
            _fsql <span>=</span> fsql<span>;</span>
            _mapper <span>=</span> mapper<span>;</span>
        <span>}</span>

        <span>/// <span><span><span>&lt;</span>summary</span><span>></span></span></span>
        <span>/// æ ¹æ®åšå®¢idã€åˆ†é¡µæ¡ä»¶æŸ¥è¯¢è¯„è®ºä¿¡æ¯</span>
        <span>/// <span><span><span>&lt;/</span>summary</span><span>></span></span></span>
        <span>/// <span><span><span>&lt;</span>param</span> <span>name</span><span><span>=</span><span>"</span>searchPostDto<span>"</span></span><span>></span></span><span><span><span>&lt;/</span>param</span><span>></span></span></span>
        <span>/// <span><span><span>&lt;</span>returns</span><span>></span></span><span><span><span>&lt;/</span>returns</span><span>></span></span></span>
        <span>[</span>HttpGet<span>]</span>
        <span>public</span> <span>PagedResultDto<span>&lt;</span>Post<span>></span></span> <span>Get</span><span>(</span><span>SearchPostDto</span> searchPostDto<span>)</span>
        <span>{</span>
            <span>ISelect<span>&lt;</span>Post<span>></span></span> selectPost <span>=</span> _fsql
                <span>.</span><span><span>Select</span><span><span>&lt;</span>Post<span>></span></span></span><span>(</span><span>)</span>
                <span>.</span><span>Where</span><span>(</span>r <span>=></span> r<span>.</span>BlogId <span>==</span> searchPostDto<span>.</span>BlogId<span>)</span><span>;</span>

            <span>List<span>&lt;</span>Post<span>></span></span> posts <span>=</span> selectPost<span>.</span><span>OrderByDescending</span><span>(</span>r <span>=></span> r<span>.</span>ReplyTime<span>)</span>
                <span>.</span><span>Page</span><span>(</span>searchPostDto<span>.</span>PageNumber<span>,</span> searchPostDto<span>.</span>PageSize<span>)</span>
                <span>.</span><span>ToList</span><span>(</span><span>)</span><span>;</span>

            <span><span>long</span></span> total <span>=</span> selectPost<span>.</span><span>Count</span><span>(</span><span>)</span><span>;</span>

            <span>return</span> <span>new</span> <span>PagedResultDto<span>&lt;</span>Post<span>></span></span><span>(</span>total<span>,</span> posts<span>)</span><span>;</span>
        <span>}</span>

        <span>// GET: api/Post/5</span>
        <span>[</span><span>HttpGet</span><span>(</span><span>"{id}"</span><span>,</span> Name <span>=</span> <span>"Get"</span><span>)</span><span>]</span>
        <span>public</span> <span>Post</span> <span>Get</span><span>(</span><span><span>int</span></span> id<span>)</span>
        <span>{</span>
            <span>return</span> _fsql<span>.</span><span><span>Select</span><span><span>&lt;</span>Post<span>></span></span></span><span>(</span><span>)</span><span>.</span><span>Where</span><span>(</span>a <span>=></span> a<span>.</span>PostId <span>==</span> id<span>)</span><span>.</span><span>ToOne</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>

        <span>// POST: api/Post</span>
        <span>[</span>HttpPost<span>]</span>
        <span>public</span> <span><span>void</span></span> <span>Post</span><span>(</span><span>[</span><span><span>FromBody</span></span><span>]</span> <span>CreatePostDto</span> createPostDto<span>)</span>
        <span>{</span>
            <span>Post</span> post <span>=</span> _mapper<span>.</span><span><span>Map</span><span><span>&lt;</span>Post<span>></span></span></span><span>(</span>createPostDto<span>)</span><span>;</span>
            post<span>.</span>ReplyTime <span>=</span> DateTime<span>.</span>Now<span>;</span>
            _fsql<span>.</span><span>Insert</span><span>(</span>post<span>)</span><span>.</span><span>ExecuteAffrows</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>


        <span>// DELETE: api/Post/</span>
        <span>[</span><span><span>HttpDelete</span><span><span>(</span><span>"{id}"</span><span>)</span></span></span><span>]</span>
        <span>public</span> <span>async</span> <span>Task</span> <span>DeleteAsync</span><span>(</span><span><span>int</span></span> id<span>)</span>
        <span>{</span>
            <span>await</span> _fsql<span>.</span><span><span>Delete</span><span><span>&lt;</span>Post<span>></span></span></span><span>(</span><span>new</span> <span>Post</span> <span>{</span> PostId <span>=</span> id <span>}</span><span>)</span><span>.</span><span>ExecuteAffrowsAsync</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br></div></div><h3 id="å‚è€ƒ" tabindex="-1"> å‚è€ƒ</h3>
<ul>
<li>å»ºè®®å¤§å®¶å…ˆçœ‹å®˜ç½‘ <a href="http://automapper.org/" target="_blank" rel="noopener noreferrer">http://automapper.org/</a></li>
<li>å¼€æºåœ°å€ <a href="https://github.com/AutoMapper/AutoMapper" target="_blank" rel="noopener noreferrer">https://github.com/AutoMapper/AutoMapper</a></li>
<li>Getting-started æ–‡æ¡£ <a href="https://automapper.readthedocs.io/en/latest/Getting-started.html#what-is-automapper" target="_blank" rel="noopener noreferrer">https://automapper.readthedocs.io/en/latest/Getting-started.html#what-is-automapper</a></li>
</ul>
]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">IdentityServer4</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/IdentityServer4.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/IdentityServer4.html"/>
    <updated>2020-05-08T15:01:00.000Z</updated>
    <content type="html"><![CDATA[<h1 id="identityserver4" tabindex="-1"> IdentityServer4</h1>
<h2 id="å†™çš„ä¸€äº›identityserver4çš„ç¤ºä¾‹" tabindex="-1"> å†™çš„ä¸€äº›IdentityServer4çš„ç¤ºä¾‹</h2>
<p>IdentityServer4 å®ç°å•ç‚¹ç™»å½•æˆæƒtokenéªŒè¯</p>
<h2 id="æºç " tabindex="-1"> æºç </h2>
<p>ä»£ç æ‰˜ç®¡åœ¨GitHubä¸Š <a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-identityserver4" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-identityserver4</a></p>
<h2 id="å‚è€ƒ" tabindex="-1"> å‚è€ƒ</h2>
<ul>
<li><a href="https://www.cnblogs.com/edisonchou/p/identityserver4_foundation_and_quickstart_01.html" target="_blank" rel="noopener noreferrer">.NET Coreå¾®æœåŠ¡ä¹‹åŸºäºIdentityServerå»ºç«‹æˆæƒä¸éªŒè¯æœåŠ¡</a></li>
</ul>
]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">ImCore å³æ—¶é€šè®¯</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/ImCore-Chat.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/ImCore-Chat.html"/>
    <updated>2020-02-28T11:10:31.000Z</updated>
    <content type="html"><![CDATA[<h1 id="imcore-å³æ—¶é€šè®¯" tabindex="-1"> ImCore å³æ—¶é€šè®¯</h1>
<h2 id="ç®€ä»‹" tabindex="-1"> ç®€ä»‹</h2>
<p>åˆ©ç”¨ webSocket åè®®å®ç°ç®€æ˜“ã€é«˜æ€§èƒ½ã€é›†ç¾¤å³æ—¶é€šè®¯ç»„ä»¶ï¼Œæ”¯æŒç‚¹å¯¹ç‚¹é€šè®¯ã€ç¾¤èŠé€šè®¯ã€ä¸Šçº¿ä¸‹çº¿äº‹ä»¶æ¶ˆæ¯ç­‰ä¼—å¤šå®ç”¨æ€§åŠŸèƒ½ã€‚</p>
<h2 id="å¼€æºåœ°å€" tabindex="-1"> å¼€æºåœ°å€</h2>
<p><a href="https://github.com/2881099/im" target="_blank" rel="noopener noreferrer">https://github.com/2881099/im</a></p>
<h2 id="ç¤ºä¾‹" tabindex="-1"> ç¤ºä¾‹</h2>
<p><a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/dotnet-core-im" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/dotnet-core-im</a></p>
<h2 id="æ¼”ç¤ºæ•ˆæœ" tabindex="-1"> æ¼”ç¤ºæ•ˆæœ</h2>
<p><img src="https://ae01.alicdn.com/kf/Hf8b31f05dbb94f8da565fce29f78aa78Y.png" alt="https://ae01.alicdn.com/kf/Hf8b31f05dbb94f8da565fce29f78aa78Y.png" loading="lazy"></p>
]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">.NET Core å­¦ä¹ ç¤ºä¾‹æ–‡æ¡£</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="net-core-å­¦ä¹ ç¤ºä¾‹æ–‡æ¡£" tabindex="-1"> .NET Core å­¦ä¹ ç¤ºä¾‹æ–‡æ¡£</h1>
<p>æµè§ˆå·¦ä¾§å¯¼èˆªèœå•ä»¥æ·±å…¥äº†è§£æ–‡æ¡£.</p>
<p>.NET Core å­¦ä¹ ç¤ºä¾‹æ–‡æ¡£ä¸»è¦æ˜¯ç»“åˆ ASP .NET Coreï¼Œé›†æˆç¬¬ä¸‰æ–¹ç±»åº“çš„ç¤ºä¾‹ï¼Œè¿ç”¨åŸºç¡€ç»„ä»¶ï¼Œå†™å¥½ Demoã€‚</p>
<h2 id="æºç " tabindex="-1"> æºç </h2>
<p>ä»£ç æ‰˜ç®¡åœ¨ GitHub ä¸Š <a href="https://github.com/luoyunchong/dotnetcore-examples" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples</a></p>
<h2 id="æ¨èé˜…è¯»" tabindex="-1"> æ¨èé˜…è¯»</h2>
<ul>
<li>Microsoft Docs <a href="https://docs.microsoft.com/zh-cn" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/zh-cn</a>
å…¶ä¸­åŒ…å«å¦‚ä¸‹
<ul>
<li>.NET Core æŒ‡å— https://docs.microsoft.com/zh-cn/dotnet/core/</li>
<li>ASP .NET æ–‡æ¡£ https://docs.microsoft.com/zh-cn/aspnet/</li>
<li>.NET Core CLI æ–‡æ¡£ https://docs.microsoft.com/zh-cn/dotnet/core/tools/?tabs=netcore2x</li>
</ul>
</li>
</ul>
<h2 id="æœ¬åœ°ç¯å¢ƒè¯´æ˜" tabindex="-1"> æœ¬åœ°ç¯å¢ƒè¯´æ˜</h2>
<ul>
<li>Windows 10 (18922.rs_prerelease.190614-1427)</li>
<li>.NET Core 3.0.100-preview6-012264</li>
<li>Visual Studio Code 1.35.1ã€Microsoft Visual Studio 2019 16.1.3</li>
<li>PowerSheel</li>
<li>MySQL 5.7.25</li>
<li>Navicat Premium 12 <a href="http://blog.igeekfan.cn/2018/06/02/%E5%A4%A7%E5%90%8E%E7%AB%AF/Navicat%20Premium%2012%20%20%E7%A0%B4%E8%A7%A3%E7%89%88%E5%85%8D%E8%B4%B9%E4%B8%8B%E8%BD%BD/" target="_blank" rel="noopener noreferrer">æ¬¢è¿ä¸‹è½½</a></li>
</ul>
<h2 id="install" tabindex="-1"> Install</h2>
<p>æœ¬åœ°å¼€å‘é€‰æ‹© SDK å®‰è£…å³å¯ï¼Œè¿˜æ˜¯å®‰è£… 2.2 çš„å§ï¼Œ3.0ï¼ˆ19.6.29ï¼‰ç›®å‰è¿˜æ²¡æœ‰å‘å¸ƒç¨³å®šç‰ˆæœ¬ã€‚</p>
<ul>
<li>å®‰è£…è¿™ä¸ª <strong>https://dotnet.microsoft.com/download/dotnet-core/2.2</strong></li>
<li>https://dotnet.microsoft.com/download/dotnet-core/3.0</li>
</ul>
<p>å®‰è£…åï¼Œåœ¨ PowerShell ä¸­ä»»ä¸€ç›®å½•æŸ¥çœ‹å®‰è£…åçš„ç‰ˆæœ¬</p>
<div><pre><code>PS C:\WINDOWS\system32&gt; dotnet --version
3.0.100-preview6-012264
# æœ¬åœ°å®‰è£…äº†å¥½å‡ ä¸ª.net core sdkç‰ˆæœ¬
PS C:\WINDOWS\system32&gt; dotnet --list-sdks
2.1.700 [C:\Program Files\dotnet\sdk]
2.2.300 [C:\Program Files\dotnet\sdk]
3.0.100-preview6-012264 [C:\Program Files\dotnet\sdk]
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><h2 id="cli" tabindex="-1"> CLI</h2>
<p>å…¨ç§°ï¼šcommand-line interfaceï¼Œå‘½ä»¤è¡Œç•Œé¢ï¼Œä¸»è¦æ˜¯ cmdã€bash(sh ç­‰ç­‰)ã€powershell ç­‰ã€‚</p>
<blockquote>
<p>è¯´æ˜ <strong>æ‰€æœ‰å‘½ä»¤è¡Œéƒ½åœ¨ windows10 è‡ªå¸¦çš„ powershell ä¸­æ‰§è¡Œã€‚</strong></p>
</blockquote>
<h3 id="æŒ‡å®š-sdk-ç‰ˆæœ¬" tabindex="-1"> æŒ‡å®š SDK ç‰ˆæœ¬</h3>
<p>.NET Core é¡¹ç›®é»˜è®¤ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ .NET Coreï¼Œåœ¨æ ¹ç›®å½•ä½¿ç”¨ PowerShell ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œ</p>
<p>è¯­æ³• ï¼šdotnet new global.json --sdk-version &lt;SDK ç‰ˆæœ¬å·&gt;</p>
<div><pre><code>dotnet new globaljson --sdk-version 2.2.300
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>å‚è€ƒ</p>
<ul>
<li><a href="https://docs.microsoft.com/zh-cn/dotnet/core/tools/dotnet-new?tabs=netcore22" target="_blank" rel="noopener noreferrer">dotnet new å‘½ä»¤è¡Œ</a></li>
<li><a href="https://docs.microsoft.com/zh-cn/dotnet/core/versions/selection?view=dotnet-plat-ext-2.1" target="_blank" rel="noopener noreferrer">é€‰æ‹©è¦ä½¿ç”¨çš„ .NET Core ç‰ˆæœ¬</a></li>
</ul>
<h2 id="net-core" tabindex="-1"> .NET Core</h2>
<p>.NET Core æ˜¯ä»€ä¹ˆï¼Ÿ å®˜ç½‘è¯´çš„å¤ªé«˜å¤§ä¸Šäº† https://docs.microsoft.com/zh-cn/dotnet/core/about</p>
<p>æ€»ç»“ï¼Œ.NET Core åŒ…å«å¦‚ä¸‹</p>
<ul>
<li>äºŒä¸ª RunTime
<ul>
<li>.NET Core RunTimeï¼šåŸºç¡€ç±»å‹ç³»ç»Ÿ ã€åƒåœ¾å›æ”¶ã€åŸºå…ƒç±»å‹ç­‰ï¼Œ</li>
<li>ASP .NET RunTime ï¼šæä¾› WEBã€LOT ç­‰åº”ç”¨ç¨‹åºçš„æ¡†æ¶æ”¯æŒã€‚</li>
</ul>
</li>
<li>.NET Core CLI å·¥å…·ï¼šå„ç§å‘½ä»¤è¡Œå·¥å…·ï¼Œåˆ›å»ºé¡¹ç›®ã€ç¼–è¯‘é¡¹ç›®ï¼Œå‘å¸ƒé¡¹ç›®ç­‰ï¼›</li>
<li>è¯­è¨€ç¼–è¯‘å™¨ï¼šï¼ˆæ”¯æŒ C#ã€F#ã€VB ç­‰è¯­è¨€ï¼‰</li>
<li>dotnet å·¥å…·ï¼š.NET Core è¿è¡Œæ—¶å’Œåº“çš„å®‰è£…ç¨‹åºåŒ…</li>
</ul>
<p>ä¸‰ä¸ªå‘å¸ƒåŒ…ï¼š</p>
<ul>
<li>.NET Core è¿è¡Œæ—¶</li>
<li>ASP .NET Core è¿è¡Œæ—¶</li>
<li>.NET Core SDKï¼šåŒ…æ‹¬ä¸Šé¢äºŒä¸ªå†…å®¹ï¼Œå†åŠ ä¸Š .NET CLI å·¥å…·ç­‰</li>
</ul>
<p>æ‰€ä»¥æœ¬åœ°è°ƒè¯•æ—¶ï¼Œå¯ç›´æ¥å®‰è£…æœ€å…¨çš„ SDK å³å¯ã€‚</p>
<h2 id="é¡¹ç›®æ–‡æ¡£" tabindex="-1"> é¡¹ç›®æ–‡æ¡£</h2>
<p>ç›®å‰ å…³äºæ­¤é¡¹ç›®çš„æ–‡æ¡£æ”¾åˆ° docs æ–‡ä»¶å¤¹ä¸­ï¼Œzh-Hans ä¸ºä¸­æ–‡ï¼Œè¿™æ ·å¯æ”¯æŒå¤šè¯­è¨€ï¼Œæ¬¢è¿ç¿»è¯‘ PRï¼Œä¹‹åä¼šå‘å¸ƒè‡³</p>
<ul>
<li>æ–‡æ¡£å®˜ç½‘ <a href="https://luoyunchong.github.io/vuepress-docs/" target="_blank" rel="noopener noreferrer">https://luoyunchong.github.io/vuepress-docs/</a></li>
</ul>
<p>å°†ä½¿ç”¨ abp vnext ä¸‹çš„ modules çš„<a href="https://github.com/abpframework/abp/blob/dev/modules/docs/README.md" target="_blank" rel="noopener noreferrer">docs æ¨¡å—</a>ã€‚ä¸è¿‡ abp vnext ç°åœ¨ä¹Ÿä¸ç¨³å®šï¼Œ0.18.1ï¼Œè¿˜æ˜¯æœ‰å„ç§é—®é¢˜ï¼Œæˆ‘è¿˜æ˜¯å†™åŸºç¡€æ¨¡å—çš„ä½¿ç”¨æ–‡æ¡£å§ï¼ŒåæœŸå®Œå–„åï¼Œå‘å¸ƒæ–‡æ¡£ç½‘ç«™ã€‚</p>
<h2 id="è¯´æ˜" tabindex="-1"> è¯´æ˜</h2>
<p>æœ¬é¡¹ç›®ä¹Ÿæ˜¯æˆ‘çš„å­¦ä¹ è®°å½•ï¼Œï¼Œç”¨äºæµ‹è¯•ä¸åŒç±»åº“é›†æˆçš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥ç”¨æœ€åŸºç¡€çš„æ–¹æ¡ˆï¼Œ<strong>å‘½ä»¤è¡Œ</strong>æ¥åˆ›å»ºé¡¹ç›®ï¼Œå¼•ç”¨åŒ…ï¼Œè¿è¡Œï¼Œæµ‹è¯•ç­‰ã€‚è®©è‡ªå·±å¯¹ .net core çš„åŸç†ç»“æ„äº†è§£åœ°æ›´åŠ æ·±å…¥ä¸€äº›ã€‚</p>
<ul>
<li>é‡‡ç”¨çš„éƒ½æ˜¯ Visual Studio Code/VS2019 +PowerShell è¿è¡Œï¼Œå…³äºå¦‚ä½•é‡‡ç”¨ Visual Studio 2019 åˆ›å»ºé¡¹ç›®ï¼Œå¼•ç”¨åŒ…æ˜¯éå¸¸ç®€å•çš„ï¼Œä¸å†è¯´æ˜ã€‚</li>
</ul>
]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">è®¤è¯é‰´æƒçŠ¶æ€</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/IdentityServer4-JWT.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/IdentityServer4-JWT.html"/>
    <updated>2020-07-24T17:10:08.000Z</updated>
    <content type="html"><![CDATA[<h1 id="è®¤è¯é‰´æƒçŠ¶æ€" tabindex="-1"> è®¤è¯é‰´æƒçŠ¶æ€</h1>
<p>è®¤è¯åˆ†ä¸ºä»¥ä¸‹æƒ…å†µï¼šå½“å‰è§’è‰²ä¸ºç®¡ç†å‘˜ï¼Œè¯¥åˆ†ç»„é…ç½®äº†æƒé™ï¼Œè¯¥åˆ†ç»„æœªåˆ†é…æŸä¸€æ–¹æ³•çš„æƒé™.</p>
<p>çŠ¶æ€ç ï¼ˆStatusCode):401 UnAuthorized</p>
<table>
<thead>
<tr>
<th>StatusCode</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>401 UnAuthorized</td>
<td>æœªæˆæƒã€æ— æƒé™ã€æœªç™»å½•</td>
</tr>
<tr>
<td>422  UNPROCESSABLE ENTITY</td>
<td>ä»¤ç‰Œå¤±æ•ˆ</td>
</tr>
<tr>
<td>200</td>
<td>è®¿é—®æ­£å¸¸</td>
</tr>
</tbody>
</table>
<ol>
<li>æœªç™»å½•ï¼Œä¸å¸¦access_tokenï¼Œç›´æ¥è¯·æ±‚éœ€è¦ç™»å½•çš„æ¥å£ã€ç®¡ç†å‘˜æ¥å£ç»“æœä¸€æ ·ã€‚</li>
</ol>
<p>è¿”å›ç»“æœåº”ä¸ºï¼šçŠ¶æ€ç ï¼š401 UNAUTHORIZED</p>
<div><pre><code>{
    "error_code": 10000,
    "msg": "è®¤è¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¯·æ±‚å¤´æˆ–è€…é‡æ–°ç™»é™†",
    "request": "GET  /cms/admin/authority"
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><ol start="2">
<li>æºå¸¦access_tokenï¼Œä½†éè¶…çº§ç®¡ç†å‘˜(adminå­—æ®µä¸º2),è®¿é—®çš„æ–¹æ³•ä¸ºè§’è‰²ä¸ºè¶…ç®¡æ‰æœ‰æƒé™çš„æ–¹æ³•ã€‚</li>
</ol>
<div><pre><code>[LinCmsAuthorize(Roles = LinGroup.Administrator)]
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>è¿”å›ç»“æœåº”ä¸ºï¼šï¼šçŠ¶æ€ç ï¼š401 UNAUTHORIZED</p>
<div><pre><code>{
    "error_code": 10000,
    "msg": "åªæœ‰è¶…çº§ç®¡ç†å‘˜å¯æ“ä½œ",
    "request": "GET  /cms/admin/authority"
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><ol start="3">
<li>æºå¸¦access_token ï¼Œè®¿é—®åªéœ€è¦ç™»å½•çš„æ¥å£ï¼ˆ/cms/user/authsï¼‰</li>
</ol>
<p>æ§åˆ¶å™¨æˆ–æ–¹æ³•ä¸ŠæŒ‡å®š <strong>[Authorize]</strong> æˆ– <strong>[LinCmsAuthorize]</strong> ç‰¹æ€§æ ‡ç­¾æ—¶ï¼Œå¿…é¡»ç™»å½•æ‰èƒ½è®¿é—®ï¼Œå¦åˆ™è¿”å›ç¬¬ä¸€ç§ç»“æœã€‚</p>
<p>è¿”å›ç»“æœåº”ä¸ºï¼šçŠ¶æ€ç ï¼š200</p>
<div><pre><code>{
    "active": 1,
    "admin": 1,
    "auths": [
        {
            "ä¿¡æ¯": [
                {
                    "auth": "æŸ¥çœ‹linçš„ä¿¡æ¯",
                    "module": "ä¿¡æ¯"
                }
            ]
        }
    ],
    "avatar": null,
    "create_time": 1564372600000,
    "email": "acs@acs.com",
    "group_id": 54,
    "id": 112,
    "nickname": "alan",
    "update_time": 1564487059000
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><ol start="4">
<li>æºå¸¦access_tokenï¼Œä½†æ­¤ç”¨æˆ·æ— è®¿é—®æ­¤æ–¹æ³•çš„æƒé™ï¼ˆå³è¯¥ç”¨æˆ·çš„ç»„åˆ«æœªé…ç½®æ­¤æƒé™ï¼‰ã€‚</li>
</ol>
<p>è¿”å›ç»“æœåº”ä¸ºï¼šçŠ¶æ€ç ï¼š401 UNAUTHORIZED</p>
<div><pre><code>{
    "error_code": 10000,
    "msg": "æƒé™ä¸å¤Ÿï¼Œè¯·è”ç³»è¶…çº§ç®¡ç†å‘˜è·å¾—æƒé™",
    "request": "GET  /cms/log/search"
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><ol start="5">
<li>æºå¸¦è¿‡æœŸçš„access_tokenå€¼
è¿”å›ç»“æœåº”ä¸ºï¼šçŠ¶æ€ç ï¼š401 UNAUTHORIZED</li>
</ol>
<div><pre><code>{
    "error_code": 10050,
    "msg": "ä»¤ç‰Œè¿‡æœŸ",
    "request": "GET  /cms/admin/users"
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><ol start="6">
<li>æºå¸¦ä¸æ­£å¸¸çš„access_tokenå€¼ï¼Œåå°æ— æ³•ä¸‹æ­£å¸¸è§£æå‡ºç”¨æˆ·ä¿¡æ¯
è¿”å›ç»“æœåº”ä¸ºï¼šçŠ¶æ€ç ï¼š422 UNPROCESSABLE ENTITY</li>
</ol>
<div><pre><code>{
    "error_code": 10040,
    "msg": "ä»¤ç‰Œå¤±æ•ˆ",
    "request": "GET  /cms/admin/users"
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div>]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">äº§å“è®¾è®¡</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/Production-Design.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/Production-Design.html"/>
    <updated>2020-07-24T17:10:08.000Z</updated>
    <content type="html"><![CDATA[<h1 id="äº§å“è®¾è®¡" tabindex="-1"> äº§å“è®¾è®¡</h1>
<h2 id="äº§å“è®¾è®¡-è¯„è®ºæ¨¡å—çš„è®¾è®¡" tabindex="-1"> äº§å“è®¾è®¡-è¯„è®ºæ¨¡å—çš„è®¾è®¡</h2>
<h3 id="_1-ä¸»é¢˜å¼" tabindex="-1"> 1.ä¸»é¢˜å¼</h3>
<p>å°†è¯„è®ºåˆ†ä¸ºäºŒçº§ï¼Œç¬¬ä¸€çº§é‡‡ç”¨æ—¶é—´å€’åºï¼ŒäºŒçº§æŒ‰ç…§æ—¶é—´æ­£åºï¼Œæœ‰åŠ©äºç†è§£ä¸Šä¸‹æ–‡å…³ç³»ã€‚</p>
<p>ç”¨æˆ·æ“ä½œï¼š</p>
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-0"><label for="task-item-0"> è¯„è®ºéšç¬”(å†…å®¹æ”¯æŒè¶…é“¾æ¥ã€emoji)</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-1"><label for="task-item-1">  ç‚¹èµè¯„è®º/å–æ¶ˆç‚¹èµ</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-2"><label for="task-item-2">  å›å¤è¯„è®º</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-3"><label for="task-item-3">  åˆ é™¤è‡ªå·±çš„è¯„è®º</label></li>
</ul>
<p>è¿è¥æ“ä½œï¼š</p>
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-4"><label for="task-item-4">  å®¡æ ¸é€šè¿‡/æ‹‰é»‘è¯„è®º</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-5"><label for="task-item-5">  åˆ é™¤ä»»ä½•è¯„è®º</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-6"><label for="task-item-6">  æ‹‰é»‘åçš„æ˜¾ç¤ºé€»è¾‘ã€‚ï¼ˆä¿ç•™å½“å‰åŒºå—ã€æ˜¾ç¤ºå†…å®¹ä¸ºï¼šè¯¥è¯„è®ºå› è¿è§„è¢«æ‹‰é»‘ï¼‰</label></li>
<li>åˆ é™¤ï¼šï¼ˆå¦‚æœæ˜¯äºŒçº§è¯„è®ºï¼Œç›´æ¥è½¯åˆ é™¤ï¼Œå¦‚æœæ˜¯ä¸€çº§è¯„è®ºï¼Œè½¯åˆ é™¤å­è¯„è®ºå’Œå½“å‰è¯„è®º-éœ€è¦æå‰æé†’ç”¨æˆ·ï¼‰
äº¤äº’è®¾è®¡</li>
<li>è¯„è®ºçš„å­—æ•°é•¿åº¦ï¼ˆ500ï¼‰ã€emojiã€‚</li>
<li>ç‚¹èµäº¤äº’-åŠ¨ç”»ã€æ¶ˆæ¯é€šçŸ¥/æ¨é€</li>
<li>è¯„è®ºåŒºåŸŸå…ƒç´ ï¼Œéœ€è¦æœ‰æ˜ç¡®å¯ç‚¹å‡»çš„åŒºåŸŸï¼Œä¼šè·³è½¬åˆ°å“ªä¸ªåœ°æ–¹ã€‚</li>
</ul>
<h3 id="ä¼˜åŒ–" tabindex="-1"> ä¼˜åŒ–</h3>
<ul>
<li>ç²¾é€‰è¯„è®º</li>
</ul>
<h2 id="æ’è¡Œæ¦œè§è§£" tabindex="-1"> æ’è¡Œæ¦œè§è§£</h2>
<p>æ’è¡Œæ¦œä»å¿ƒç†å­¦ä¸Šåˆ†æï¼Œä¸»è¦ä»å››ä¸ªæ–¹é¢å½±å“ç€æ‚¨ï¼š<strong>å¯»æ‰¾æƒå¨ ã€å‚ä¸æ¯”è¾ƒ ã€å…³æ³¨ä¸»æµ ã€è‡ªæˆ‘ç¡®è®¤ã€‚</strong></p>
<p>å¦‚ä½•è®¾è®¡ä¸€ä¸ªç®€å•çš„æ’è¡Œæ¦œå‘¢ã€‚ã€‚</p>
<p>åœ¨ä¸€ä¸ªåšå®¢éšç¬”ä¸­ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ª3å¤©ã€ä¸ƒå¤©ï¼ˆå‘¨æ¦œï¼‰ã€30å¤©ï¼ˆæœˆæ¦œï¼‰ã€å…¨éƒ¨çš„æ¦œå•ã€‚ä»¥æµè§ˆé‡ï¼ˆæƒé‡1ï¼‰ã€ç‚¹èµé‡ï¼ˆ20ï¼‰ã€è¯„è®ºé‡ï¼ˆ30)ã€‚æƒé‡å¯è‡ªå·±å®šä¹‰ã€‚</p>
<p>1.é»˜è®¤å–æœ€æ–°çš„éšç¬”</p>
<p>å‰å°ä¼ create_timeæ—¶ï¼Œä½¿ç”¨å¦‚ä¸‹sql</p>
<div><pre><code>select * from `blog_article` order by create_time desc;
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>2.ä¼ æ’åºæ–¹å¼ä¸ºæœ€è¿‘nå¤©çš„çƒ­æ¦œæ—¶ã€‚</p>
<p>å‚æ•°ï¼šTHREE_DAYS_HOTTESTï¼ˆä¸‰å¤©ï¼‰ã€WEEKLY_HOTTEST(ä¸ƒå¤©ï¼‰ã€MONTHLY_HOTTESTï¼ˆä¸€ä¸ªæœˆï¼‰ã€HOTTESTï¼ˆå…¨éƒ¨ï¼‰</p>
<p>mysql æŸ¥è¯¢å½“å‰æ—¥æœŸæ—¶é—´å‰ä¸‰å¤©æ•°æ®</p>
<div><pre><code>select date_sub(now() ,interval 3 day);
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>æ ¹æ®æƒé‡æŸ¥è¯¢</p>
<div><pre><code>select * from `blog_article` a 
where a.`create_time`>(select date_sub(now() ,interval 3 day))
order by (a.`view_hits` + a.`likes_quantity` * 20 + a.`comment_quantity` * 30) DESC, a.`create_time` DESC

</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="åˆ›ä½œè€…ä¸­å¿ƒ" tabindex="-1"> åˆ›ä½œè€…ä¸­å¿ƒ</h2>
<h3 id="ç”¨æˆ·ä¸»é¡µ" tabindex="-1"> ç”¨æˆ·ä¸»é¡µ</h3>
<p>ç»Ÿè®¡å€¼ï¼šé˜…è¯»æ€»æ•°ï¼Œç‚¹èµæ€»æ•°ï¼Œå…³æ³¨è€…æ€»æ•°</p>
<h3 id="ä¸ªäººè®¾ç½®" tabindex="-1"> ä¸ªäººè®¾ç½®</h3>
<p>ç”¨æˆ·ä¿¡æ¯ã€å¯†ç ä¿®æ”¹</p>
<h2 id="æ›´å¤šå‚è€ƒ" tabindex="-1"> æ›´å¤šå‚è€ƒ</h2>
<ul>
<li><a href="http://www.woshipm.com/pd/1255548.html" target="_blank" rel="noopener noreferrer">ä¸‡å­—é•¿æ–‡æ·±åº¦åˆ†æï¼šäº§å“æ’è¡Œæ¦œçš„è®¾è®¡å’Œç©æ³•</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/52322777" target="_blank" rel="noopener noreferrer">æƒ³çŸ¥é“è°æ˜¯ä½ çš„æœ€ä½³ç”¨æˆ·ï¼ŸåŸºäºRediså®ç°æ’è¡Œæ¦œå‘¨æœŸæ¦œä¸æœ€è¿‘NæœŸæ¦œ</a></li>
</ul>
]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">å…¨å±€æ•æ„Ÿè¯å¤„ç†</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/StopWords.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/StopWords.html"/>
    <updated>2020-07-24T17:10:08.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å…¨å±€æ•æ„Ÿè¯å¤„ç†" tabindex="-1"> å…¨å±€æ•æ„Ÿè¯å¤„ç†</h1>
<p>åŸºäºToolGood.Wordsç±»åº“ï¼Œé…åˆæ•æ„Ÿå­—çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå†™çš„APIæ¥å£ã€‚</p>
<ul>
<li><a href="https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-stopwords" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-stopwords</a></li>
</ul>
<p>ä¸€å…±äºŒç§æ–¹å¼</p>
<h2 id="_1-toolgood-words" tabindex="-1"> 1.ToolGood.Words</h2>
<p>ç±»åº“é…åˆæ•æ„Ÿåº“</p>
<ul>
<li><a href="https://github.com/toolgood/ToolGood.Words" target="_blank" rel="noopener noreferrer">ToolGood.Words</a></li>
</ul>
<p>ç®€å•ç”¨æ³•</p>
<div><pre><code>[Fact]
public void IssuesTest_17()
{
    var illegalWordsSearch = new IllegalWordsSearch();
    string s = "ä¸­å›½|zgäºº|abc";
    illegalWordsSearch.SetKeywords(s.Split('|'));
    var str = illegalWordsSearch.Replace("æˆ‘æ˜¯ä¸­ç¾å›½äººå‰å®³ä¸­å›½å®Œç¾ï½ï½‚ï½ƒddbå¥½çš„", '*');

    Assert.Equal("æˆ‘æ˜¯ä¸­ç¾å›½äººå‰å®³**å®Œç¾***ddbå¥½çš„", str);
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><p>é…åˆæ•æ„Ÿåº“æ–‡æœ¬æ–‡ä»¶ï¼Œå†™çš„å·¥å…·ç±»</p>
<p>äºŒä¸ªæ–‡ä»¶æ”¾åˆ°wwwroot/_Illegalç›®å½•ä¸‹ï¼Œé€šè¿‡ReplaceStopWordsæ–¹æ³•è°ƒç”¨å³å¯å¯¹</p>
<ul>
<li><a href="https://github.com/toolgood/ToolGood.Words/blob/master/csharp/ToolGood.Words.Test/_Illegal/IllegalKeywords.txt" target="_blank" rel="noopener noreferrer">https://github.com/toolgood/ToolGood.Words/blob/master/csharp/ToolGood.Words.Test/_Illegal/IllegalKeywords.txt</a></li>
<li><a href="https://github.com/toolgood/ToolGood.Words/blob/master/csharp/ToolGood.Words.Test/_Illegal/IllegalUrls.txt" target="_blank" rel="noopener noreferrer">https://github.com/toolgood/ToolGood.Words/blob/master/csharp/ToolGood.Words.Test/_Illegal/IllegalUrls.txt</a></li>
</ul>
<div><pre><code>public class ToolGoodUtils
{
    //æ•æ„Ÿåº“åªè¦è¿™äºŒä¸ªæ–‡ä»¶å­˜åœ¨å³å¯
    //æœ¬åœ°æ•æ„Ÿåº“ç¼“å­˜-https://github.com/toolgood/ToolGood.Words/tree/master/csharp/ToolGood.Words.Test/_Illegal
    //å› ä¸ºéœ€è¦ä¸Šä¼ è‡³githubå¹¶åŒæ­¥gitee,å®‰å…¨èµ·è§ï¼Œæ‰€ä»¥æœªä¸Šä¼ è‡³gitï¼Œéœ€è¦è‡ªè¡Œä¸‹è½½å¹¶å¤åˆ¶
    private const string KeywordsPath = "wwwroot/_Illegal/IllegalKeywords.txt";
    private const string UrlsPath = "wwwroot/_Illegal/IllegalUrls.txt";

    private const string InfoPath = "wwwroot/_Illegal/IllegalInfo.txt";
    private const string BitPath = "wwwroot/_Illegal/IllegalBit.iws";

    private static IllegalWordsSearch _search;
    /// &lt;summary>
    /// æœ¬åœ°æ•æ„Ÿåº“,æ–‡ä»¶ä¿®æ”¹åï¼Œé‡æ–°åˆ›å»ºç¼“å­˜Bit
    /// &lt;/summary>
    /// &lt;returns>&lt;/returns>
    public static IllegalWordsSearch GetIllegalWordsSearch()
    {
        if (_search == null)
        {
            string ipath = Path.GetFullPath(InfoPath);
            if (File.Exists(ipath) == false)
            {
                _search = CreateIllegalWordsSearch();
            }
            else
            {
                var texts = File.ReadAllText(ipath).Split('|');
                if (new FileInfo(Path.GetFullPath(KeywordsPath)).LastWriteTime.ToString("yyyy-MM-dd HH:mm:ss") !=
                    texts[0] ||
                    new FileInfo(Path.GetFullPath(UrlsPath)).LastWriteTime.ToString("yyyy-MM-dd HH:mm:ss") !=
                    texts[1]
                )
                {
                    _search = CreateIllegalWordsSearch();
                }
                else
                {
                    var s = new IllegalWordsSearch();
                    s.Load(Path.GetFullPath(BitPath));
                    _search = s;
                }
            }
        }
        return _search;
    }

    private static IllegalWordsSearch CreateIllegalWordsSearch()
    {
        string[] words1 = File.ReadAllLines(Path.GetFullPath(KeywordsPath), Encoding.UTF8);
        string[] words2 = File.ReadAllLines(Path.GetFullPath(UrlsPath), Encoding.UTF8);
        var words = new List&lt;string>();
        foreach (var item in words1)
        {
            words.Add(item.Trim());
        }
        foreach (var item in words2)
        {
            words.Add(item.Trim());
        }

        var search = new IllegalWordsSearch();
        search.SetKeywords(words);

        search.Save(Path.GetFullPath(BitPath));

        var text = new FileInfo(Path.GetFullPath(KeywordsPath)).LastWriteTime.ToString("yyyy-MM-dd HH:mm:ss") + "|"+ new FileInfo(Path.GetFullPath(UrlsPath)).LastWriteTime.ToString("yyyy-MM-dd HH:mm:ss");
        File.WriteAllText(Path.GetFullPath(InfoPath), text);

        return search;
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br></div></div><h2 id="_2-å¾ªç¯ä½¿ç”¨replace" tabindex="-1"> 2. å¾ªç¯ä½¿ç”¨Replace</h2>
<p>æ–¹æ¡ˆï¼šé€šè¿‡ç»´æŠ¤æ•æ„Ÿåº“ï¼Œå¾ªç¯replace
å¤§ä½¬åˆ†äº«ç»™æˆ‘çš„ï¼Œç¨å¾®æ”¹æˆäº†ä»æ–‡ä»¶ä¸­è·å–æ•æ„Ÿå­—ã€‚</p>
<div><pre><code>public static class StopWords
{

    static readonly ConcurrentDictionary&lt;string, bool> FunNlpDataSensitive = new ConcurrentDictionary&lt;string, bool>();
    static readonly ConcurrentDictionary&lt;int, string> ReplaceNewValue = new ConcurrentDictionary&lt;int, string>();

    private const string KeywordsPath = "wwwroot/_Illegal/IllegalKeywords.txt";
    private const string UrlsPath = "wwwroot/_Illegal/IllegalUrls.txt";


    static StopWords()
    {
        LoadDataFromFile();
    }

    public static void LoadDataFromFile()
    {
        string words1 = File.ReadAllText(Path.GetFullPath(KeywordsPath), Encoding.UTF8);
        string words2 = File.ReadAllText(Path.GetFullPath(UrlsPath), Encoding.UTF8);
        LoadDataFromText(words1);
        LoadDataFromText(words2);
    }


    public static void LoadDataFromText(string text)
    {
        int oldcount = FunNlpDataSensitive.Count;
        foreach (string wd in text.Split('\n'))
        {
            string keykey = wd.Trim().Trim('\r', '\n').Trim();
            if (string.IsNullOrEmpty(keykey)) continue;
            FunNlpDataSensitive.TryAdd(keykey, true);
            if (ReplaceNewValue.ContainsKey(keykey.Length) == false)
                ReplaceNewValue.TryAdd(keykey.Length, "".PadRight(keykey.Length, '*'));
        }
        Console.WriteLine($"æ•æ„Ÿè¯åŠ è½½å®Œæ¯•ï¼Œå¢åŠ æ•°é‡ï¼š{FunNlpDataSensitive.Count - oldcount}");
    }


    /// &lt;summary>
    /// æ›¿æ¢æ‰€æœ‰æ•æ„Ÿè¯ä¸º *
    /// &lt;/summary>
    /// &lt;param name="that">&lt;/param>
    /// &lt;returns>&lt;/returns>
    public static string ReplaceStopWords(this string that)
    {
        foreach (var wd in FunNlpDataSensitive.Keys)
            that = that.Replace(wd, ReplaceNewValue.TryGetValue(wd.Length, out var tryval) ? tryval : "".PadRight(wd.Length, '*'));
        return that;
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br></div></div><h2 id="freesqlå…¨å±€å¤„ç†æ•æ„Ÿè¯" tabindex="-1"> FreeSqlå…¨å±€å¤„ç†æ•æ„Ÿè¯</h2>
<p>ä½¿ç”¨FreeSqlè¿™ä¸ªORMæ—¶ï¼Œå…¨å±€å¤„ç†stringç±»å‹çš„å€¼ï¼Œè¿›è¡Œæ•æ„Ÿè¯å¤„ç†ã€‚ä»£ç åœ¨StartUp.csçš„æ„é€ å‡½æ•°ä¸­ã€‚</p>
<div><pre><code>//æ•æ„Ÿè¯å¤„ç†
IllegalWordsSearch illegalWords = ToolGoodUtils.GetIllegalWordsSearch();

Fsql.Aop.AuditValue += (s, e) =>
{
    if (e.Column.CsType == typeof(string) &amp;&amp; e.Value != null)
    {
        string oldVal = (string)e.Value;
        string newVal = illegalWords.Replace(oldVal);
        //ç¬¬äºŒç§å¤„ç†æ•æ„Ÿè¯çš„æ–¹å¼
        //string newVal = oldVal.ReplaceStopWords();
        if (newVal != oldVal)
        {
            e.Value = newVal;
        }
    }
};
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div>]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">å¼€å‘èµ·æ­¥</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/dev-start.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/dev-start.html"/>
    <updated>2021-12-12T10:05:43.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å¼€å‘èµ·æ­¥" tabindex="-1"> å¼€å‘èµ·æ­¥</h1>
<h2 id="é¡¹ç›®ç»“æ„" tabindex="-1"> é¡¹ç›®ç»“æ„</h2>
<ul>
<li>framework
<ul>
<li>IGeekFan.Localization.FreeSqlï¼šä½¿ç”¨FreeSqlå­˜å‚¨æœ¬åœ°åŒ–æ•°æ®</li>
</ul>
</li>
<li>identityserver4
<ul>
<li>LinCms.IdentityServer4:ä½¿ç”¨id4æˆæƒç™»å½•</li>
</ul>
</li>
<li>src
<ul>
<li>LinCms.Webï¼šæ¥å£APIï¼ˆASP.NET Core)ã€ä¸­é—´ä»¶ï¼Œæƒé™éªŒè¯</li>
<li>LinCms.Application:åº”ç”¨æœåŠ¡</li>
<li>LinCms.Application.Contracts:DTO,æ•°æ®ä¼ è¾“å¯¹è±¡,åº”ç”¨æœåŠ¡æ¥å£</li>
<li>LinCms.Infrastructure:åŸºç¡€è®¾æ–½ï¼Œæ•°æ®åº“æŒä¹…æ€§çš„æ“ä½œï¼Œä»“å‚¨æ¥å£çš„å®ç°</li>
<li>LinCms.Core:è¯¥åº”ç”¨çš„æ ¸å¿ƒï¼Œå®ä½“ç±»ï¼Œé€šç”¨æ“ä½œç±»ï¼ŒAOPæ‰©å±•ï¼Œåˆ†é¡µå¯¹è±¡ï¼ŒåŸºç¡€ä¾èµ–å¯¹è±¡æ¥å£ï¼Œæ—¶é—´æ‰©å±•æ–¹æ³•ï¼Œå½“å‰ç”¨æˆ·ä¿¡æ¯ï¼Œå¼‚å¸¸ç±»ï¼Œå€¼å¯¹è±¡ï¼Œä»“å‚¨æ¥å£</li>
<li>LinCms.Plugins ä½¿ç”¨å•é¡¹ç›®å®ç°æŸä¸ªä¸šåŠ¡çš„æ‰©å±•ï¼Œä¸éœ€è¦ä¸»è¦é¡¹ç›®ç»“æ„ï¼Œå¯æš‚æ—¶å¿½ç•¥ã€‚</li>
</ul>
</li>
<li>test
<ul>
<li>LinCms.Test:å¯¹ä»“å‚¨ï¼Œåº”ç”¨æœåŠ¡æˆ–å·¥å…·ç±»è¿›è¡Œæµ‹è¯•</li>
</ul>
</li>
</ul>
<div><pre><code>â”œâ”€framework
â”‚  â””â”€src
â”‚      â””â”€IGeekFan.Localization.FreeSql
â”œâ”€identityserver4
â”‚  â””â”€LinCms.IdentityServer4
â”‚      â”œâ”€Controllers
â”‚      â”œâ”€IdentityServer4
â”œâ”€src
â”‚  â”œâ”€LinCms.Application
â”‚  â”‚  â”œâ”€Cms
â”‚  â”‚  â”‚  â”œâ”€Admin
â”‚  â”‚  â”‚  â”œâ”€Files
â”‚  â”‚  â”‚  â”œâ”€Groups
â”‚  â”‚  â”‚  â”œâ”€Logs
â”‚  â”‚  â”‚  â”œâ”€Permissions
â”‚  â”‚  â”‚  â”œâ”€Settings
â”‚  â”‚  â”‚  â””â”€Users
â”‚  â”œâ”€LinCms.Application.Contracts
â”‚  â”‚  â”œâ”€Cms
â”‚  â”‚  â”‚  â”œâ”€Account
â”‚  â”‚  â”‚  â”œâ”€Admins
â”‚  â”‚  â”‚  â”‚  â””â”€Dtos
â”‚  â”‚  â”‚  â”œâ”€Files
â”‚  â”‚  â”‚  â”‚  â””â”€Dtos
â”‚  â”‚  â”‚  â”œâ”€Groups
â”‚  â”‚  â”‚  â”‚  â””â”€Dtos
â”‚  â”‚  â”‚  â”œâ”€Logs
â”‚  â”‚  â”‚  â”‚  â””â”€Dtos
â”‚  â”‚  â”‚  â”œâ”€Permissions
â”‚  â”‚  â”‚  â”‚  â””â”€Dtos
â”‚  â”‚  â”‚  â”œâ”€Settings
â”‚  â”‚  â”‚  â”‚  â””â”€Dtos
â”‚  â”‚  â”‚  â””â”€Users
â”‚  â”‚  â”‚      â””â”€Dtos
â”‚  â”œâ”€LinCms.Core
â”‚  â”‚  â”œâ”€Aop
â”‚  â”‚  â”œâ”€Common
â”‚  â”‚  â”œâ”€Data
â”‚  â”‚  â”‚  â””â”€Enums
â”‚  â”‚  â”œâ”€Dependency
â”‚  â”‚  â”œâ”€Entities
â”‚  â”‚  â”‚  â””â”€Settings
â”‚  â”‚  â”œâ”€Exceptions
â”‚  â”‚  â”œâ”€Extensions
â”‚  â”‚  â”œâ”€IRepositories
â”‚  â”‚  â”œâ”€LinCms
â”‚  â”‚  â”‚  â””â”€Core
â”‚  â”‚  â”œâ”€Middleware
â”‚  â”‚  â””â”€Security
â”‚  â”œâ”€LinCms.Infrastructure
â”‚  â”‚  â””â”€Repositories
â”‚  â”œâ”€LinCms.Plugins
â”‚  â”‚  â””â”€Poem
â”‚  â”‚      â”œâ”€AutoMapper
â”‚  â”‚      â”œâ”€Controllers
â”‚  â”‚      â””â”€Models
â”‚  â””â”€LinCms.Web
â”‚      â”œâ”€Configs
â”‚      â”œâ”€Controllers
â”‚      â”‚  â”œâ”€Cms
â”‚      â”œâ”€Data
â”‚      â”‚  â””â”€Authorization
â”‚      â”œâ”€Properties
â”‚      â”œâ”€SnakeCaseQuery
â”‚      â”œâ”€Uow
â”‚      â”œâ”€Utils
â”‚      â””â”€wwwroot
â””â”€test
    â””â”€LinCms.Test
        â”œâ”€Controller
        â”‚  â”œâ”€Cms
        â”œâ”€Properties
        â”œâ”€Service
        â”‚  â””â”€Cms
        â””â”€Utils
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br><span>73</span><br><span>74</span><br><span>75</span><br></div></div><h2 id="ç›¸å…³æŠ€æœ¯" tabindex="-1"> ç›¸å…³æŠ€æœ¯</h2>
<h3 id="freesql" tabindex="-1"> FreeSql</h3>
<ul>
<li>
<p><a href="/dotnetcore/examples/freesql-in-aspnetcore-webapi-how-to-use.html" target="_blank" rel="noopener noreferrer">ä¸»è¦åœ¨ä»‹ç»FreeSqlåœ¨ASP.NTE Core WebApiä¸­å¦‚ä½•ä½¿ç”¨çš„è¿‡ç¨‹ï¼Œå®Œæˆä¸€ä¸ªæœ€ç®€å•çš„åšå®¢ç³»ç»Ÿçš„åç«¯æ¥å£</a></p>
</li>
<li>
<p><a href="/dotnetcore/examples/freesql-sample-blog-restful-use-automapper.html" target="_blank" rel="noopener noreferrer">æœ¬æ–‡ä½¿ç”¨ASP .NET Coreçš„WEB APIï¼Œæ„å»ºä¸€ä¸ªRESTfulé£æ ¼çš„æ¥å£ï¼Œä½¿ç”¨Freesqlè®¿é—®MySQLæ•°æ®åº“ï¼Œå®ç°äºŒä¸ªè¡¨çš„ç®€å•åšå®¢ï¼Œå¹¶é›†æˆAutoMapperã€‚</a></p>
</li>
</ul>
<h3 id="identityserver4" tabindex="-1"> IdentityServer4</h3>
<ul>
<li><a href="/dotnetcore/examples/IdentityServer4.html" target="_blank" rel="noopener noreferrer">IdentityServer4 åœ¨æœ¬é¡¹ç›®ä¸­çš„åº”ç”¨</a></li>
</ul>
]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">åç«¯å‡†å¤‡</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/dotnetcore-start.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/dotnetcore-start.html"/>
    <updated>2021-12-22T18:31:25.000Z</updated>
    <content type="html"><![CDATA[<h1 id="åç«¯å‡†å¤‡" tabindex="-1"> åç«¯å‡†å¤‡</h1>
<h2 id="server-ç«¯å¿…å¤‡ç¯å¢ƒ" tabindex="-1"> Server ç«¯å¿…å¤‡ç¯å¢ƒ</h2>
<ul>
<li>å®‰è£…è½¯ä»¶å¼€å‘åŒ… <a href="https://dotnet.microsoft.com/zh-cn/download/dotnet/6.0" target="_blank" rel="noopener noreferrer">.NET SDK 6.0</a></li>
<li>å®‰è£…å¼€å‘å·¥å…·  <a href="https://visualstudio.microsoft.com/zh-hans/vs/" target="_blank" rel="noopener noreferrer">Visual Studio 2022</a>  æˆ– <a href="https://www.jetbrains.com/rider/" target="_blank" rel="noopener noreferrer">Rider</a></li>
<li>å®‰è£…MySQLï¼ˆversion 5.7+)</li>
<li>Redis 4.0.14.2 for Windows <a href="https://github.com/tporadowski/redis/releases" target="_blank" rel="noopener noreferrer">https://github.com/tporadowski/redis/releases</a></li>
</ul>
<h2 id="è·å–å·¥ç¨‹é¡¹ç›®" tabindex="-1"> è·å–å·¥ç¨‹é¡¹ç›®</h2>
<div><pre><code><span>git</span> clone https://github.com/luoyunchong/lin-cms-dotnetcore.git
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="æ•°æ®åº“é…ç½®" tabindex="-1"> æ•°æ®åº“é…ç½®</h2>
<p>æ–‡ä»¶ä½ç½®<code>src/LinCms.Web/appsettings.json</code>ï¼Œå½“æ•°æ®åº“ä¸­å­˜å‚¨è¡¨æƒ…åŒ…æ˜¯ï¼Œ<code>Charset</code>ä¸º<code>utf8mb4</code></p>
<p><strong>è¯·åŠ¡å¿…æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µä¿®æ”¹æ­¤é…ç½®é¡¹</strong>ï¼Œ<code>DefaultDB</code>ä¸º0æ—¶ï¼Œä»£è¡¨ä½¿ç”¨<code>MySQL</code>ï¼Œ<code>DefaultDB</code>ä¸º1æ—¶ï¼Œä»£è¡¨ä½¿ç”¨<code>SqlServer</code>,ä»¥æ­¤ç±»æ¨ã€‚</p>
<div><pre><code> <span>"ConnectionStrings"</span><span>:</span> <span>{</span>
    <span>"DefaultDB"</span><span>:</span> <span>"0"</span><span>,</span>
    <span>"DataType"</span><span>:</span> <span>{</span>
      <span>"MySql"</span><span>:</span> <span>0</span><span>,</span>
      <span>"SqlServer"</span><span>:</span> <span>1</span><span>,</span>
      <span>"PostgreSQL"</span><span>:</span> <span>2</span><span>,</span>
      <span>"Oracle"</span><span>:</span> <span>3</span><span>,</span>
      <span>"Sqlite"</span><span>:</span> <span>4</span>
    <span>}</span><span>,</span>
    <span>"MySql"</span><span>:</span> <span>"Data Source=localhost;Port=3306;User ID=root;Password=root;Initial Catalog=lincms;Charset=utf8mb4;SslMode=none;Max pool size=1;Connection LifeTime=20"</span><span>,</span>
    <span>"SqlServer"</span><span>:</span> <span>"Data Source=.;User ID=sa;Password=123456;Integrated Security=True;Initial Catalog=LinCMS;Pooling=true;Min Pool Size=1"</span><span>,</span>
    <span>"PostgreSQL"</span><span>:</span> <span>"Host=localhost;Port=5432;Username=postgres;Password=123456; Database=lincms;Pooling=true;Minimum Pool Size=1"</span><span>,</span>
    <span>"Oracle"</span><span>:</span> <span>null</span><span>,</span>
    <span>"Sqlite"</span><span>:</span> <span>"Data Source=|DataDirectory|\\lincms.db; Attachs=lincms.db; Pooling=true;Min Pool Size=1"</span><span>,</span>
    <span>"CsRedis"</span><span>:</span> <span>"127.0.0.1:6379,password=,defaultDatabase=0"</span>
  <span>}</span><span>,</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br></div></div><p><code>LinCms.IdentityServer4</code> é¡¹ç›®ä¸æ˜¯å¿…é¡»çš„ï¼Œéœ€è¦éœ€è¦è¿è¡Œï¼Œéœ€è¦ä¿®æ”¹æ•°æ®åº“é…ç½®é¡¹</p>
<p><code>identityserver4/LinCms.IdentityServer4/appsettings.json</code> æ•°æ®åº“é…ç½®ã€åŒ<code>LinCms.Web</code>ä¸­çš„é…ç½®é¡¹ç›¸åŒ</p>
<div><pre><code>  <span>"ConnectionStrings"</span><span>:</span> <span>{</span>
    <span>"DefaultDB"</span><span>:</span> <span>"0"</span><span>,</span>
    <span>"DataType"</span><span>:</span> <span>{</span>
      <span>"MySql"</span><span>:</span> <span>0</span><span>,</span>
      <span>"SqlServer"</span><span>:</span> <span>1</span><span>,</span>
      <span>"PostgreSQL"</span><span>:</span> <span>2</span><span>,</span>
      <span>"Oracle"</span><span>:</span> <span>3</span><span>,</span>
      <span>"Sqlite"</span><span>:</span> <span>4</span>
    <span>}</span><span>,</span>
    <span>"MySql"</span><span>:</span> <span>"Data Source=localhost;Port=3308;User ID=root;Password=root;Initial Catalog=lincms;Charset=utf8mb4;SslMode=none;Max pool size=1;Connection LifeTime=20"</span><span>,</span>
    <span>"SqlServer"</span><span>:</span> <span>"Data Source=.;User ID=sa;Password=123456;Integrated Security=True;Initial Catalog=LinCMS;Pooling=true;Min Pool Size=1"</span><span>,</span>
    <span>"Sqlite"</span><span>:</span> <span>"Data Source=|DataDirectory|\\lincms.db; Attachs=lincms.db; Pooling=true;Min Pool Size=1"</span>
  <span>}</span><span>,</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><p>å…¶ä¸­MariaDBï¼ˆçœ‹åšMySqlï¼‰,é€šè¿‡<code>Serilog</code>è®°å½•æ—¥å¿—ï¼Œéœ€è¦é…ç½®ç›¸åº”çš„é“¾æ¥ä¸²ã€‚</p>
<div><pre><code><span>{</span>
        <span>"Name"</span><span>:</span> <span>"MariaDB"</span><span>,</span>
        <span>"Args"</span><span>:</span> <span>{</span>
          <span>"connectionString"</span><span>:</span> <span>"Data Source=localhost;Port=3306;User ID=root;Password=root;Initial Catalog=lincms;Charset=utf8mb4;SslMode=none;Max pool size=1;Connection LifeTime=20"</span><span>,</span>
        <span>}</span>
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="æ•°æ®è¿ç§»" tabindex="-1"> æ•°æ®è¿ç§»</h2>
<p>è¯¥é¡¹ç›®ä½¿ç”¨<a href="https://github.com/2881099/FreeSql" target="_blank" rel="noopener noreferrer">FreeSql</a>ï¼Œé»˜è®¤è‡ªåŠ¨è¿ç§»æ•°æ®è¡¨ç»“æ„ï¼Œä¼šè‡ªåŠ¨æ ¹æ®é…ç½®é¡¹åˆ›å»ºæ•°æ®åº“ï¼Œåˆå§‹åŒ–ç§å­æ•°æ®</p>
<p>é»˜è®¤ä¼šåˆ›å»ºç”¨æˆ·<code>admin</code>ï¼Œå¯†ç <code>123qwe</code></p>
<h2 id="visual-studio-2022è¿è¡Œé¡¹ç›®" tabindex="-1"> visual studio 2022è¿è¡Œé¡¹ç›®</h2>
<p>åŒå‡»lin-cms-dotnetcore.slnï¼Œä½¿ç”¨vs2022æ‰“å¼€é¡¹ç›®ã€‚å³é”®è§£å†³æ–¹æ¡ˆï¼Œç‚¹å‡»ç”Ÿæˆè§£å†³æ–¹æ¡ˆã€‚</p>
<p>ç”±äºå°†identityserver4å•ç‹¬æ‹†æˆäº†ä¸€ä¸ªé¡¹ç›®ï¼Œæ‰€ä»¥éœ€è¦åŒæ—¶å¯åŠ¨äºŒä¸ªé¡¹ç›®ï¼Œ<strong>å³é”®è§£å†³æ–¹æ¡ˆï¼Œå±æ€§ã€‚</strong>,é€‰æ‹©å¤šä¸ªå¯åŠ¨é¡¹ç›®ï¼Œå‹¾é€‰äºŒä¸ªé¡¹ç›®åŒæ—¶å¯åŠ¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://pic.downk.cc/item/5e83fd74504f4bcb04cf5474.png" alt="" loading="lazy"></p>
<p>è¿™æ—¶å€™ä¼šæ‰“å¼€äºŒä¸ªç½‘é¡µ  https://localhost:5001/swagger/index.htmlï¼Œå³å¯çœ‹åˆ°swaggeré¡µé¢ã€‚</p>
<p><img src="https://pic.downk.cc/item/5e83ffd1504f4bcb04d0f039.jpg" alt="" loading="lazy"></p>
<p>ä¼šæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®<a href="https://localhosst:5001/swagger/index.html" target="_blank" rel="noopener noreferrer">https://localhosst:5001/swagger/index.html</a>ï¼Œä¼šçœ‹åˆ°swaggerçš„æ–‡æ¡£ã€‚
è®¿é—®<a href="https://localhosst:5001/swagger/index.html" target="_blank" rel="noopener noreferrer">https://localhosst:5003/swagger/index.html</a> æ˜¯ids4çš„æ¥å£æ–‡æ¡£ï¼Œä»€ä¹ˆä¹Ÿçœ‹ä¸åˆ°ã€‚</p>
<p>LinCms.Webè¿è¡Œæ•ˆæœï¼š
<img src="https://ae01.alicdn.com/kf/He52bc4d3708242d2995419bb584e1f53Q.jpg" alt="" loading="lazy"></p>
<h2 id="éƒ¨ç½²" tabindex="-1"> éƒ¨ç½²</h2>
<ul>
<li><a href="https://blog.igeekfan.cn/2022/06/09/dotnetcore/ASP.NET-Core-Deploy-To-Ubuntu" target="_blank" rel="noopener noreferrer">éƒ¨ç½²è‡³Linux(Ubuntu16.06)</a></li>
<li><a href="https://blog.igeekfan.cn/2022/06/09/dotnetcore/ASP.NET-Core-Deploy-To-Docker-Ubuntu/" target="_blank" rel="noopener noreferrer">éƒ¨ç½²è‡³Linux(Ubuntu16.06)ä¸‹çš„Docker</a></li>
</ul>
<h2 id="éƒ¨ç½²å‰å‡†å¤‡" tabindex="-1"> éƒ¨ç½²å‰å‡†å¤‡</h2>
<p>å› ä¸ºè¯¥é¡¹ç›®åŸºäºIdentityServer4,å®ç°çš„æˆæƒè®¤è¯æœåŠ¡ï¼Œ</p>
<p>å¼€å‘é˜¶æ®µä½¿ç”¨<code>AddDeveloperSigningCredential()</code>æ–¹æ³•å³å¯å®Œæˆç­¾åè®¤è¯ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨<code>AddSigningCredential()</code>æ–¹æ³•å¹¶ä¸”ä½¿ç”¨OpenSSLç”Ÿæˆè‡ªå·±çš„ç­¾åè¯ä¹¦</p>
<p>Startup.cs</p>
<div><pre><code>            services.AddIdentityServer()
#if  DEBUG
                .AddDeveloperSigningCredential()
#endif
#if !DEBUG
                .AddSigningCredential(new X509Certificate2(Path.Combine(AppContext.BaseDirectory,
                        Configuration["Certificates:Path"]),
                    Configuration["Certificates:Password"]))
#endif
                .AddInMemoryIdentityResources(InMemoryConfiguration.GetIdentityResources())
                .AddInMemoryApiResources(InMemoryConfiguration.GetApis())
                .AddInMemoryClients(InMemoryConfiguration.GetClients())
                .AddProfileService&lt;LinCmsProfileService>()
                .AddResourceOwnerValidator&lt;LinCmsResourceOwnerPasswordValidator>();
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><p>appsettings.Production.json</p>
<div><pre><code>{
    "Certificates":
    {
        "Path":"ids4.pfx",
        "Password":"123qwe"
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br></div></div><h3 id="ä½¿ç”¨opensslç”Ÿæˆè¯ä¹¦" tabindex="-1"> ä½¿ç”¨OpenSSLç”Ÿæˆè¯ä¹¦</h3>
<p>å®˜ç½‘ä¸‹è½½å¹¶å®‰è£…OpenSSL <a href="https://slproweb.com/products/Win32OpenSSL.html" target="_blank" rel="noopener noreferrer">OpenSSLå®˜ç½‘</a></p>
<p>ä¸‹è½½ Win64 OpenSSL v1.1.1b ç‰ˆæœ¬</p>
<p>åœ¨OpenSSLçš„binæ–‡ä»¶å¤¹ï¼Œä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€CMDæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div><pre><code>openssl req -newkey rsa:2048 -nodes -keyout ids4.key -x509 -days 365 -out ids4.cer
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>ä¸‹é¢å°†ç”Ÿæˆçš„è¯ä¹¦å’ŒKeyå°è£…æˆä¸€ä¸ªæ–‡ä»¶ï¼Œä»¥ä¾¿IdentityServerå¯ä»¥ä½¿ç”¨å®ƒä»¬å»æ­£ç¡®åœ°ç­¾åtokens</p>
<div><pre><code>openssl pkcs12 -export -in ids4.cer -inkey ids4.key -out ids4.pfx 
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h5 id="æ³¨-åœ¨ç”Ÿæˆçš„è¿‡ç¨‹ä¸­ä¼šè®©æˆ‘ä»¬è¾“å…¥export-password" tabindex="-1"> (æ³¨ï¼šåœ¨ç”Ÿæˆçš„è¿‡ç¨‹ä¸­ä¼šè®©æˆ‘ä»¬è¾“å…¥Export Password)</h5>
<p>è¿™ä¸ª å¯†ç ä¸appsettings.Production.jsoné…ç½®é¡¹ç›¸åŒã€‚</p>
<p>å‘å¸ƒæ—¶ï¼ŒæŠŠids4.pfxï¼Œæ”¾åˆ°é¡¹ç›®æ ¹ç›®å½•</p>
<h2 id="å‚è€ƒ" tabindex="-1"> å‚è€ƒ</h2>
<ul>
<li><a href="https://www.cnblogs.com/guolianyu/p/9872661.html" target="_blank" rel="noopener noreferrer">IdentityServer4ä¹‹JWTç­¾å(RSAåŠ å¯†è¯ä¹¦)åŠéªŒç­¾</a></li>
</ul>
]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">code</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/error-code.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/error-code.html"/>
    <updated>2020-02-28T11:10:31.000Z</updated>
    <content type="html"><![CDATA[<h1 id="code" tabindex="-1"> code</h1>
<h2 id="æ ¸å¿ƒåº“å†…ç½®å·²ä½¿ç”¨çŠ¶æ€ç " tabindex="-1"> æ ¸å¿ƒåº“å†…ç½®å·²ä½¿ç”¨çŠ¶æ€ç </h2>
<p>0 æˆåŠŸ</p>
<p>999 æœåŠ¡å™¨æœªçŸ¥é”™è¯¯</p>
<p>9999 å¤±è´¥</p>
<p>10000 è®¤è¯å¤±è´¥</p>
<p>10020 èµ„æºä¸å­˜åœ¨</p>
<p>10030 å‚æ•°é”™è¯¯</p>
<p>10040 ä»¤ç‰Œå¤±æ•ˆ</p>
<p>10050 ä»¤ç‰Œè¿‡æœŸ</p>
<p>10060 å­—æ®µé‡å¤</p>
<p>10070 ç¦æ­¢æ“ä½œ</p>
<p>10080 è¯·æ±‚æ–¹æ³•ä¸å…è®¸</p>
<p>10100 refresh token è·å–å¤±è´¥</p>
<p>10110 æ–‡ä»¶ä½“ç§¯è¿‡å¤§</p>
<p>10120 æ–‡ä»¶æ•°é‡è¿‡å¤š</p>
<p>10130 æ–‡ä»¶æ‰©å±•åä¸ç¬¦åˆè§„èŒƒ</p>
<p>10140 è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•</p>
]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">åŠŸèƒ½æ¨¡å—çš„è®¾è®¡</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/pm-design-modules.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/pm-design-modules.html"/>
    <updated>2020-05-08T05:46:31.000Z</updated>
    <content type="html"><![CDATA[<h1 id="åŠŸèƒ½æ¨¡å—çš„è®¾è®¡" tabindex="-1"> åŠŸèƒ½æ¨¡å—çš„è®¾è®¡</h1>
<h2 id="åŸºç¡€æƒé™æ¨¡å—" tabindex="-1"> åŸºç¡€æƒé™æ¨¡å—</h2>
<ul>
<li>ç”¨æˆ·ä¿¡æ¯ï¼šé‚®ä»¶ã€ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰ã€æ˜µç§°ã€å¤´åƒã€åˆ†ç»„ã€æ˜¯å¦æ¿€æ´»ã€æ‰‹æœºå·ã€æ˜¯å¦æ˜¯Adminã€ä¸ªæ€§ç­¾å
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-0"><label for="task-item-0"> æ³¨å†Œ/ç™»å½•</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-1"><label for="task-item-1"> ä¸Šä¼ å¤´åƒ</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-2"><label for="task-item-2"> ä¿®æ”¹å¯†ç </label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-3"><label for="task-item-3"> ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ä¿®æ”¹</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-4"><label for="task-item-4"> ç”¨æˆ·å¢åˆ æ”¹ï¼Œé…ç½®åˆ†ç»„</label></li>
</ul>
</li>
<li>ç»‘å®šç¬¬ä¸‰æ–¹è´¦å·
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-5"><label for="task-item-5"> GitHubç™»å½•</label></li>
<li><input type="checkbox"  disabled="disabled" id="task-item-6"><label for="task-item-6"> QQ ç™»å½•</label></li>
</ul>
</li>
<li>åˆ†ç»„ä¿¡æ¯ï¼šæ˜¯å¦é™æ€åˆ†ç»„ï¼ˆæ— æ³•åˆ é™¤ï¼Œæ— æ³•ä¿®æ”¹åˆ†ç»„ç¼–ç ï¼‰ã€åç§°å¯ä»¥ä¿®æ”¹
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-7"><label for="task-item-7"> åˆ†ç»„å¢åˆ æ”¹</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-8"><label for="task-item-8"> ç»„åˆ«é…ç½®æƒé™</label></li>
</ul>
</li>
<li>æ–‡ä»¶ç®¡ç†
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-9"><label for="task-item-9"> æœ¬åœ°æ–‡ä»¶ä¸Šä¼ </label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-10"><label for="task-item-10"> ä¸ƒç‰›äº‘å­˜å‚¨</label></li>
<li><input type="checkbox"  disabled="disabled" id="task-item-11"><label for="task-item-11"> æ–‡ä»¶å»é‡ï¼Œç§’ä¼ </label></li>
</ul>
</li>
<li>ç³»ç»Ÿæ—¥å¿—ï¼šè¯·æ±‚æ–¹æ³•ã€è·¯å¾„ã€httpè¿”å›ç ã€æ—¶é—´ã€ç”¨æˆ·æ˜µç§°ã€ç”¨æˆ·idã€è®¿é—®å“ªä¸ªæƒé™ã€ æ—¥å¿—ä¿¡æ¯
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-12"><label for="task-item-12"> è®°å½•ç³»ç»Ÿè¯·æ±‚çš„æ—¥å¿—</label></li>
<li><input type="checkbox"  disabled="disabled" id="task-item-13"><label for="task-item-13"> å¼‚å¸¸æ—¥å¿—</label></li>
</ul>
</li>
<li>è®¾ç½®ç®¡ç†ï¼šname(é”®ï¼‰,value(å€¼),provider_name(æä¾›å),provider_keyï¼ˆæä¾›è€…å€¼ï¼‰
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-14"><label for="task-item-14"> è®¾ç½®æ–°å¢ä¿®æ”¹åˆ é™¤</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-15"><label for="task-item-15"> æ‰€æœ‰è®¾ç½®</label></li>
</ul>
</li>
</ul>
<p>æ¯”å¦‚å­˜æŸç”¨æˆ·é€‰æ‹©çš„æ˜¯markdownè¿˜æ˜¯å¯Œæ–‡æœ¬ã€‚</p>
<div><pre><code>name="Article.Editor",
value="markdown" æˆ– "å¯Œæ–‡æœ¬"ï¼Œ
provider_nameä¸º"User",
provider_keyä¸ºç”¨æˆ·Id
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>æˆ–å­˜å‚¨ä¸ƒç‰›äº‘çš„æŸä¸€ä¸ªé…ç½®</p>
<div><pre><code>name="Qiniu.AK",
value="asfadsfadf23rft66S4XM2GIK7FGmj7czuYkcAyNGDAc" ï¼Œ
provider_nameä¸º"Qiniu"æˆ–è‡ªå·±å®šä¹‰çš„å­—ç¬¦ä¸²
provider_keyä¸ºç©º
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="cms-ç®¡ç†å‘˜ç»´æŠ¤æ¨¡å—" tabindex="-1"> cms ç®¡ç†å‘˜ç»´æŠ¤æ¨¡å—</h2>
<ul>
<li>æ ‡ç­¾ç®¡ç†ï¼šåç§°ã€å›¾ç‰‡ï¼Œæ˜¯å¦å¯ç”¨/ç¦ç”¨ï¼Œæ’åºã€æ–‡ç« æ•°é‡ã€ç”¨æˆ·å…³æ³¨æ•°é‡ã€‚
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-16"><label for="task-item-16"> æ ‡ç­¾å¢åˆ æ”¹</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-17"><label for="task-item-17"> æ ‡ç­¾åˆ—è¡¨ï¼Œç¦ç”¨</label></li>
</ul>
</li>
<li>æŠ€æœ¯é¢‘é“ï¼šå°é¢å›¾ã€åç§°ã€æ˜¯å¦å¯ç”¨/ç¦ç”¨ã€æ’åºã€ç¼–ç ã€å¤‡æ³¨æè¿°ã€ä¸‹å±æ ‡ç­¾.ä¸€ä¸ªæŠ€æœ¯é¢‘é“å¯¹åº”å¤šä¸ªæ ‡ç­¾
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-18"><label for="task-item-18"> æŠ€æœ¯é¢‘é“å¢åˆ æ”¹</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-19"><label for="task-item-19"> åˆ—è¡¨ã€ç¦ç”¨</label></li>
</ul>
</li>
<li>éšç¬”ç®¡ç†ï¼š
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-20"><label for="task-item-20"> å®¡æ ¸éšç¬”/æ‹‰é»‘</label></li>
</ul>
</li>
<li>è¯„è®ºç®¡ç†
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-21"><label for="task-item-21"> åå°å®¡æ ¸é€šè¿‡/æ‹‰é»‘</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-22"><label for="task-item-22"> ç®¡ç†å‘˜åˆ é™¤è¯„è®º</label></li>
</ul>
</li>
<li>å­—å…¸ç®¡ç†
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-23"><label for="task-item-23"> å­—å…¸ç±»åˆ«ç®¡ç†</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-24"><label for="task-item-24"> å­—å…¸ç®¡ç†ï¼šå¦‚éšç¬”ç±»å‹ï¼ˆåŸåˆ›ã€è½¬è½½ã€ç¿»è¯‘ï¼‰</label></li>
</ul>
</li>
</ul>
<h2 id="cms-ç”¨æˆ·ç«¯æ¨¡å—" tabindex="-1"> cms ç”¨æˆ·ç«¯æ¨¡å—</h2>
<ul>
<li>
<p>æŠ€æœ¯é¢‘é“</p>
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-25"><label for="task-item-25"> é¦–é¡µå±•ç¤ºæŠ€æœ¯é¢‘é“</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-26"><label for="task-item-26"> é€‰æ‹©æŠ€æœ¯é¢‘é“åï¼Œå¯å†æ ¹æ®æ ‡ç­¾æŸ¥è¯¢æ–‡ç« </label></li>
</ul>
</li>
<li>
<p>åˆ†ç±»ä¸“æ ç®¡ç†:å‘å¸ƒéšç¬”æ—¶å¯é€‰æ‹©å•ä¸ªåˆ†ç±»ã€‚</p>
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-27"><label for="task-item-27"> åˆ†ç±»å¢åˆ æ”¹(éšç¬”æ•°é‡ã€å›¾ç‰‡ã€åç§°ã€æ’åº)</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-28"><label for="task-item-28"> åˆ†ç±»åˆ—è¡¨ï¼Œä»…æŸ¥çœ‹ã€ç¼–è¾‘è‡ªå·±åˆ›å»ºçš„åˆ†ç±»ä¸“æ </label></li>
</ul>
</li>
<li>
<p>æ ‡ç­¾ï¼šç»Ÿè®¡æ¯ä¸ªæ ‡ç­¾ä¸‹å¤šå°‘ä¸ªæ–‡ç« ã€å¤šå°‘äººå…³æ³¨</p>
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-29"><label for="task-item-29"> æ ‡ç­¾åˆ—è¡¨</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-30"><label for="task-item-30"> æ— é™åŠ è½½</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-31"><label for="task-item-31"> æœ€æ–°/æœ€çƒ­ æ ¹æ®æ ‡ç­¾åç§°æ¨¡ç³ŠæŸ¥è¯¢</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-32"><label for="task-item-32"> å·²å…³æ³¨çš„æ ‡ç­¾</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-33"><label for="task-item-33"> çƒ­é—¨æ ‡ç­¾</label></li>
</ul>
</li>
<li>
<p>éšç¬”</p>
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-34"><label for="task-item-34"> æ”¯æŒmarkdownï¼Œå¢åˆ æ”¹ï¼ˆä»…è‡ªå·±çš„éšç¬”ï¼‰,ä¿®æ­£åˆ†ç±»ä¸“æ ä¸­çš„éšç¬”æ•°é‡</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-35"><label for="task-item-35"> åˆ—è¡¨æ— é™åŠ è½½ï¼ŒæŒ‰æ ‡ç­¾æŸ¥è¯¢éšç¬”</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-36"><label for="task-item-36"> ç‚¹èµéšç¬”</label></li>
<li>éšç¬”è¯¦æƒ…é¡µ
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-37"><label for="task-item-37"> æ”¯æŒç›®å½•å¯¼èˆªï¼ˆæ»šåŠ¨æ—¶ï¼Œå›ºå®šè‡³é¡¶éƒ¨ä½ç½®ï¼‰ï¼Œå±•ç¤ºå­—æ•°ç»Ÿè®¡ã€é¢„è®¡é˜…è¯»æ—¶é•¿ï¼›</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-38"><label for="task-item-38"> ä½œè€…ä»‹ç»ï¼šå¤´åƒï¼Œæ˜µç§°ï¼Œç­¾åï¼Œéšç¬”æ•°ï¼›</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-39"><label for="task-item-39"> å±•ç¤ºæ–‡ç« ç±»å‹ï¼šåŸåˆ›ã€è½¬è½½ã€ç¿»è¯‘</label></li>
<li><input type="checkbox"  disabled="disabled" id="task-item-40"><label for="task-item-40">  ç›¸å…³æ–‡ç« </label></li>
<li><input type="checkbox"  disabled="disabled" id="task-item-41"><label for="task-item-41">  æ¨èæ–‡ç« </label></li>
</ul>
</li>
</ul>
</li>
<li>
<p>è¯„è®º</p>
<ul>
<li><input type="checkbox"  disabled="disabled" id="task-item-42"><label for="task-item-42"> ç”¨æˆ·å…³é—­è¯„è®ºæ—¶ï¼Œæ— æ³•å¯¹éšç¬”è¿›è¡Œè¯„è®º</label></li>
<li><input type="checkbox"  disabled="disabled" id="task-item-43"><label for="task-item-43"> è¯„è®ºéšç¬”(å†…å®¹æ”¯æŒè¶…é“¾æ¥ã€emoji)</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-44"><label for="task-item-44"> åˆ é™¤è‡ªå·±çš„è¯„è®º</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-45"><label for="task-item-45"> ç‚¹èµè¯„è®º</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-46"><label for="task-item-46"> å›å¤è¯„è®º</label></li>
</ul>
</li>
<li>
<p>å…³æ³¨</p>
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-47"><label for="task-item-47"> å…³æ³¨/å–æ¶ˆå…³æ³¨ç”¨æˆ·</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-48"><label for="task-item-48"> å…³æ³¨/å–æ¶ˆå…³æ³¨æ ‡ç­¾</label></li>
</ul>
</li>
<li>
<p>ä¸ªäººä¸»é¡µ</p>
<ul>
<li>éšç¬”
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-49"><label for="task-item-49"> ç”¨æˆ·ä¸“æ åˆ†ç±»å±•ç¤º</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-50"><label for="task-item-50"> æœ€æ–°å‘å¸ƒçš„éšç¬”</label></li>
</ul>
</li>
<li>å…³æ³¨
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-51"><label for="task-item-51"> å…³æ³¨çš„äºº</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-52"><label for="task-item-52"> ç²‰ä¸</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-53"><label for="task-item-53"> å…³æ³¨çš„æ ‡ç­¾</label></li>
</ul>
</li>
</ul>
</li>
<li>
<p>è®¾ç½®</p>
<ul>
<li>ä¸ªäººä¸»é¡µè®¾ç½®
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-54"><label for="task-item-54"> ä¸ªäººèµ„æ–™æ›´æ–°</label></li>
</ul>
</li>
<li>å®‰å…¨è®¾ç½®
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-55"><label for="task-item-55"> å¯†ç ä¿®æ”¹</label></li>
</ul>
</li>
<li>åšå®¢è®¾ç½®
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-56"><label for="task-item-56"> é»˜è®¤ç¼–è¾‘å™¨è®¾ç½®(markdown/å¯Œæ–‡æœ¬)</label></li>
</ul>
</li>
</ul>
</li>
<li>
<p>æ¶ˆæ¯</p>
<ul>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-57"><label for="task-item-57"> ç‚¹èµéšç¬”ã€ç‚¹èµè¯„è®º</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-58"><label for="task-item-58"> è¯„è®ºéšç¬”ã€å›å¤è¯„è®º</label></li>
<li><input type="checkbox" checked="checked" disabled="disabled" id="task-item-59"><label for="task-item-59"> ç”¨æˆ·å…³æ³¨</label></li>
</ul>
</li>
</ul>
<h2 id="è¯„è®ºæ¨¡å—" tabindex="-1"> è¯„è®ºæ¨¡å—</h2>
<h3 id="ä¸»é¢˜å¼" tabindex="-1"> ä¸»é¢˜å¼</h3>
<p>å°†è¯„è®ºåˆ†ä¸ºäºŒçº§ï¼Œç¬¬ä¸€çº§é‡‡ç”¨æ—¶é—´å€’åºï¼ŒäºŒçº§æŒ‰ç…§æ—¶é—´æ­£åºï¼Œæœ‰åŠ©äºç†è§£ä¸Šä¸‹æ–‡å…³ç³»ã€‚</p>
<p>ç”¨æˆ·æ“ä½œï¼š</p>
<ul>
<li>è¯„è®ºéšç¬”(å†…å®¹æ”¯æŒè¶…é“¾æ¥ã€emoji)</li>
<li>ç‚¹èµè¯„è®º/å–æ¶ˆç‚¹èµ</li>
<li>å›å¤è¯„è®º</li>
<li>åˆ é™¤è‡ªå·±çš„è¯„è®º</li>
</ul>
<p>è¿è¥æ“ä½œï¼š</p>
<ul>
<li>å®¡æ ¸é€šè¿‡/æ‹‰é»‘è¯„è®º</li>
<li>åˆ é™¤ä»»ä½•è¯„è®º</li>
<li>æ‹‰é»‘åçš„æ˜¾ç¤ºé€»è¾‘ã€‚ï¼ˆä¿ç•™å½“å‰åŒºå—ã€æ˜¾ç¤ºå†…å®¹ä¸ºï¼šè¯¥è¯„è®ºå› è¿è§„è¢«æ‹‰é»‘ï¼‰</li>
<li>åˆ é™¤ï¼šï¼ˆå¦‚æœæ˜¯äºŒçº§è¯„è®ºï¼Œç›´æ¥è½¯åˆ é™¤ï¼Œå¦‚æœæ˜¯ä¸€çº§è¯„è®ºï¼Œè½¯åˆ é™¤å­è¯„è®ºå’Œå½“å‰è¯„è®º-éœ€è¦æå‰æé†’ç”¨æˆ·ï¼‰
äº¤äº’è®¾è®¡</li>
<li>è¯„è®ºçš„å­—æ•°é•¿åº¦ï¼ˆ500ï¼‰ã€emojiã€‚</li>
<li>ç‚¹èµäº¤äº’-åŠ¨ç”»ã€æ¶ˆæ¯é€šçŸ¥/æ¨é€</li>
<li>è¯„è®ºåŒºåŸŸå…ƒç´ ï¼Œéœ€è¦æœ‰æ˜ç¡®å¯ç‚¹å‡»çš„åŒºåŸŸï¼Œä¼šè·³è½¬åˆ°å“ªä¸ªåœ°æ–¹ã€‚</li>
</ul>
<h3 id="ä¼˜åŒ–" tabindex="-1"> ä¼˜åŒ–</h3>
<ul>
<li>ç²¾é€‰è¯„è®º</li>
</ul>
<h3 id="è„‘å›¾åˆ†äº«" tabindex="-1"> è„‘å›¾åˆ†äº«</h3>
<p><a href="http://naotu.baidu.com/file/6532431a2e1f0c37c93c5ffd1dd5b49c?token=87690a9bc64fbae1" target="_blank" rel="noopener noreferrer">http://naotu.baidu.com/file/6532431a2e1f0c37c93c5ffd1dd5b49c?token=87690a9bc64fbae1</a></p>
<h3 id="åˆ†ç»„" tabindex="-1"> åˆ†ç»„</h3>
<p>åˆ†ä¸ºä¸‰ç§</p>
<div><pre><code>id  name        info
1	Admin	    ç³»ç»Ÿç®¡ç†å‘˜
2	CmsAdmin	å†…å®¹ç®¡ç†å‘˜
3	User	    æ™®é€šç”¨æˆ·
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h3 id="å®¡è®¡æ—¥å¿—" tabindex="-1"> å®¡è®¡æ—¥å¿—</h3>
<p>å¤§å¤šæ•°è¡¨å­˜åœ¨å¦‚ä¸‹8ä¸ªå­—æ®µï¼Œç”¨äºè®°å½•è¡Œçš„å˜åŒ–çŠ¶æ€ï¼Œis_deletedä¸ºè½¯åˆ é™¤ï¼Œæ‰§è¡Œåˆ é™¤æ“ä½œæ—¶ï¼Œå°†å…¶çŠ¶æ€ç½®ä¸ºtrueï¼Œé»˜è®¤å®ä½“ç±»ç»§æ‰¿ <strong>FullAduitEntity</strong>  å³å¯æ‹¥æœ‰ä»¥ä¸‹8ä¸ªå­—æ®µã€‚è¯¥è®¾è®¡å‚è€ƒABPä¸­çš„å®ç°ã€‚FullAduitEntityä¸ºæ³›å‹ï¼Œé»˜è®¤idä¸ºlongç±»å‹ï¼ŒFullAduitEntity&lt;Guid&gt;,å³å¯æ”¹å˜ä¸»é”®ç±»å‹ï¼Œé»˜è®¤LinUserè¡¨ä¸»é”®longï¼Œä¿æŒ<strong>create_user_id</strong>,<strong>delete_user_id</strong>,<strong>update_user_id</strong>éƒ½ä¸LinUserçš„ä¸»é”®ç›¸åŒ</p>
<div><pre><code>
id	                bigint
create_user_id  	bigint
create_time	        datetime
is_deleted	        bit
delete_user_id  	bigint
delete_time	        datetime
update_user_id	    bigint
update_time	        datetime


</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="_0-3-0ç‰ˆæœ¬æƒé™åŠŸèƒ½å‡çº§" tabindex="-1"> 0.3.0ç‰ˆæœ¬æƒé™åŠŸèƒ½å‡çº§</h2>
<p>ä¸ºæ”¯æŒä¸€ä¸ªç”¨æˆ·å¤šä¸ªåˆ†ç»„ï¼Œä¸€ä¸ªåˆ†ç»„å¤šä¸ªæƒé™ï¼Œä¸€ä¸ªç”¨æˆ·å¯åˆ†å¤šç§æˆæƒç™»å½•æ–¹å¼ï¼Œæ ¹æ®lin-cms-springbooté¡¹ç›®åŠŸèƒ½æ¨¡å—å‡çº§ï¼Œä»‹ç»å¦‚ä¸‹ï¼š</p>
<ol>
<li>lin_permission  æƒé™è¡¨ï¼Œæœ¬ç³»ç»Ÿé€šè¿‡åå°„åœ¨ç³»ç»Ÿåˆæ¬¡å¯åŠ¨æ—¶ï¼Œå¯åŠ¨å¼‚æ­¥ä»»åŠ¡ï¼Œå°†ä¸å­˜åœ¨çš„æƒé™æ–°å¢åˆ°æ­¤è¡¨ä¸­ã€‚</li>
<li>lin_group_permission  åˆ†ç»„æƒé™è¡¨ï¼Œç”¨äºåˆ†ç»„ä¸æƒé™è¡¨çš„å…³è”</li>
<li>lin_user_group  ç”¨æˆ·åˆ†ç»„è¡¨ã€‚ç”¨äºç”¨æˆ·å’Œåˆ†ç»„è¡¨çš„å…³è”ã€‚å¯é…ç½®ä¸€ä¸ªç”¨æˆ·å±äºå¤šä¸ªåˆ†ç»„ã€‚</li>
<li>lin_user_identity ç”¨æˆ·æˆæƒä¿¡æ¯è¡¨ï¼Œç”¨äºå­˜å‚¨ä¸åŒç™»å½•ç±»å‹çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æ‰‹æœºå·ã€é‚®ä»¶ã€ç”¨æˆ·åã€ç¬¬ä¸‰æ–¹åº”ç”¨ï¼ˆå¾®ä¿¡ã€QQã€GitHubï¼‰çš„ç™»å½•</li>
</ol>
<h2 id="lin-cms-å¼€æºåœ°å€åˆ†äº«" tabindex="-1"> lin-cms å¼€æºåœ°å€åˆ†äº«</h2>
<ul>
<li>åç«¯æ¥å£ <a href="https://github.com/luoyunchong/lin-cms-dotnetcore" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/lin-cms-dotnetcore</a></li>
<li>ç®¡ç†åå°UI <a href="https://github.com/luoyunchong/lin-cms-vue" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/lin-cms-vue</a></li>
<li>å‰ç«¯UI<a href="https://github.com/luoyunchong/lin-cms-vvlog" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/lin-cms-vvlog</a></li>
</ul>
]]></content>
    <category term="lin-cms-dotnetcore"/>
    <published>2019-11-24T12:44:22.000Z</published>
  </entry>
  <entry>
    <title type="html">GitHubç¬¬ä¸‰æ–¹æˆæƒç™»å½•</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/spa-github-login.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/spa-github-login.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<p>ä½¿ç”¨ SPA+.NET Core3.1 å®ç° GitHub ç¬¬ä¸‰æ–¹æˆæƒç™»å½• ç±»ä¼¼ä½¿ç”¨ AspNet.Security.OAuth.GitHubï¼Œå‰ç«¯ä½¿ç”¨å¦‚ä¸‹ï¼šVUE+Vue-Router+axios</p>
<h2 id="aspnet-security-oauth-github" tabindex="-1"> AspNet.Security.OAuth.GitHub</h2>
<ul>
<li>GitHub <a href="https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers" target="_blank" rel="noopener noreferrer">https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers</a></li>
</ul>
<h2 id="github-æˆæƒç™»å½•" tabindex="-1"> GitHub æˆæƒç™»å½•</h2>
<p>ä»€ä¹ˆé…ç½®çš„è¿‡ç¨‹ä¸è¯´äº†ã€‚ã€‚æœ‰ä¸€æ¨ã€‚</p>
<ul>
<li><a href="https://www.jianshu.com/p/78d186aeb526" target="_blank" rel="noopener noreferrer">GitHub ç¬¬ä¸‰æ–¹ç™»å½•</a></li>
<li><a href="https://juejin.im/post/5dfb04cee51d45583a66c2f3" target="_blank" rel="noopener noreferrer">ç»™ä½ çš„ç½‘ç«™æ·»åŠ ç¬¬ä¸‰æ–¹ç™»å½•ä»¥åŠçŸ­ä¿¡éªŒè¯åŠŸèƒ½</a></li>
</ul>
<p>ä¸‹é¢ä¸ºç¤ºä¾‹</p>
<div><pre><code>client_id:0be6b05fc717bfc4fb67
client_secret:dcaced9f176afba64e89d88b9b06ffc4a887a609
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>Get</p>
<div><pre><code>https://github.com/login/oauth/authorize?client_id=0be6b05fc717bfc4fb67&amp;redirect_uri=https://localhost:5001/signin-github
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>ä¼šé‡å®šå‘åˆ°</p>
<p><a href="https://localhost:5001/signin-github?code=07537a84d12bbae08361" target="_blank" rel="noopener noreferrer">https://localhost:5001/signin-github?code=07537a84d12bbae08361</a></p>
<p>è¿™ä¸ª code æ”¾åˆ°ä¸‹é¢çš„è¯·æ±‚ä¸­ï¼Œè·å– access_token
POST æ–¹å¼ï¼ˆPostMan å»è¯·æ±‚ï¼‰</p>
<div><pre><code>https://github.com/login/oauth/access_token?client_id=0be6b05fc717bfc4fb67&amp;client_secret=dcaced9f176afba64e89d88b9b06ffc4a887a609&amp;code=07537a84d12bbae08361
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>Get æ–¹å¼</p>
<div><pre><code>https://api.github.com/user?access_token=787506afa3271d077b98f18af56d7cfdc8db43b4
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>ç„¶åå°±èƒ½è·å–ç”¨æˆ·ä¿¡æ¯</p>
<div><pre><code>{
   "login": "luoyunchong",
   "id": 18613266,
   "node_id": "MDQ6VXNlcjE4NjEzMjY2",
   "avatar_url": "https://avatars1.githubusercontent.com/u/18613266?v=4",
   "gravatar_id": "",
   "url": "https://api.github.com/users/luoyunchong",
   "html_url": "https://github.com/luoyunchong",
   "followers_url": "https://api.github.com/users/luoyunchong/followers",
   "following_url": "https://api.github.com/users/luoyunchong/following{/other_user}",
   "gists_url": "https://api.github.com/users/luoyunchong/gists{/gist_id}",
   "starred_url": "https://api.github.com/users/luoyunchong/starred{/owner}{/repo}",
   "subscriptions_url": "https://api.github.com/users/luoyunchong/subscriptions",
   "organizations_url": "https://api.github.com/users/luoyunchong/orgs",
   "repos_url": "https://api.github.com/users/luoyunchong/repos",
   "events_url": "https://api.github.com/users/luoyunchong/events{/privacy}",
   "received_events_url": "https://api.github.com/users/luoyunchong/received_events",
   "type": "User",
   "site_admin": false,
   "name": "IGeekFan",
   "company": null,
   "blog": "https://blog.igeekfan.cn",
   "location": null,
   "email": "luoyunchong@foxmail.com",
   "hireable": null,
   "bio": "å­¦ä¹ ä¹‹è·¯æ¼«æ¼«æ— æœŸã€‚",
   "public_repos": 14,
   "public_gists": 0,
   "followers": 16,
   "following": 11,
   "created_at": "2016-04-22T10:33:44Z",
   "updated_at": "2019-12-21T14:49:33Z"
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br></div></div><h2 id="net-core3-1" tabindex="-1"> .NET Core3.1</h2>
<p>ä»¥ä¸‹ä»£ç ä¸ºä¸»è¦ä»£ç ï¼Œå®Œæ•´ä»£ç çœ‹ä¸‹é¢çš„ DEMO é“¾æ¥ã€‚</p>
<p>ä½¿ç”¨ WebApi æ—¶ï¼Œçœ‹äº†ä¸€äº›é¡¹ç›®ï¼Œå…¨æ˜¯åŸºäº MVC ç»“æ„çš„ï¼Œéƒ½ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚çœ‹äº†ä¸€äº›åšå®¢ä¸Šé¢ä»‹ç» ,æ­¥éª¤éƒ½æ˜¯åƒç¯‡ä¸€å¾‹ï¼Œéƒ½æ˜¯é…åˆå‰åç«¯åˆ†ç¦»çš„ã€‚</p>
<ul>
<li>å‰ç«¯è¿è¡Œåœ¨:http://localhost:8081</li>
<li>åç«¯è¿è¡Œåœ¨:https://localhost:5001</li>
</ul>
<h3 id="å‰åç«¯åˆ†ç¦»çš„-spa-é…åˆç¬¬ä¸‰æ–¹æˆæƒç™»å½•æµç¨‹å¦‚ä¸‹" tabindex="-1"> å‰åç«¯åˆ†ç¦»çš„ SPA é…åˆç¬¬ä¸‰æ–¹æˆæƒç™»å½•æµç¨‹å¦‚ä¸‹</h3>
<p>æœ¬åœ°æµ‹è¯•æ—¶ï¼ŒgitHub å›è°ƒåœ°å€è®¾ç½® http(s)ğŸ˜•/ip:ç«¯å£/signin-github</p>
<ul>
<li>å¦‚: https://localhost:5001/signin-githubã€‚</li>
</ul>
<h4 id="_1-ä¸Šé¢è¿™ä¸ªæ˜æ˜å¡«å†™çš„åç«¯çš„åœ°å€-é‚£åç«¯æ€ä¹ˆæŠŠç»“æœé€šçŸ¥å‰ç«¯å‘¢" tabindex="-1"> 1. ä¸Šé¢è¿™ä¸ªæ˜æ˜å¡«å†™çš„åç«¯çš„åœ°å€ï¼Œé‚£åç«¯æ€ä¹ˆæŠŠç»“æœé€šçŸ¥å‰ç«¯å‘¢ï¼Ÿ</h4>
<p>å‰ç«¯è¯·æ±‚<strong>https://localhost:5001/signin?provider=GitHub&amp;redirectUrl=http://localhost:8080/login-result</strong></p>
<ul>
<li>æä¾›å‚æ•° provider ä¸º GitHubï¼Œ</li>
<li>redirectUrl ä¸º GitHub æˆæƒç™»å½•åï¼Œå›è°ƒ signin-github åï¼Œåç«¯å†å»é‡å®šå‘çš„åœ°å€ï¼Œè¿™é‡Œå¡«å‰ç«¯çš„ä¸€ä¸ªè·¯ç”±ã€‚</li>
</ul>
<h4 id="_2-åç«¯åªæä¾›äº†-signin-signin-callback-è·¯ç”±-æ²¡æœ‰-signin-github-é‚£-github-ä¸Šé…ç½®çš„è·¯ç”±æ˜¯æ€ä¹ˆå›è°ƒå›æ¥å‘¢" tabindex="-1"> 2. åç«¯åªæä¾›äº† signinï¼Œsignin-callback è·¯ç”±ï¼Œæ²¡æœ‰ signin-githubï¼Œé‚£ github ä¸Šé…ç½®çš„è·¯ç”±æ˜¯æ€ä¹ˆå›è°ƒå›æ¥å‘¢ï¼Ÿ</h4>
<p><a href="https://docs.microsoft.com/zh-cn/aspnet/core/security/authentication/social/google-logins?view=aspnetcore-3.1" target="_blank" rel="noopener noreferrer">google-ç™»å½•ï¼Œå¾®è½¯æ–‡æ¡£</a>ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª<strong>æ›´æ”¹é»˜è®¤å›è°ƒ URI</strong>,é€šè¿‡ AddGitHub ä¸­çš„ CallbackPath å±æ€§é…ç½®ã€‚</p>
<p>ä»‹ç»äº†å›è°ƒåœ°å€åº”é…ç½® signin-google,æ‰€ä»¥è¿™é‡Œåº”è¯¥æ˜¯ signin-githubï¼Œä»–æ˜¯å¯ä»¥é…ç½®çš„ï¼Œä¸éœ€è¦è‡ªå·±å†™ç¨‹åºå¤„ç† signin-google è¿™ä¸ªè·¯ç”±ï¼Œå†…éƒ¨æœ‰ä¸­é—´ä»¶å·²ç»å¤„ç†äº†ã€‚</p>
<h4 id="_3-å›è°ƒåˆ°-signin-github-å-åç«¯æ€ä¹ˆå¤„ç†-æ‰èƒ½è®©å‰ç«¯åˆ·æ–°ã€‚è·å–ç™»å½•åçš„ä¿¡æ¯å‘¢ã€‚" tabindex="-1"> 3. å›è°ƒåˆ° signin-github åï¼Œåç«¯æ€ä¹ˆå¤„ç†ï¼Œæ‰èƒ½è®©å‰ç«¯åˆ·æ–°ã€‚è·å–ç™»å½•åçš„ä¿¡æ¯å‘¢ã€‚</h4>
<p>å…·ä½“ä¸Šé¢çš„æ ¹æ® code è·å– access_tokenï¼Œæ ¹æ® access_token è·å–ç”¨æˆ·çš„ä¿¡æ¯çš„è¿‡ç¨‹ï¼Œè¿™äº›å¤„ç†çš„è¿‡ç¨‹ï¼Œéƒ½ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ç›´æ¥è·å–ç”¨æˆ·ä¿¡æ¯ã€‚</p>
<p>ä¸€ä¸ªæ–¹æ³• SignIn,åªè¦<strong>return Challenge(properties, provider);</strong>ï¼Œ</p>
<ul>
<li>provider ä¸º GitHubï¼Œ</li>
<li>properties var properties = new AuthenticationProperties { RedirectUri = url };</li>
</ul>
<p>è¿™ä¸ª url ä¸ºå¦ä¸€ä¸ªè·å–ç”¨æˆ·ä¿¡æ¯çš„è·¯ç”±ï¼Œåªè¦æ‹¼æ¥å¥½åœ°å€å³å¯ã€‚</p>
<div><pre><code>var authenticateResult = await _contextAccessor.HttpContext.AuthenticateAsync(provider);
string email = authenticateResult.Principal.FindFirst(ClaimTypes.Email)?.Value;
string name = authenticateResult.Principal.FindFirst(ClaimTypes.Name)?.Value;
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>éœ€è¦æ³¨å…¥</p>
<div><pre><code>private readonly IHttpContextAccessor _contextAccessor;
public AuthenticationController( IHttpContextAccessor contextAccessor)
{
    _contextAccessor = contextAccessor;
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h3 id="ä»£ç éƒ¨ç½²-ç®€åŒ–" tabindex="-1"> ä»£ç éƒ¨ç½²ï¼ˆç®€åŒ–ï¼‰</h3>
<p>æ‰“å¼€ NuGet åŒ…ç®¡ç†,å®‰è£…åŒ…</p>
<div><pre><code>Install-Package AspNet.Security.OAuth.GitHub
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>appSettings.json</p>
<div><pre><code>"Authentication": {
    "GitHub": {
      "ClientId": "0be6b05fc717bfc4fb67",
      "ClientSecret": "dcaced9f176afba64e89d88b9b06ffc4a887a609"
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div><p>add æ‰©å±•æ–¹æ³•</p>
<div><pre><code>public static class JwtConfiguration
{
    public static void AddJwtConfiguration(this IServiceCollection services, IConfiguration configuration)
    {

        services.AddAuthentication(opts =>
            {
                opts.DefaultScheme = CookieAuthenticationDefaults.AuthenticationScheme;
                opts.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;
            }).AddCookie(options =>
        {
            options.LoginPath = "/signin";
            options.LogoutPath = "/signout";
        }).AddGitHub(options =>
        {
            options.ClientId = configuration["Authentication:GitHub:ClientId"];
            options.ClientSecret = configuration["Authentication:GitHub:ClientSecret"];
        });
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br></div></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚å¤´åƒï¼Œemailï¼Œæ˜¯æ²¡æœ‰è·å–çš„ã€‚</p>
<div><pre><code>.AddGitHub(options =>
{
    options.ClientId = configuration["Authentication:GitHub:ClientId"];
    options.ClientSecret = configuration["Authentication:GitHub:ClientSecret"];
    //options.CallbackPath = new PathString("~/signin-github");//ä¸GitHubä¸Šçš„å›è°ƒåœ°å€ç›¸åŒï¼Œé»˜è®¤å³æ˜¯/signin-github
    options.Scope.Add("user:email");
    //authenticateResult.Principal.FindFirst(LinConsts.Claims.AvatarUrl)?.Value;  å¾—åˆ°GitHubå¤´åƒ
    options.ClaimActions.MapJsonKey(LinConsts.Claims.AvatarUrl, "avatar_url");
    options.ClaimActions.MapJsonKey(LinConsts.Claims.BIO, "bio");
    options.ClaimActions.MapJsonKey(LinConsts.Claims.BlogAddress, "blog");
});

#å…¶ä¸­LinConstsç±»ä¸ºé™æ€å¸¸é‡
public static class LinConsts
{
    public static class Claims
    {
        public const string BIO = "urn:github:bio";
        public const string AvatarUrl = "urn:github:avatar_url";
        public const string BlogAddress = "urn:github:blog";
    }
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br></div></div><p>startup.cs</p>
<p>ConfigureServices ä¸­é…ç½®æ­¤æœåŠ¡</p>
<div><pre><code>    services.AddSingleton&lt;IHttpContextAccessor, HttpContextAccessor>();
    services.AddJwtConfiguration(Configuration);
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>åˆ›å»º AuthenticationController.cs
å¢åŠ  SignInï¼Œç”¨äºå¤„ç†ç”¨æˆ·æˆæƒæˆåŠŸåï¼Œé‡å®šå› signin-callback,å¹¶å°†å‚æ•°å¸¦å›ã€‚</p>
<div><pre><code>        private readonly IHttpContextAccessor _contextAccessor;
        private readonly IConfiguration _configuration;

        public AuthenticationController(IHttpContextAccessor contextAccessor, IConfiguration configuration)
        {
            _contextAccessor = contextAccessor;
            _configuration = configuration;
        }

        [HttpGet("~/signin")]
        public async Task&lt;IActionResult> SignIn(string provider, string redirectUrl)
        {
            var request = _contextAccessor.HttpContext.Request;
            var url =
                $"{request.Scheme}://{request.Host}{request.PathBase}{request.Path}-callback?provider={provider}&amp;redirectUrl={redirectUrl}";
            var properties = new AuthenticationProperties { RedirectUri = url };
            properties.Items["LoginProviderKey"] = provider;
            return Challenge(properties, provider);

        }
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br></div></div><p>åœ¨ signin æ–¹æ³•ä¸­ï¼Œç”¨æˆ·ç‚¹å‡»æˆæƒåï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼Œä¼šæ ¹æ®å…¶ä¼ é€’çš„ URLï¼Œé‡å®šå‘åˆ°è¿™ä¸ªåœ°å€ï¼Œsignin-callback,å‚æ•°ä¹Ÿä¼šä¸€åŒæºå¸¦ã€‚provider ä¸º GitHub,redirectUrl ä¸ºï¼šhttp://localhost:8081/login-result.</p>
<div><pre><code>[HttpGet("~/signin-callback")]
public async Task&lt;IActionResult> Home(string provider = null, string redirectUrl = "")
{
    var authenticateResult = await _contextAccessor.HttpContext.AuthenticateAsync(provider);
    if (!authenticateResult.Succeeded) return Redirect(redirectUrl);
    var openIdClaim = authenticateResult.Principal.FindFirst(ClaimTypes.NameIdentifier);
    if (openIdClaim == null || string.IsNullOrWhiteSpace(openIdClaim.Value))
        return Redirect(redirectUrl);

    //TODO è®°å½•æˆæƒæˆåŠŸåçš„ä¿¡æ¯

    string email = authenticateResult.Principal.FindFirst(ClaimTypes.Email)?.Value;
    string name = authenticateResult.Principal.FindFirst(ClaimTypes.Name)?.Value;
    string gitHubName = authenticateResult.Principal.FindFirst(GitHubAuthenticationConstants.Claims.Name)?.Value;
    string gitHubUrl = authenticateResult.Principal.FindFirst(GitHubAuthenticationConstants.Claims.Url)?.Value;
    //startup ä¸­ AddGitHubé…ç½®é¡¹  options.ClaimActions.MapJsonKey(LinConsts.Claims.AvatarUrl, "avatar_url");
    string avatarUrl = authenticateResult.Principal.FindFirst(LinConsts.Claims.AvatarUrl)?.Value;

    return Redirect($"{redirectUrl}?openId={openIdClaim.Value}");
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br></div></div><p>è¿™æ—¶å€™æˆ‘ä»¬èƒ½è·å–ç”¨æˆ·ä¿¡æ¯äº†ã€‚é‚£ä¹ˆå‰ç«¯æ€ä¹ˆåŠå‘¢ã€‚æˆ‘ä»¬å†™ä¸ªæ–¹æ³•ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œçœ‹çœ‹æ•ˆæœã€‚</p>
<ul>
<li>æµè§ˆå™¨ç›´æ¥æ‰“å¼€èƒ½å¾—åˆ° github çš„ idã€‚</li>
<li>axios GET è¯·æ±‚ https://localhost:5001/OpenId å¾—åˆ° null</li>
</ul>
<div><pre><code>[HttpGet("~/OpenId")]
public async Task&lt;string> OpenId(string provider = null)
{
   var authenticateResult = await _contextAccessor.HttpContext.AuthenticateAsync(provider);
   if (!authenticateResult.Succeeded) return null;
   var openIdClaim = authenticateResult.Principal.FindFirst(ClaimTypes.NameIdentifier);
   return openIdClaim?.Value;
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>æˆ‘è®°å¾—ä¹‹å‰ä¼  Token æ—¶ï¼Œåå°æ˜¯å¯ä»¥è¿™æ ·è·å–çš„ã€‚</p>
<div><pre><code>[HttpGet("~/GetOpenIdByToken")]
public string GetOpenIdByToken()
{
    return User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>LoginResult.vue åœ¨ created ç”Ÿå‘½å‘¨æœŸä¸­ã€‚éƒ½æ˜¯å¾—åˆ° null</p>
<div><pre><code>axios({
  methods: "get",
  url: "https://localhost:5001/OpenId?provider=GitHub"
})
  .then(function(response) {
    // handle success
    console.log(response);
  })

axios({
  methods: "get",
  url: "https://localhost:5001/GetOpenIdByToken"
})
  .then(function(response) {
    // handle success
    console.log(response);
  })
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><h3 id="ä¸ºä»€ä¹ˆå‘¢" tabindex="-1"> ä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿï¼Ÿ</h3>
<p>å› ä¸ºå‰åç«¯åˆ†ç¦»ï¼Œä¸æ˜¯åŸºäº Cookies çš„ã€‚http æ˜¯æ— çŠ¶æ€çš„ã€‚æ¯æ¬¡è¯·æ±‚æ— æ³•åŒºåˆ†ç”¨æˆ·çš„ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®å½“å‰çš„ ClaimsPrincipalï¼Œæ ¹æ® JWT ç”Ÿæˆç›¸åº”çš„ Tokenï¼Œaxios è¯·æ±‚æ—¶ï¼Œæ”¾åˆ° headers ä¸­ã€‚</p>
<p>å®‰è£…åŒ…</p>
<div><pre><code>Install-Package Microsoft.AspNetCore.Authentication.JwtBearer
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>AppSettings.json é…ç½®æ”¹æˆ</p>
<div><pre><code>"Authentication": {
"JwtBearer": {
  "SecurityKey": "JWTStudyWebsite_DI20DXU3",
  "Issuer": "JWTStudy",
  "Audience": "JWTStudyWebsite"
},
"GitHub": {
  "ClientId": "0be6b05fc717bfc4fb67",
  "ClientSecret": "dcaced9f176afba64e89d88b9b06ffc4a887a609"
}
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p>åœ¨ signin-callback è·¯ç”±ä¸­ï¼Œå¾—åˆ° authenticateResult.Principalï¼Œå…¶ä¸­é»˜è®¤åŒ…å«äº†(id,login,name,url)ï¼Œæˆæƒå¾—åˆ° eamilï¼Œå¦å¤– MapJsonKey æ‰©å±•äº†ä»¥ä¸‹å­—æ®µï¼ˆavatar_urlã€bioã€blog)</p>
<div><pre><code>var authenticateResult = await _contextAccessor.HttpContext.AuthenticateAsync(provider);
string token = this.CreateToken(authenticateResult.Principal);
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>æ ¹æ® ClaimsPrincipal å€¼ç”Ÿæˆ token å€¼ã€‚</p>
<div><pre><code>private string CreateToken(ClaimsPrincipal claimsPrincipal)
{

    var handler = new JwtSecurityTokenHandler();
    var key = new SymmetricSecurityKey(
        Encoding.UTF8.GetBytes(_configuration["Authentication:JwtBearer:SecurityKey"]));
    var credentials = new SigningCredentials(key, SecurityAlgorithms.HmacSha256);
    var token = new JwtSecurityToken(
        _configuration["Authentication:JwtBearer:Issuer"],
        _configuration["Authentication:JwtBearer:Audience"],
        claimsPrincipal.Claims,
        expires: DateTime.Now.AddMinutes(30),
        signingCredentials: credentials
    );

    return handler.WriteToken(token);
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><p>è¿™é‡Œçš„ claimsPrincipal æ˜¯ä»€ä¹ˆå‘¢ã€‚ç®€å•çš„è¯´å°±æ˜¯ä¸€ä¸ªå­˜æœ‰ github æˆæƒä¿¡æ¯çš„å¯¹è±¡ï¼Œå¯ä»¥è§£æå‡ºå¯¹åº”çš„ Clamisï¼Œè¿™é‡Œå…¶å®å°±æ˜¯ç”¨äº† Clamis çš„å±æ€§å€¼ã€‚</p>
<table>
<thead>
<tr>
<th>Claim</th>
<th>ClaimsIdentity</th>
<th>ClaimsPrincipal</th>
</tr>
</thead>
<tbody>
<tr>
<td>idã€name,url,email,avatar_url ç­‰</td>
<td>ç”±å¤šç»„ Claim ç»„æˆï¼Œè¿™é‡Œå¯æŒ‡ GitHub æˆæƒç™»å½•åå¾—åˆ°çš„é‚£ä¸ªå¯¹è±¡ã€‚</td>
<td>ClaimsIdentity çš„æŒæœ‰è€…</td>
</tr>
</tbody>
</table>
<p>å…·ä½“ Jwt çš„ç”Ÿæˆä¸é…ç½®é¡¹ã€‚è¿™é‡Œä¸è¯¦ç»†è¯´æ˜ã€‚å¯ä»¥çœ‹è¿™ä¸ªç¤ºä¾‹ï¼ˆ.NET Core2.2ï¼‰<a href="https://github.com/luoyunchong/BasicTemplate" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/BasicTemplate</a></p>
<p>AddJwtConfiguration æ”¹æˆå¦‚ä¸‹å†…å®¹</p>
<div><pre><code>public static void AddJwtConfiguration(this IServiceCollection services, IConfiguration configuration)
{

    services.AddAuthentication(opts =>
        {
            opts.DefaultScheme = CookieAuthenticationDefaults.AuthenticationScheme;
            opts.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;
        }).AddCookie(options =>
    {
        options.LoginPath = "/signin";
        options.LogoutPath = "/signout";
    }).AddJwtBearer(JwtBearerDefaults.AuthenticationScheme, options =>
    {
        options.Audience = configuration["Authentication:JwtBearer:Audience"];

        options.TokenValidationParameters = new TokenValidationParameters
        {
            // The signing key must match!
            ValidateIssuerSigningKey = true,
            IssuerSigningKey = new SymmetricSecurityKey(
                Encoding.ASCII.GetBytes(configuration["Authentication:JwtBearer:SecurityKey"])),

            // Validate the JWT Issuer (iss) claim
            ValidateIssuer = true,
            ValidIssuer = configuration["Authentication:JwtBearer:Issuer"],

            // Validate the JWT Audience (aud) claim
            ValidateAudience = true,
            ValidAudience = configuration["Authentication:JwtBearer:Audience"],

            // Validate the token expiry
            ValidateLifetime = true,

            // If you want to allow a certain amount of clock drift, set that here
            //ClockSkew = TimeSpan.Zero
        };
    }).AddGitHub(options =>
    {
        options.ClientId = configuration["Authentication:GitHub:ClientId"];
        options.ClientSecret = configuration["Authentication:GitHub:ClientSecret"];
        //options.CallbackPath = new PathString("~/signin-github");//ä¸GitHubä¸Šçš„å›è°ƒåœ°å€ç›¸åŒï¼Œé»˜è®¤å³æ˜¯/signin-github
        options.Scope.Add("user:email");
        //authenticateResult.Principal.FindFirst(LinConsts.Claims.AvatarUrl)?.Value;  å¾—åˆ°GitHubå¤´åƒ
        options.ClaimActions.MapJsonKey(LinConsts.Claims.AvatarUrl, "avatar_url");
        options.ClaimActions.MapJsonKey(LinConsts.Claims.BIO, "bio");
        options.ClaimActions.MapJsonKey(LinConsts.Claims.BlogAddress, "blog");
    });
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br></div></div><p><a href="https://github.com/luoyunchong/dotnetcore-examples/blob/master/aspnetcore-oatuth2/spa-vue-oauth2/src/components/LoginResult.vue" target="_blank" rel="noopener noreferrer">å‰ç«¯ LoginResult.vue ä»£ç </a></p>
<p>å‰ç«¯è¿è¡Œ</p>
<div><pre><code>yarn install
yarn serve
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br></div></div><p>ç‚¹å‡» GitHub ç™»å½•</p>
<p>GetOpenIdByToken æ ¹æ®ç”Ÿæˆçš„ token å€¼ï¼Œè§£æå‡ºäº†ç”¨æˆ· id,è¿™æ ·å‰ç«¯åœ¨ login-result è¿™ä¸ªç»„ä»¶ä¸­ï¼ŒæŠŠ token ä¿å­˜å¥½ï¼Œå¹¶é‡å®šå‘è‡ªå·±çš„ä¸»é¡µï¼Œè·å–ç”¨æˆ·æ‰€æœ‰ä¿¡æ¯å³å¯ã€‚</p>
<div><pre><code>data: 18613266
status: 200
config: {url: "https://localhost:5001/GetOpenIdByToken"}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>OpenId?provider=GitHub åˆ™å¾—ä¸åˆ°æ•°æ®ï¼Œåªèƒ½æµè§ˆå™¨ç›´æ¥è¯·æ±‚ https://localhost:5001/OpenId?provider=GitHubï¼Œæ‰èƒ½åˆ° github çš„ idã€‚è¿™ä¸ªé€‚åº”äºå‰åç«¯ä¸åˆ†ç¦»ï¼Œæˆ–è€…å±äºä¹‹å‰æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ MVC ç»“æ„ï¼ŒåŒä¸€åŸŸåä¸‹ï¼ŒåŒä¸€ç«¯å£ï¼ŒåŸºäº Cookies ç™»å½•çš„åˆ¤æ–­ã€‚</p>
<h2 id="å‚è€ƒ" tabindex="-1"> å‚è€ƒ</h2>
<ul>
<li><a href="https://www.cnblogs.com/rsls/p/10522649.html" target="_blank" rel="noopener noreferrer">.net Core2.2 WebApi é€šè¿‡ OAuth2.0 å®ç°å¾®ä¿¡ç™»å½•</a></li>
<li><a href="https://blog.csdn.net/weixin_30414305/article/details/101389325" target="_blank" rel="noopener noreferrer">AspNetCore3.0 å’Œ JWT</a></li>
<li><a href="http://www.woshipm.com/pd/509712.html" target="_blank" rel="noopener noreferrer">ç”¨æˆ·ç³»ç»Ÿè®¾è®¡ï¼šç¬¬ä¸‰æ–¹æˆæƒã€è´¦å·ç»‘å®šåŠè§£ç»‘ï¼ˆä¸‹ï¼‰</a></li>
</ul>
<h2 id="demo-ç¤ºä¾‹" tabindex="-1"> Demo ç¤ºä¾‹</h2>
<ul>
<li>GitHub <a href="https://github.com/luoyunchong/dotnetcore-examples/blob/master/aspnetcore-oatuth2" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/dotnetcore-examples/blob/master/aspnetcore-oatuth2</a></li>
</ul>
]]></content>
    <category term="lin-cms-dotnetcore"/>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
  <entry>
    <title type="html">å‰ç«¯å‡†å¤‡</title>
    <id>https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/vue-start.html</id>
    <link href="https://igeekfan.cn/igeekfan-docs/dotnetcore/lin-cms/vue-start.html"/>
    <updated>2022-06-02T11:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å‰ç«¯å‡†å¤‡" tabindex="-1"> å‰ç«¯å‡†å¤‡</h1>
<h2 id="å¼€æºåœ°å€" tabindex="-1"> å¼€æºåœ°å€</h2>
<ul>
<li>ç®¡ç†ç«¯ UI <a href="https://github.com/luoyunchong/lin-cms-vue" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/lin-cms-vue</a></li>
<li>ç”¨æˆ·ç«¯ UI <a href="https://github.com/luoyunchong/lin-cms-vvlog" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/lin-cms-vvlog</a></li>
</ul>
<h2 id="åšå®¢æ¨¡å—çº¿ä¸Šåœ°å€" tabindex="-1"> åšå®¢æ¨¡å—çº¿ä¸Šåœ°å€</h2>
<ul>
<li>æœ¬é¡¹ç›® swagger åœ°å€ <a href="https://api.igeekfan.cn/swagger/index.html" target="_blank" rel="noopener noreferrer">https://api.igeekfan.cn/swagger/index.html</a></li>
<li>ç”¨æˆ·ç«¯ lin-cms-vvlog <a href="https://vvlog.baimocore.cn" target="_blank" rel="noopener noreferrer">https://vvlog.baimocore.cn</a>
<ul>
<li>æ™®é€šç”¨æˆ·ï¼š710277267@qq.com</li>
<li>å¯†ç ï¼š123qwe</li>
</ul>
</li>
<li>ç®¡ç†å‘˜ lin-cms-vue <a href="https://cms.baimocore.cn" target="_blank" rel="noopener noreferrer">https://cms.baimocore.cn/</a>
<ul>
<li>ç®¡ç†å‘˜ï¼š admin</li>
<li>å¯†ç ï¼š123qwe</li>
</ul>
</li>
</ul>
<h2 id="å¿«é€Ÿä¸Šæ‰‹" tabindex="-1"> å¿«é€Ÿä¸Šæ‰‹</h2>
<p>å¼€å‘å¿…å¤‡</p>
<ul>
<li><a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">Node.js 10+</a> ç‰ˆæœ¬å³å¯ï¼Œæˆ‘é¡»å®‰è£… 12.7</li>
<li><a href="https://yarnpkg.com/zh-Hant/docs/install#windows-stable" target="_blank" rel="noopener noreferrer">yarn</a></li>
</ul>
<p>å¦‚æœä»¥ä¸‹å‘½ä»¤æœ‰é—®é¢˜ï¼Œè¯·åˆ é™¤ yarn.lockï¼Œnode_modules æ–‡ä»¶å¤¹åï¼Œé‡æ–°æ‰§è¡Œ yarnï¼Œyarn serve</p>
<div><pre><code># clone the project
git clone https://github.com/luoyunchong/lin-cms-vue.git

# install dependency
yarn

# develop
yarn serve

# deploy
yarn deploy
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h2 id="deploy-å‘å¸ƒ" tabindex="-1"> deploy å‘å¸ƒ</h2>
<p>scp2 æ–¹ä¾¿å¿«é€Ÿå‘å¸ƒï¼Œä¸€è¡Œå‘½ä»¤å°±èƒ½å¿«é€Ÿå‘å¸ƒæˆåŠŸã€‚</p>
<p>å¿…å¤‡æ¡ä»¶ï¼šï¼ˆå‚æ•°ï¼‰</p>
<ul>
<li>ä¸€å° linux çš„æœåŠ¡å™¨ï¼Œip</li>
<li>ç”¨æˆ·å</li>
<li>å¯†ç </li>
<li>ç«¯å£ï¼šé»˜è®¤æ˜¯ 22</li>
<li>å‘å¸ƒçš„åœ°å€ã€‚è¿™é‡Œæ”¾åˆ°/var/www/lin-cms-vue ç›®å½•ä¸­ã€‚</li>
</ul>
<h2 id="æ­¥éª¤" tabindex="-1"> æ­¥éª¤</h2>
<p>æ ¹ç›®å½•æ–°å»º deploy ç›®å½•ï¼Œåˆ›å»º index.js æ–‡ä»¶ã€‚</p>
<div><pre><code>'use strict'
// å¼•å…¥scp2æ¨¡å—
var client = require('scp2');
const ora = require('ora')
const chalk = require('chalk')
const spinner = ora('æ­£åœ¨å‘å¸ƒåˆ°ç”Ÿäº§æœåŠ¡å™¨...')
spinner.start()
client.scp('dist/', {
    "host": "",
    "username": "",
    "password": "",
    "port": "22",
    "path": "/var/www/lin-cms-vue"
}, function (err) {
    spinner.stop()
    if (!err) {
        console.log("npm run build-scp2: scp2å·¥å…·ä¸Šä¼ å®Œæ¯•,è¿œç«¯æœåŠ¡è·¯å¾„ï¼š/var/www/lin-cms-vue")
    } else {
        console.log("err", err)
    }
})
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><p>å¿«é€Ÿå‘å¸ƒï¼Œéœ€è¦å®‰è£… scp2</p>
<div><pre><code>cnpm install scp2
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><p>package.json ä¸­å¢åŠ </p>
<div><pre><code>  "scripts": {
    "deploy": "yarn build:production &amp;&amp; node ./deploy",
}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br></div></div><div><pre><code>yarn deploy
</code></pre><div aria-hidden="true"><span>1</span><br></div></div><h2 id="nginx-é…ç½®" tabindex="-1"> nginx é…ç½®</h2>
<ul>
<li>vue ä½¿ç”¨ history çš„é…ç½®</li>
</ul>
<div><pre><code>server {
    listen 8080;
    root /var/www/lin-cms-vue;

   charset utf-8;
   location / {
       try_files $uri $uri/ /index.html;

     }

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   html;
    }

}
</code></pre><div aria-hidden="true"><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br></div></div><h2 id="é…ç½®é¡¹" tabindex="-1"> é…ç½®é¡¹</h2>
<ol>
<li>
<p>é…ç½® api åœ°å€ï¼š æ‰“å¼€é…ç½®æ–‡ä»¶ src/config/index.js é…ç½® baseUrl ï¼Œæœ¬åœ°å¼€å‘é˜¶æ®µé…ç½®æœ¬åœ°è™šæ‹ŸåŸŸå(https://localhost:5001/)ï¼Œçº¿ä¸Šéƒ¨ç½²ç”Ÿäº§åŸŸåã€‚</p>
</li>
<li>
<p>ç”¨æˆ·åï¼š<strong>admin</strong> å¯†ç  <strong>123qwe</strong></p>
</li>
</ol>
]]></content>
    <published>2020-02-28T11:10:31.000Z</published>
  </entry>
</feed>