import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,b as e,o as n}from"./app-CAdyq2UH.js";const l="/igeekfan-docs/assets/356361-5afcd9e65421b9e5-nGzb8dJr.webp",t={};function h(k,i){return n(),a("div",null,i[0]||(i[0]=[e(`<h1 id="asp-net-core-supervisord部署至ubuntu" tabindex="-1"><a class="header-anchor" href="#asp-net-core-supervisord部署至ubuntu"><span><a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core+Supervisord部署至Ubuntu</span></a></h1><h1 id="asp-net-core-supervisord部署至ubuntu-1" tabindex="-1"><a class="header-anchor" href="#asp-net-core-supervisord部署至ubuntu-1"><span><a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core+Supervisord部署至Ubuntu</span></a></h1><p>asp.netcore中内置了kestrel,如果不通过代理工具，如IIS，Nginx,Apache，HTTP请求内容如下</p><h2 id="前提条件" tabindex="-1"><a class="header-anchor" href="#前提条件"><span>前提条件</span></a></h2><ul><li>ubuntu服务器</li><li>安装nginx</li><li><a href="http://xn--zfru1gtwfryc62q5j3c.net" target="_blank" rel="noopener noreferrer">服务器已安装.net</a> sdk 6</li><li>安装守护进程 supervisor</li></ul><h2 id="supervisor-守护进程" tabindex="-1"><a class="header-anchor" href="#supervisor-守护进程"><span>supervisor 守护进程</span></a></h2><ul><li>官网 <a href="http://supervisord.org/" target="_blank" rel="noopener noreferrer">http://supervisord.org/</a></li></ul><p>什么是守护进程</p><p>守护进程(Daemon)是一个运行在后台的特殊进程，它独立于终端，并且以周期性地执行某些任务,在linux中，由于在linux中，每个系统与用户进行交流的界面称为终端，每一个从此终端开始运行的进程都会依附于这个终端，这个终端被称为这些进程的控制终端，当控制终端被关闭的时候，相应的进程都会自动关闭。但是守护进程却能突破这种限制，它脱离于终端并且在后台运行，并且它脱离终端的目的是为了避免进程在运行的过程中的信息在任何终端中显示并且进程也不会被任何终端所产生的终端信息所打断。它从被执行的时候开始运转，直到整个系统关闭才退出。在 Linux 上有很多可以管理进程的工具，我们使用 Supervisor 来做这个事情。</p><p>为什么部署asp.netcore项目需要一个守护进程</p><p>因为asp.netcore项目部署后，服务器可能存在关机，断开终端，无法保证web程序自启动。</p><h2 id="ubuntu安装supervisor" tabindex="-1"><a class="header-anchor" href="#ubuntu安装supervisor"><span>Ubuntu安装supervisor</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> supervisor</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 安装 守护进程 supervisor</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/supervisor/conf.d/</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     # 进入配置目录 </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> devops_api.conf</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 新建 一个配置文件 ，只要以 .conf结尾即可。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置devops-api-conf" tabindex="-1"><a class="header-anchor" href="#配置devops-api-conf"><span>配置devops_api.conf</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[program:devops_api]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">command</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">dotnet</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DevOps.Api.dll</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --urls=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://*:7000&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">directory</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/home/igeekfan/code/devops_api</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">environment</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ASPNETCORE__ENVIRONMENT</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">Production</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">www-data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stopsignal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">INT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">autostart</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">autorestart</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">startsecs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stderr_logfile</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/home/igeekfan/code/devops_api/DevOps_Api.err.log</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stdout_logfile</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/home/igeekfan/code/devops_api/DevOps_Api.out.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>把linux的发布包放到了/home/igeekfan/code/devops_api目录中</p><p>有相应注释的，conf不能有注释，虽然没有任何异常，但无法启动服务。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[program:devops_api]##程序名称，终端控制时需要的标识</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">command</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">dotnet</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DevOps.Api.dll</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --urls=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://*:7000&quot;</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #要执行的命令</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">directory</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/home/igeekfan/code/devops_api</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #命令执行的目录</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">environment</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ASPNETCORE__ENVIRONMENT</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">Production</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #环境变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">www-data</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #进程执行的用户身份</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stopsignal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">INT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">autostart</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">true</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #是否自动启动</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">autorestart</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">true</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #是否自动重启</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">startsecs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #自动重启间隔</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stderr_logfile</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/home/igeekfan/code/devops_api/DevOps_Api.err.log</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #标准错误日志</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stdout_logfile</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/home/igeekfan/code/devops_api/DevOps_Api.out.log</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #标准输出日志</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="重启守护进程" tabindex="-1"><a class="header-anchor" href="#重启守护进程"><span>重启守护进程</span></a></h3><p>（重新发布后，或服务崩溃后）</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#重启守护进程</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/init.d/supervisor</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> restart</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> service</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> supervisor</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 暂停服务supervisor</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> service</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> supervisor</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> stop</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启动服务supervisor</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> service</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> supervisor</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> start</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="supervisorctl-常用的相关命令" tabindex="-1"><a class="header-anchor" href="#supervisorctl-常用的相关命令"><span>supervisorctl 常用的相关命令</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看所有任务状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> status</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 关闭所有任务 </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#重启指定应用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">application</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nam</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#停止指定应用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">application</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nam</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#启动指定应用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">application</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nam</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#重启所有应用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> all</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#停止所有应用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#启动所有应用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 修改配置文件可用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看日志</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看日志</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  /home/igeekfan/code/devops_api/DevOps_Api.err.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>查看devops_api进程</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -ef</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> devops_api</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">www-data</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    38</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    31</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 02:57</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dotnet</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /home/igeekfan/code/devops_api/DevOps.Api.dll</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --urls=http://</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">:7000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">igeekfan</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   124</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     9</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 03:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pts/0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --color=auto</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> devops_api</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="supervisor设置开机" tabindex="-1"><a class="header-anchor" href="#supervisor设置开机"><span>supervisor设置开机</span></a></h2><p>设置<code>ubuntu</code>下的supervisor开机 自启动</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/rc.local</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在exit 0 之前加入以下命令</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">/usr/local/bin/supervisord</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="supervisor-ui-管理台" tabindex="-1"><a class="header-anchor" href="#supervisor-ui-管理台"><span>Supervisor UI 管理台</span></a></h2><p>Supervisor 默认给我们提供了一个图形界面来供我们管理进程和任务，linux下需要我们手动开启</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/supervisor/supervisord.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>增加配置,我们就能直接访问localhost:7002</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[inet_http_server]</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">0.0.0.0:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">7002username</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userpassword</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">123</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果有防火墙</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --add-port=7002/tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --permanent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nginx反向代理" tabindex="-1"><a class="header-anchor" href="#nginx反向代理"><span>Nginx反向代理</span></a></h2><p>一般情况下，我们建议使用nginx进行代理</p><p><img src="`+l+`" alt="356361-5afcd9e65421b9e5.webp"></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>安装好以后，定位到 /etc/nginx/sites-available/default 文件。更改server 节点如下</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">server</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 80</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        proxy_pass</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://localhost:7000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        proxy_http_version</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1.1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Upgrade</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $http_upgrade</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Connection</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> keep-alive</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        proxy_cache_bypass</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $http_upgrade</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后重新启动 Nginx</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> service</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> reload　</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #也可以使用这条命令重新加载配置项</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>`,47)]))}const d=s(t,[["render",h],["__file","ASPNETCore-Supervisord-Ubuntu.html.vue"]]),g=JSON.parse('{"path":"/dotnetcore/examples/ASPNETCore-Supervisord-Ubuntu.html","title":"ASP.NET Core+Supervisord部署至Ubuntu","lang":"zh-CN","frontmatter":{"description":"ASP.NET Core+Supervisord部署至Ubuntu ASP.NET Core+Supervisord部署至Ubuntu asp.netcore中内置了kestrel,如果不通过代理工具，如IIS，Nginx,Apache，HTTP请求内容如下 前提条件 ubuntu服务器 安装nginx 服务器已安装.net sdk 6 安装守护进程 ...","head":[["meta",{"property":"og:url","content":"https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/ASPNETCore-Supervisord-Ubuntu.html"}],["meta",{"property":"og:site_name","content":".NET 开发者指北"}],["meta",{"property":"og:title","content":"ASP.NET Core+Supervisord部署至Ubuntu"}],["meta",{"property":"og:description","content":"ASP.NET Core+Supervisord部署至Ubuntu ASP.NET Core+Supervisord部署至Ubuntu asp.netcore中内置了kestrel,如果不通过代理工具，如IIS，Nginx,Apache，HTTP请求内容如下 前提条件 ubuntu服务器 安装nginx 服务器已安装.net sdk 6 安装守护进程 ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-01-05T14:28:28.000Z"}],["meta",{"property":"article:modified_time","content":"2024-01-05T14:28:28.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ASP.NET Core+Supervisord部署至Ubuntu\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-01-05T14:28:28.000Z\\",\\"author\\":[]}"],["link",{"rel":"alternate","type":"application/atom+xml","href":"https://igeekfan.cn/igeekfan-docs/atom.xml","title":".NET 开发者指北 Atom Feed"}],["link",{"rel":"alternate","type":"application/json","href":"https://igeekfan.cn/igeekfan-docs/feed.json","title":".NET 开发者指北 JSON Feed"}],["link",{"rel":"alternate","type":"application/rss+xml","href":"https://igeekfan.cn/igeekfan-docs/rss.xml","title":".NET 开发者指北 RSS Feed"}]]},"headers":[{"level":2,"title":"前提条件","slug":"前提条件","link":"#前提条件","children":[]},{"level":2,"title":"supervisor 守护进程","slug":"supervisor-守护进程","link":"#supervisor-守护进程","children":[]},{"level":2,"title":"Ubuntu安装supervisor","slug":"ubuntu安装supervisor","link":"#ubuntu安装supervisor","children":[]},{"level":2,"title":"配置devops_api.conf","slug":"配置devops-api-conf","link":"#配置devops-api-conf","children":[{"level":3,"title":"重启守护进程","slug":"重启守护进程","link":"#重启守护进程","children":[]}]},{"level":2,"title":"supervisorctl 常用的相关命令","slug":"supervisorctl-常用的相关命令","link":"#supervisorctl-常用的相关命令","children":[]},{"level":2,"title":"supervisor设置开机","slug":"supervisor设置开机","link":"#supervisor设置开机","children":[]},{"level":2,"title":"Supervisor UI 管理台","slug":"supervisor-ui-管理台","link":"#supervisor-ui-管理台","children":[]},{"level":2,"title":"Nginx反向代理","slug":"nginx反向代理","link":"#nginx反向代理","children":[]}],"git":{"createdTime":1704464620000,"updatedTime":1704464908000,"contributors":[{"name":"igeekfan","email":"igeekfan@foxmail.com","commits":2}]},"readingTime":{"minutes":3.42,"words":1025},"filePathRelative":"dotnetcore/examples/ASPNETCore-Supervisord-Ubuntu.md","localizedDate":"2024年1月5日","autoDesc":true}');export{d as comp,g as data};
