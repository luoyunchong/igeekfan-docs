import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,b as e,o as n}from"./app-CJ5rCfjJ.js";const t={};function l(h,s){return n(),a("div",null,s[0]||(s[0]=[e(`<h1 id="asp-net-core-systemd部署至ubuntu" tabindex="-1"><a class="header-anchor" href="#asp-net-core-systemd部署至ubuntu"><span><a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core+Systemd部署至Ubuntu</span></a></h1><h1 id="systemd部署至ubuntu" tabindex="-1"><a class="header-anchor" href="#systemd部署至ubuntu"><span>Systemd部署至Ubuntu</span></a></h1><p>本指南介绍如何在 Ubuntu 16.04 服务器上设置生产就绪 <a href="http://asp.net/" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core 环境。 这些说明可能适用于较新版本的 Ubunt</p><blockquote><p>对于 Ubuntu 14.04，建议使用 supervisord 作为监视 Kestrel 进程的解决方案。 systemd 不适用于 Ubuntu 14.04。</p></blockquote><p>有关 Ubuntu 14.04 的说明，请参阅<a href="https://github.com/dotnet/AspNetCore.Docs/blob/e9c1419175c4dd7e152df3746ba1df5935aaafd5/aspnetcore/publishing/linuxproduction.md" target="_blank" rel="noopener noreferrer">本主题的以前版本</a>。</p><h2 id="下载源码" tabindex="-1"><a class="header-anchor" href="#下载源码"><span>下载源码</span></a></h2><p>部署devops/Devops.Api.csproj，打包，将所有文件上传至linux的 <code>/var/www/devops_api</code> 目录中</p><p><a href="https://github.com/luoyunchong/devops" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/devops</a></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> e:/code:/devops/DevOps.Api</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dotnet</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> publish</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --configuration</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Release</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="systemd" tabindex="-1"><a class="header-anchor" href="#systemd"><span>Systemd</span></a></h2><p>服务器设置为将对 <code>http://&lt;serveraddress&gt;:80</code> 发起的请求转发到在 <code>http://127.0.0.1:5000</code> 中的 Kestrel 上运行的 <a href="http://asp.net/" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core 应用。 但是，未将 Nginx 设置为管理 Kestrel 进程。 <code>systemd</code> 可用于创建服务文件以启动和监视基础 Web 应用。 <code>systemd</code> 是一个初始系统，可以提供启动、停止和管理进程的许多强大的功能。</p><p>创建服务定义文件：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/systemd/system/kestrel-devops-api.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>下示例是应用的一个 <code>.ini</code> 服务文件：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Description</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">Example</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> .NET</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Web</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> API</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> App</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> running</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Ubuntu</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">After</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">network.target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">WorkingDirectory</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/var/www/devops_api</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ExecStart</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/usr/bin/dotnet</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> /var/www/devops_api/DevOps.Api.dll</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --urls=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://*:7000&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Restart</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">always</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Restart service after 10 seconds if the dotnet service crashes:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">RestartSec</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">10</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">KillSignal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">SIGINT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">SyslogIdentifier</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">devops-api</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">User</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">www-data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Environment</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ASPNETCORE_ENVIRONMENT</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">Production</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Environment</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">DOTNET_PRINT_TELEMETRY_MESSAGE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">WantedBy</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">multi-user.target</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在前面的示例中，管理服务的用户由 <code>User</code> 选项指定。 用户 (<code>www-data</code>) 必须存在并且拥有正确应用文件的所有权。</p><p>使用 <code>TimeoutStopSec</code> 配置在收到初始中断信号后等待应用程序关闭的持续时间。 如果应用程序在此时间段内未关闭，则将发出 SIGKILL 以终止该应用程序。 提供作为无单位秒数的值（例如，<code>150</code>）、时间跨度值（例如，<code>2min 30s</code>）或 <code>infinity</code> 以禁用超时。 <code>TimeoutStopSec</code> 默认为管理器配置文件 (<code>systemd-system.conf</code>, <code>system.conf.d</code>, <code>systemd-user.conf</code>, <code>user.conf.d</code>) 中 <code>DefaultTimeoutStopSec</code> 的值。 大多数分发版的默认超时时间为 90 秒。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># The default value is 90 seconds for most distributions.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">TimeoutStopSec</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">90</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Linux 具有区分大小写的文件系统。 将 <code>ASPNETCORE_ENVIRONMENT</code> 设置为 <code>Production</code> 时，将搜索配置文件 <code>appsettings.Production.json</code>，而不搜索 <code>appsettings.production.json</code>。</p><p>必须转义某些值（例如，SQL 连接字符串）以供配置提供程序读取环境变量。 使用以下命令生成适当的转义值以供在配置文件中使用：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">systemd-escape</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&lt;value-to-escape&gt;&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>环境变量名不支持冒号 (<code>:</code>) 分隔符。 使用双下划线 (<code>__</code>) 代替冒号。 环境变量读入配置时，<a href="https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/configuration/?view=aspnetcore-6.0#environment-variables" target="_blank" rel="noopener noreferrer">环境变量配置提供程序</a>将双下划线转换为冒号。 以下示例中，连接字符串密钥 <code>ConnectionStrings:DefaultConnection</code> 以 <code>ConnectionStrings__DefaultConnection</code> 形式设置到服务定义文件中：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Environment</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ConnectionStrings__DefaultConnection</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Connection</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> String}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>After=network.target</code> 是systemd服务单元文件中的一个设置，它指定了服务单元应该在哪个系统目标（target）之后启动。在这种情况下，<code>network.target</code> 指的是网络服务的启动。这个设置确保了在网络服务启动之后，才会启动你的服务单元。这是因为在某些情况下，你的服务可能需要依赖于网络服务。这个设置可以确保你的服务在网络服务可用时启动，避免了启动服务时出现问题的可能性。</p><p>保存该文件并启用该服务。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kestrel-devops-api.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>启用该服务，并确认它正在运行</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kestrel-devops-api.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kestrel-devops-api.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kestrel-devops-api.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">●</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kestrel-devops-api.service</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Example</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .NET</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Web</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> API</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> App</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> running</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Ubuntu</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">     Loaded:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> loaded</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (/etc/systemd/system/kestrel-devops-api.service; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">vendor</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> preset:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">     Active:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> active</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (running) since Sun 2022-06-12 01:41:00 CST; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2min</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 2s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   Main</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PID:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2395006</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (dotnet)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      Tasks:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (limit: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4612</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">     Memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 26.8M</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">     CGroup:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /system.slice/kestrel-devops-api.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">             └─2395006</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/bin/dotnet</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /var/www/devops_api/DevOps.Api.dll</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --urls=http://</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">:7000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 01:41:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> hecs-x-large-2-linux-20200616150407</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dotnet-example[2395006]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> info:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Microsoft.Hosting.Lifetime[14]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 01:41:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> hecs-x-large-2-linux-20200616150407</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dotnet-example[2395006]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       Now</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> listening</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> on:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://[::]:7000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 01:41:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> hecs-x-large-2-linux-20200616150407</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dotnet-example[2395006]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> info:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Microsoft.Hosting.Lifetime[0]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 01:41:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> hecs-x-large-2-linux-20200616150407</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dotnet-example[2395006]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       Application</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> started.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Press</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Ctrl+C</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> shut</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> down.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 01:41:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> hecs-x-large-2-linux-20200616150407</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dotnet-example[2395006]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> info:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Microsoft.Hosting.Lifetime[0]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 01:41:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> hecs-x-large-2-linux-20200616150407</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dotnet-example[2395006]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       Hosting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> environment:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Production</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 01:41:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> hecs-x-large-2-linux-20200616150407</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dotnet-example[2395006]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> info:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Microsoft.Hosting.Lifetime[0]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 01:41:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> hecs-x-large-2-linux-20200616150407</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dotnet-example[2395006]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       Content</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> path:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /var/www/devops_api/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 01:41:12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> hecs-x-large-2-linux-20200616150407</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dotnet-example[2395006]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> warn:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Microsoft.AspNetCore.HttpsPolicy.HttpsRedirectionMiddleware[3]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Jun</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 01:41:12</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> hecs-x-large-2-linux-20200616150407</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dotnet-example[2395006]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       Failed</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> determine</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> port</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> redirect.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="查看日志" tabindex="-1"><a class="header-anchor" href="#查看日志"><span>查看日志</span></a></h2><p>使用 Kestrel 的 Web 应用是通过 <code>systemd</code> 进行管理的，因此所有事件和进程都被记录到集中日志。 但是，此日志包含由 <code>systemd</code> 管理的所有服务和进程的全部条目。 若要查看特定于 <code>kestrel-helloapp.service</code> 的项，请使用以下命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -fu</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kestrel-devops-api.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>有关进一步筛选，使用时间选项（如 <code>--since today</code>、<code>--until 1 hour ago</code>）或这些选项的组合可以减少返回的条目数。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -fu</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kestrel-devops-api.service</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --since</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;2016-10-18&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --until</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;2016-10-18 04:00&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><a href="https://docs.microsoft.com/zh-cn/aspnet/core/host-and-deploy/linux-nginx?view=aspnetcore-6.0" target="_blank" rel="noopener noreferrer">使用 Nginx 在 Linux 上托管 ASP.NET Core | Microsoft Docs</a></p><p><a href="https://github.com/luoyunchong/devops" target="_blank" rel="noopener noreferrer">https://github.com/luoyunchong/devops</a></p>`,36)]))}const d=i(t,[["render",l],["__file","ASPNETCore-Systemd-Ubuntu.html.vue"]]),r=JSON.parse('{"path":"/dotnetcore/examples/ASPNETCore-Systemd-Ubuntu.html","title":"ASP.NET Core+Systemd部署至Ubuntu","lang":"zh-CN","frontmatter":{"description":"ASP.NET Core+Systemd部署至Ubuntu Systemd部署至Ubuntu 本指南介绍如何在 Ubuntu 16.04 服务器上设置生产就绪 ASP.NET Core 环境。 这些说明可能适用于较新版本的 Ubunt 对于 Ubuntu 14.04，建议使用 supervisord 作为监视 Kestrel 进程的解决方案。 syst...","head":[["meta",{"property":"og:url","content":"https://igeekfan.cn/igeekfan-docs/dotnetcore/examples/ASPNETCore-Systemd-Ubuntu.html"}],["meta",{"property":"og:site_name","content":".NET 开发者指北"}],["meta",{"property":"og:title","content":"ASP.NET Core+Systemd部署至Ubuntu"}],["meta",{"property":"og:description","content":"ASP.NET Core+Systemd部署至Ubuntu Systemd部署至Ubuntu 本指南介绍如何在 Ubuntu 16.04 服务器上设置生产就绪 ASP.NET Core 环境。 这些说明可能适用于较新版本的 Ubunt 对于 Ubuntu 14.04，建议使用 supervisord 作为监视 Kestrel 进程的解决方案。 syst..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-01-05T14:23:40.000Z"}],["meta",{"property":"article:modified_time","content":"2024-01-05T14:23:40.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ASP.NET Core+Systemd部署至Ubuntu\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-01-05T14:23:40.000Z\\",\\"author\\":[]}"],["link",{"rel":"alternate","type":"application/atom+xml","href":"https://igeekfan.cn/igeekfan-docs/atom.xml","title":".NET 开发者指北 Atom Feed"}],["link",{"rel":"alternate","type":"application/json","href":"https://igeekfan.cn/igeekfan-docs/feed.json","title":".NET 开发者指北 JSON Feed"}],["link",{"rel":"alternate","type":"application/rss+xml","href":"https://igeekfan.cn/igeekfan-docs/rss.xml","title":".NET 开发者指北 RSS Feed"}]]},"headers":[{"level":2,"title":"下载源码","slug":"下载源码","link":"#下载源码","children":[]},{"level":2,"title":"Systemd","slug":"systemd","link":"#systemd","children":[]},{"level":2,"title":"查看日志","slug":"查看日志","link":"#查看日志","children":[]}],"git":{"createdTime":1704464620000,"updatedTime":1704464620000,"contributors":[{"name":"igeekfan","email":"igeekfan@foxmail.com","commits":1}]},"readingTime":{"minutes":4.29,"words":1286},"filePathRelative":"dotnetcore/examples/ASPNETCore-Systemd-Ubuntu.md","localizedDate":"2024年1月5日","autoDesc":true}');export{d as comp,r as data};
