(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{687:function(s,a,n){"use strict";n.r(a);var t=n(10),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"全局敏感词处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#全局敏感词处理"}},[s._v("#")]),s._v(" 全局敏感词处理")]),s._v(" "),n("p",[s._v("基于ToolGood.Words类库，配合敏感字的文本文件，写的API接口。")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-stopwords",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/luoyunchong/dotnetcore-examples/tree/master/aspnetcore-stopwords"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("一共二种方式")]),s._v(" "),n("h2",{attrs:{id:"_1-toolgood-words"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-toolgood-words"}},[s._v("#")]),s._v(" 1.ToolGood.Words")]),s._v(" "),n("p",[s._v("类库配合敏感库")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/toolgood/ToolGood.Words",target:"_blank",rel:"noopener noreferrer"}},[s._v("ToolGood.Words"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("简单用法")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[Fact]\npublic void IssuesTest_17()\n{\n    var illegalWordsSearch = new IllegalWordsSearch();\n    string s = "中国|zg人|abc";\n    illegalWordsSearch.SetKeywords(s.Split(\'|\'));\n    var str = illegalWordsSearch.Replace("我是中美国人厉害中国完美ａｂｃddb好的", \'*\');\n\n    Assert.Equal("我是中美国人厉害**完美***ddb好的", str);\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("配合敏感库文本文件，写的工具类")]),s._v(" "),n("p",[s._v("二个文件放到wwwroot/_Illegal目录下，通过ReplaceStopWords方法调用即可对")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/toolgood/ToolGood.Words/blob/master/csharp/ToolGood.Words.Test/_Illegal/IllegalKeywords.txt",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/toolgood/ToolGood.Words/blob/master/csharp/ToolGood.Words.Test/_Illegal/IllegalKeywords.txt"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/toolgood/ToolGood.Words/blob/master/csharp/ToolGood.Words.Test/_Illegal/IllegalUrls.txt",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/toolgood/ToolGood.Words/blob/master/csharp/ToolGood.Words.Test/_Illegal/IllegalUrls.txt"),n("OutboundLink")],1)])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('public class ToolGoodUtils\n{\n    //敏感库只要这二个文件存在即可\n    //本地敏感库缓存-https://github.com/toolgood/ToolGood.Words/tree/master/csharp/ToolGood.Words.Test/_Illegal\n    //因为需要上传至github并同步gitee,安全起见，所以未上传至git，需要自行下载并复制\n    private const string KeywordsPath = "wwwroot/_Illegal/IllegalKeywords.txt";\n    private const string UrlsPath = "wwwroot/_Illegal/IllegalUrls.txt";\n\n    private const string InfoPath = "wwwroot/_Illegal/IllegalInfo.txt";\n    private const string BitPath = "wwwroot/_Illegal/IllegalBit.iws";\n\n    private static IllegalWordsSearch _search;\n    /// <summary>\n    /// 本地敏感库,文件修改后，重新创建缓存Bit\n    /// </summary>\n    /// <returns></returns>\n    public static IllegalWordsSearch GetIllegalWordsSearch()\n    {\n        if (_search == null)\n        {\n            string ipath = Path.GetFullPath(InfoPath);\n            if (File.Exists(ipath) == false)\n            {\n                _search = CreateIllegalWordsSearch();\n            }\n            else\n            {\n                var texts = File.ReadAllText(ipath).Split(\'|\');\n                if (new FileInfo(Path.GetFullPath(KeywordsPath)).LastWriteTime.ToString("yyyy-MM-dd HH:mm:ss") !=\n                    texts[0] ||\n                    new FileInfo(Path.GetFullPath(UrlsPath)).LastWriteTime.ToString("yyyy-MM-dd HH:mm:ss") !=\n                    texts[1]\n                )\n                {\n                    _search = CreateIllegalWordsSearch();\n                }\n                else\n                {\n                    var s = new IllegalWordsSearch();\n                    s.Load(Path.GetFullPath(BitPath));\n                    _search = s;\n                }\n            }\n        }\n        return _search;\n    }\n\n    private static IllegalWordsSearch CreateIllegalWordsSearch()\n    {\n        string[] words1 = File.ReadAllLines(Path.GetFullPath(KeywordsPath), Encoding.UTF8);\n        string[] words2 = File.ReadAllLines(Path.GetFullPath(UrlsPath), Encoding.UTF8);\n        var words = new List<string>();\n        foreach (var item in words1)\n        {\n            words.Add(item.Trim());\n        }\n        foreach (var item in words2)\n        {\n            words.Add(item.Trim());\n        }\n\n        var search = new IllegalWordsSearch();\n        search.SetKeywords(words);\n\n        search.Save(Path.GetFullPath(BitPath));\n\n        var text = new FileInfo(Path.GetFullPath(KeywordsPath)).LastWriteTime.ToString("yyyy-MM-dd HH:mm:ss") + "|"+ new FileInfo(Path.GetFullPath(UrlsPath)).LastWriteTime.ToString("yyyy-MM-dd HH:mm:ss");\n        File.WriteAllText(Path.GetFullPath(InfoPath), text);\n\n        return search;\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br")])]),n("h2",{attrs:{id:"_2-循环使用replace"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-循环使用replace"}},[s._v("#")]),s._v(" 2. 循环使用Replace")]),s._v(" "),n("p",[s._v("方案：通过维护敏感库，循环replace\n大佬分享给我的，稍微改成了从文件中获取敏感字。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('public static class StopWords\n{\n\n    static readonly ConcurrentDictionary<string, bool> FunNlpDataSensitive = new ConcurrentDictionary<string, bool>();\n    static readonly ConcurrentDictionary<int, string> ReplaceNewValue = new ConcurrentDictionary<int, string>();\n\n    private const string KeywordsPath = "wwwroot/_Illegal/IllegalKeywords.txt";\n    private const string UrlsPath = "wwwroot/_Illegal/IllegalUrls.txt";\n\n\n    static StopWords()\n    {\n        LoadDataFromFile();\n    }\n\n    public static void LoadDataFromFile()\n    {\n        string words1 = File.ReadAllText(Path.GetFullPath(KeywordsPath), Encoding.UTF8);\n        string words2 = File.ReadAllText(Path.GetFullPath(UrlsPath), Encoding.UTF8);\n        LoadDataFromText(words1);\n        LoadDataFromText(words2);\n    }\n\n\n    public static void LoadDataFromText(string text)\n    {\n        int oldcount = FunNlpDataSensitive.Count;\n        foreach (string wd in text.Split(\'\\n\'))\n        {\n            string keykey = wd.Trim().Trim(\'\\r\', \'\\n\').Trim();\n            if (string.IsNullOrEmpty(keykey)) continue;\n            FunNlpDataSensitive.TryAdd(keykey, true);\n            if (ReplaceNewValue.ContainsKey(keykey.Length) == false)\n                ReplaceNewValue.TryAdd(keykey.Length, "".PadRight(keykey.Length, \'*\'));\n        }\n        Console.WriteLine($"敏感词加载完毕，增加数量：{FunNlpDataSensitive.Count - oldcount}");\n    }\n\n\n    /// <summary>\n    /// 替换所有敏感词为 *\n    /// </summary>\n    /// <param name="that"></param>\n    /// <returns></returns>\n    public static string ReplaceStopWords(this string that)\n    {\n        foreach (var wd in FunNlpDataSensitive.Keys)\n            that = that.Replace(wd, ReplaceNewValue.TryGetValue(wd.Length, out var tryval) ? tryval : "".PadRight(wd.Length, \'*\'));\n        return that;\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br")])]),n("h2",{attrs:{id:"freesql全局处理敏感词"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#freesql全局处理敏感词"}},[s._v("#")]),s._v(" FreeSql全局处理敏感词")]),s._v(" "),n("p",[s._v("使用FreeSql这个ORM时，全局处理string类型的值，进行敏感词处理。代码在StartUp.cs的构造函数中。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("//敏感词处理\nIllegalWordsSearch illegalWords = ToolGoodUtils.GetIllegalWordsSearch();\n\nFsql.Aop.AuditValue += (s, e) =>\n{\n    if (e.Column.CsType == typeof(string) && e.Value != null)\n    {\n        string oldVal = (string)e.Value;\n        string newVal = illegalWords.Replace(oldVal);\n        //第二种处理敏感词的方式\n        //string newVal = oldVal.ReplaceStopWords();\n        if (newVal != oldVal)\n        {\n            e.Value = newVal;\n        }\n    }\n};\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);