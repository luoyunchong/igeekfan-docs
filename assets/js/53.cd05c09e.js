(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{630:function(t,e,a){"use strict";a.r(e);var n=a(10),s=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"cap实现eventbus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cap实现eventbus"}},[t._v("#")]),t._v(" CAP实现EventBus")]),t._v(" "),a("p",[t._v("分布式事务一致性，使用的是 "),a("a",{attrs:{href:"https://github.com/dotnetcore/cap",target:"_blank",rel:"noopener noreferrer"}},[t._v("CAP"),a("OutboundLink")],1),t._v("，那么我们在什么情况下使用它呢。")]),t._v(" "),a("p",[t._v("EventBus:事件总线，是一个基于观察者模块的事件发布/订阅框架，可以将一些复杂的，重复的操作，异步的操作，交给系统去处理，当前系统直接返回成功的操作。")]),t._v(" "),a("p",[t._v("简单的说就是解耦，")]),t._v(" "),a("p",[t._v("比如用户发布文章后，需要将消息推送给关注的用户，这时候，推送会浪费许多时间，本来这个操作与当前登录的用户没有关系，用户也只关注文章发布是否成功，。后续，将推送等操作，交给另一件事件去处理，这样速度更快，屏蔽了一些细节。就类似一种消息通知，我不关心后续是什么操作，只将自己的一些状态传递过去。")]),t._v(" "),a("p",[t._v("我们先来了解一下CAP中的EventBus，主要特点是发布订阅模式，内部使用RabbitMQ实现异构系统的消息同步，通过本地消息表对信息持久化，保证由EventBus发出的消息是可靠的，即高可用。")]),t._v(" "),a("p",[t._v("如果系统启动后在log/log200xxx.txt日志错误原因，RabbitMQ")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("DotNetCore.CAP.BrokerConnectionException: Broker Unreachable\n ---\x3e RabbitMQ.Client.Exceptions.BrokerUnreachableException: None of the specified endpoints were reachable\n ---\x3e RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=530, text=\"NOT_ALLOWED - access to vhost '/admin' refused for user 'admin'\", classId=10, methodId=40, cause=\n   at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply(TimeSpan timeout)\n   at RabbitMQ.Client.Impl.ModelBase.ConnectionOpen(String virtualHost, String capabilities, Boolean insist)\n   at RabbitMQ.Client.Framing.Impl.Connection.Open(Boolean insist)\n   at RabbitMQ.Client.Framing.Impl.Connection..ctor(IConnectionFactory factory, Boolean insist, IFrameHandler frameHandler, String clientProvidedName)\n   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.Init(IFrameHandler fh)\n   at RabbitMQ.Client.Framing.Impl.AutorecoveringConnection.Init(IEndpointResolver endpoints)\n   at RabbitMQ.Client.ConnectionFactory.CreateConnection(IEndpointResolver endpointResolver, String clientProvidedName)\n   --- End of inner exception stack trace ---\n   at RabbitMQ.Client.ConnectionFactory.CreateConnection(IEndpointResolver endpointResolver, String clientProvidedName)\n   at RabbitMQ.Client.ConnectionFactory.CreateConnection(String clientProvidedName)\n   at DotNetCore.CAP.RabbitMQ.ConnectionChannelPool.<>c__DisplayClass19_0.<CreateConnection>b__1()\n   at DotNetCore.CAP.RabbitMQ.ConnectionChannelPool.GetConnection()\n   at DotNetCore.CAP.RabbitMQ.RabbitMQConsumerClient.Connect()\n   at DotNetCore.CAP.RabbitMQ.RabbitMQConsumerClientFactory.Create(String groupId)\n   --- End of inner exception stack trace ---\n   at DotNetCore.CAP.RabbitMQ.RabbitMQConsumerClientFactory.Create(String groupId)\n   at DotNetCore.CAP.Internal.ConsumerRegister.<>c__DisplayClass17_0.<Start>b__0()\n2020-04-26 15:59:54.280 +08:00 [DBG] Transport connection checking...\n2020-04-26 15:59:54.281 +08:00 [WRN] Transport connection is unhealthy, reconnection...\n2020-04-26 15:59:54.467 +08:00 [ERR] Broker Unreachable\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br")])]),a("h2",{attrs:{id:"安装下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装下载"}},[t._v("#")]),t._v(" 安装下载")]),t._v(" "),a("p",[t._v("我们就需要安装rabbitmq了后，配置好用户，密码，virtual_hosts，因为rabbimq是erlang写的，所以\n前提要安装erlang,官网下载比百度网盘还慢，也可自行去官网下载。")]),t._v(" "),a("p",[t._v("erlang 安装包 链接：https://pan.baidu.com/s/1T1_dI7iPMpEgiP8QC5tlaw\n提取码：86jm")]),t._v(" "),a("p",[t._v("rabbitmq 安装包  链接：https://pan.baidu.com/s/1wD22_gKFX2LW9oOx69rnCA\n提取码：ohea")]),t._v(" "),a("h2",{attrs:{id:"配置rabbitmq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置rabbitmq"}},[t._v("#")]),t._v(" 配置RabbitMQ")]),t._v(" "),a("blockquote",[a("p",[t._v("服务开启后，管理地址：http://localhost:15672/")])]),t._v(" "),a("ul",[a("li",[t._v("帐号：guest 密码 : guest")])]),t._v(" "),a("p",[t._v("如果遇到RabbitmMQ安装后，web管理端口http://localhost:15672/ 无法访问的解决")]),t._v(" "),a("p",[t._v("先进入rabbitMQ安装目录下的sbin目录,在目录下shift+右键打开命令行")]),t._v(" "),a("p",[t._v("使用rabbitmq-plugins.bat enable rabbitmq_management开启网页管理界面,然后重启rabbitMQ")]),t._v(" "),a("p",[t._v("1."),a("a",{attrs:{href:"https://blog.csdn.net/sxf359/article/details/78239382",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.csdn.net/sxf359/article/details/78239382"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("2."),a("img",{attrs:{src:"https://note.youdao.com/yws/api/personal/file/7FA20220D5454DF9B0788B33E3A41FED?method=download&shareKey=c2e5f279b574304e3bd777a75a4e3045",alt:"示例"}})]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("此命令执行要先定位到rabbitmq的安装目录下的sbin文件夹下。")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" rabbitmq-plugins enable rabbitmq_management\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h2",{attrs:{id:"docker下安装rabbitmq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker下安装rabbitmq"}},[t._v("#")]),t._v(" docker下安装rabbitmq")]),t._v(" "),a("p",[t._v("通过docker来安装rabbitmq,并启动\n1.拉取镜像")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull rabbitmq:3.7.7-management\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("2.创建和启动容器")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker run -d --name rabbitmq3.7.7 -p 5672:5672 -p 15672:15672 -v `pwd`/data:/var/lib/rabbitmq --hostname myRabbit -e RABBITMQ_DEFAULT_VHOST=my_vhost  -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin df80af9ca0c9\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("说明：")]),t._v(" "),a("p",[t._v("-d 后台运行容器；")]),t._v(" "),a("p",[t._v("--name 指定容器名；")]),t._v(" "),a("p",[t._v("-p 指定服务运行的端口（5672：应用访问端口；15672：控制台Web端口号）；")]),t._v(" "),a("p",[t._v("-v 映射目录或文件；")]),t._v(" "),a("p",[t._v("--hostname  主机名（RabbitMQ的一个重要注意事项是它根据所谓的 “节点名称” 存储数据，默认为主机名）；")]),t._v(" "),a("p",[t._v("-e 指定环境变量；（RABBITMQ_DEFAULT_VHOST：默认虚拟机名；RABBITMQ_DEFAULT_USER：默认的用户名；RABBITMQ_DEFAULT_PASS：默认用户名的密码）")]),t._v(" "),a("p",[t._v("其他，可查看正在运行的容器")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker ps \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("打开浏览器，进入web管理端:http://Server-IP:15672，用户名密码都是admin")]),t._v(" "),a("h2",{attrs:{id:"开发配置项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发配置项"}},[t._v("#")]),t._v(" 开发配置项")]),t._v(" "),a("p",[t._v("lin-cms-dotnetcore 中 appsettings.json中配置如下，默认guest,不太安全，所以需要我们稍微学习一下rabbitmq的工具的使用。")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(' "RabbitMQ": {\n    "HostName": "localhost",\n    "UserName": "admin",\n    "Password": "123456",\n    "Port": 5672,\n    "VirtualHost": "/admin"\n  }\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("ol",[a("li",[a("p",[t._v("新增一个admin用户，配置这个账号的密码是123455(好像也不安全)，配置tag,这里我们选择management\n"),a("img",{attrs:{src:"https://pic.downk.cc/item/5ea54319c2a9a83be5d27c56.png",alt:""}})])]),t._v(" "),a("li",[a("p",[t._v("新建一个virtual hosts，啥意思就不BB了。\n"),a("img",{attrs:{src:"https://pic.downk.cc/item/5ea54392c2a9a83be5d2f596.png",alt:""}})])])]),t._v(" "),a("p",[t._v("3.给admin这个用户配置virtual hosts")]),t._v(" "),a("p",[t._v("先选择第一个图中的admin用户。\n"),a("img",{attrs:{src:"https://pic.downk.cc/item/5ea5446ac2a9a83be5d3ab26.jpg",alt:""}})]),t._v(" "),a("p",[t._v("然后set permission选择virtual hosts /admin 点击set permission，万事大吉\n"),a("img",{attrs:{src:"https://pic.downk.cc/item/5ea5449bc2a9a83be5d3d674.jpg",alt:""}})]),t._v(" "),a("p",[t._v("重新启动项目，日志不会显示错误。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://pic.downk.cc/item/5ea545d8c2a9a83be5d4e4e4.jpg",alt:""}})])])}),[],!1,null,null,null);e.default=s.exports}}]);