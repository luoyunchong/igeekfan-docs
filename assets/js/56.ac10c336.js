(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{635:function(n,s,t){"use strict";t.r(s);var e=t(10),a=Object(e.a)({},(function(){var n=this,s=n.$createElement,t=n._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("p",[n._v("ä½¿ç”¨SPA+.NET Core3.1å®ç° GitHubç¬¬ä¸‰æ–¹æˆæƒç™»å½• ç±»ä¼¼ä½¿ç”¨AspNet.Security.OAuth.GitHubï¼Œå‰ç«¯ä½¿ç”¨å¦‚ä¸‹ï¼šVUE+Vue-Router+axios")]),n._v(" "),t("h2",{attrs:{id:"aspnet-security-oauth-github"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#aspnet-security-oauth-github"}},[n._v("#")]),n._v(" AspNet.Security.OAuth.GitHub")]),n._v(" "),t("ul",[t("li",[n._v("GitHub "),t("a",{attrs:{href:"https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers"),t("OutboundLink")],1)])]),n._v(" "),t("h2",{attrs:{id:"githubæˆæƒç™»å½•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#githubæˆæƒç™»å½•"}},[n._v("#")]),n._v(" GitHubæˆæƒç™»å½•")]),n._v(" "),t("p",[n._v("ä»€ä¹ˆé…ç½®çš„è¿‡ç¨‹ä¸è¯´äº†ã€‚ã€‚æœ‰ä¸€æ¨ã€‚")]),n._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.jianshu.com/p/78d186aeb526",target:"_blank",rel:"noopener noreferrer"}},[n._v("GitHub ç¬¬ä¸‰æ–¹ç™»å½•"),t("OutboundLink")],1)]),n._v(" "),t("li",[t("a",{attrs:{href:"https://juejin.im/post/5dfb04cee51d45583a66c2f3",target:"_blank",rel:"noopener noreferrer"}},[n._v("ç»™ä½ çš„ç½‘ç«™æ·»åŠ ç¬¬ä¸‰æ–¹ç™»å½•ä»¥åŠçŸ­ä¿¡éªŒè¯åŠŸèƒ½"),t("OutboundLink")],1)])]),n._v(" "),t("p",[n._v("ä¸‹é¢ä¸ºç¤ºä¾‹")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("client_id:0be6b05fc717bfc4fb67\nclient_secret:dcaced9f176afba64e89d88b9b06ffc4a887a609\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br")])]),t("p",[n._v("Get")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("https://github.com/login/oauth/authorize?client_id=0be6b05fc717bfc4fb67&redirect_uri=https://localhost:5001/signin-github\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br")])]),t("p",[n._v("ä¼šé‡å®šå‘åˆ°")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://localhost:5001/signin-github?code=07537a84d12bbae08361",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://localhost:5001/signin-github?code=07537a84d12bbae08361"),t("OutboundLink")],1)]),n._v(" "),t("p",[n._v("è¿™ä¸ªcodeæ”¾åˆ°ä¸‹é¢çš„è¯·æ±‚ä¸­ï¼Œè·å–access_token\nPOSTæ–¹å¼ï¼ˆPostManå»è¯·æ±‚ï¼‰")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("https://github.com/login/oauth/access_token?client_id=0be6b05fc717bfc4fb67&client_secret=dcaced9f176afba64e89d88b9b06ffc4a887a609&code=07537a84d12bbae08361\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br")])]),t("p",[n._v("Getæ–¹å¼")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("https://api.github.com/user?access_token=787506afa3271d077b98f18af56d7cfdc8db43b4\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br")])]),t("p",[n._v("ç„¶åå°±èƒ½è·å–ç”¨æˆ·ä¿¡æ¯")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('{\n   "login": "luoyunchong",\n   "id": 18613266,\n   "node_id": "MDQ6VXNlcjE4NjEzMjY2",\n   "avatar_url": "https://avatars1.githubusercontent.com/u/18613266?v=4",\n   "gravatar_id": "",\n   "url": "https://api.github.com/users/luoyunchong",\n   "html_url": "https://github.com/luoyunchong",\n   "followers_url": "https://api.github.com/users/luoyunchong/followers",\n   "following_url": "https://api.github.com/users/luoyunchong/following{/other_user}",\n   "gists_url": "https://api.github.com/users/luoyunchong/gists{/gist_id}",\n   "starred_url": "https://api.github.com/users/luoyunchong/starred{/owner}{/repo}",\n   "subscriptions_url": "https://api.github.com/users/luoyunchong/subscriptions",\n   "organizations_url": "https://api.github.com/users/luoyunchong/orgs",\n   "repos_url": "https://api.github.com/users/luoyunchong/repos",\n   "events_url": "https://api.github.com/users/luoyunchong/events{/privacy}",\n   "received_events_url": "https://api.github.com/users/luoyunchong/received_events",\n   "type": "User",\n   "site_admin": false,\n   "name": "IGeekFan",\n   "company": null,\n   "blog": "https://blog.igeekfan.cn",\n   "location": null,\n   "email": "luoyunchong@foxmail.com",\n   "hireable": null,\n   "bio": "å­¦ä¹ ä¹‹è·¯æ¼«æ¼«æ— æœŸã€‚",\n   "public_repos": 14,\n   "public_gists": 0,\n   "followers": 16,\n   "following": 11,\n   "created_at": "2016-04-22T10:33:44Z",\n   "updated_at": "2019-12-21T14:49:33Z"\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br")])]),t("h2",{attrs:{id:"net-core3-1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#net-core3-1"}},[n._v("#")]),n._v(" .NET Core3.1")]),n._v(" "),t("p",[n._v("ä»¥ä¸‹ä»£ç ä¸ºä¸»è¦ä»£ç ï¼Œå®Œæ•´ä»£ç çœ‹ä¸‹é¢çš„DEMOé“¾æ¥ã€‚")]),n._v(" "),t("p",[n._v("ä½¿ç”¨WebApiæ—¶ï¼Œçœ‹äº†ä¸€äº›é¡¹ç›®ï¼Œå…¨æ˜¯åŸºäºMVCç»“æ„çš„ï¼Œéƒ½ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚çœ‹äº†ä¸€äº›åšå®¢ä¸Šé¢ä»‹ç» ,æ­¥éª¤éƒ½æ˜¯åƒç¯‡ä¸€å¾‹ï¼Œéƒ½æ˜¯é…åˆå‰åç«¯åˆ†ç¦»çš„ã€‚")]),n._v(" "),t("ul",[t("li",[n._v("å‰ç«¯è¿è¡Œåœ¨:http://localhost:8081")]),n._v(" "),t("li",[n._v("åç«¯è¿è¡Œåœ¨:https://localhost:5001")])]),n._v(" "),t("h3",{attrs:{id:"å‰åç«¯åˆ†ç¦»çš„spa-é…åˆç¬¬ä¸‰æ–¹æˆæƒç™»å½•æµç¨‹å¦‚ä¸‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‰åç«¯åˆ†ç¦»çš„spa-é…åˆç¬¬ä¸‰æ–¹æˆæƒç™»å½•æµç¨‹å¦‚ä¸‹"}},[n._v("#")]),n._v(" å‰åç«¯åˆ†ç¦»çš„SPA é…åˆç¬¬ä¸‰æ–¹æˆæƒç™»å½•æµç¨‹å¦‚ä¸‹")]),n._v(" "),t("p",[n._v("æœ¬åœ°æµ‹è¯•æ—¶ï¼ŒgitHubå›è°ƒåœ°å€è®¾ç½® http(s)ğŸ˜•/ip:ç«¯å£/signin-github")]),n._v(" "),t("ul",[t("li",[n._v("å¦‚: https://localhost:5001/signin-githubã€‚")])]),n._v(" "),t("h4",{attrs:{id:"_1-ä¸Šé¢è¿™ä¸ªæ˜æ˜å¡«å†™çš„åç«¯çš„åœ°å€-é‚£åç«¯æ€ä¹ˆæŠŠç»“æœé€šçŸ¥å‰ç«¯å‘¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ä¸Šé¢è¿™ä¸ªæ˜æ˜å¡«å†™çš„åç«¯çš„åœ°å€-é‚£åç«¯æ€ä¹ˆæŠŠç»“æœé€šçŸ¥å‰ç«¯å‘¢"}},[n._v("#")]),n._v(" 1. ä¸Šé¢è¿™ä¸ªæ˜æ˜å¡«å†™çš„åç«¯çš„åœ°å€ï¼Œé‚£åç«¯æ€ä¹ˆæŠŠç»“æœé€šçŸ¥å‰ç«¯å‘¢ï¼Ÿ")]),n._v(" "),t("p",[n._v("å‰ç«¯è¯·æ±‚"),t("strong",[n._v("https://localhost:5001/signin?provider=GitHub&redirectUrl=http://localhost:8080/login-result")])]),n._v(" "),t("ul",[t("li",[n._v("æä¾›å‚æ•°providerä¸ºGitHubï¼Œ")]),n._v(" "),t("li",[n._v("redirectUrlä¸ºGitHubæˆæƒç™»å½•åï¼Œå›è°ƒsignin-githubåï¼Œåç«¯å†å»é‡å®šå‘çš„åœ°å€ï¼Œè¿™é‡Œå¡«å‰ç«¯çš„ä¸€ä¸ªè·¯ç”±ã€‚")])]),n._v(" "),t("h4",{attrs:{id:"_2-åç«¯åªæä¾›äº†signin-signin-callbackè·¯ç”±-æ²¡æœ‰signin-github-é‚£githubä¸Šé…ç½®çš„è·¯ç”±æ˜¯æ€ä¹ˆå›è°ƒå›æ¥å‘¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-åç«¯åªæä¾›äº†signin-signin-callbackè·¯ç”±-æ²¡æœ‰signin-github-é‚£githubä¸Šé…ç½®çš„è·¯ç”±æ˜¯æ€ä¹ˆå›è°ƒå›æ¥å‘¢"}},[n._v("#")]),n._v(" 2. åç«¯åªæä¾›äº†signinï¼Œsignin-callbackè·¯ç”±ï¼Œæ²¡æœ‰signin-githubï¼Œé‚£githubä¸Šé…ç½®çš„è·¯ç”±æ˜¯æ€ä¹ˆå›è°ƒå›æ¥å‘¢ï¼Ÿ")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/aspnet/core/security/authentication/social/google-logins?view=aspnetcore-3.1",target:"_blank",rel:"noopener noreferrer"}},[n._v("google-ç™»å½•ï¼Œå¾®è½¯æ–‡æ¡£"),t("OutboundLink")],1),n._v("ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª"),t("strong",[n._v("æ›´æ”¹é»˜è®¤å›è°ƒ URI")]),n._v(",é€šè¿‡ AddGitHubä¸­çš„CallbackPathå±æ€§é…ç½®ã€‚")]),n._v(" "),t("p",[n._v("ä»‹ç»äº†å›è°ƒåœ°å€åº”é…ç½®signin-google,æ‰€ä»¥è¿™é‡Œåº”è¯¥æ˜¯signin-githubï¼Œä»–æ˜¯å¯ä»¥é…ç½®çš„ï¼Œä¸éœ€è¦è‡ªå·±å†™ç¨‹åºå¤„ç†signin-googleè¿™ä¸ªè·¯ç”±ï¼Œå†…éƒ¨æœ‰ä¸­é—´ä»¶å·²ç»å¤„ç†äº†ã€‚")]),n._v(" "),t("h4",{attrs:{id:"_3-å›è°ƒåˆ°signin-githubå-åç«¯æ€ä¹ˆå¤„ç†-æ‰èƒ½è®©å‰ç«¯åˆ·æ–°ã€‚è·å–ç™»å½•åçš„ä¿¡æ¯å‘¢ã€‚"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-å›è°ƒåˆ°signin-githubå-åç«¯æ€ä¹ˆå¤„ç†-æ‰èƒ½è®©å‰ç«¯åˆ·æ–°ã€‚è·å–ç™»å½•åçš„ä¿¡æ¯å‘¢ã€‚"}},[n._v("#")]),n._v(" 3. å›è°ƒåˆ°signin-githubåï¼Œåç«¯æ€ä¹ˆå¤„ç†ï¼Œæ‰èƒ½è®©å‰ç«¯åˆ·æ–°ã€‚è·å–ç™»å½•åçš„ä¿¡æ¯å‘¢ã€‚")]),n._v(" "),t("p",[n._v("å…·ä½“ä¸Šé¢çš„æ ¹æ®codeè·å–access_tokenï¼Œæ ¹æ®access_tokenè·å–ç”¨æˆ·çš„ä¿¡æ¯çš„è¿‡ç¨‹ï¼Œè¿™äº›å¤„ç†çš„è¿‡ç¨‹ï¼Œéƒ½ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ç›´æ¥è·å–ç”¨æˆ·ä¿¡æ¯ã€‚")]),n._v(" "),t("p",[n._v("ä¸€ä¸ªæ–¹æ³•SignIn,åªè¦"),t("strong",[n._v("return Challenge(properties, provider);")]),n._v("ï¼Œ")]),n._v(" "),t("ul",[t("li",[n._v("provider ä¸º GitHubï¼Œ")]),n._v(" "),t("li",[n._v("properties  var properties = new AuthenticationProperties { RedirectUri = url };")])]),n._v(" "),t("p",[n._v("è¿™ä¸ªurlä¸ºå¦ä¸€ä¸ªè·å–ç”¨æˆ·ä¿¡æ¯çš„è·¯ç”±ï¼Œåªè¦æ‹¼æ¥å¥½åœ°å€å³å¯ã€‚")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("var authenticateResult = await _contextAccessor.HttpContext.AuthenticateAsync(provider);\nstring email = authenticateResult.Principal.FindFirst(ClaimTypes.Email)?.Value;\nstring name = authenticateResult.Principal.FindFirst(ClaimTypes.Name)?.Value;\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br")])]),t("p",[n._v("éœ€è¦æ³¨å…¥")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("private readonly IHttpContextAccessor _contextAccessor;\npublic AuthenticationController( IHttpContextAccessor contextAccessor)\n{\n    _contextAccessor = contextAccessor;\n}\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br")])]),t("h3",{attrs:{id:"ä»£ç éƒ¨ç½²-ç®€åŒ–"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä»£ç éƒ¨ç½²-ç®€åŒ–"}},[n._v("#")]),n._v(" ä»£ç éƒ¨ç½²ï¼ˆç®€åŒ–ï¼‰")]),n._v(" "),t("p",[n._v("æ‰“å¼€NuGetåŒ…ç®¡ç†,å®‰è£…åŒ…")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("Install-Package AspNet.Security.OAuth.GitHub\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br")])]),t("p",[n._v("appSettings.json")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('"Authentication": {\n    "GitHub": {\n      "ClientId": "0be6b05fc717bfc4fb67",\n      "ClientSecret": "dcaced9f176afba64e89d88b9b06ffc4a887a609"\n    }\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br")])]),t("p",[n._v("addæ‰©å±•æ–¹æ³•")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('public static class JwtConfiguration\n{\n    public static void AddJwtConfiguration(this IServiceCollection services, IConfiguration configuration)\n    {\n\n        services.AddAuthentication(opts =>\n            {\n                opts.DefaultScheme = CookieAuthenticationDefaults.AuthenticationScheme;\n                opts.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;\n            }).AddCookie(options =>\n        {\n            options.LoginPath = "/signin";\n            options.LogoutPath = "/signout";\n        }).AddGitHub(options =>\n        {\n            options.ClientId = configuration["Authentication:GitHub:ClientId"];\n            options.ClientSecret = configuration["Authentication:GitHub:ClientSecret"];\n        });\n    }\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br")])]),t("p",[n._v("é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚å¤´åƒï¼Œemailï¼Œæ˜¯æ²¡æœ‰è·å–çš„ã€‚")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('.AddGitHub(options =>\n{\n    options.ClientId = configuration["Authentication:GitHub:ClientId"];\n    options.ClientSecret = configuration["Authentication:GitHub:ClientSecret"];\n    //options.CallbackPath = new PathString("~/signin-github");//ä¸GitHubä¸Šçš„å›è°ƒåœ°å€ç›¸åŒï¼Œé»˜è®¤å³æ˜¯/signin-github\n    options.Scope.Add("user:email");\n    //authenticateResult.Principal.FindFirst(LinConsts.Claims.AvatarUrl)?.Value;  å¾—åˆ°GitHubå¤´åƒ\n    options.ClaimActions.MapJsonKey(LinConsts.Claims.AvatarUrl, "avatar_url");\n    options.ClaimActions.MapJsonKey(LinConsts.Claims.BIO, "bio");\n    options.ClaimActions.MapJsonKey(LinConsts.Claims.BlogAddress, "blog");\n});\n\n#å…¶ä¸­LinConstsç±»ä¸ºé™æ€å¸¸é‡\npublic static class LinConsts\n{\n    public static class Claims\n    {\n        public const string BIO = "urn:github:bio";\n        public const string AvatarUrl = "urn:github:avatar_url";\n        public const string BlogAddress = "urn:github:blog";\n    }\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br")])]),t("p",[n._v("startup.cs")]),n._v(" "),t("p",[n._v("ConfigureServicesä¸­é…ç½®æ­¤æœåŠ¡")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("    services.AddSingleton<IHttpContextAccessor, HttpContextAccessor>();\n    services.AddJwtConfiguration(Configuration);\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br")])]),t("p",[n._v("åˆ›å»ºAuthenticationController.cs\nå¢åŠ SignInï¼Œç”¨äºå¤„ç†ç”¨æˆ·æˆæƒæˆåŠŸåï¼Œé‡å®šå›signin-callback,å¹¶å°†å‚æ•°å¸¦å›ã€‚")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('        private readonly IHttpContextAccessor _contextAccessor;\n        private readonly IConfiguration _configuration;\n\n        public AuthenticationController(IHttpContextAccessor contextAccessor, IConfiguration configuration)\n        {\n            _contextAccessor = contextAccessor;\n            _configuration = configuration;\n        }\n        \n        [HttpGet("~/signin")]\n        public async Task<IActionResult> SignIn(string provider, string redirectUrl)\n        {\n            var request = _contextAccessor.HttpContext.Request;\n            var url =\n                $"{request.Scheme}://{request.Host}{request.PathBase}{request.Path}-callback?provider={provider}&redirectUrl={redirectUrl}";\n            var properties = new AuthenticationProperties { RedirectUri = url };\n            properties.Items["LoginProviderKey"] = provider;\n            return Challenge(properties, provider);\n\n        }\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br")])]),t("p",[n._v("åœ¨signinæ–¹æ³•ä¸­ï¼Œç”¨æˆ·ç‚¹å‡»æˆæƒåï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼Œä¼šæ ¹æ®å…¶ä¼ é€’çš„URLï¼Œé‡å®šå‘åˆ°è¿™ä¸ªåœ°å€ï¼Œsignin-callback,å‚æ•°ä¹Ÿä¼šä¸€åŒæºå¸¦ã€‚providerä¸ºGitHub,redirectUrlä¸ºï¼šhttp://localhost:8081/login-result.")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('[HttpGet("~/signin-callback")]\npublic async Task<IActionResult> Home(string provider = null, string redirectUrl = "")\n{\n    var authenticateResult = await _contextAccessor.HttpContext.AuthenticateAsync(provider);\n    if (!authenticateResult.Succeeded) return Redirect(redirectUrl);\n    var openIdClaim = authenticateResult.Principal.FindFirst(ClaimTypes.NameIdentifier);\n    if (openIdClaim == null || string.IsNullOrWhiteSpace(openIdClaim.Value))\n        return Redirect(redirectUrl);\n\n    //TODO è®°å½•æˆæƒæˆåŠŸåçš„ä¿¡æ¯ \n\n    string email = authenticateResult.Principal.FindFirst(ClaimTypes.Email)?.Value;\n    string name = authenticateResult.Principal.FindFirst(ClaimTypes.Name)?.Value;\n    string gitHubName = authenticateResult.Principal.FindFirst(GitHubAuthenticationConstants.Claims.Name)?.Value;\n    string gitHubUrl = authenticateResult.Principal.FindFirst(GitHubAuthenticationConstants.Claims.Url)?.Value;\n    //startup ä¸­ AddGitHubé…ç½®é¡¹  options.ClaimActions.MapJsonKey(LinConsts.Claims.AvatarUrl, "avatar_url");\n    string avatarUrl = authenticateResult.Principal.FindFirst(LinConsts.Claims.AvatarUrl)?.Value;\n\n    return Redirect($"{redirectUrl}?openId={openIdClaim.Value}");\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br")])]),t("p",[n._v("è¿™æ—¶å€™æˆ‘ä»¬èƒ½è·å–ç”¨æˆ·ä¿¡æ¯äº†ã€‚é‚£ä¹ˆå‰ç«¯æ€ä¹ˆåŠå‘¢ã€‚æˆ‘ä»¬å†™ä¸ªæ–¹æ³•ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œçœ‹çœ‹æ•ˆæœã€‚")]),n._v(" "),t("ul",[t("li",[n._v("æµè§ˆå™¨ç›´æ¥æ‰“å¼€èƒ½å¾—åˆ°githubçš„idã€‚")]),n._v(" "),t("li",[n._v("axios GETè¯·æ±‚ https://localhost:5001/OpenId å¾—åˆ°null")])]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('[HttpGet("~/OpenId")]\npublic async Task<string> OpenId(string provider = null)\n{\n   var authenticateResult = await _contextAccessor.HttpContext.AuthenticateAsync(provider);\n   if (!authenticateResult.Succeeded) return null;\n   var openIdClaim = authenticateResult.Principal.FindFirst(ClaimTypes.NameIdentifier);\n   return openIdClaim?.Value;\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br")])]),t("p",[n._v("æˆ‘è®°å¾—ä¹‹å‰ä¼ Tokenæ—¶ï¼Œåå°æ˜¯å¯ä»¥è¿™æ ·è·å–çš„ã€‚")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('[HttpGet("~/GetOpenIdByToken")]\npublic string GetOpenIdByToken()\n{\n    return User.FindFirst(ClaimTypes.NameIdentifier)?.Value;\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br")])]),t("p",[n._v("LoginResult.vueåœ¨createdç”Ÿå‘½å‘¨æœŸä¸­ã€‚éƒ½æ˜¯å¾—åˆ°null")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('axios({\n  methods: "get",\n  url: "https://localhost:5001/OpenId?provider=GitHub"\n})\n  .then(function(response) {\n    // handle success\n    console.log(response);\n  })\n\naxios({\n  methods: "get",\n  url: "https://localhost:5001/GetOpenIdByToken"\n})\n  .then(function(response) {\n    // handle success\n    console.log(response);\n  })\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br")])]),t("h3",{attrs:{id:"ä¸ºä»€ä¹ˆå‘¢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆå‘¢"}},[n._v("#")]),n._v(" ä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿï¼Ÿ")]),n._v(" "),t("p",[n._v("å› ä¸ºå‰åç«¯åˆ†ç¦»ï¼Œä¸æ˜¯åŸºäºCookiesçš„ã€‚httpæ˜¯æ— çŠ¶æ€çš„ã€‚æ¯æ¬¡è¯·æ±‚æ— æ³•åŒºåˆ†ç”¨æˆ·çš„ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®å½“å‰çš„ClaimsPrincipalï¼Œæ ¹æ®JWTç”Ÿæˆç›¸åº”çš„Tokenï¼Œaxiosè¯·æ±‚æ—¶ï¼Œæ”¾åˆ°headersä¸­ã€‚")]),n._v(" "),t("p",[n._v("å®‰è£…åŒ…")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("Install-Package Microsoft.AspNetCore.Authentication.JwtBearer\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br")])]),t("p",[n._v("AppSettings.jsoné…ç½®æ”¹æˆ")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('"Authentication": {\n"JwtBearer": {\n  "SecurityKey": "JWTStudyWebsite_DI20DXU3",\n  "Issuer": "JWTStudy",\n  "Audience": "JWTStudyWebsite"\n},\n"GitHub": {\n  "ClientId": "0be6b05fc717bfc4fb67",\n  "ClientSecret": "dcaced9f176afba64e89d88b9b06ffc4a887a609"\n}\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br")])]),t("p",[n._v("åœ¨signin-callbackè·¯ç”±ä¸­ï¼Œå¾—åˆ°authenticateResult.Principalï¼Œå…¶ä¸­é»˜è®¤åŒ…å«äº†(id,login,name,url)ï¼Œæˆæƒå¾—åˆ°eamilï¼Œå¦å¤–MapJsonKeyæ‰©å±•äº†ä»¥ä¸‹å­—æ®µï¼ˆavatar_urlã€bioã€blog)")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("var authenticateResult = await _contextAccessor.HttpContext.AuthenticateAsync(provider);\nstring token = this.CreateToken(authenticateResult.Principal);\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br")])]),t("p",[n._v("æ ¹æ®ClaimsPrincipalå€¼ç”Ÿæˆtokenå€¼ã€‚")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('private string CreateToken(ClaimsPrincipal claimsPrincipal)\n{\n\n    var handler = new JwtSecurityTokenHandler();\n    var key = new SymmetricSecurityKey(\n        Encoding.UTF8.GetBytes(_configuration["Authentication:JwtBearer:SecurityKey"]));\n    var credentials = new SigningCredentials(key, SecurityAlgorithms.HmacSha256);\n    var token = new JwtSecurityToken(\n        _configuration["Authentication:JwtBearer:Issuer"],\n        _configuration["Authentication:JwtBearer:Audience"],\n        claimsPrincipal.Claims,\n        expires: DateTime.Now.AddMinutes(30),\n        signingCredentials: credentials\n    );\n\n    return handler.WriteToken(token);\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br")])]),t("p",[n._v("è¿™é‡Œçš„claimsPrincipalæ˜¯ä»€ä¹ˆå‘¢ã€‚ç®€å•çš„è¯´å°±æ˜¯ä¸€ä¸ªå­˜æœ‰githubæˆæƒä¿¡æ¯çš„å¯¹è±¡ï¼Œå¯ä»¥è§£æå‡ºå¯¹åº”çš„Clamisï¼Œè¿™é‡Œå…¶å®å°±æ˜¯ç”¨äº†Clamisçš„å±æ€§å€¼ã€‚")]),n._v(" "),t("table",[t("thead",[t("tr",[t("th",[n._v("Claim")]),n._v(" "),t("th",[n._v("ClaimsIdentity")]),n._v(" "),t("th",[n._v("ClaimsPrincipal")])])]),n._v(" "),t("tbody",[t("tr",[t("td",[n._v("idã€name,url,email,avatar_urlç­‰")]),n._v(" "),t("td",[n._v("ç”±å¤šç»„Claimç»„æˆï¼Œè¿™é‡Œå¯æŒ‡GitHubæˆæƒç™»å½•åå¾—åˆ°çš„é‚£ä¸ªå¯¹è±¡ã€‚")]),n._v(" "),t("td",[n._v("ClaimsIdentityçš„æŒæœ‰è€…")])])])]),n._v(" "),t("p",[n._v("å…·ä½“Jwtçš„ç”Ÿæˆä¸é…ç½®é¡¹ã€‚è¿™é‡Œä¸è¯¦ç»†è¯´æ˜ã€‚å¯ä»¥çœ‹è¿™ä¸ªç¤ºä¾‹ï¼ˆ.NET Core2.2ï¼‰"),t("a",{attrs:{href:"https://github.com/luoyunchong/BasicTemplate",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://github.com/luoyunchong/BasicTemplate"),t("OutboundLink")],1)]),n._v(" "),t("p",[n._v("AddJwtConfigurationæ”¹æˆå¦‚ä¸‹å†…å®¹")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('public static void AddJwtConfiguration(this IServiceCollection services, IConfiguration configuration)\n{\n\n    services.AddAuthentication(opts =>\n        {\n            opts.DefaultScheme = CookieAuthenticationDefaults.AuthenticationScheme;\n            opts.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;\n        }).AddCookie(options =>\n    {\n        options.LoginPath = "/signin";\n        options.LogoutPath = "/signout";\n    }).AddJwtBearer(JwtBearerDefaults.AuthenticationScheme, options =>\n    {\n        options.Audience = configuration["Authentication:JwtBearer:Audience"];\n\n        options.TokenValidationParameters = new TokenValidationParameters\n        {\n            // The signing key must match!\n            ValidateIssuerSigningKey = true,\n            IssuerSigningKey = new SymmetricSecurityKey(\n                Encoding.ASCII.GetBytes(configuration["Authentication:JwtBearer:SecurityKey"])),\n\n            // Validate the JWT Issuer (iss) claim\n            ValidateIssuer = true,\n            ValidIssuer = configuration["Authentication:JwtBearer:Issuer"],\n\n            // Validate the JWT Audience (aud) claim\n            ValidateAudience = true,\n            ValidAudience = configuration["Authentication:JwtBearer:Audience"],\n\n            // Validate the token expiry\n            ValidateLifetime = true,\n\n            // If you want to allow a certain amount of clock drift, set that here\n            //ClockSkew = TimeSpan.Zero\n        };\n    }).AddGitHub(options =>\n    {\n        options.ClientId = configuration["Authentication:GitHub:ClientId"];\n        options.ClientSecret = configuration["Authentication:GitHub:ClientSecret"];\n        //options.CallbackPath = new PathString("~/signin-github");//ä¸GitHubä¸Šçš„å›è°ƒåœ°å€ç›¸åŒï¼Œé»˜è®¤å³æ˜¯/signin-github\n        options.Scope.Add("user:email");\n        //authenticateResult.Principal.FindFirst(LinConsts.Claims.AvatarUrl)?.Value;  å¾—åˆ°GitHubå¤´åƒ\n        options.ClaimActions.MapJsonKey(LinConsts.Claims.AvatarUrl, "avatar_url");\n        options.ClaimActions.MapJsonKey(LinConsts.Claims.BIO, "bio");\n        options.ClaimActions.MapJsonKey(LinConsts.Claims.BlogAddress, "blog");\n    });\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br"),t("span",{staticClass:"line-number"},[n._v("39")]),t("br"),t("span",{staticClass:"line-number"},[n._v("40")]),t("br"),t("span",{staticClass:"line-number"},[n._v("41")]),t("br"),t("span",{staticClass:"line-number"},[n._v("42")]),t("br"),t("span",{staticClass:"line-number"},[n._v("43")]),t("br"),t("span",{staticClass:"line-number"},[n._v("44")]),t("br"),t("span",{staticClass:"line-number"},[n._v("45")]),t("br"),t("span",{staticClass:"line-number"},[n._v("46")]),t("br"),t("span",{staticClass:"line-number"},[n._v("47")]),t("br"),t("span",{staticClass:"line-number"},[n._v("48")]),t("br")])]),t("p",[t("a",{attrs:{href:"https://github.com/luoyunchong/dotnetcore-examples/blob/master/aspnetcore-oatuth2/spa-vue-oauth2/src/components/LoginResult.vue",target:"_blank",rel:"noopener noreferrer"}},[n._v("å‰ç«¯LoginResult.vueä»£ç "),t("OutboundLink")],1)]),n._v(" "),t("p",[n._v("å‰ç«¯è¿è¡Œ")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("yarn install\nyarn serve\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br")])]),t("p",[n._v("ç‚¹å‡»GitHubç™»å½•")]),n._v(" "),t("p",[n._v("GetOpenIdByTokenæ ¹æ®ç”Ÿæˆçš„tokenå€¼ï¼Œè§£æå‡ºäº†ç”¨æˆ·id,è¿™æ ·å‰ç«¯åœ¨login-resultè¿™ä¸ªç»„ä»¶ä¸­ï¼ŒæŠŠtokenä¿å­˜å¥½ï¼Œå¹¶é‡å®šå‘è‡ªå·±çš„ä¸»é¡µï¼Œè·å–ç”¨æˆ·æ‰€æœ‰ä¿¡æ¯å³å¯ã€‚")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('data: 18613266\nstatus: 200\nconfig: {url: "https://localhost:5001/GetOpenIdByToken"}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br")])]),t("p",[n._v("OpenId?provider=GitHubåˆ™å¾—ä¸åˆ°æ•°æ®ï¼Œåªèƒ½æµè§ˆå™¨ç›´æ¥è¯·æ±‚https://localhost:5001/OpenId?provider=GitHubï¼Œæ‰èƒ½åˆ°github çš„idã€‚è¿™ä¸ªé€‚åº”äºå‰åç«¯ä¸åˆ†ç¦»ï¼Œæˆ–è€…å±äºä¹‹å‰æˆ‘ä»¬ç»å¸¸ä½¿ç”¨MVCç»“æ„ï¼ŒåŒä¸€åŸŸåä¸‹ï¼ŒåŒä¸€ç«¯å£ï¼ŒåŸºäºCookiesç™»å½•çš„åˆ¤æ–­ã€‚")]),n._v(" "),t("h2",{attrs:{id:"å‚è€ƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒ"}},[n._v("#")]),n._v(" å‚è€ƒ")]),n._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.cnblogs.com/rsls/p/10522649.html",target:"_blank",rel:"noopener noreferrer"}},[n._v(".net Core2.2 WebApié€šè¿‡OAuth2.0å®ç°å¾®ä¿¡ç™»å½•"),t("OutboundLink")],1)]),n._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/weixin_30414305/article/details/101389325",target:"_blank",rel:"noopener noreferrer"}},[n._v("AspNetCore3.0 å’Œ JWT"),t("OutboundLink")],1)]),n._v(" "),t("li",[t("a",{attrs:{href:"http://www.woshipm.com/pd/509712.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("ç”¨æˆ·ç³»ç»Ÿè®¾è®¡ï¼šç¬¬ä¸‰æ–¹æˆæƒã€è´¦å·ç»‘å®šåŠè§£ç»‘ï¼ˆä¸‹ï¼‰"),t("OutboundLink")],1)])]),n._v(" "),t("h2",{attrs:{id:"demo-ç¤ºä¾‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#demo-ç¤ºä¾‹"}},[n._v("#")]),n._v(" Demo  ç¤ºä¾‹")]),n._v(" "),t("ul",[t("li",[n._v("GitHub "),t("a",{attrs:{href:"https://github.com/luoyunchong/dotnetcore-examples/blob/master/aspnetcore-oatuth2",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://github.com/luoyunchong/dotnetcore-examples/blob/master/aspnetcore-oatuth2"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=a.exports}}]);